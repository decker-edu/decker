<!DOCTYPE html>
<html$if(lang)$ lang="$lang$"$endif$$if(dir)$ dir="$dir$"$endif$>

<head>
  <meta charset="utf-8">
  <meta name="generator" content="pandoc">
$for(author-meta)$
  <meta name="author" content="$author-meta$">
$endfor$
$if(date-meta)$
  <meta name="dcterms.date" content="$date-meta$">
$endif$
$if(keywords)$
  <meta name="keywords" content="$for(keywords)$$keywords$$sep$, $endfor$">
$endif$
$if(title)$
$if(subtitle)$
  <title>$title$: $subtitle$</title>
$else$
  <title>$title$</title>
$endif$
$endif$
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

$if(template.favicon)$
  <link rel="shortcut icon" href="$template.favicon$">
$endif$

  <!-- Default values for CSS variables can live here. They can be overridden by
  meta data values. -->
  <link rel="stylesheet" href="$decker-support-dir$/css/variables.css">

  <!-- Transfer meta data values from keys `palette.colors` and `css-variables`
  into a style sheet. Default values can come from `variables.css`. -->
  <style class="css-declarations">
    :root {
      $for(css-light-colors/pairs)$
        --light-$it.key$: $it.value$;
      $endfor$
      $for(css-dark-colors/pairs)$
        --dark-$it.key$: $it.value$;
      $endfor$
    }
    @media (prefers-color-scheme: light) {
      :root {
        $for(css-light-color-declarations)$
          $css-light-color-declarations$
        $endfor$
      }

     :root.dark {
       $for(css-dark-color-declarations)$
         $css-dark-color-declarations$
       $endfor$
     }
   }
   @media (prefers-color-scheme: dark) {
     :root {
       $for(css-dark-color-declarations)$
         $css-dark-color-declarations$
       $endfor$
     }

      :root.light {
        $for(css-light-color-declarations)$
          $css-light-color-declarations$
        $endfor$
      }
    }
    :root {
      $for(css-declarations)$
        $css-declarations$
      $endfor$
    }
  </style>

  <!-- Any CSS variables set in the CSS files below, cannot be overridden by
  meta data values. -->
  <link rel="stylesheet" href="$decker-support-dir$/components/components.css">
  <link rel="stylesheet" href="$decker-support-dir$/vendor/reveal/dist/reset.css">
  <link rel="stylesheet" href="$decker-support-dir$/vendor/reveal/dist/reveal.css">
  <link rel="stylesheet" href="$decker-support-dir$/plugins/decker/ui-anchors.css">
  <link rel="stylesheet" href="$decker-support-dir$/vendor/videojs/video-js.min.css">
  <link rel="stylesheet" href="$decker-support-dir$/css/deck.css">
  <link rel="stylesheet" href="$decker-support-dir$/plugins/whiteboard/whiteboard.css">
  <link rel="stylesheet" href="$decker-support-dir$/plugins/menu/menu.css">
  <link rel="stylesheet" href="$decker-support-dir$/plugins/feedback/feedback.css">
  <link rel="stylesheet" href="$decker-support-dir$/plugins/explain/explain.css">
  $if(live-captions)$
  <link rel="stylesheet" href="$decker-support-dir$/plugins/live-captioning/live-captioning.css">
  $endif$
  <link rel="stylesheet" href="$decker-support-dir$/plugins/examiner/examiner.css">
  <link rel="stylesheet" href="$decker-support-dir$/flyingFocus/flying-focus.css">
$if(poll)$
  <link rel="stylesheet" href="$decker-support-dir$/plugins/poll/poll.css">
$endif$
  <link rel="stylesheet" href="$decker-support-dir$/plugins/quiz-wue/quiz-wue.css">

$if(highlightjs)$
  <link rel="stylesheet" href="$decker-support-dir$/vendor/css/$highlightjs$.css">
$endif$

<!-- Syntax highlighting CSS inserted by Pandoc's built-in syntax highlighting.
-->
$if(highlighting-css)$
  <style>
$highlighting-css$
  </style>
$endif$

$for(template.css)$
  <link rel="stylesheet" href="$template.css$"/>
$endfor$

<link rel="stylesheet" href="$decker-support-dir$/css/wburg.css">

  <script type="module">
    /* Store JSON encoded Pandoc meta data in a global variable. */
    import initializeDecker from "./$decker-support-dir$/js/decker.js";
    initializeDecker("$decker-meta-url$");
  </script>

  <script src="$decker-support-dir$/vendor/videojs/video.min.js"></script>
  <script src="$decker-support-dir$/vendor/chartjs/chart.umd.js"></script>
</head>

<body class="deck">
  <div class="reveal">
    <div class="slides">

$if(title)$
$deck-title.html()$
$endif$

$if(toc)$
    <section id="$idprefix$TOC">
    $table-of-contents$
    </section>
$endif$

<!-- Keep left aligned -->
$body$

    </div>
  </div>

  <script type="module">
    // import Reveal and all plugins 
    import Reveal from './$decker-support-dir$/vendor/reveal/dist/reveal.esm.js';
    import deckerPlugin from './$decker-support-dir$/plugins/decker/decker.js';
    import uiAnchorsPlugin from './$decker-support-dir$/plugins/decker/ui-anchors.js';
    import mathPlugin from './$decker-support-dir$/plugins/math/math.js';
    import whiteboardPlugin from './$decker-support-dir$/plugins/whiteboard/whiteboard.js';
    import searchPlugin from './$decker-support-dir$/plugins/search/search.js';
    import zoomPlugin from './$decker-support-dir$/plugins/zoom/zoom.js';
    import printPlugin from './$decker-support-dir$/plugins/print/print.js';
    import jinglesPlugin from './$decker-support-dir$/plugins/jingles/jingles.js';
    import quizPlugin from './$decker-support-dir$/plugins/quiz/quiz.js';
$if(poll)$
    import pollPlugin from './$decker-support-dir$/plugins/poll/poll.js';
$endif$
    import quizWuePlugin from './$decker-support-dir$/plugins/quiz-wue/quiz-wue.js';
    import explainPlugin from './$decker-support-dir$/plugins/explain/explain.js';
    import examinerPlugin from "./$decker-support-dir$/plugins/examiner/examiner.js";
    import chartsPlugin from './$decker-support-dir$/plugins/charts/charts.js';
    import menuPlugin from './$decker-support-dir$/plugins/menu/menu.js';
    import feedbackPlugin from './$decker-support-dir$/plugins/feedback/feedback.js';
$if(highlightjs)$
    import highlightPlugin from './$decker-support-dir$/vendor/reveal/plugin/highlight/highlight.esm.js';
$endif$
    import notesPlugin from './$decker-support-dir$/vendor/reveal/plugin/notes/notes.esm.js';
$if(live-captions)$
    import captionPlugin from './$decker-support-dir$/plugins/live-captioning/live-captioning.js';
$endif$
    import a11yPlugin from './$decker-support-dir$/plugins/a11y/a11y.js';

    let revealConfig = { 
      // reveal configuration (see https://revealjs.com/config/)
      ...Decker.meta.reveal,

      // plugin configuration
      math: { mathjax: String.raw`$decker-support-dir$/vendor/mathjax/`, ...Decker.meta.math },
      chart: Decker.meta.chart,
      menu: Decker.meta.menu,
      explain: Decker.meta.explain,
      feedback: Decker.meta.feedback || Decker.meta["decker-engine"],
      jingles: Decker.meta.jingles,
      whiteboard: Decker.meta.whiteboard,
      // list of plugins
      plugins: [
         deckerPlugin,
         uiAnchorsPlugin,
         mathPlugin,
         chartsPlugin,
         whiteboardPlugin,
         searchPlugin,
         printPlugin,
         jinglesPlugin,
         quizPlugin,
         quizWuePlugin,
         explainPlugin,
         examinerPlugin,
         menuPlugin,
         feedbackPlugin,
$if(highlightjs)$
         highlightPlugin,
$endif$
         notesPlugin,
$if(live-captions)$
         captionPlugin,
$endif$
         a11yPlugin,
$if(poll)$
         pollPlugin
$endif$
      ]
    };

    Reveal.initialize(revealConfig);

   window.Reveal = Reveal;
  </script>

</body>

$if(live-captions)$
<script src="$decker-support-dir$/components/awesome-button.js"></script>
$endif$
<script type="module" src="$decker-support-dir$/components/custom-dialog.js"></script>
$for(template.js)$
  <script type="module" src="$template.js$"></script>
$endfor$

<!--  Injection of own code for reveal's highlight.js is not as trivial as it seems. A good overview
is found in this issue: https://github.com/hakimel/reveal.js/issues/2761
We are using the reveal version just before where Hakim added the necessary callback to 
allow easy addition of new languages. For some reason, the workaround by larskinn 
does not work since pandoc seems to priduce a hickup, when the necessary code definitions
are included here in the template. As a solution, the initialization of the respective code
in Reveal.initialize(revealConfig); as a promise has to be outsourced to a non-parsed script
which I still have to try. However, needs some more time. Unfortunatly this is not context free
since it also needs to set highlight: { highlightOnLoad: false }, here and then to manually scan
all code blocks and apply the plugin's highlighting code at the end which also did not work so
far maybe due to timing issues (it is executed at the wrong time during the overall process. This
comment here is just a reminder of where this was left of... -->

<!-- <script src="$decker-support-dir$/js/highlightjs-6502acme.js"></script> -->

</html>
