(()=>{"use strict";var t={d:(e,i)=>{for(var s in i)t.o(i,s)&&!t.o(e,s)&&Object.defineProperty(e,s,{enumerable:!0,get:i[s]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e),r:t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}},e={};t.r(e),t.d(e,{AbstractRegion:()=>A,DummyRegion:()=>k,HoverRegion:()=>R,LiveRegion:()=>M,SpeechRegion:()=>N,StringRegion:()=>E,ToolTip:()=>O});var i={};t.r(i),t.d(i,{AbstractExplorer:()=>P});var s={};t.r(s),t.d(s,{AbstractKeyExplorer:()=>T,Magnifier:()=>L,SpeechExplorer:()=>_});var o={};t.r(o),t.d(o,{AbstractMouseExplorer:()=>H,ContentHoverer:()=>D,FlameHoverer:()=>F,Hoverer:()=>J,ValueHoverer:()=>U});var r={};t.r(r),t.d(r,{AbstractTreeExplorer:()=>j,FlameColorer:()=>B,TreeColorer:()=>G});var h={};t.r(h),t.d(h,{ExplorerPool:()=>V,RegionPool:()=>X});var n={};t.r(n),t.d(n,{ExplorerHandler:()=>$,ExplorerMathDocumentMixin:()=>Y,ExplorerMathItemMixin:()=>W,setA11yOption:()=>q,setA11yOptions:()=>Q});const a=("undefined"!=typeof window?window:global).MathJax._.components.global,l=(a.GLOBAL,a.isObject,a.combineConfig,a.combineDefaults),c=a.combineWithMathJax,d=(a.MathJax,MathJax._.core.MathItem),p=(d.protoItem,d.AbstractMathItem,d.STATE),u=d.newState,g=MathJax._.a11y["semantic-enrich"],m=(g.enrichVisitor,g.EnrichedMathItemMixin,g.EnrichedMathDocumentMixin,g.EnrichHandler),y=MathJax._.util.Options,f=(y.isObject,y.APPEND,y.REMOVE,y.OPTIONS,y.Expandable,y.expandable),x=(y.makeArray,y.keys,y.copy,y.insert,y.defaultOptions,y.userOptions,y.selectOptions,y.selectOptionsFromKeys,y.separateOptions,y.lookup,MathJax._.core.MmlTree.SerializedMmlVisitor),v=(x.toEntity,x.SerializedMmlVisitor),b=MathJax._.util.StyleList.CssStyles,w=MathJax._.a11y.sre,S=w.Sre;w.sreReady,w.default;class A{constructor(t){this.document=t,this.CLASS=this.constructor,this.AddStyles(),this.AddElement()}AddStyles(){if(this.CLASS.styleAdded)return;let t=this.document.adaptor.node("style");t.innerHTML=this.CLASS.style.cssText,this.document.adaptor.head(this.document.adaptor.document).appendChild(t),this.CLASS.styleAdded=!0}AddElement(){let t=this.document.adaptor.node("div");t.classList.add(this.CLASS.className),t.style.backgroundColor="white",this.div=t,this.inner=this.document.adaptor.node("div"),this.div.appendChild(this.inner),this.document.adaptor.body(this.document.adaptor.document).appendChild(this.div)}Show(t,e){this.position(t),this.highlight(e),this.div.classList.add(this.CLASS.className+"_Show")}Hide(){this.div.classList.remove(this.CLASS.className+"_Show")}stackRegions(t){const e=t.getBoundingClientRect();let i=0,s=Number.POSITIVE_INFINITY,o=this.document.adaptor.document.getElementsByClassName(this.CLASS.className+"_Show");for(let t,e=0;t=o[e];e++)t!==this.div&&(i=Math.max(t.getBoundingClientRect().bottom,i),s=Math.min(t.getBoundingClientRect().left,s));const r=(i||e.bottom+10)+window.pageYOffset,h=(s<Number.POSITIVE_INFINITY?s:e.left)+window.pageXOffset;this.div.style.top=r+"px",this.div.style.left=h+"px"}}A.styleAdded=!1;class k extends A{Clear(){}Update(){}Hide(){}Show(){}AddElement(){}AddStyles(){}position(){}highlight(t){}}class E extends A{Clear(){this.Update(""),this.inner.style.top="",this.inner.style.backgroundColor=""}Update(t){this.inner.textContent="",this.inner.textContent=t}position(t){this.stackRegions(t)}highlight(t){const e=t.colorString();this.inner.style.backgroundColor=e.background,this.inner.style.color=e.foreground}}class O extends E{}O.className="MJX_ToolTip",O.style=new b({["."+O.className]:{position:"absolute",display:"inline-block",height:"1px",width:"1px"},["."+O.className+"_Show"]:{width:"auto",height:"auto",opacity:1,"text-align":"center","border-radius":"6px",padding:"0px 0px","border-bottom":"1px dotted black",position:"absolute","z-index":202}});class M extends E{constructor(t){super(t),this.document=t,this.div.setAttribute("aria-live","assertive")}}M.className="MJX_LiveRegion",M.style=new b({["."+M.className]:{position:"absolute",top:"0",height:"1px",width:"1px",padding:"1px",overflow:"hidden"},["."+M.className+"_Show"]:{top:"0",position:"absolute",width:"auto",height:"auto",padding:"0px 0px",opacity:1,"z-index":"202",left:0,right:0,margin:"0 auto","background-color":"rgba(0, 0, 255, 0.2)","box-shadow":"0px 5px 20px #888",border:"2px solid #CCCCCC"}});const C=["pitch","rate","volume"];class N extends M{constructor(){super(...arguments),this.active=!1,this.node=null,this.clear=!1,this.highlighter=S.getHighlighter({color:"red"},{color:"black"},{renderer:this.document.outputJax.name,browser:"v3"})}Show(t,e){this.node=t,super.Show(t,e)}Update(t){this.active=this.document.options.a11y.voicing&&!!speechSynthesis.getVoices().length,speechSynthesis.cancel(),this.clear=!0;let[e,i]=this.ssmlParsing(t);super.Update(e),this.active&&e&&this.makeUtterances(i,this.document.options.sre.locale)}makeUtterances(t,e){let i=null;for(let s of t)if(s.mark){if(!i){this.highlightNode(s.mark,!0);continue}i.addEventListener("end",(t=>{this.highlightNode(s.mark)}))}else if(s.pause){let t=parseInt(s.pause.match(/^[0-9]+/)[0]);if(isNaN(t)||!i)continue;i.addEventListener("end",(e=>{speechSynthesis.pause(),setTimeout((()=>{speechSynthesis.resume()}),t)}))}else i=new SpeechSynthesisUtterance(s.text),s.rate&&(i.rate=s.rate),s.pitch&&(i.pitch=s.pitch),i.lang=e,speechSynthesis.speak(i);i&&i.addEventListener("end",(t=>{this.highlighter.unhighlight()}))}highlightNode(t,e=!1){this.highlighter.unhighlight();let i=Array.from(this.node.querySelectorAll(`[data-semantic-id="${t}"]`));this.clear&&!e||this.highlighter.highlight(i),this.clear=!1}ssmlParsing(t){let e=(new DOMParser).parseFromString(t,"text/xml"),i=[],s=[];return this.recurseSsml(Array.from(e.documentElement.childNodes),i,s),[s.join(" "),i]}recurseSsml(t,e,i,s={}){for(let o of t)if(3!==o.nodeType){if(1===o.nodeType){let t=o,r=t.tagName;if("speak"===r)continue;if("prosody"===r){this.recurseSsml(Array.from(o.childNodes),e,i,this.getProsody(t,s));continue}switch(r){case"break":e.push({pause:t.getAttribute("time")});break;case"mark":e.push({mark:t.getAttribute("name")});break;case"say-as":let o=t.textContent;e.push(Object.assign({text:o,character:!0},s)),i.push(o)}}}else{let t=o.textContent.trim();t&&(i.push(t),e.push(Object.assign({text:t},s)))}}getProsody(t,e){let i={};for(let s of C)if(t.hasAttribute(s)){let[o,r]=N.extractProsody(t.getAttribute(s));if(!o){i[s]="volume"===s?.5:1;continue}let h=e[s];h=h||("volume"===s?.5:1);let n=N.combinePros[s](parseInt(r,10),o);i[s]="-"===o?h-n:h+n}return i}static extractProsody(t){let e=t.match(N.prosodyRegexp);return e?[e[1],e[2]]:(console.warn("Something went wrong with the prosody matching."),["","100"])}}N.combinePros={pitch:(t,e)=>t/100*1,volume:(t,e)=>t/100*.5,rate:(t,e)=>t/100*1},N.prosodyRegexp=/([\+|-]*)([0-9]+)%/;class R extends A{constructor(t){super(t),this.document=t,this.inner.style.lineHeight="0"}position(t){const e=t.getBoundingClientRect(),i=this.div.getBoundingClientRect();let s,o=e.left+e.width/2-i.width/2;switch(o=o<0?0:o,o+=window.pageXOffset,this.document.options.a11y.align){case"top":s=e.top-i.height-10;break;case"bottom":s=e.bottom+10;break;default:s=e.top+e.height/2-i.height/2}s+=window.pageYOffset,s=s<0?0:s,this.div.style.top=s+"px",this.div.style.left=o+"px"}highlight(t){if(this.inner.firstChild&&!this.inner.firstChild.hasAttribute("sre-highlight"))return;const e=t.colorString();this.inner.style.backgroundColor=e.background,this.inner.style.color=e.foreground}Show(t,e){this.div.style.fontSize=this.document.options.a11y.magnify,this.Update(t),super.Show(t,e)}Clear(){this.inner.textContent="",this.inner.style.top="",this.inner.style.backgroundColor=""}Update(t){this.Clear();let e=this.cloneNode(t);this.inner.appendChild(e)}cloneNode(t){let e=t.cloneNode(!0);if("MJX-CONTAINER"!==e.nodeName){"g"!==e.nodeName&&(e.style.marginLeft=e.style.marginRight="0");let i=t;for(;i&&"MJX-CONTAINER"!==i.nodeName;)i=i.parentNode;if("MJX-MATH"!==e.nodeName&&"svg"!==e.nodeName){if(e=i.firstChild.cloneNode(!1).appendChild(e).parentNode,"svg"===e.nodeName){e.firstChild.setAttribute("transform","matrix(1 0 0 -1 0 0)");const s=parseFloat(e.getAttribute("viewBox").split(/ /)[2]),o=parseFloat(e.getAttribute("width")),{x:r,y:h,width:n,height:a}=t.getBBox();e.setAttribute("viewBox",[r,-(h+a),n,a].join(" ")),e.removeAttribute("style"),e.setAttribute("width",o/s*n+"ex"),e.setAttribute("height",o/s*a+"ex"),i.setAttribute("sre-highlight","false")}}e=i.cloneNode(!1).appendChild(e).parentNode,e.style.margin="0"}return e}}R.className="MJX_HoverRegion",R.style=new b({["."+R.className]:{position:"absolute",height:"1px",width:"1px",padding:"1px",overflow:"hidden"},["."+R.className+"_Show"]:{position:"absolute",width:"max-content",height:"auto",padding:"0px 0px",opacity:1,"z-index":"202",margin:"0 auto","background-color":"rgba(0, 0, 255, 0.2)","box-shadow":"0px 10px 20px #888",border:"2px solid #CCCCCC"}});class P{get highlighter(){return this.pool.highlighter}static stopEvent(t){t.preventDefault?t.preventDefault():t.returnValue=!1,t.stopImmediatePropagation?t.stopImmediatePropagation():t.stopPropagation&&t.stopPropagation(),t.cancelBubble=!0}static create(t,e,i,s,...o){return new this(t,e,i,s,...o)}constructor(t,e,i,s,...o){this.document=t,this.pool=e,this.region=i,this.node=s,this.stoppable=!0,this.events=[],this._active=!1}Events(){return this.events}get active(){return this._active}set active(t){this._active=t}Attach(){this.AddEvents()}Detach(){this.RemoveEvents()}Start(){this.active=!0}Stop(){this.active&&(this.region.Clear(),this.region.Hide(),this.active=!1)}AddEvents(){for(let[t,e]of this.events)this.node.addEventListener(t,e)}RemoveEvents(){for(let[t,e]of this.events)this.node.removeEventListener(t,e)}Update(t=!1){}stopEvent(t){this.stoppable&&P.stopEvent(t)}}var I=function(t,e,i,s){return new(i||(i=Promise))((function(o,r){function h(t){try{a(s.next(t))}catch(t){r(t)}}function n(t){try{a(s.throw(t))}catch(t){r(t)}}function a(t){var e;t.done?o(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(h,n)}a((s=s.apply(t,e||[])).next())}))};class T extends P{constructor(){super(...arguments),this.attached=!1,this.sound=!1,this.eventsAttached=!1,this.events=super.Events().concat([["keydown",this.KeyDown.bind(this)],["focusin",this.FocusIn.bind(this)],["focusout",this.FocusOut.bind(this)]]),this.oldIndex=null}FocusIn(t){}FocusOut(t){this.Stop()}Update(t=!1){if(!this.active&&!t)return;this.pool.unhighlight();let e=this.walker.getFocus(!0).getNodes();e.length||(this.walker.refocus(),e=this.walker.getFocus().getNodes()),this.pool.highlight(e)}Attach(){super.Attach(),this.attached=!0,this.oldIndex=this.node.tabIndex,this.node.tabIndex=1,this.node.setAttribute("role","tree")}AddEvents(){this.eventsAttached||(super.AddEvents(),this.eventsAttached=!0)}Detach(){this.active&&(this.node.tabIndex=this.oldIndex,this.oldIndex=null,this.node.removeAttribute("role")),this.attached=!1}Stop(){this.active&&(this.walker.deactivate(),this.pool.unhighlight()),super.Stop()}Move(t){this.walker.move(t)?this.Update():this.sound&&this.NoMove()}NoMove(){let t=new AudioContext,e=t.createOscillator();e.frequency.value=300,e.connect(t.destination),e.start(t.currentTime),e.stop(t.currentTime+.05)}}class _ extends T{constructor(t,e,i,s,o){super(t,e,i,s),this.document=t,this.pool=e,this.region=i,this.node=s,this.mml=o,this.showRegion="subtitles",this.init=!1,this.restarted=!1,this.initWalker()}Start(){if(!this.attached)return;let t=this.getOptions();if(!this.init)return this.init=!0,void(_.updatePromise=_.updatePromise.then((()=>I(this,void 0,void 0,(function*(){return S.sreReady().then((()=>S.setupEngine({locale:t.locale}))).then((()=>{this.Speech(this.walker),this.Start()}))})))).catch((t=>console.log(t.message))));super.Start(),this.speechGenerator=S.getSpeechGenerator("Direct"),this.speechGenerator.setOptions(t),this.walker=S.getWalker("table",this.node,this.speechGenerator,this.highlighter,this.mml),this.walker.activate(),this.Update(),this.document.options.a11y[this.showRegion]&&_.updatePromise.then((()=>this.region.Show(this.node,this.highlighter))),this.restarted=!0}Update(t=!1){let e=t;t=!1,super.Update(t);let i=this.speechGenerator.getOptions();"speech"===i.modality&&(this.document.options.sre.domain=i.domain,this.document.options.sre.style=i.style,this.document.options.a11y.speechRules=i.domain+"-"+i.style),_.updatePromise=_.updatePromise.then((()=>I(this,void 0,void 0,(function*(){return S.sreReady().then((()=>S.setupEngine({markup:i.markup,modality:i.modality,locale:i.locale}))).then((()=>{if(!e){let t=this.walker.speech();this.region.Update(t)}}))}))))}Speech(t){_.updatePromise.then((()=>{t.speech(),this.node.setAttribute("hasspeech","true"),this.Update(!0),this.restarted&&this.document.options.a11y[this.showRegion]&&this.region.Show(this.node,this.highlighter)}))}KeyDown(t){const e=t.keyCode;if(this.walker.modifier=t.shiftKey,17!==e){if(27===e)return this.Stop(),void this.stopEvent(t);if(this.active){if(this.Move(e),this.triggerLink(e))return;this.stopEvent(t)}else(32===e&&t.shiftKey||13===e)&&(this.Start(),this.stopEvent(t))}else speechSynthesis.cancel()}triggerLink(t){var e,i;if(13!==t)return!1;let s=null===(e=this.walker.getFocus().getNodes())||void 0===e?void 0:e[0];return!!(null===(i=null==s?void 0:s.getAttribute("data-semantic-postfix"))||void 0===i?void 0:i.match(/(^| )link($| )/))&&(s.parentNode.dispatchEvent(new MouseEvent("click")),!0)}initWalker(){this.speechGenerator=S.getSpeechGenerator("Tree");let t=S.getWalker("dummy",this.node,this.speechGenerator,this.highlighter,this.mml);this.walker=t}getOptions(){let t=this.speechGenerator.getOptions(),e=this.document.options.sre;return"speech"!==t.modality||t.locale===e.locale&&t.domain===e.domain&&t.style===e.style||(t.domain=e.domain,t.style=e.style,t.locale=e.locale,this.walker.update(t)),t}}_.updatePromise=Promise.resolve();class L extends T{constructor(t,e,i,s,o){super(t,e,i,s),this.document=t,this.pool=e,this.region=i,this.node=s,this.mml=o,this.walker=S.getWalker("table",this.node,S.getSpeechGenerator("Dummy"),this.highlighter,this.mml)}Update(t=!1){super.Update(t),this.showFocus()}Start(){super.Start(),this.attached&&(this.region.Show(this.node,this.highlighter),this.walker.activate(),this.Update())}showFocus(){let t=this.walker.getFocus().getNodes()[0];this.region.Show(t,this.highlighter)}KeyDown(t){const e=t.keyCode;return this.walker.modifier=t.shiftKey,27===e?(this.Stop(),void this.stopEvent(t)):this.active&&13!==e?(this.Move(e),void this.stopEvent(t)):void((32===e&&t.shiftKey||13===e)&&(this.Start(),this.stopEvent(t)))}}class H extends P{constructor(){super(...arguments),this.events=super.Events().concat([["mouseover",this.MouseOver.bind(this)],["mouseout",this.MouseOut.bind(this)]])}MouseOver(t){this.Start()}MouseOut(t){this.Stop()}}class J extends H{constructor(t,e,i,s,o,r){super(t,e,i,s),this.document=t,this.pool=e,this.region=i,this.node=s,this.nodeQuery=o,this.nodeAccess=r}MouseOut(t){t.clientX===this.coord[0]&&t.clientY===this.coord[1]||(this.highlighter.unhighlight(),this.region.Hide(),super.MouseOut(t))}MouseOver(t){super.MouseOver(t);let e=t.target;this.coord=[t.clientX,t.clientY];let[i,s]=this.getNode(e);i&&(this.highlighter.unhighlight(),this.highlighter.highlight([i]),this.region.Update(s),this.region.Show(i,this.highlighter))}getNode(t){let e=t;for(;t&&t!==this.node;){if(this.nodeQuery(t))return[t,this.nodeAccess(t)];t=t.parentNode}for(t=e;t;){if(this.nodeQuery(t))return[t,this.nodeAccess(t)];let e=t.childNodes[0];t=e&&"defs"===e.tagName?t.childNodes[1]:e}return[null,null]}}class U extends J{}class D extends J{}class F extends J{constructor(t,e,i,s){super(t,e,new k(t),s,(t=>this.highlighter.isMactionNode(t)),(()=>{})),this.document=t,this.pool=e,this.node=s}}class j extends P{constructor(t,e,i,s,o){super(t,e,null,s),this.document=t,this.pool=e,this.region=i,this.node=s,this.mml=o,this.stoppable=!1}Attach(){super.Attach(),this.Start()}Detach(){this.Stop(),super.Detach()}}class B extends j{Start(){this.active||(this.active=!0,this.highlighter.highlightAll(this.node))}Stop(){this.active&&this.highlighter.unhighlightAll(),this.active=!1}}class G extends j{Start(){if(this.active)return;this.active=!0;let t=S.getSpeechGenerator("Color");this.node.hasAttribute("hasforegroundcolor")||(t.generateSpeech(this.node,this.mml),this.node.setAttribute("hasforegroundcolor","true")),this.highlighter.colorizeAll(this.node)}Stop(){this.active&&this.highlighter.uncolorizeAll(this.node),this.active=!1}}class X{constructor(t){this.document=t,this.speechRegion=new N(this.document),this.brailleRegion=new M(this.document),this.magnifier=new R(this.document),this.tooltip1=new O(this.document),this.tooltip2=new O(this.document),this.tooltip3=new O(this.document)}}let K={speech:(t,e,i,...s)=>{let o=_.create(t,e,t.explorerRegions.speechRegion,i,...s);return o.speechGenerator.setOptions({automark:!0,markup:"ssml",locale:t.options.sre.locale,domain:t.options.sre.domain,style:t.options.sre.style,modality:"speech"}),o.speechGenerator.getOptions().locale!==S.engineSetup().locale&&(t.options.sre.locale=S.engineSetup().locale,o.speechGenerator.setOptions({locale:t.options.sre.locale})),o.sound=!0,o.showRegion="subtitles",o},braille:(t,e,i,...s)=>{let o=_.create(t,e,t.explorerRegions.brailleRegion,i,...s);return o.speechGenerator.setOptions({automark:!1,markup:"none",locale:"nemeth",domain:"default",style:"default",modality:"braille"}),o.showRegion="viewBraille",o},keyMagnifier:(t,e,i,...s)=>L.create(t,e,t.explorerRegions.magnifier,i,...s),mouseMagnifier:(t,e,i,...s)=>D.create(t,e,t.explorerRegions.magnifier,i,(t=>t.hasAttribute("data-semantic-type")),(t=>t)),hover:(t,e,i,...s)=>F.create(t,e,null,i),infoType:(t,e,i,...s)=>U.create(t,e,t.explorerRegions.tooltip1,i,(t=>t.hasAttribute("data-semantic-type")),(t=>t.getAttribute("data-semantic-type"))),infoRole:(t,e,i,...s)=>U.create(t,e,t.explorerRegions.tooltip2,i,(t=>t.hasAttribute("data-semantic-role")),(t=>t.getAttribute("data-semantic-role"))),infoPrefix:(t,e,i,...s)=>U.create(t,e,t.explorerRegions.tooltip3,i,(t=>t.hasAttribute("data-semantic-prefix")),(t=>t.getAttribute("data-semantic-prefix"))),flame:(t,e,i,...s)=>B.create(t,e,null,i),treeColoring:(t,e,i,...s)=>G.create(t,e,null,i,...s)};class V{constructor(){this.explorers={},this.attached=[],this._restart=[]}get highlighter(){if(this._renderer!==this.document.outputJax.name)return this._renderer=this.document.outputJax.name,this.setPrimaryHighlighter(),this._highlighter;let[t,e]=this.colorOptions();return S.updateHighlighter(e,t,this._highlighter),this._highlighter}init(t,e,i){this.document=t,this.mml=i,this.node=e,this.setPrimaryHighlighter();for(let t of Object.keys(K))this.explorers[t]=K[t](this.document,this,this.node,this.mml);this.setSecondaryHighlighter(),this.attach()}attach(){this.attached=[];let t=[];for(let e of Object.keys(this.explorers)){let i=this.explorers[e];i instanceof T&&(i.AddEvents(),i.stoppable=!1,t.unshift(i)),this.document.options.a11y[e]?(i.Attach(),this.attached.push(e)):i.Detach()}for(let e of t)if(e.attached){e.stoppable=!0;break}}reattach(){for(let t of this.attached){let e=this.explorers[t];e.active&&(this._restart.push(t),e.Stop())}}restart(){this._restart.forEach((t=>this.explorers[t].Start())),this._restart=[]}setPrimaryHighlighter(){let[t,e]=this.colorOptions();this._highlighter=S.getHighlighter(e,t,{renderer:this.document.outputJax.name,browser:"v3"})}setSecondaryHighlighter(){this.secondaryHighlighter=S.getHighlighter({color:"red"},{color:"black"},{renderer:this.document.outputJax.name,browser:"v3"}),this.explorers.speech.region.highlighter=this.secondaryHighlighter}highlight(t){this.highlighter.highlight(t)}unhighlight(){this.secondaryHighlighter.unhighlight(),this.highlighter.unhighlight()}colorOptions(){let t=this.document.options.a11y;return[{color:t.foregroundColor.toLowerCase(),alpha:t.foregroundOpacity/100},{color:t.backgroundColor.toLowerCase(),alpha:t.backgroundOpacity/100}]}}const z="undefined"!=typeof window;function W(t,e){return class extends t{constructor(){super(...arguments),this.refocus=!1,this.savedId=null}explorable(t,i=!1){if(!(this.state()>=p.EXPLORER)){if(!this.isEscaped&&(t.options.enableExplorer||i)){const i=this.typesetRoot,s=e(this.root);this.savedId&&(this.typesetRoot.setAttribute("sre-explorer-id",this.savedId),this.savedId=null),this.explorers||(this.explorers=new V),this.explorers.init(t,i,s)}this.state(p.EXPLORER)}}rerender(t,e=p.RERENDER){this.savedId=this.typesetRoot.getAttribute("sre-explorer-id"),this.refocus=!!z&&window.document.activeElement===this.typesetRoot,this.explorers&&this.explorers.reattach(),super.rerender(t,e)}updateDocument(t){super.updateDocument(t),this.refocus&&this.typesetRoot.focus(),this.explorers&&this.explorers.restart(),this.refocus=!1}}}function Y(t){var e;return(e=class extends t{constructor(...t){super(...t),this.explorerRegions=null;const e=this.constructor.ProcessBits;e.has("explorer")||e.allocate("explorer");const i=new v(this.mmlFactory),s=this.options;s.a11y.speechRules||(s.a11y.speechRules=`${s.sre.domain}-${s.sre.style}`),s.MathItem=W(s.MathItem,(t=>i.visitTree(t)))}explorable(){if(!this.processed.isSet("explorer")){if(this.options.enableExplorer){this.explorerRegions||(this.explorerRegions=new X(this));for(const t of this.math)t.explorable(this)}this.processed.set("explorer")}return this}state(t,e=!1){return super.state(t,e),t<p.EXPLORER&&this.processed.clear("explorer"),this}}).OPTIONS=Object.assign(Object.assign({},t.OPTIONS),{enableExplorer:z,renderActions:f(Object.assign(Object.assign({},t.OPTIONS.renderActions),{explorable:[p.EXPLORER]})),sre:f(Object.assign(Object.assign({},t.OPTIONS.sre),{speech:"shallow"})),a11y:{align:"top",backgroundColor:"Blue",backgroundOpacity:20,braille:!1,flame:!1,foregroundColor:"Black",foregroundOpacity:100,highlight:"None",hover:!1,infoPrefix:!1,infoRole:!1,infoType:!1,keyMagnifier:!1,magnification:"None",magnify:"400%",mouseMagnifier:!1,speech:!0,subtitles:!0,treeColoring:!1,viewBraille:!1,voicing:!1}}),e}function $(t,e=null){return!t.documentClass.prototype.enrich&&e&&(t=m(t,e)),t.documentClass=Y(t.documentClass),t}function Q(t,e){let i=S.engineSetup();for(let s in e)void 0===t.options.a11y[s]?void 0!==i[s]&&(t.options.sre[s]=e[s]):(q(t,s,e[s]),"locale"===s&&(t.options.sre[s]=e[s]));for(let e of t.math)e.explorers.attach()}function q(t,e,i){switch(e){case"speechRules":const[s,o]=i.split("-");t.options.sre.domain=s,t.options.sre.style=o;break;case"magnification":switch(i){case"None":t.options.a11y.magnification=i,t.options.a11y.keyMagnifier=!1,t.options.a11y.mouseMagnifier=!1;break;case"Keyboard":t.options.a11y.magnification=i,t.options.a11y.keyMagnifier=!0,t.options.a11y.mouseMagnifier=!1;break;case"Mouse":t.options.a11y.magnification=i,t.options.a11y.keyMagnifier=!1,t.options.a11y.mouseMagnifier=!0}break;case"highlight":switch(i){case"None":t.options.a11y.highlight=i,t.options.a11y.hover=!1,t.options.a11y.flame=!1;break;case"Hover":t.options.a11y.highlight=i,t.options.a11y.hover=!0,t.options.a11y.flame=!1;break;case"Flame":t.options.a11y.highlight=i,t.options.a11y.hover=!1,t.options.a11y.flame=!0}break;default:t.options.a11y[e]=i}}u("EXPLORER",160),MathJax.loader&&MathJax.loader.checkVersion("a11y/explorer","4.0.0-beta.4","a11y"),c({_:{a11y:{explorer_ts:n,explorer:{Explorer:i,ExplorerPool:h,KeyExplorer:s,MouseExplorer:o,Region:e,TreeExplorer:r}}}}),MathJax.startup&&"undefined"!=typeof window&&(MathJax.config.options&&!1!==MathJax.config.options.enableExplorer&&l(MathJax.config,"options",{menuOptions:{settings:{explorer:!0}}}),MathJax.startup.extendHandler((t=>$(t))))})();