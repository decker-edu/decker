(()=>{"use strict";var __webpack_modules__={336:(__unused_webpack___webpack_module__,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{f:()=>SystemExternal});var _variables_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(820);class SystemExternal{static nodeRequire(){return eval("require")}static extRequire(t){return"undefined"!=typeof process&&"undefined"!=typeof require?SystemExternal.nodeRequire()(t):null}}SystemExternal.windowSupported=!("undefined"==typeof window),SystemExternal.documentSupported=SystemExternal.windowSupported&&!(void 0===window.document),SystemExternal.xmldom=SystemExternal.documentSupported?window:SystemExternal.extRequire("@xmldom/xmldom"),SystemExternal.document=SystemExternal.documentSupported?window.document:(new SystemExternal.xmldom.DOMImplementation).createDocument("","",0),SystemExternal.xpath=SystemExternal.documentSupported?document:function(){const t={document:{},XPathResult:{}};return SystemExternal.extRequire("wicked-good-xpath").install(t),t.document.XPathResult=t.XPathResult,t.document}(),SystemExternal.mathmapsIePath="https://cdn.jsdelivr.net/npm/sre-mathmaps-ie@"+_variables_js__WEBPACK_IMPORTED_MODULE_0__.u.VERSION+"mathmaps_ie.js",SystemExternal.fs=SystemExternal.documentSupported?null:SystemExternal.extRequire("fs"),SystemExternal.url=_variables_js__WEBPACK_IMPORTED_MODULE_0__.u.url,SystemExternal.jsonPath=function(){if(SystemExternal.documentSupported)return SystemExternal.url;if(process.env.SRE_JSON_PATH||global.SRE_JSON_PATH)return process.env.SRE_JSON_PATH||global.SRE_JSON_PATH;try{return SystemExternal.nodeRequire().resolve("speech-rule-engine").replace(/sre\.js$/,"")+"mathmaps"}catch(t){}try{return SystemExternal.nodeRequire().resolve(".").replace(/sre\.js$/,"")+"mathmaps"}catch(t){}return("undefined"!=typeof __dirname?__dirname+"/lib/mathmaps":process.cwd())+"/lib/mathmaps"}(),SystemExternal.WGXpath=_variables_js__WEBPACK_IMPORTED_MODULE_0__.u.WGXpath,SystemExternal.wgxpath=null},820:(t,e,n)=>{n.d(e,{u:()=>r});class r{static ensureLocale(t,e){return r.LOCALES.get(t)?t:(console.error(`Locale ${t} does not exist! Using ${r.LOCALES.get(e)} instead.`),e)}}r.VERSION="4.1.0-beta.10",r.LOCALES=new Map([["af","Africaans"],["ca","Catalan"],["da","Danish"],["de","German"],["en","English"],["es","Spanish"],["euro","Euro"],["fr","French"],["hi","Hindi"],["it","Italian"],["ko","Korean"],["nb","Bokm\xe5l"],["nn","Nynorsk"],["sv","Swedish"],["nemeth","Nemeth"]]),r.mathjaxVersion="4.0.0-beta.5",r.url="https://cdn.jsdelivr.net/npm/speech-rule-engine@"+r.VERSION+"/lib/mathmaps",r.WGXpath="https://cdn.jsdelivr.net/npm/wicked-good-xpath@1.3.0/dist/wgxpath.install.js"}},__webpack_module_cache__={};function __webpack_require__(t){var e=__webpack_module_cache__[t];if(void 0!==e)return e.exports;var n=__webpack_module_cache__[t]={exports:{}};return __webpack_modules__[t](n,n.exports,__webpack_require__),n.exports}__webpack_require__.d=(t,e)=>{for(var n in e)__webpack_require__.o(e,n)&&!__webpack_require__.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:e[n]})},__webpack_require__.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),__webpack_require__.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})};var __webpack_exports__={};(()=>{var t={};__webpack_require__.r(t),__webpack_require__.d(t,{Sre:()=>wu,default:()=>Gu,sreReady:()=>ku});const e=("undefined"!=typeof window?window:global).MathJax._.components.global,n=(e.GLOBAL,e.isObject,e.combineConfig,e.combineDefaults,e.combineWithMathJax);e.MathJax;var r,s,o;!function(t){t.DOMAIN="domain",t.STYLE="style",t.LOCALE="locale",t.TOPIC="topic",t.MODALITY="modality"}(r||(r={}));class i{static createProp(...t){const e=c.DEFAULT_ORDER,n={};for(let r=0,s=t.length,o=e.length;r<s&&r<o;r++)n[e[r]]=t[r];return new i(n)}constructor(t,e=Object.keys(t)){this.properties=t,this.order=e}getProperties(){return this.properties}getOrder(){return this.order}getAxes(){return this.order}getProperty(t){return this.properties[t]}updateProperties(t){this.properties=t}allProperties(){const t=[];return this.order.forEach((e=>t.push(this.getProperty(e).slice()))),t}toString(){const t=[];return this.order.forEach((e=>t.push(e+": "+this.getProperty(e).toString()))),t.join("\n")}}class c extends i{static createCstr(...t){const e=c.DEFAULT_ORDER,n={};for(let r=0,s=t.length,o=e.length;r<s&&r<o;r++)n[e[r]]=t[r];return new c(n)}static defaultCstr(){return c.createCstr.apply(null,c.DEFAULT_ORDER.map((function(t){return c.DEFAULT_VALUES[t]})))}static validOrder(t){const e=c.DEFAULT_ORDER.slice();return t.every((t=>{const n=e.indexOf(t);return-1!==n&&e.splice(n,1)}))}constructor(t,e){const n={};for(const[e,r]of Object.entries(t))n[e]=[r];super(n,e),this.components=t}getComponents(){return this.components}getValue(t){return this.components[t]}getValues(){return this.order.map((t=>this.getValue(t)))}allProperties(){const t=super.allProperties();for(let e,n,r=0;e=t[r],n=this.order[r];r++){const t=this.getValue(n);-1===e.indexOf(t)&&e.unshift(t)}return t}toString(){return this.getValues().join(".")}equal(t){const e=t.getAxes();if(this.order.length!==e.length)return!1;for(let n,r=0;n=e[r];r++){const e=this.getValue(n);if(!e||t.getValue(n)!==e)return!1}return!0}}c.DEFAULT_ORDER=[r.LOCALE,r.MODALITY,r.DOMAIN,r.STYLE,r.TOPIC],c.BASE_LOCALE="base",c.DEFAULT_VALUE="default",c.DEFAULT_VALUES={[r.LOCALE]:"en",[r.DOMAIN]:c.DEFAULT_VALUE,[r.STYLE]:c.DEFAULT_VALUE,[r.TOPIC]:c.DEFAULT_VALUE,[r.MODALITY]:"speech"};class a{constructor(t){this.order=t}parse(t){const e=t.split("."),n={};if(e.length>this.order.length)throw new Error("Invalid dynamic constraint: "+n);let r=0;for(let t,s=0;t=this.order[s],e.length;s++,r++){const r=e.shift();n[t]=r}return new c(n,this.order.slice(0,r))}}class l{constructor(t,e=new i(t.getProperties(),t.getOrder())){this.reference=t,this.fallback=e,this.order=this.reference.getOrder()}getReference(){return this.reference}setReference(t,e){this.reference=t,this.fallback=e||new i(t.getProperties(),t.getOrder()),this.order=this.reference.getOrder()}match(t){const e=t.getAxes();return e.length===this.reference.getAxes().length&&e.every((e=>{const n=t.getValue(e);return n===this.reference.getValue(e)||-1!==this.fallback.getProperty(e).indexOf(n)}))}compare(t,e){let n=!1;for(let r,s=0;r=this.order[s];s++){const s=t.getValue(r),o=e.getValue(r);if(!n){const t=this.reference.getValue(r);if(t===s&&t!==o)return-1;if(t===o&&t!==s)return 1;if(t===s&&t===o)continue;t!==s&&t!==o&&(n=!0)}const i=this.fallback.getProperty(r),c=i.indexOf(s),a=i.indexOf(o);if(c<a)return-1;if(a<c)return 1}return 0}toString(){return this.reference.toString()+"\n"+this.fallback.toString()}}!function(t){t.SYNC="sync",t.ASYNC="async",t.HTTP="http"}(s||(s={})),function(t){t.PITCH="pitch",t.RATE="rate",t.VOLUME="volume",t.PAUSE="pause",t.JOIN="join",t.LAYOUT="layout"}(o||(o={}));const u=[o.PITCH,o.RATE,o.VOLUME,o.PAUSE,o.JOIN];var h,d;!function(t){t.NONE="none",t.SHALLOW="shallow",t.DEEP="deep"}(h||(h={})),function(t){t.NONE="none",t.LAYOUT="layout",t.COUNTING="counting",t.PUNCTUATION="punctuation",t.SSML="ssml",t.ACSS="acss",t.SABLE="sable",t.VOICEXML="voicexml"}(d||(d={}));const f={mathspeak:"default",clearspeak:"default"};var p=__webpack_require__(336);class m{static getInstance(){return m.instance=m.instance||new m,m.instance}init(t){return t&&this.startDebugFile_(t),this.isActive_=!0,this.fileHandle}output(...t){this.isActive_&&this.output_(t)}generateOutput(t){this.isActive_&&this.output_(t.apply(t,[]))}exit(t=(()=>{})){this.fileHandle.then((()=>{this.isActive_&&this.stream_&&this.stream_.end("","",t)}))}constructor(){this.isActive_=!1,this.outputFunction_=console.info,this.fileHandle=Promise.resolve(),this.stream_=null}startDebugFile_(t){this.fileHandle=p.f.fs.promises.open(t,"w"),this.fileHandle=this.fileHandle.then((e=>{this.stream_=e.createWriteStream(t),this.outputFunction_=function(...t){this.stream_.write(t.join(" ")),this.stream_.write("\n")}.bind(this),this.stream_.on("error",function(t){console.info("Invalid log file. Debug information sent to console."),this.outputFunction_=console.info}.bind(this)),this.stream_.on("finish",(function(){console.info("Finalizing debug file.")}))}))}output_(t){console.info!==this.outputFunction_?this.fileHandle.then((()=>this.outputFunction_.apply(this.outputFunction_,["Speech Rule Engine Debugger:"].concat(t)))):this.outputFunction_.apply(console,["Speech Rule Engine Debugger:"].concat(t))}}var E=__webpack_require__(820);class g extends Error{constructor(t=""){super(),this.message=t,this.name="SRE Error"}}class N{set defaultLocale(t){this._defaultLocale=E.u.ensureLocale(t,this._defaultLocale)}get defaultLocale(){return this._defaultLocale}static getInstance(){return N.instance=N.instance||new N,N.instance}static defaultEvaluator(t,e){return t}static evaluateNode(t){return N.nodeEvaluator(t)}getRate(){const t=parseInt(this.rate,10);return isNaN(t)?100:t}setDynamicCstr(t){if(this.defaultLocale&&(c.DEFAULT_VALUES[r.LOCALE]=this.defaultLocale),t){const e=Object.keys(t);for(let n=0;n<e.length;n++){const r=e[n];if(-1!==c.DEFAULT_ORDER.indexOf(r)){const e=t[r];this[r]=e}}}f[this.domain]=this.style;const e=[this.locale,this.modality,this.domain,this.style].join("."),n=i.createProp([c.DEFAULT_VALUES[r.LOCALE]],[c.DEFAULT_VALUES[r.MODALITY]],[c.DEFAULT_VALUES[r.DOMAIN]],[c.DEFAULT_VALUES[r.STYLE]]),s=this.comparators[this.domain],o=this.parsers[this.domain];this.parser=o||this.defaultParser,this.dynamicCstr=this.parser.parse(e),this.dynamicCstr.updateProperties(n.getProperties()),this.comparator=s?s():new l(this.dynamicCstr)}constructor(){this.customLoader=null,this.parsers={},this.comparator=null,this.mode=s.SYNC,this.init=!0,this.delay=!1,this.comparators={},this.domain="mathspeak",this.style=c.DEFAULT_VALUES[r.STYLE],this._defaultLocale=c.DEFAULT_VALUES[r.LOCALE],this.locale=c.DEFAULT_VALUES[r.LOCALE],this.subiso="",this.modality=c.DEFAULT_VALUES[r.MODALITY],this.speech=h.NONE,this.markup=d.NONE,this.mark=!0,this.automark=!1,this.character=!0,this.cleanpause=!0,this.cayleyshort=!0,this.linebreaks=!1,this.rate="100",this.walker="Table",this.structure=!1,this.aria=!1,this.ruleSets=[],this.strict=!1,this.isIE=!1,this.isEdge=!1,this.pprint=!1,this.config=!1,this.rules="",this.prune="",this.locale=this.defaultLocale,this.evaluator=N.defaultEvaluator,this.defaultParser=new a(c.DEFAULT_ORDER),this.parser=this.defaultParser,this.dynamicCstr=c.defaultCstr()}configurate(t){this.mode!==s.HTTP||this.config||(!function(t){const e=document.documentElement.querySelectorAll('script[type="text/x-sre-config"]');for(let n=0,r=e.length;n<r;n++){let r;try{r=e[n].innerHTML;const s=JSON.parse(r);for(const[e,n]of Object.entries(s))t[e]=n}catch(t){m.getInstance().output("Illegal configuration ",r)}}}(t),this.config=!0),function(t){if("undefined"!=typeof SREfeature)for(const[e,n]of Object.entries(SREfeature))t[e]=n}(t)}setCustomLoader(t){t&&(this.customLoader=t)}}N.BINARY_FEATURES=["automark","mark","character","cleanpause","strict","structure","aria","pprint","cayleyshort","linebreaks"],N.STRING_FEATURES=["markup","style","domain","speech","walker","defaultLocale","locale","delay","modality","rate","rules","subiso","prune"],N.nodeEvaluator=function(t){return[]};class S{static get(t=N.getInstance().locale){return S.promises[t]||Promise.resolve("")}static getall(){return Promise.all(Object.values(S.promises))}}function T(){return"undefined"!=typeof XPathResult}S.loaded={},S.promises={};const I={currentDocument:null,evaluate:T()?document.evaluate:p.f.xpath.evaluate,result:T()?XPathResult:p.f.xpath.XPathResult,createNSResolver:T()?document.createNSResolver:p.f.xpath.createNSResolver},A={xhtml:"http://www.w3.org/1999/xhtml",mathml:"http://www.w3.org/1998/Math/MathML",mml:"http://www.w3.org/1998/Math/MathML",svg:"http://www.w3.org/2000/svg"};function R(t){return A[t]||null}class O{constructor(){this.lookupNamespaceURI=R}}function C(t,e,n){return N.getInstance().mode!==s.HTTP||N.getInstance().isIE||N.getInstance().isEdge?I.evaluate(t,e,new O,n,null):I.currentDocument.evaluate(t,e,R,n,null)}function b(t,e){let n;try{n=C(t,e,I.result.ORDERED_NODE_ITERATOR_TYPE)}catch(t){return[]}const r=[];for(let t=n.iterateNext();t;t=n.iterateNext())r.push(t);return r}function L(t){if(N.getInstance().mode!==s.HTTP)return;let e=t;for(;e&&!e.evaluate;)e=e.parentNode;e&&e.evaluate?I.currentDocument=e:t.ownerDocument&&(I.currentDocument=t.ownerDocument)}function M(t){const e=[];for(let n=0,r=t.length;n<r;n++)e.push(t[n]);return e}function y(t){const e=new p.f.xmldom.DOMParser,n=function(t){return(t=t.replace(/&nbsp;/g,"\xa0")).replace(/>[ \f\n\r\t\v\u200b]+</g,"><").trim()}(t),r=!!n.match(/&(?!lt|gt|amp|quot|apos)\w+;/g);if(!n)throw new Error("Empty input!");try{const t=e.parseFromString(n,r?"text/html":"text/xml");return N.getInstance().mode===s.HTTP?(I.currentDocument=t,r?t.body.childNodes[0]:t.documentElement):t.documentElement}catch(t){throw new g("Illegal input: "+t.message)}}var _,P,F,U;function x(t,e){t.parentNode&&(t.parentNode.insertBefore(e,t),t.parentNode.removeChild(t))}function D(t){return p.f.document.createElement(t)}function v(t,e){return p.f.document.createElementNS(t,e)}function w(t){let e="",n=/(>)(<)(\/*)/g,r=0,s=(t=t.replace(n,"$1\r\n$2$3")).split("\r\n");for(n=/(\.)*(<)(\/*)/g,s=s.map((t=>t.replace(n,"$1\r\n$2$3").split("\r\n"))).reduce(((t,e)=>t.concat(e)),[]);s.length;){let t=s.shift();if(!t)continue;let n=0;if(t.match(/^<\w[^>/]*>[^>]+$/)){const e=B(t,s[0]);e[0]?e[1]?(t+=s.shift().slice(0,-e[1].length),e[1].trim()&&s.unshift(e[1])):t+=s.shift():n=1}else if(t.match(/^<\/\w/))0!==r&&(r-=1);else if(t.match(/^<\w[^>]*[^/]>.*$/))n=1;else if(t.match(/^<\w[^>]*\/>.+$/)){const e=t.indexOf(">")+1,n=t.slice(e);n.trim()&&s.unshift(),t=t.slice(0,e)+n}else n=0;e+=new Array(r+1).join("  ")+t+"\r\n",r+=n}return e}function B(t,e){if(!e)return[!1,""];const n=t.match(/^<([^> ]+).*>/),r=e.match(/^<\/([^>]+)>(.*)/);return n&&r&&n[1]===r[1]?[!0,r[2]]:[!1,""]}function k(t,e,n){return t.querySelectorAll?M(t.querySelectorAll(`[${e}="${n}"]`)):b(`.//*[@${e}="${n}"]`,t)}function G(t){return t.tagName.toUpperCase()}function V(t){return t.cloneNode(!0)}function $(t){return(new p.f.xmldom.XMLSerializer).serializeToString(t)}function j(t){const e=t.toString(16).toUpperCase();return e.length>3?e:("000"+e).slice(-4)}function H([t,e],n){const r=parseInt(t,16),s=parseInt(e,16),o=[];for(let t=r;t<=s;t++){let e=j(t);!1!==n[e]&&(e=n[e]||e,o.push(e))}return o}function X(t,e={}){return H(t,e).map((t=>String.fromCodePoint(parseInt(t,16))))}!function(t){t[t.ELEMENT_NODE=1]="ELEMENT_NODE",t[t.ATTRIBUTE_NODE=2]="ATTRIBUTE_NODE",t[t.TEXT_NODE=3]="TEXT_NODE",t[t.CDATA_SECTION_NODE=4]="CDATA_SECTION_NODE",t[t.ENTITY_REFERENCE_NODE=5]="ENTITY_REFERENCE_NODE",t[t.ENTITY_NODE=6]="ENTITY_NODE",t[t.PROCESSING_INSTRUCTION_NODE=7]="PROCESSING_INSTRUCTION_NODE",t[t.COMMENT_NODE=8]="COMMENT_NODE",t[t.DOCUMENT_NODE=9]="DOCUMENT_NODE",t[t.DOCUMENT_TYPE_NODE=10]="DOCUMENT_TYPE_NODE",t[t.DOCUMENT_FRAGMENT_NODE=11]="DOCUMENT_FRAGMENT_NODE",t[t.NOTATION_NODE=12]="NOTATION_NODE"}(_||(_={})),function(t){t.BOLD="bold",t.BOLDFRAKTUR="bold-fraktur",t.BOLDITALIC="bold-italic",t.BOLDSCRIPT="bold-script",t.DOUBLESTRUCK="double-struck",t.DOUBLESTRUCKITALIC="double-struck-italic",t.FULLWIDTH="fullwidth",t.FRAKTUR="fraktur",t.ITALIC="italic",t.MONOSPACE="monospace",t.NORMAL="normal",t.SCRIPT="script",t.SANSSERIF="sans-serif",t.SANSSERIFITALIC="sans-serif-italic",t.SANSSERIFBOLD="sans-serif-bold",t.SANSSERIFBOLDITALIC="sans-serif-bold-italic"}(P||(P={})),function(t){t.SUPER="super",t.SUB="sub",t.CIRCLED="circled",t.PARENTHESIZED="parenthesized",t.PERIOD="period",t.NEGATIVECIRCLED="negative-circled",t.DOUBLECIRCLED="double-circled",t.CIRCLEDSANSSERIF="circled-sans-serif",t.NEGATIVECIRCLEDSANSSERIF="negative-circled-sans-serif",t.COMMA="comma",t.SQUARED="squared",t.NEGATIVESQUARED="negative-squared"}(F||(F={})),function(t){t.LATINCAP="latinCap",t.LATINSMALL="latinSmall",t.GREEKCAP="greekCap",t.GREEKSMALL="greekSmall",t.DIGIT="digit"}(U||(U={}));const W=[{interval:["1D400","1D419"],base:U.LATINCAP,subst:{},capital:!0,category:"Lu",font:P.BOLD},{interval:["1D41A","1D433"],base:U.LATINSMALL,subst:{},capital:!1,category:"Ll",font:P.BOLD},{interval:["1D56C","1D585"],base:U.LATINCAP,subst:{},capital:!0,category:"Lu",font:P.BOLDFRAKTUR},{interval:["1D586","1D59F"],base:U.LATINSMALL,subst:{},capital:!1,category:"Ll",font:P.BOLDFRAKTUR},{interval:["1D468","1D481"],base:U.LATINCAP,subst:{},capital:!0,category:"Lu",font:P.BOLDITALIC},{interval:["1D482","1D49B"],base:U.LATINSMALL,subst:{},capital:!1,category:"Ll",font:P.BOLDITALIC},{interval:["1D4D0","1D4E9"],base:U.LATINCAP,subst:{},capital:!0,category:"Lu",font:P.BOLDSCRIPT},{interval:["1D4EA","1D503"],base:U.LATINSMALL,subst:{},capital:!1,category:"Ll",font:P.BOLDSCRIPT},{interval:["1D538","1D551"],base:U.LATINCAP,subst:{"1D53A":"2102","1D53F":"210D","1D545":"2115","1D547":"2119","1D548":"211A","1D549":"211D","1D551":"2124"},capital:!0,category:"Lu",font:P.DOUBLESTRUCK},{interval:["1D552","1D56B"],base:U.LATINSMALL,subst:{},capital:!1,category:"Ll",font:P.DOUBLESTRUCK},{interval:["1D504","1D51D"],base:U.LATINCAP,subst:{"1D506":"212D","1D50B":"210C","1D50C":"2111","1D515":"211C","1D51D":"2128"},capital:!0,category:"Lu",font:P.FRAKTUR},{interval:["1D51E","1D537"],base:U.LATINSMALL,subst:{},capital:!1,category:"Ll",font:P.FRAKTUR},{interval:["FF21","FF3A"],base:U.LATINCAP,subst:{},capital:!0,category:"Lu",font:P.FULLWIDTH},{interval:["FF41","FF5A"],base:U.LATINSMALL,subst:{},capital:!1,category:"Ll",font:P.FULLWIDTH},{interval:["1D434","1D44D"],base:U.LATINCAP,subst:{},capital:!0,category:"Lu",font:P.ITALIC},{interval:["1D44E","1D467"],base:U.LATINSMALL,subst:{"1D455":"210E"},capital:!1,category:"Ll",font:P.ITALIC},{interval:["1D670","1D689"],base:U.LATINCAP,subst:{},capital:!0,category:"Lu",font:P.MONOSPACE},{interval:["1D68A","1D6A3"],base:U.LATINSMALL,subst:{},capital:!1,category:"Ll",font:P.MONOSPACE},{interval:["0041","005A"],base:U.LATINCAP,subst:{},capital:!0,category:"Lu",font:P.NORMAL},{interval:["0061","007A"],base:U.LATINSMALL,subst:{},capital:!1,category:"Ll",font:P.NORMAL},{interval:["1D49C","1D4B5"],base:U.LATINCAP,subst:{"1D49D":"212C","1D4A0":"2130","1D4A1":"2131","1D4A3":"210B","1D4A4":"2110","1D4A7":"2112","1D4A8":"2133","1D4AD":"211B"},capital:!0,category:"Lu",font:P.SCRIPT},{interval:["1D4B6","1D4CF"],base:U.LATINSMALL,subst:{"1D4BA":"212F","1D4BC":"210A","1D4C4":"2134"},capital:!1,category:"Ll",font:P.SCRIPT},{interval:["1D5A0","1D5B9"],base:U.LATINCAP,subst:{},capital:!0,category:"Lu",font:P.SANSSERIF},{interval:["1D5BA","1D5D3"],base:U.LATINSMALL,subst:{},capital:!1,category:"Ll",font:P.SANSSERIF},{interval:["1D608","1D621"],base:U.LATINCAP,subst:{},capital:!0,category:"Lu",font:P.SANSSERIFITALIC},{interval:["1D622","1D63B"],base:U.LATINSMALL,subst:{},capital:!1,category:"Ll",font:P.SANSSERIFITALIC},{interval:["1D5D4","1D5ED"],base:U.LATINCAP,subst:{},capital:!0,category:"Lu",font:P.SANSSERIFBOLD},{interval:["1D5EE","1D607"],base:U.LATINSMALL,subst:{},capital:!1,category:"Ll",font:P.SANSSERIFBOLD},{interval:["1D63C","1D655"],base:U.LATINCAP,subst:{},capital:!0,category:"Lu",font:P.SANSSERIFBOLDITALIC},{interval:["1D656","1D66F"],base:U.LATINSMALL,subst:{},capital:!1,category:"Ll",font:P.SANSSERIFBOLDITALIC},{interval:["0391","03A9"],base:U.GREEKCAP,subst:{"03A2":"03F4"},capital:!0,category:"Lu",font:P.NORMAL},{interval:["03B0","03D0"],base:U.GREEKSMALL,subst:{"03B0":"2207","03CA":"2202","03CB":"03F5","03CC":"03D1","03CD":"03F0","03CE":"03D5","03CF":"03F1","03D0":"03D6"},capital:!1,category:"Ll",font:P.NORMAL},{interval:["1D6A8","1D6C0"],base:U.GREEKCAP,subst:{},capital:!0,category:"Lu",font:P.BOLD},{interval:["1D6C1","1D6E1"],base:U.GREEKSMALL,subst:{},capital:!1,category:"Ll",font:P.BOLD},{interval:["1D6E2","1D6FA"],base:U.GREEKCAP,subst:{},capital:!0,category:"Lu",font:P.ITALIC},{interval:["1D6FB","1D71B"],base:U.GREEKSMALL,subst:{},capital:!1,category:"Ll",font:P.ITALIC},{interval:["1D71C","1D734"],base:U.GREEKCAP,subst:{},capital:!0,category:"Lu",font:P.BOLDITALIC},{interval:["1D735","1D755"],base:U.GREEKSMALL,subst:{},capital:!1,category:"Ll",font:P.BOLDITALIC},{interval:["1D756","1D76E"],base:U.GREEKCAP,subst:{},capital:!0,category:"Lu",font:P.SANSSERIFBOLD},{interval:["1D76F","1D78F"],base:U.GREEKSMALL,subst:{},capital:!1,category:"Ll",font:P.SANSSERIFBOLD},{interval:["1D790","1D7A8"],base:U.GREEKCAP,subst:{},capital:!0,category:"Lu",font:P.SANSSERIFBOLDITALIC},{interval:["1D7A9","1D7C9"],base:U.GREEKSMALL,subst:{},capital:!1,category:"Ll",font:P.SANSSERIFBOLDITALIC},{interval:["0030","0039"],base:U.DIGIT,subst:{},offset:0,category:"Nd",font:P.NORMAL},{interval:["2070","2079"],base:U.DIGIT,subst:{2071:"00B9",2072:"00B2",2073:"00B3"},offset:0,category:"No",font:F.SUPER},{interval:["2080","2089"],base:U.DIGIT,subst:{},offset:0,category:"No",font:F.SUB},{interval:["245F","2473"],base:U.DIGIT,subst:{"245F":"24EA"},offset:0,category:"No",font:F.CIRCLED},{interval:["3251","325F"],base:U.DIGIT,subst:{},offset:21,category:"No",font:F.CIRCLED},{interval:["32B1","32BF"],base:U.DIGIT,subst:{},offset:36,category:"No",font:F.CIRCLED},{interval:["2474","2487"],base:U.DIGIT,subst:{},offset:1,category:"No",font:F.PARENTHESIZED},{interval:["2487","249B"],base:U.DIGIT,subst:{2487:"1F100"},offset:0,category:"No",font:F.PERIOD},{interval:["2775","277F"],base:U.DIGIT,subst:{2775:"24FF"},offset:0,category:"No",font:F.NEGATIVECIRCLED},{interval:["24EB","24F4"],base:U.DIGIT,subst:{},offset:11,category:"No",font:F.NEGATIVECIRCLED},{interval:["24F5","24FE"],base:U.DIGIT,subst:{},offset:1,category:"No",font:F.DOUBLECIRCLED},{interval:["277F","2789"],base:U.DIGIT,subst:{"277F":"1F10B"},offset:0,category:"No",font:F.CIRCLEDSANSSERIF},{interval:["2789","2793"],base:U.DIGIT,subst:{2789:"1F10C"},offset:0,category:"No",font:F.NEGATIVECIRCLEDSANSSERIF},{interval:["FF10","FF19"],base:U.DIGIT,subst:{},offset:0,category:"Nd",font:P.FULLWIDTH},{interval:["1D7CE","1D7D7"],base:U.DIGIT,subst:{},offset:0,category:"Nd",font:P.BOLD},{interval:["1D7D8","1D7E1"],base:U.DIGIT,subst:{},offset:0,category:"Nd",font:P.DOUBLESTRUCK},{interval:["1D7E2","1D7EB"],base:U.DIGIT,subst:{},offset:0,category:"Nd",font:P.SANSSERIF},{interval:["1D7EC","1D7F5"],base:U.DIGIT,subst:{},offset:0,category:"Nd",font:P.SANSSERIFBOLD},{interval:["1D7F6","1D7FF"],base:U.DIGIT,subst:{},offset:0,category:"Nd",font:P.MONOSPACE},{interval:["1F101","1F10A"],base:U.DIGIT,subst:{},offset:0,category:"No",font:F.COMMA},{interval:["24B6","24CF"],base:U.LATINCAP,subst:{},capital:!0,category:"So",font:F.CIRCLED},{interval:["24D0","24E9"],base:U.LATINSMALL,subst:{},capital:!1,category:"So",font:F.CIRCLED},{interval:["1F110","1F129"],base:U.LATINCAP,subst:{},capital:!0,category:"So",font:F.PARENTHESIZED},{interval:["249C","24B5"],base:U.LATINSMALL,subst:{},capital:!1,category:"So",font:F.PARENTHESIZED},{interval:["1F130","1F149"],base:U.LATINCAP,subst:{},capital:!0,category:"So",font:F.SQUARED},{interval:["1F170","1F189"],base:U.LATINCAP,subst:{},capital:!0,category:"So",font:F.NEGATIVESQUARED},{interval:["1F150","1F169"],base:U.LATINCAP,subst:{},capital:!0,category:"So",font:F.NEGATIVECIRCLED}],Y=new Map;function K(t,e){return t+e.split("-").map((t=>t[0].toUpperCase()+t.slice(1))).join("")}for(const t of W){const e=K(t.base,t.font),n=X(t.interval,t.subst);let r=Y.get(e);r?r.unicode=r.unicode.concat(n):(r=t,r.unicode=n,Y.set(e,r))}var q;!function(t){t.PUNCTUATION="punctuation",t.FENCE="fence",t.NUMBER="number",t.IDENTIFIER="identifier",t.TEXT="text",t.OPERATOR="operator",t.RELATION="relation",t.LARGEOP="largeop",t.FUNCTION="function",t.ACCENT="accent",t.FENCED="fenced",t.FRACTION="fraction",t.PUNCTUATED="punctuated",t.RELSEQ="relseq",t.MULTIREL="multirel",t.INFIXOP="infixop",t.PREFIXOP="prefixop",t.POSTFIXOP="postfixop",t.APPL="appl",t.INTEGRAL="integral",t.BIGOP="bigop",t.SQRT="sqrt",t.ROOT="root",t.LIMUPPER="limupper",t.LIMLOWER="limlower",t.LIMBOTH="limboth",t.SUBSCRIPT="subscript",t.SUPERSCRIPT="superscript",t.UNDERSCORE="underscore",t.OVERSCORE="overscore",t.TENSOR="tensor",t.TABLE="table",t.MULTILINE="multiline",t.MATRIX="matrix",t.VECTOR="vector",t.CASES="cases",t.ROW="row",t.LINE="line",t.CELL="cell",t.ENCLOSE="enclose",t.INFERENCE="inference",t.RULELABEL="rulelabel",t.CONCLUSION="conclusion",t.PREMISES="premises",t.UNKNOWN="unknown",t.EMPTY="empty"}(q||(q={}));const z=Object.assign({},q);var Q;!function(t){t.COMMA="comma",t.SEMICOLON="semicolon",t.ELLIPSIS="ellipsis",t.FULLSTOP="fullstop",t.QUESTION="question",t.EXCLAMATION="exclamation",t.QUOTES="quotes",t.DASH="dash",t.TILDE="tilde",t.PRIME="prime",t.DEGREE="degree",t.VBAR="vbar",t.COLON="colon",t.OPENFENCE="openfence",t.CLOSEFENCE="closefence",t.APPLICATION="application",t.DUMMY="dummy",t.UNIT="unit",t.LABEL="label",t.OPEN="open",t.CLOSE="close",t.TOP="top",t.BOTTOM="bottom",t.NEUTRAL="neutral",t.METRIC="metric",t.LATINLETTER="latinletter",t.GREEKLETTER="greekletter",t.OTHERLETTER="otherletter",t.NUMBERSET="numbersetletter",t.INTEGER="integer",t.FLOAT="float",t.OTHERNUMBER="othernumber",t.INFTY="infty",t.MIXED="mixed",t.MULTIACCENT="multiaccent",t.OVERACCENT="overaccent",t.UNDERACCENT="underaccent",t.UNDEROVER="underover",t.SUBSUP="subsup",t.LEFTSUB="leftsub",t.LEFTSUPER="leftsuper",t.RIGHTSUB="rightsub",t.RIGHTSUPER="rightsuper",t.LEFTRIGHT="leftright",t.ABOVEBELOW="abovebelow",t.SETEMPTY="set empty",t.SETEXT="set extended",t.SETSINGLE="set singleton",t.SETCOLLECT="set collection",t.STRING="string",t.SPACE="space",t.ANNOTATION="annotation",t.TEXT="text",t.SEQUENCE="sequence",t.ENDPUNCT="endpunct",t.STARTPUNCT="startpunct",t.NEGATIVE="negative",t.POSITIVE="positive",t.NEGATION="negation",t.MULTIOP="multiop",t.PREFIXOP="prefix operator",t.POSTFIXOP="postfix operator",t.LIMFUNC="limit function",t.INFIXFUNC="infix function",t.PREFIXFUNC="prefix function",t.POSTFIXFUNC="postfix function",t.SIMPLEFUNC="simple function",t.COMPFUNC="composed function",t.SUM="sum",t.INTEGRAL="integral",t.GEOMETRY="geometry",t.BOX="box",t.BLOCK="block",t.ADDITION="addition",t.MULTIPLICATION="multiplication",t.SUBTRACTION="subtraction",t.IMPLICIT="implicit",t.DIVISION="division",t.VULGAR="vulgar",t.EQUALITY="equality",t.INEQUALITY="inequality",t.ARROW="arrow",t.ELEMENT="element",t.NONELEMENT="nonelement",t.REELEMENT="reelement",t.RENONELEMENT="renonelement",t.SET="set",t.DETERMINANT="determinant",t.ROWVECTOR="rowvector",t.BINOMIAL="binomial",t.SQUAREMATRIX="squarematrix",t.CYCLE="cycle",t.MULTILINE="multiline",t.MATRIX="matrix",t.VECTOR="vector",t.CASES="cases",t.TABLE="table",t.CAYLEY="cayley",t.PROOF="proof",t.LEFT="left",t.RIGHT="right",t.UP="up",t.DOWN="down",t.FINAL="final",t.SINGLE="single",t.HYP="hyp",t.AXIOM="axiom",t.LOGIC="logic",t.UNKNOWN="unknown",t.MGLYPH="mglyph"}(Q||(Q={}));const J=Object.assign({},Q);var Z;!function(t){t.CALIGRAPHIC="caligraphic",t.CALIGRAPHICBOLD="caligraphic-bold",t.OLDSTYLE="oldstyle",t.OLDSTYLEBOLD="oldstyle-bold",t.UNKNOWN="unknown"}(Z||(Z={}));const tt=Object.assign(Object.assign(Object.assign({},P),Z),F);var et;!function(t){t.ALLLETTERS="allLetters",t.D="d",t.BAR="bar",t.TILDE="tilde"}(et||(et={}));const nt=Object.assign(Object.assign({},U),et);function rt(t,e){return t.toString()}function st(t){return t.toString()}function ot(t,e){return t+e.toLowerCase()}const it={};function ct(t,e=""){if(!t.childNodes||!t.childNodes[0]||!t.childNodes[0].childNodes||t.childNodes[0].childNodes.length<2||t.childNodes[0].childNodes[0].tagName!==z.NUMBER||t.childNodes[0].childNodes[0].getAttribute("role")!==J.INTEGER||t.childNodes[0].childNodes[1].tagName!==z.NUMBER||t.childNodes[0].childNodes[1].getAttribute("role")!==J.INTEGER)return{convertible:!1,content:t.textContent};const n=t.childNodes[0].childNodes[1].textContent,r=t.childNodes[0].childNodes[0].textContent,s=Number(n),o=Number(r);return isNaN(s)||isNaN(o)?{convertible:!1,content:`${r} ${e} ${n}`}:{convertible:!0,enumerator:o,denominator:s}}function at(t,e,n){const r=ct(t);if(r.convertible){const t=r.enumerator,s=r.denominator;return t>0&&t<e&&s>0&&s<n}return!1}function lt(t={}){return Object.assign({zero:"zero",ones:[],tens:[],large:[],special:{},wordOrdinal:st,numericOrdinal:st,numberToWords:st,numberToOrdinal:rt,vulgarSep:" ",numSep:" "},t)}it.identityCombiner=function(t,e,n){return t+e+n},it.prefixCombiner=function(t,e,n){return t=n?n+" "+t:t,e?e+" "+t:t},it.postfixCombiner=function(t,e,n){return t=n?n+" "+t:t,e?t+" "+e:t},it.romanceCombiner=function(t,e,n){return t=n?t+" "+n:t,e?t+" "+e:t};const ut=ht();function ht(){return{FUNCTIONS:{fracNestDepth:t=>at(t,10,100),radicalNestDepth:t=>"",combineRootIndex:function(t,e){return t},combineNestedFraction:it.identityCombiner,combineNestedRadical:it.identityCombiner,fontRegexp:function(t){return new RegExp("^"+t.split(/ |-/).join("( |-)")+"( |-)")},si:ot,plural:st},MESSAGES:{MS:{},MSroots:{},font:{},embellish:{},role:{},enclose:{},navigate:{},regexp:{},unitTimes:""},ALPHABETS:{latinSmall:[],latinCap:[],greekSmall:[],greekCap:[],capPrefix:{default:""},smallPrefix:{default:""},digitPrefix:{default:""},languagePrefix:{},digitTrans:{default:st,mathspeak:st,clearspeak:st},letterTrans:{default:st},combiner:(t,e,n)=>t},NUMBERS:lt(),COMBINERS:{},CORRECTIONS:{},SUBISO:{default:"",current:"",all:[]}}}function dt(t){switch(t){case 1:return ut.MESSAGES.MS.ONCE||"";case 2:return ut.MESSAGES.MS.TWICE;default:return t.toString()}}function ft(t,e){return t===ut.MESSAGES.MS.ROOTINDEX||t===ut.MESSAGES.MS.INDEX?t:t+" "+e}function pt(t){return mt(ut.MESSAGES.font[t],t)}function mt(t,e){return void 0===t?e:"string"==typeof t?t:t[0]}const Et="grammar";class gt{static getInstance(){return gt.instance=gt.instance||new gt,gt.instance}static parseInput(t){const e={},n=t.split(":");for(const t of n){const n=t.split("="),r=n[0].trim();n[1]?e[r]=n[1].trim():r.match(/^!/)?e[r.slice(1)]=!1:e[r]=!0}return e}static parseState(t){const e={},n=t.split(" ");for(const t of n){const n=t.split(":"),r=n[0],s=n[1];e[r]=s||!0}return e}static translateString(t){if(t.match(/:unit$/))return gt.translateUnit(t);const e=N.getInstance();let n=e.evaluator(t,e.dynamicCstr);return n=null===n?t:n,gt.getInstance().getParameter("plural")&&(n=ut.FUNCTIONS.plural(n)),n}static translateUnit(t){t=gt.prepareUnit(t);const e=N.getInstance(),n=gt.getInstance().getParameter("plural"),r=e.strict,s=`${e.locale}.${e.modality}.default`;let o,i;return e.strict=!0,n&&(o=e.defaultParser.parse(s+".plural"),i=e.evaluator(t,o)),i?(e.strict=r,i):(o=e.defaultParser.parse(s+".default"),i=e.evaluator(t,o),e.strict=r,i?(n&&(i=ut.FUNCTIONS.plural(i)),i):gt.cleanUnit(t))}static prepareUnit(t){const e=t.match(/:unit$/);return e?t.slice(0,e.index).replace(/\s+/g," ")+t.slice(e.index):t}static cleanUnit(t){return t.match(/:unit$/)?t.replace(/:unit$/,""):t}clear(){this.parameters_={},this.stateStack_=[]}setParameter(t,e){const n=this.parameters_[t];return e?this.parameters_[t]=e:delete this.parameters_[t],n}getParameter(t){return this.parameters_[t]}setCorrection(t,e){this.corrections_[t]=e}setPreprocessor(t,e){this.preprocessors_[t]=e}getCorrection(t){return this.corrections_[t]}getState(){const t=[];for(const[e,n]of Object.entries(this.parameters_))t.push("string"==typeof n?e+":"+n:e);return t.join(" ")}processSingles(){const t={};for(const e of this.singles)t[e]=!1;this.singles=[],this.pushState(t)}pushState(t){for(let[e,n]of Object.entries(t))e.match(/^\?/)&&(delete t[e],e=e.slice(1),this.singles.push(e)),t[e]=this.setParameter(e,n);this.stateStack_.push(t)}popState(){const t=this.stateStack_.pop();for(const[e,n]of Object.entries(t))this.setParameter(e,n)}setAttribute(t){if(t&&t.nodeType===_.ELEMENT_NODE){const e=this.getState();e&&t.setAttribute(Et,e)}}preprocess(t){return this.runProcessors(t,this.preprocessors_)}correct(t){return this.runProcessors(t,this.corrections_)}apply(t,e){return this.currentFlags=e||{},t=this.currentFlags.adjust||this.currentFlags.preprocess?gt.getInstance().preprocess(t):t,(this.parameters_.translate||this.currentFlags.translate)&&(t=gt.translateString(t)),t=this.currentFlags.adjust||this.currentFlags.correct?gt.getInstance().correct(t):t,this.currentFlags={},t}runProcessors(t,e){for(const[n,r]of Object.entries(this.parameters_)){const s=e[n];s&&(t=!0===r?s(t):s(t,r))}return t}constructor(){this.currentFlags={},this.parameters_={},this.corrections_={},this.preprocessors_={},this.stateStack_=[],this.singles=[]}}function Nt(t,e){if(!e||!t)return t;const n=ut.FUNCTIONS.fontRegexp(pt(e));return t.replace(n,"")}function St(t){let e=t%1e3,n="",r=At.ones[Math.floor(e/100)];if(n+=r?r+At.numSep+"honderd":"",e%=100,e)if(n+=n?At.numSep:"",r=At.ones[e],r)n+=r;else{const t=At.tens[Math.floor(e/10)];r=At.ones[e%10],n+=r?r+"-en-"+t:t}return n}function Tt(t){if(0===t)return At.zero;if(t>=Math.pow(10,36))return t.toString();let e=0,n="";for(;t>0;){if(t%1e3){const r=St(t%1e3);if(e){const t=At.large[e];n=r+At.numSep+t+(n?At.numSep+n:"")}else n=r+(n?At.numSep+n:"")}t=Math.floor(t/1e3),e++}return n}function It(t){if(1===t)return"eerste";if(3===t)return"derde";if(8===t)return"agste";if(9===t)return"negende";return Tt(t)+(t<19?"de":"ste")}gt.getInstance().setCorrection("localFont",pt),gt.getInstance().setCorrection("localRole",(function(t){return mt(ut.MESSAGES.role[t],t)})),gt.getInstance().setCorrection("localEnclose",(function(t){return mt(ut.MESSAGES.enclose[t],t)})),gt.getInstance().setCorrection("ignoreFont",Nt),gt.getInstance().setPreprocessor("annotation",(function(t,e){return t+":"+e})),gt.getInstance().setPreprocessor("noTranslateText",(function(t){return t.match(new RegExp("^["+ut.MESSAGES.regexp.TEXT+"]+$"))&&(gt.getInstance().currentFlags.translate=!1),t})),gt.getInstance().setCorrection("ignoreCaps",(function(t){let e=ut.ALPHABETS.capPrefix[N.getInstance().domain];return void 0===e&&(e=ut.ALPHABETS.capPrefix.default),Nt(t,e)})),gt.getInstance().setPreprocessor("numbers2alpha",(function(t){return t.match(/\d+/)?ut.NUMBERS.numberToWords(parseInt(t,10)):t}));const At=lt({wordOrdinal:It,numericOrdinal:function(t){return t.toString()+"."},numberToWords:Tt,numberToOrdinal:function(t,e){return 1===t?"enkel":2===t?e?"helftes":"helfte":4===t?e?"kwarte":"kwart":It(t)+(e?"s":"")}}),Rt=function(t,e,n){return t=n?n+" "+t:t,e?t+" "+e:t};let Ot=null;function Ct(t){const e=t%1e3,n=Math.floor(e/100),r=n?1===n?"cent":Mt.ones[n]+"-cents":"",s=function(t){const e=t%100;if(e<20)return Mt.ones[e];const n=Math.floor(e/10),r=Mt.tens[n],s=Mt.ones[e%10];return r&&s?r+(2===n?"-i-":"-")+s:r||s}(e%100);return r&&s?r+Mt.numSep+s:r||s}function bt(t){if(0===t)return Mt.zero;if(t>=Math.pow(10,36))return t.toString();let e=0,n="";for(;t>0;){const r=t%(e>1?1e6:1e3);if(r){let t=Mt.large[e];if(e)if(1===e)n=(1===r?"":Ct(r)+Mt.numSep)+t+(n?Mt.numSep+n:"");else{const e=bt(r);t=1===r?t:t.replace(/\u00f3$/,"ons"),n=e+Mt.numSep+t+(n?Mt.numSep+n:"")}else n=Ct(r)}t=Math.floor(t/(e>1?1e6:1e3)),e++}return n}function Lt(t){const e=gt.getInstance().getParameter("gender");return t.toString()+("f"===e?"a":"n")}const Mt=lt({numericOrdinal:Lt,numberToWords:bt,numberToOrdinal:function(t,e){if(t>1999)return Lt(t);if(t<=10)return Mt.special.onesOrdinals[t-1];const n=bt(t);return n.match(/mil$/)?n.replace(/mil$/,"mil\xb7l\xe8sima"):n.match(/u$/)?n.replace(/u$/,"vena"):n.match(/a$/)?n.replace(/a$/,"ena"):n+(n.match(/e$/)?"na":"ena")}}),yt=function(t,e,n){return t="sans serif "+(n?n+" "+t:t),e?t+" "+e:t};let _t=null;function Pt(t,e=!1){return t===Dt.ones[1]?e?"et":"en":t}function Ft(t,e=!1){let n=t%1e3,r="",s=Dt.ones[Math.floor(n/100)];if(r+=s?Pt(s,!0)+" hundrede":"",n%=100,n)if(r+=r?" og ":"",s=e?Dt.special.smallOrdinals[n]:Dt.ones[n],s)r+=s;else{const t=e?Dt.special.tensOrdinals[Math.floor(n/10)]:Dt.tens[Math.floor(n/10)];s=Dt.ones[n%10],r+=s?Pt(s)+"og"+t:t}return r}function Ut(t,e=!1){if(0===t)return Dt.zero;if(t>=Math.pow(10,36))return t.toString();let n=0,r="";for(;t>0;){const s=t%1e3;if(s){const t=Ft(s,e&&!n);if(n){const e=Dt.large[n],o=s>1?"er":"";r=Pt(t,n<=1)+" "+e+o+(r?" og ":"")+r}else r=Pt(t)+r}t=Math.floor(t/1e3),n++}return r}function xt(t){if(t%100)return Ut(t,!0);const e=Ut(t);return e.match(/e$/)?e:e+"e"}const Dt=lt({wordOrdinal:xt,numericOrdinal:function(t){return t.toString()+"."},numberToWords:Ut,numberToOrdinal:function(t,e){return 1===t?e?"hel":"hele":2===t?e?"halv":"halve":xt(t)+(e?"dele":"del")}});let vt=null;function wt(t,e=!1){return t===Vt.ones[1]?e?"eine":"ein":t}function Bt(t){let e=t%1e3,n="",r=Vt.ones[Math.floor(e/100)];if(n+=r?wt(r)+"hundert":"",e%=100,e)if(n+=n?Vt.numSep:"",r=Vt.ones[e],r)n+=r;else{const t=Vt.tens[Math.floor(e/10)];r=Vt.ones[e%10],n+=r?wt(r)+"und"+t:t}return n}function kt(t){if(0===t)return Vt.zero;if(t>=Math.pow(10,36))return t.toString();let e=0,n="";for(;t>0;){const r=t%1e3;if(r){const s=Bt(t%1e3);if(e){const t=Vt.large[e],o=e>1&&r>1?t.match(/e$/)?"n":"en":"";n=wt(s,e>1)+t+o+n}else n=wt(s,e>1)+n}t=Math.floor(t/1e3),e++}return n.replace(/ein$/,"eins")}function Gt(t){if(1===t)return"erste";if(3===t)return"dritte";if(7===t)return"siebte";if(8===t)return"achte";return kt(t)+(t<19?"te":"ste")}const Vt=lt({wordOrdinal:Gt,numericOrdinal:function(t){return t.toString()+"."},numberToWords:kt,numberToOrdinal:function(t,e){return 1===t?"eintel":2===t?e?"halbe":"halb":Gt(t)+"l"}}),$t=function(t,e,n){return"s"===n&&(e=e.split(" ").map((function(t){return t.replace(/s$/,"")})).join(" "),n=""),t=n?n+" "+t:t,e?e+" "+t:t},jt=function(t,e,n){return t=n&&"s"!==n?n+" "+t:t,e?t+" "+e:t};let Ht=null;function Xt(t){let e=t%1e3,n="";return n+=Kt.ones[Math.floor(e/100)]?Kt.ones[Math.floor(e/100)]+Kt.numSep+"hundred":"",e%=100,e&&(n+=n?Kt.numSep:"",n+=Kt.ones[e]||Kt.tens[Math.floor(e/10)]+(e%10?Kt.numSep+Kt.ones[e%10]:"")),n}function Wt(t){if(0===t)return Kt.zero;if(t>=Math.pow(10,36))return t.toString();let e=0,n="";for(;t>0;){t%1e3&&(n=Xt(t%1e3)+(e?"-"+Kt.large[e]+"-":"")+n),t=Math.floor(t/1e3),e++}return n.replace(/-$/,"")}function Yt(t){let e=Wt(t);return e.match(/one$/)?e=e.slice(0,-3)+"first":e.match(/two$/)?e=e.slice(0,-3)+"second":e.match(/three$/)?e=e.slice(0,-5)+"third":e.match(/five$/)?e=e.slice(0,-4)+"fifth":e.match(/eight$/)?e=e.slice(0,-5)+"eighth":e.match(/nine$/)?e=e.slice(0,-4)+"ninth":e.match(/twelve$/)?e=e.slice(0,-6)+"twelfth":e.match(/ty$/)?e=e.slice(0,-2)+"tieth":e+="th",e}const Kt=lt({wordOrdinal:Yt,numericOrdinal:function(t){const e=t%100,n=t.toString();if(e>10&&e<20)return n+"th";switch(t%10){case 1:return n+"st";case 2:return n+"nd";case 3:return n+"rd";default:return n+"th"}},numberToWords:Wt,numberToOrdinal:function(t,e){if(1===t)return e?"oneths":"oneth";if(2===t)return e?"halves":"half";const n=Yt(t);return e?n+"s":n}});let qt=null;function zt(t){const e=t%1e3,n=Math.floor(e/100),r=Qt.special.hundreds[n],s=function(t){const e=t%100;if(e<30)return Qt.ones[e];const n=Qt.tens[Math.floor(e/10)],r=Qt.ones[e%10];return n&&r?n+" y "+r:n||r}(e%100);return 1===n?s?r+"to "+s:r:r&&s?r+" "+s:r||s}const Qt=lt({numericOrdinal:function(t){const e=gt.getInstance().getParameter("gender");return t.toString()+("f"===e?"a":"o")},numberToWords:function(t){if(0===t)return Qt.zero;if(t>=Math.pow(10,36))return t.toString();let e=0,n="";for(;t>0;){const r=t%1e3;if(r){let t=Qt.large[e];const s=zt(r);e?1===r?(t=t.match("/^mil( |$)/")?t:"un "+t,n=t+(n?" "+n:"")):(t=t.replace(/\u00f3n$/,"ones"),n=zt(r)+" "+t+(n?" "+n:"")):n=s}t=Math.floor(t/1e3),e++}return n},numberToOrdinal:function(t,e){if(t>1999)return t.toString()+"a";if(t<=12)return Qt.special.onesOrdinals[t-1];const n=[];if(t>=1e3&&(t-=1e3,n.push("mil\xe9sima")),!t)return n.join(" ");let r=0;return r=Math.floor(t/100),r>0&&(n.push(Qt.special.hundredsOrdinals[r-1]),t%=100),t<=12?n.push(Qt.special.onesOrdinals[t-1]):(r=Math.floor(t/10),r>0&&(n.push(Qt.special.tensOrdinals[r-1]),t%=10),t>0&&n.push(Qt.special.onesOrdinals[t-1])),n.join(" ")}}),Jt=function(t,e,n){return t="sans serif "+(n?n+" "+t:t),e?t+" "+e:t};let Zt=null;let te=null;function ee(t){let e=t%1e3,n="";if(n+=oe.ones[Math.floor(e/100)]?oe.ones[Math.floor(e/100)]+"-cent":"",e%=100,e){n+=n?"-":"";let t=oe.ones[e];if(t)n+=t;else{const r=oe.tens[Math.floor(e/10)];r.match(/-dix$/)?(t=oe.ones[e%10+10],n+=r.replace(/-dix$/,"")+"-"+t):n+=r+(e%10?"-"+oe.ones[e%10]:"")}}const r=n.match(/s-\w+$/);return r?n.replace(/s-\w+$/,r[0].slice(1)):n.replace(/-un$/,"-et-un")}function ne(t){if(0===t)return oe.zero;if(t>=Math.pow(10,36))return t.toString();oe.special["tens-"+N.getInstance().subiso]&&(oe.tens=oe.special["tens-"+N.getInstance().subiso]);let e=0,n="";for(;t>0;){const r=t%1e3;if(r){let t=oe.large[e];const s=ee(r);if(t&&t.match(/^mille /)){const r=t.replace(/^mille /,"");n=n.match(RegExp(r))?s+(e?"-mille-":"")+n:n.match(RegExp(r.replace(/s$/,"")))?s+(e?"-mille-":"")+n.replace(r.replace(/s$/,""),r):s+(e?"-"+t+"-":"")+n}else t=1===r&&t?t.replace(/s$/,""):t,n=s+(e?"-"+t+"-":"")+n}t=Math.floor(t/1e3),e++}return n.replace(/-$/,"")}const re={1:"uni\xe8me",2:"demi",3:"tiers",4:"quart"};function se(t){if(1===t)return"premi\xe8re";let e=ne(t);return e.match(/^neuf$/)?e=e.slice(0,-1)+"v":e.match(/cinq$/)?e+="u":e.match(/trois$/)?e+="":(e.match(/e$/)||e.match(/s$/))&&(e=e.slice(0,-1)),e+="i\xe8me",e}const oe=lt({wordOrdinal:se,numericOrdinal:function(t){const e=gt.getInstance().getParameter("gender");return 1===t?t.toString()+("m"===e?"er":"re"):t.toString()+"e"},numberToWords:ne,numberToOrdinal:function(t,e){const n=re[t]||se(t);return 3===t?n:e?n+"s":n}});let ie=null;function ce(t){if(0===t)return le.zero;if(t>=Math.pow(10,32))return t.toString();let e=0,n="";const r=function(t){let e=t%1e3,n="";return n+=le.ones[Math.floor(e/100)]?le.ones[Math.floor(e/100)]+le.numSep+le.special.hundred:"",e%=100,e&&(n+=n?le.numSep:"",n+=le.ones[e]),n}(t%1e3);if(!(t=Math.floor(t/1e3)))return r;for(;t>0;){const r=t%100;r&&(n=le.ones[r]+le.numSep+le.large[e]+(n?le.numSep+n:"")),t=Math.floor(t/100),e++}return r?n+le.numSep+r:n}function ae(t){const e=gt.getInstance().getParameter("gender");if(t<=0)return t.toString();if(t<10)return"f"===e?le.special.ordinalsFeminine[t]:le.special.ordinalsMasculine[t];return ce(t)+("f"===e?"\u0935\u0940\u0902":"\u0935\u093e\u0901")}const le=lt({wordOrdinal:ae,numericOrdinal:function(t){const e=gt.getInstance().getParameter("gender");return t>0&&t<10?"f"===e?le.special.simpleSmallOrdinalsFeminine[t]:le.special.simpleSmallOrdinalsMasculine[t]:t.toString().split("").map((function(t){const e=parseInt(t,10);return isNaN(e)?"":le.special.simpleNumbers[e]})).join("")+("f"===e?"\u0935\u0940\u0902":"\u0935\u093e\u0901")},numberToWords:ce,numberToOrdinal:function(t,e){return t<=10?le.special.smallDenominators[t]:ae(t)+" \u0905\u0902\u0936"}});let ue=null;function he(t){let e=t%1e4,n="";return n+=me.ones[Math.floor(e/1e3)]?1===Math.floor(e/1e3)?"\ucc9c":me.ones[Math.floor(e/1e3)]+"\ucc9c":"",e%=1e3,e&&(n+=me.ones[Math.floor(e/100)]?1===Math.floor(e/100)?"\ubc31":me.ones[Math.floor(e/100)]+"\ubc31":"",e%=100,n+=me.tens[Math.floor(e/10)]+(e%10?me.ones[e%10]:"")),n}function de(t){if(0===t)return me.zero;if(t>=Math.pow(10,36))return t.toString();let e=0,n="";for(;t>0;){t%1e4&&(n=he(t%1e4)+(e?me.large[e]+me.numSep:"")+n),t=Math.floor(t/1e4),e++}return n.replace(/ $/,"")}function fe(t,e){return 1===t?"\uccab\ubc88\uc9f8":pe(t)+"\ubc88\uc9f8"}function pe(t){const e=de(t),n=de(t%=100);if(!n||!t)return e;const r=20===t?"\uc2a4\ubb34":me.tens[10+Math.floor(t/10)],s=me.ones[10+Math.floor(t%10)];return e.slice(0,-n.length)+r+s}const me=lt({wordOrdinal:pe,numericOrdinal:function(t){return fe(t)},numberToWords:de,numberToOrdinal:fe});let Ee=null;function ge(t){let e=t%1e3,n="";if(n+=Te.ones[Math.floor(e/100)]?Te.ones[Math.floor(e/100)]+Te.numSep+"cento":"",e%=100,e){n+=n?Te.numSep:"";const t=Te.ones[e];if(t)n+=t;else{let t=Te.tens[Math.floor(e/10)];const r=e%10;1!==r&&8!==r||(t=t.slice(0,-1)),n+=t,n+=r?Te.numSep+Te.ones[e%10]:""}}return n}function Ne(t){if(0===t)return Te.zero;if(t>=Math.pow(10,36))return t.toString();if(1===t&&gt.getInstance().getParameter("fraction"))return"un";let e=0,n="";for(;t>0;){t%1e3&&(n=ge(t%1e3)+(e?"-"+Te.large[e]+"-":"")+n),t=Math.floor(t/1e3),e++}return n.replace(/-$/,"")}function Se(t){const e="m"===gt.getInstance().getParameter("gender")?"o":"a";let n=Te.special.onesOrdinals[t];return n?n.slice(0,-1)+e:(n=Ne(t),n.slice(0,-1)+"esim"+e)}const Te=lt({wordOrdinal:Se,numericOrdinal:function(t){const e=gt.getInstance().getParameter("gender");return t.toString()+("m"===e?"o":"a")},numberToWords:Ne,numberToOrdinal:function(t,e){if(2===t)return e?"mezzi":"mezzo";const n=Se(t);if(!e)return n;const r=n.match(/o$/)?"i":"e";return n.slice(0,-1)+r}}),Ie=function(t,e,n){return t.match(/^[a-zA-Z]$/)&&(e=e.replace("cerchiato","cerchiata")),t=n?t+" "+n:t,e?t+" "+e:t};let Ae=null;function Re(t,e=!1){let n=t%1e3,r="";const s=Math.floor(n/100),o=be.ones[s];if(r+=o?(1===s?"":o)+"hundre":"",n%=100,n){if(r+=r?"og":"",e){const t=be.special.smallOrdinals[n];if(t)return r+t;if(n%10)return r+be.tens[Math.floor(n/10)]+be.special.smallOrdinals[n%10]}r+=be.ones[n]||be.tens[Math.floor(n/10)]+(n%10?be.ones[n%10]:"")}return e?Oe(r):r}function Oe(t){const e=be.special.endOrdinal[0];return"a"===e&&t.match(/en$/)?t.slice(0,-2)+be.special.endOrdinal:t.match(/(d|n)$/)||t.match(/hundre$/)?t+"de":t.match(/i$/)?t+be.special.endOrdinal:"a"===e&&t.match(/e$/)?t.slice(0,-1)+be.special.endOrdinal:(t.match(/e$/),t+"nde")}function Ce(t){return ye(t,!0)}const be=lt({wordOrdinal:Ce,numericOrdinal:function(t){return t.toString()+"."},numberToWords:ye,numberToOrdinal:function(t,e){return Ce(t)}});function Le(t,e=!1){return t===be.ones[1]?"ein"===t?"eitt ":e?"et":"ett":t}function Me(t,e=!1){let n=t%1e3,r="",s=be.ones[Math.floor(n/100)];if(r+=s?Le(s)+"hundre":"",n%=100,n){if(r+=r?"og":"",e){const t=be.special.smallOrdinals[n];if(t)return r+t}if(s=be.ones[n],s)r+=s;else{const t=be.tens[Math.floor(n/10)];s=be.ones[n%10],r+=s?s+"og"+t:t}}return e?Oe(r):r}function ye(t,e=!1){const n="alt"===N.getInstance().subiso?function(t,e=!1){if(0===t)return e?be.special.smallOrdinals[0]:be.zero;if(t>=Math.pow(10,36))return t.toString();let n=0,r="";for(;t>0;){const s=t%1e3;if(s){const o=Me(t%1e3,!n&&e);!n&&e&&(e=!e),r=(1===n?Le(o,!0):o)+(n>1?be.numSep:"")+(n?be.large[n]+(n>1&&s>1?"er":""):"")+(n>1&&r?be.numSep:"")+r}t=Math.floor(t/1e3),n++}return e?r+(r.match(/tusen$/)?"de":"te"):r}(t,e):function(t,e=!1){if(0===t)return e?be.special.smallOrdinals[0]:be.zero;if(t>=Math.pow(10,36))return t.toString();let n=0,r="";for(;t>0;){const s=t%1e3;if(s){const o=Re(t%1e3,!n&&e);!n&&e&&(e=!e),r=o+(n?" "+be.large[n]+(n>1&&s>1?"er":"")+(r?" ":""):"")+r}t=Math.floor(t/1e3),n++}return e?r+(r.match(/tusen$/)?"de":"te"):r}(t,e);return n}let _e=null;function Pe(t){return t.toString().split("").map((function(t){return Fe.ones[parseInt(t,10)]})).join("")}const Fe=lt({numberToWords:Pe,numberToOrdinal:Pe}),Ue=function(t){return t.match(RegExp("^"+ke.ALPHABETS.languagePrefix.english))?t.slice(1):t},xe=function(t,e,n){return t=Ue(t),e?t+e:t},De=function(t,e,n){return e+Ue(t)},ve=function(t,e,n){return e+(n||"")+(t=Ue(t))+"\u283b"},we=function(t,e,n){return e+(n||"")+(t=Ue(t))+"\u283b\u283b"},Be=function(t,e,n){return e+(t=Ue(t))+"\u283e"};let ke=null;let Ge=null;function Ve(t){let e=t%1e3,n="";const r=Math.floor(e/100);return n+=He.ones[r]?(1===r?"":He.ones[r]+He.numSep)+"hundra":"",e%=100,e&&(n+=n?He.numSep:"",n+=He.ones[e]||He.tens[Math.floor(e/10)]+(e%10?He.numSep+He.ones[e%10]:"")),n}function $e(t,e=!1){if(0===t)return He.zero;if(t>=Math.pow(10,36))return t.toString();let n=0,r="";for(;t>0;){const s=t%1e3;if(s){const o=He.large[n],i=s>1&&n>1&&!e?"er":"";r=(1===n&&1===s?"":(n>1&&1===s?"en":Ve(t%1e3))+(n>1?" ":""))+(n?o+i+(n>1?" ":""):"")+r}t=Math.floor(t/1e3),n++}return r.replace(/ $/,"")}function je(t){let e=$e(t,!0);return e.match(/^noll$/)?e="nollte":e.match(/ett$/)?e=e.replace(/ett$/,"f\xf6rsta"):e.match(/tv\xe5$/)?e=e.replace(/tv\xe5$/,"andra"):e.match(/tre$/)?e=e.replace(/tre$/,"tredje"):e.match(/fyra$/)?e=e.replace(/fyra$/,"fj\xe4rde"):e.match(/fem$/)?e=e.replace(/fem$/,"femte"):e.match(/sex$/)?e=e.replace(/sex$/,"sj\xe4tte"):e.match(/sju$/)?e=e.replace(/sju$/,"sjunde"):e.match(/\xe5tta$/)?e=e.replace(/\xe5tta$/,"\xe5ttonde"):e.match(/nio$/)?e=e.replace(/nio$/,"nionde"):e.match(/tio$/)?e=e.replace(/tio$/,"tionde"):e.match(/elva$/)?e=e.replace(/elva$/,"elfte"):e.match(/tolv$/)?e=e.replace(/tolv$/,"tolfte"):e.match(/tusen$/)?e=e.replace(/tusen$/,"tusonde"):e.match(/jard$/)||e.match(/jon$/)?e+="te":e+="de",e}const He=lt({wordOrdinal:je,numericOrdinal:function(t){const e=t.toString();return e.match(/11$|12$/)?e+":e":e+(e.match(/1$|2$/)?":a":":e")},numberToWords:$e,numberToOrdinal:function(t,e){if(1===t)return"hel";if(2===t)return e?"halva":"halv";let n=je(t);return n=n.match(/de$/)?n.replace(/de$/,""):n,n+(e?"delar":"del")}});let Xe=null;const We={af:function(){return Ot||(Ot=function(){const t=ht();return t.NUMBERS=At,t.COMBINERS.germanPostfix=Rt,t.FUNCTIONS.radicalNestDepth=dt,t.FUNCTIONS.plural=t=>/.*s$/.test(t)?t:t+"s",t.FUNCTIONS.fontRegexp=function(t){return new RegExp("((^"+t+" )|( "+t+"$))")},t.ALPHABETS.combiner=it.prefixCombiner,t.ALPHABETS.digitTrans.default=At.numberToWords,t.CORRECTIONS.article=t=>gt.getInstance().getParameter("noArticle")?"":t,t}()),Ot},ca:function(){return _t||(_t=function(){const t=ht();return t.NUMBERS=Mt,t.COMBINERS.sansserif=yt,t.FUNCTIONS.fracNestDepth=t=>!1,t.FUNCTIONS.combineRootIndex=ft,t.FUNCTIONS.combineNestedRadical=(t,e,n)=>t+n,t.FUNCTIONS.fontRegexp=t=>RegExp("^"+t+" "),t.FUNCTIONS.plural=t=>/.*os$/.test(t)?t+"sos":/.*s$/.test(t)?t+"os":/.*ga$/.test(t)?t.slice(0,-2)+"gues":/.*\xe7a$/.test(t)?t.slice(0,-2)+"ces":/.*ca$/.test(t)?t.slice(0,-2)+"ques":/.*ja$/.test(t)?t.slice(0,-2)+"ges":/.*qua$/.test(t)?t.slice(0,-3)+"q\xfces":/.*a$/.test(t)?t.slice(0,-1)+"es":/.*(e|i)$/.test(t)?t+"ns":/.*\xed$/.test(t)?t.slice(0,-1)+"ins":t+"s",t.FUNCTIONS.si=(t,e)=>(e.match(/^metre/)&&(t=t.replace(/a$/,"\xe0").replace(/o$/,"\xf2").replace(/i$/,"\xed")),t+e),t.ALPHABETS.combiner=it.prefixCombiner,t}()),_t},da:function(){return vt||(vt=function(){const t=ht();return t.NUMBERS=Dt,t.FUNCTIONS.radicalNestDepth=dt,t.FUNCTIONS.fontRegexp=e=>e===t.ALPHABETS.capPrefix.default?RegExp("^"+e+" "):RegExp(" "+e+"$"),t.ALPHABETS.combiner=it.postfixCombiner,t.ALPHABETS.digitTrans.default=Dt.numberToWords,t}()),vt},de:function(){return Ht||(Ht=function(){const t=ht();return t.NUMBERS=Vt,t.COMBINERS.germanPostfix=jt,t.ALPHABETS.combiner=$t,t.FUNCTIONS.radicalNestDepth=e=>e>1?t.NUMBERS.numberToWords(e)+"fach":"",t.FUNCTIONS.combineRootIndex=(t,e)=>{const n=e?e+"wurzel":"";return t.replace("Wurzel",n)},t.FUNCTIONS.combineNestedRadical=(t,e,n)=>{const r=(e?e+" ":"")+(t=n.match(/exponent$/)?t+"r":t);return n.match(/ /)?n.replace(/ /," "+r+" "):r+" "+n},t.FUNCTIONS.fontRegexp=function(t){return t=t.split(" ").map((function(t){return t.replace(/s$/,"(|s)")})).join(" "),new RegExp("((^"+t+" )|( "+t+"$))")},t.CORRECTIONS.correctOne=t=>t.replace(/^eins$/,"ein"),t.CORRECTIONS.localFontNumber=t=>pt(t).split(" ").map((function(t){return t.replace(/s$/,"")})).join(" "),t.CORRECTIONS.lowercase=t=>t.toLowerCase(),t.CORRECTIONS.article=t=>{const e=gt.getInstance().getParameter("case"),n=gt.getInstance().getParameter("plural");return"dative"===e?{der:"dem",die:n?"den":"der",das:"dem"}[t]:t},t.CORRECTIONS.masculine=t=>"dative"===gt.getInstance().getParameter("case")?t+"n":t,t}()),Ht},en:function(){return qt||(qt=function(){const t=ht();return t.NUMBERS=Kt,t.FUNCTIONS.radicalNestDepth=dt,t.FUNCTIONS.plural=t=>/.*s$/.test(t)?t:t+"s",t.ALPHABETS.combiner=it.prefixCombiner,t.ALPHABETS.digitTrans.default=Kt.numberToWords,t.CORRECTIONS.article=t=>gt.getInstance().getParameter("noArticle")?"":t,t}()),qt},es:function(){return Zt||(Zt=function(){const t=ht();return t.NUMBERS=Qt,t.COMBINERS.sansserif=Jt,t.FUNCTIONS.fracNestDepth=t=>!1,t.FUNCTIONS.combineRootIndex=ft,t.FUNCTIONS.combineNestedRadical=(t,e,n)=>t+n,t.FUNCTIONS.fontRegexp=t=>RegExp("^"+t+" "),t.FUNCTIONS.plural=t=>/.*(a|e|i|o|u)$/.test(t)?t+"s":/.*z$/.test(t)?t.slice(0,-1)+"ces":/.*c$/.test(t)?t.slice(0,-1)+"ques":/.*g$/.test(t)?t+"ues":/.*\u00f3n$/.test(t)?t.slice(0,-2)+"ones":t+"es",t.FUNCTIONS.si=(t,e)=>(e.match(/^metro/)&&(t=t.replace(/a$/,"\xe1").replace(/o$/,"\xf3").replace(/i$/,"\xed")),t+e),t.ALPHABETS.combiner=it.prefixCombiner,t}()),Zt},euro:function(){return te||(te=ht()),te},fr:function(){return ie||(ie=function(){const t=ht();return t.NUMBERS=oe,t.FUNCTIONS.radicalNestDepth=dt,t.FUNCTIONS.combineRootIndex=ft,t.FUNCTIONS.combineNestedFraction=(t,e,n)=>n.replace(/ $/g,"")+e+t,t.FUNCTIONS.combineNestedRadical=(t,e,n)=>n+" "+t,t.FUNCTIONS.fontRegexp=t=>RegExp(" (en |)"+t+"$"),t.FUNCTIONS.plural=t=>/.*s$/.test(t)?t:t+"s",t.CORRECTIONS.article=t=>gt.getInstance().getParameter("noArticle")?"":t,t.ALPHABETS.combiner=it.romanceCombiner,t.SUBISO={default:"fr",current:"fr",all:["fr","be","ch"]},t}()),ie},hi:function(){return ue||(ue=function(){const t=ht();return t.NUMBERS=le,t.ALPHABETS.combiner=it.prefixCombiner,t.FUNCTIONS.radicalNestDepth=dt,t}()),ue},it:function(){return Ae||(Ae=function(){const t=ht();return t.NUMBERS=Te,t.COMBINERS.italianPostfix=Ie,t.FUNCTIONS.radicalNestDepth=dt,t.FUNCTIONS.combineRootIndex=ft,t.FUNCTIONS.combineNestedFraction=(t,e,n)=>n.replace(/ $/g,"")+e+t,t.FUNCTIONS.combineNestedRadical=(t,e,n)=>n+" "+t,t.FUNCTIONS.fontRegexp=t=>RegExp(" (en |)"+t+"$"),t.ALPHABETS.combiner=it.romanceCombiner,t}()),Ae},ko:function(){return Ee||(Ee=function(){const t=ht();return t.NUMBERS=me,t.FUNCTIONS.radicalNestDepth=dt,t.FUNCTIONS.plural=function(t){return t},t.FUNCTIONS.si=(t,e)=>t+e,t.FUNCTIONS.combineRootIndex=function(t,e){return t+e},t.ALPHABETS.combiner=it.prefixCombiner,t.ALPHABETS.digitTrans.default=me.numberToWords,t.CORRECTIONS.postposition=t=>{if(["\uac19\ub2e4","\ub294","\uc640","\ub97c","\ub85c"].includes(t))return t;const e=t.slice(-1);let n=(e.charCodeAt(0)-44032)%28>0;return e.match(/[r,l,n,m,1,3,6,7,8,0]/i)&&(n=!0),gt.getInstance().setParameter("final",n),t},t.CORRECTIONS.article=t=>{const e=gt.getInstance().getParameter("final");e&&gt.getInstance().setParameter("final",!1),"\uac19\ub2e4"===t&&(t="\ub294");const n={\ub294:"\uc740",\uc640:"\uacfc",\ub97c:"\uc744",\ub85c:"\uc73c\ub85c"}[t];return void 0!==n&&e?n:t},t}()),Ee},nb:function(){return _e||(_e=function(){const t=ht();return t.NUMBERS=be,t.ALPHABETS.combiner=it.prefixCombiner,t.ALPHABETS.digitTrans.default=be.numberToWords,t.FUNCTIONS.radicalNestDepth=dt,t}()),_e},nn:function(){return Ge||(Ge=function(){const t=ht();return t.NUMBERS=be,t.ALPHABETS.combiner=it.prefixCombiner,t.ALPHABETS.digitTrans.default=be.numberToWords,t.FUNCTIONS.radicalNestDepth=dt,t.SUBISO={default:"",current:"",all:["","alt"]},t}()),Ge},sv:function(){return Xe||(Xe=function(){const t=ht();return t.NUMBERS=He,t.FUNCTIONS.radicalNestDepth=dt,t.FUNCTIONS.fontRegexp=function(t){return new RegExp("((^"+t+" )|( "+t+"$))")},t.ALPHABETS.combiner=it.prefixCombiner,t.ALPHABETS.digitTrans.default=He.numberToWords,t.CORRECTIONS.correctOne=t=>t.replace(/^ett$/,"en"),t}()),Xe},nemeth:function(){return ke||(ke=function(){const t=ht();return t.NUMBERS=Fe,t.COMBINERS={postfixCombiner:xe,germanCombiner:De,embellishCombiner:ve,doubleEmbellishCombiner:we,parensCombiner:Be},t.FUNCTIONS.fracNestDepth=t=>!1,t.FUNCTIONS.fontRegexp=t=>RegExp("^"+t),t.FUNCTIONS.si=st,t.ALPHABETS.combiner=(t,e,n)=>e?e+n+t:Ue(t),t.ALPHABETS.digitTrans={default:Fe.numberToWords},t}()),ke}};function Ye(){const t=function(){const t=E.u.ensureLocale(N.getInstance().locale,N.getInstance().defaultLocale);return N.getInstance().locale=t,We[t]()}();if(function(t){const e=N.getInstance().subiso;-1===t.SUBISO.all.indexOf(e)&&(N.getInstance().subiso=t.SUBISO.default);t.SUBISO.current=N.getInstance().subiso}(t),t){for(const e of Object.getOwnPropertyNames(t))ut[e]=t[e];for(const[e,n]of Object.entries(t.CORRECTIONS))gt.getInstance().setCorrection(e,n)}}function Ke(){return"undefined"!=typeof window&&"ActiveXObject"in window&&"clipboardData"in window&&(Je(p.f.mathmapsIePath),ze(),!0)}const qe=null;function ze(t){Je(p.f.WGXpath),Qe(t)}function Qe(t,e){let n=e||1;"undefined"==typeof wgxpath&&n<10?setTimeout((function(){Qe(t,n++)}),200):n>=10||(p.f.wgxpath=wgxpath,t?p.f.wgxpath.install({document}):p.f.wgxpath.install(),I.evaluate=document.evaluate,I.result=XPathResult,I.createNSResolver=document.createNSResolver)}function Je(t){const e=p.f.document.createElement("script");e.type="text/javascript",e.src=t,p.f.document.head?p.f.document.head.appendChild(e):p.f.document.body.appendChild(e)}function Ze(t){return t.match("/$")?t:t+"/"}function tn(t,e="json"){return Ze(p.f.jsonPath)+t+(e.match(/^\./)?e:"."+e)}var en=function(t,e){var n={};for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&e.indexOf(r)<0&&(n[r]=t[r]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var s=0;for(r=Object.getOwnPropertySymbols(t);s<r.length;s++)e.indexOf(r[s])<0&&Object.prototype.propertyIsEnumerable.call(t,r[s])&&(n[r[s]]=t[r[s]])}return n};const nn={functionApplication:String.fromCodePoint(8289),invisibleTimes:String.fromCodePoint(8290),invisibleComma:String.fromCodePoint(8291),invisiblePlus:String.fromCodePoint(8292)};class rn extends Map{get(t){return super.get(t)||{role:J.UNKNOWN,type:z.UNKNOWN,font:tt.UNKNOWN}}}class sn extends Map{set(t,e,n=""){return super.set(this.secKey(e,t),n||e),this}has(t,e){return super.has(this.secKey(e,t))}get(t,e){return super.get(this.secKey(e,t))}secKey(t,e){return e?`${t} ${e}`:`${t}`}}const on={Meaning:new rn,Secondary:new sn,FencesHoriz:new Map,FencesVert:new Map,LatexCommands:new Map};function cn(t,e){for(const n of t)on.Meaning.set(n,{role:e.role||J.UNKNOWN,type:e.type||z.UNKNOWN,font:e.font||tt.UNKNOWN}),e.secondary&&on.Secondary.set(n,e.secondary)}function an(t,e,n=1){const r={},s=function(t){let e=[];for(const n of t)Array.isArray(n)?e=e.concat(H(n,{}).map((t=>parseInt(t,16)))):e.push(parseInt(n,16));return e}(e);for(const e of s)r[e]||(t.set(String.fromCodePoint(e),String.fromCodePoint(e+n)),r[e]=!0,r[e+n]=!0)}const ln=["cos","cot","csc","sec","sin","tan","arccos","arccot","arccsc","arcsec","arcsin","arctan"].concat(["cosh","coth","csch","sech","sinh","tanh","arcosh","arcoth","arcsch","arsech","arsinh","artanh"],["deg","det","dim","hom","ker","Tr"],["log","ln","lg","exp","gcd","lcm","arg","im","re","Pr"]);function un(t,e,n,r,s,o=[],i={},c={}){const a=Y.get(K(t,r));a&&(a.unicode.forEach((t=>{on.Meaning.set(t,{type:e,role:n,font:s}),o.forEach((e=>on.Secondary.set(t,e)))})),function(t,e){for(const[n,r]of Object.entries(e)){const e=t[n];void 0!==e&&on.Meaning.set(e,r)}}(a.unicode,i),function(t,e){for(const[n,r]of Object.entries(e)){const e=t[n];void 0!==e&&on.Secondary.set(e,r)}}(a.unicode,c))}[{set:["23","26","40","5c","a1","a7","b6","bf","2017",["2022","2025"],"2027","203b","203c",["2041","2043"],["2047","2049"],["204b","204d"],"2050","2055","2056",["2058","205e"],"2234","2235","fe45","fe46","fe5f","fe60","fe68","fe6b","ff03","ff06","ff0f","ff20","ff3c"],type:z.PUNCTUATION,role:J.UNKNOWN},{set:["22","ab","bb","2dd",["2018","201f"],"2039","203a",["301d","301f"],"fe10","ff02","ff07"],type:z.PUNCTUATION,role:J.QUOTES},{set:["3b","204f","2a1f","2a3e","fe14","fe54","ff1b"],type:z.PUNCTUATION,role:J.SEMICOLON},{set:["3f","203d","fe16","fe56","ff1f"],type:z.PUNCTUATION,role:J.QUESTION},{set:["21","fe15","fe57","ff01"],type:z.PUNCTUATION,role:J.EXCLAMATION},{set:["5e","60","a8","aa","b4","ba","2c7",["2d8","2da"],"2040","207a","207d","207e","ff3e","ff40"],type:z.PUNCTUATION,role:J.OVERACCENT},{set:["b8","2db","2038","203f","2054","208a","208d","208e"],type:z.PUNCTUATION,role:J.UNDERACCENT},{set:["3a","2982","fe13","fe30","fe55","ff1a"],type:z.PUNCTUATION,role:J.COLON},{set:["2c","2063","fe50","ff0c"],type:z.PUNCTUATION,role:J.COMMA},{set:["2026",["22ee","22f1"],"fe19"],type:z.PUNCTUATION,role:J.ELLIPSIS},{set:["2e","fe52","ff0e"],type:z.PUNCTUATION,role:J.FULLSTOP},{set:["2d","207b","208b","2212","2796","fe63","ff0d"],type:z.OPERATOR,role:J.DASH,secondary:nt.BAR},{set:["5f","af",["2010","2015"],"203e","208b",["fe49","fe4f"],"fe58","ff3f","ffe3"],type:z.PUNCTUATION,role:J.DASH,secondary:nt.BAR},{set:["7e","2dc","2f7","303","330","334","2053","223c","223d","301c","ff5e"],type:z.OPERATOR,role:J.TILDE,secondary:nt.TILDE},{set:["27","2b9","2ba",["2032","2037"],"2057"],type:z.PUNCTUATION,role:J.PRIME},{set:["b0"],type:z.PUNCTUATION,role:J.DEGREE},{set:["2b","b1","2064","2213","2214","2228","222a",["228c","228e"],"2294","2295","229d","229e","22bb","22bd","22c4","22ce","22d3","2304","271b","271c","2795","27cf","29fa","29fb","29fe",["2a22","2a28"],"2a2d","2a2e","2a39","2a42","2a45","2a46","2a48","2a4a","2a4c","2a4f","2a50","2a52","2a54","2a56","2a57","2a59","2a5b","2a5d",["2a61","2a63"],"2adc","2add","fe62","ff0b"],type:z.OPERATOR,role:J.ADDITION},{set:["2a","b7","d7","2020","2021","204e","2051","2062",["2217","2219"],"2227","2229","2240","2293","2297",["2299","229b"],"22a0","22a1","22b9","22bc",["22c5","22cc"],"22cf","22d2","22d4","2303","2305","2306","25cb","2715","2716","27ce","27d1",["29d1","29d7"],"29e2","2a1d",["2a2f","2a37"],["2a3b","2a3d"],"2a40","2a43","2a44","2a47","2a49","2a4b","2a4d","2a4e","2a51","2a53","2a55","2a58","2a5a","2a5c",["2a5e","2a60"],"2ada","2adb","fe61","ff0a"],type:z.OPERATOR,role:J.MULTIPLICATION},{set:["2d","af","2010","2011","2052","207b","208b","2212","2216","2238","2242","2296","229f","2796","29ff",["2a29","2a2c"],"2a3a","2a41","fe63","ff0d"],type:z.OPERATOR,role:J.SUBTRACTION},{set:["2f","f7","2044","2215","2298","2797","27cc","29bc",["29f5","29f9"],"2a38"],type:z.OPERATOR,role:J.DIVISION},{set:["25","2030","2031","ff05","fe6a"],type:z.OPERATOR,role:J.POSTFIXOP},{set:["ac","2200","2201","2203","2204","2206",["221a","221c"],"2310","ffe2"],type:z.OPERATOR,role:J.PREFIXOP},{set:["2320","2321","23aa","23ae","23af","23b2","23b3","23b6","23b7"],type:z.OPERATOR,role:J.PREFIXOP},{set:["1d7ca","1d7cb"],type:z.OPERATOR,role:J.PREFIXOP,font:tt.BOLD},{set:["3d","7e","207c","208c","221d","2237",["223a","223f"],"2243","2245","2248",["224a","224e"],["2251","225f"],"2261","2263","229c","22cd","22d5","29e4","29e6","2a66","2a67",["2a6a","2a6c"],["2a6c","2a78"],"fe66","ff1d"],type:z.RELATION,role:J.EQUALITY},{set:["3c","3e","2241","2242","2244","2246","2247","2249","224f","2250","2260","2262",["2264","2281"],"22b0","22b1",["22d6","22e1"],["22e6","22e9"],["2976","2978"],"29c0","29c1","29e1","29e3","29e5",["2a79","2abc"],["2af7","2afa"],"fe64","fe65","ff1c","ff1e"],type:z.RELATION,role:J.INEQUALITY},{set:[["2282","228b"],["228f","2292"],["22b2","22b8"],"22d0","22d1",["22e2","22e5"],["22ea","22ed"],"27c3","27c4",["27c7","27c9"],["27d5","27d7"],"27dc",["2979","297b"],"29df",["2abd","2ad8"]],type:z.RELATION,role:J.SET},{set:["2236",["27e0","27e5"],"292b","292c",["29b5","29bb"],"29be","29bf",["29c2","29d0"]],type:z.RELATION,role:J.UNKNOWN},{set:["2205",["29b0","29b4"]],type:z.IDENTIFIER,role:J.SETEMPTY},{set:["1ab2","221e",["29dc","29de"]],type:z.IDENTIFIER,role:J.INFTY},{set:["22a2","22a3",["22a6","22af"],"27da","27db","27dd","27de","2ade",["2ae2","2ae6"],"2aec","2aed"],type:z.RELATION,role:J.LOGIC},{set:["22a4","22a5","22ba","27d8","27d9","27df","2adf","2ae0",["2ae7","2aeb"],"2af1"],type:z.IDENTIFIER,role:J.LOGIC},{set:[["2190","21ff"],"2301","2324","238b","2794",["2798","27af"],["27b1","27be"],["27f0","27ff"],["2900","292a"],["292d","2975"],["297c","297f"],["2b00","2b11"],["2b30","2b4c"],["ffe9","ffec"]],type:z.RELATION,role:J.ARROW},{set:["2208","220a",["22f2","22f9"],"22ff","27d2","2ad9"],type:z.OPERATOR,role:J.ELEMENT},{set:["2209"],type:z.OPERATOR,role:J.NONELEMENT},{set:["220b","220d",["22fa","22fe"]],type:z.OPERATOR,role:J.REELEMENT},{set:["220c"],type:z.OPERATOR,role:J.RENONELEMENT},{set:[["220f","2211"],["22c0","22c3"],["2a00","2a0b"],"2a3f","2afc","2aff"],type:z.LARGEOP,role:J.SUM},{set:["2140"],type:z.LARGEOP,role:J.SUM,font:tt.DOUBLESTRUCK},{set:[["222b","2233"],["2a0c","2a17"],["2a17","2a1c"]],type:z.LARGEOP,role:J.INTEGRAL},{set:[["2500","257F"]],type:z.RELATION,role:J.BOX},{set:[["2580","259F"]],type:z.IDENTIFIER,role:J.BLOCK},{set:[["25A0","25FF"],["2B12","2B2F"],["2B50","2B59"]],type:z.RELATION,role:J.GEOMETRY},{set:["220e","2300","2302","2311","29bd","29e0",["29e8","29f3"],"2a1e","2afe","ffed","ffee"],type:z.OPERATOR,role:J.GEOMETRY},{set:[["221f","2222"],"22be","22bf",["2312","2314"],"237c","27c0",["299b","29af"]],type:z.OPERATOR,role:J.GEOMETRY},{set:["24",["a2","a5"],"b5","2123",["2125","2127"],"212a","212b","fe69","ff04","ffe0","ffe1","ffe5","ffe6"],type:z.IDENTIFIER,role:J.UNKNOWN},{set:["a9","ae","210f","2114","2116","2117",["211e","2122"],"212e","2132",["2139","213b"],["2141","2144"],"214d","214e",["1f12a","1f12c"],"1f18a"],type:z.IDENTIFIER,role:J.OTHERLETTER},{set:["2224","2226","2239","2307","27b0","27bf","27c1","27c2","27ca","27cb","27cd","27d0","27d3","27d4","2981","2999","299a","29e7","29f4","2a20","2a21","2a64","2a65","2a68","2a69","2ae1",["2aee","2af0"],"2af2","2af3","2af5","2af6","2afb","2afd"],type:z.OPERATOR,role:J.UNKNOWN},{set:["2605","2606","26aa","26ab",["2720","274d"]],type:z.OPERATOR,role:J.UNKNOWN},{set:[["2145","2149"]],type:z.IDENTIFIER,role:J.LATINLETTER,font:tt.DOUBLESTRUCKITALIC,secondary:nt.ALLLETTERS},{set:[["213c","213f"]],type:z.IDENTIFIER,role:J.GREEKLETTER,font:tt.DOUBLESTRUCK,secondary:nt.ALLLETTERS},{set:["3d0","3d7","3f6",["1d26","1d2a"],"1d5e","1d60",["1d66","1d6a"]],type:z.IDENTIFIER,role:J.GREEKLETTER,font:tt.NORMAL,secondary:nt.ALLLETTERS},{set:[["2135","2138"]],type:z.IDENTIFIER,role:J.OTHERLETTER,font:tt.NORMAL,secondary:nt.ALLLETTERS},{set:["131","237"],type:z.IDENTIFIER,role:J.LATINLETTER,font:tt.NORMAL},{set:["1d6a4","1d6a5"],type:z.IDENTIFIER,role:J.LATINLETTER,font:tt.ITALIC},{set:["2113","2118"],type:z.IDENTIFIER,role:J.LATINLETTER,font:tt.SCRIPT},{set:[["c0","d6"],["d8","f6"],["f8","1bf"],["1c4","2af"],["1d00","1d25"],["1d6b","1d9a"],["1e00","1ef9"],["363","36f"],["1dd3","1de6"],["1d62","1d65"],"1dca","2071","207f",["2090","209c"],"2c7c"],type:z.IDENTIFIER,role:J.LATINLETTER,font:tt.NORMAL},{set:[["00bc","00be"],["2150","215f"],"2189"],type:z.NUMBER,role:J.FLOAT},{set:["23E8",["3248","324f"]],type:z.NUMBER,role:J.INTEGER},{set:[["214A","214C"],"2705","2713","2714","2717","2718"],type:z.IDENTIFIER,role:J.UNKNOWN},{set:["20","a0","ad",["2000","200f"],["2028","202f"],["205f","2060"],"206a","206b","206e","206f","feff",["fff9","fffb"]],type:z.TEXT,role:J.SPACE},{set:["7c","a6","2223","23b8","23b9","23d0","2758",["fe31","fe34"],"ff5c","ffe4","ffe8"],type:z.FENCE,role:J.NEUTRAL},{set:["2016","2225","2980","2af4"],type:z.FENCE,role:J.METRIC}].forEach((t=>{var{set:e}=t,n=en(t,["set"]);return cn(function(t){let e=[];for(const n of t)Array.isArray(n)?e=e.concat(X(n)):e.push(String.fromCodePoint(parseInt(n,16)));return e}(e),n)})),an(on.FencesVert,["23b4",["23dc","23e1"],["fe35","fe44"],"fe47"]),an(on.FencesHoriz,["28","2045",["2308","230f"],["231c","231f"],"2329","23b0",["2768","2775"],"27c5",["27e6","27ef"],["2983","2998"],["29d8","29db"],"29fc",["2e22","2e29"],["3008","3011"],["3014","301b"],"fd3e","fe17",["fe59","fe5e"],"ff08","ff5f","ff62"]),an(on.FencesHoriz,["5b","7b","ff3b","ff5b"],2),an(on.FencesHoriz,[["239b","23a6"]],3),an(on.FencesHoriz,[["23a7","23a9"]],4),cn([...on.FencesHoriz.keys()],{type:z.FENCE,role:J.OPEN}),cn([...on.FencesHoriz.values()],{type:z.FENCE,role:J.CLOSE}),cn([...on.FencesVert.keys()],{type:z.FENCE,role:J.TOP}),cn([...on.FencesVert.values()],{type:z.FENCE,role:J.BOTTOM}),function(){for(const[t,e]of Object.entries(tt)){const n=!!F[t]?tt.UNKNOWN:e===tt.FULLWIDTH?tt.NORMAL:e;un(U.LATINCAP,z.IDENTIFIER,J.LATINLETTER,e,n,[nt.ALLLETTERS]),un(U.LATINSMALL,z.IDENTIFIER,J.LATINLETTER,e,n,[nt.ALLLETTERS],{},{3:nt.D}),un(U.GREEKCAP,z.IDENTIFIER,J.GREEKLETTER,e,n,[nt.ALLLETTERS]),un(U.GREEKSMALL,z.IDENTIFIER,J.GREEKLETTER,e,n,[nt.ALLLETTERS],{0:{type:z.OPERATOR,role:J.PREFIXOP,font:n},26:{type:z.OPERATOR,role:J.PREFIXOP,font:n}}),un(U.DIGIT,z.NUMBER,J.INTEGER,e,n)}}(),cn(["inf","lim","liminf","limsup","max","min","sup","injlim","projlim"],{type:z.FUNCTION,role:J.LIMFUNC}),cn(ln,{type:z.FUNCTION,role:J.PREFIXFUNC}),cn(["mod","rem"],{type:z.OPERATOR,role:J.PREFIXFUNC});class hn{constructor(){this.rules=new Map}static parseUnicode(t){const e=parseInt(t,16);return String.fromCodePoint(e)}static testDynamicConstraints_(t,e){return N.getInstance().strict?e.cstr.equal(t):N.getInstance().comparator.match(e.cstr)}defineRulesFromMappings(t,e,n){for(const[r,s]of Object.entries(n))for(const[n,o]of Object.entries(s))this.defineRuleFromStrings(t,e,r,n,o)}getRules(t){let e=this.rules.get(t);return e||(e=[],this.rules.set(t,e)),e}defineRuleFromStrings(t,e,n,r,s){let o=this.getRules(t);const i=N.getInstance().parsers[n]||N.getInstance().defaultParser,c=N.getInstance().comparators[n],a=`${t}.${e}.${n}.${r}`,l=i.parse(a),u=c?c():N.getInstance().comparator,h=u.getReference();u.setReference(l);const d={cstr:l,action:s};o=o.filter((t=>!l.equal(t.cstr))),o.push(d),this.rules.set(t,o),u.setReference(h)}lookupRule(t,e){let n=this.getRules(e.getValue(r.LOCALE));return n=n.filter((function(t){return hn.testDynamicConstraints_(e,t)})),1===n.length?n[0]:n.length?n.sort(((t,e)=>N.getInstance().comparator.compare(t.cstr,e.cstr)))[0]:null}}let dn=c.DEFAULT_VALUES[r.LOCALE],fn=c.DEFAULT_VALUES[r.MODALITY];function pn(t){return!(!t.locale&&!t.modality)&&(dn=t.locale||dn,fn=t.modality||fn,!0)}let mn={};function En(t){mn=t}const gn=new Map,Nn=new Map;function Sn(t,e){let n=gn.get(e);return n||(n=new hn,n.base=Nn.get(t),gn.set(e,n),n)}function Tn(t){const e=Nn.get(t.key);if(!e)return;const n=t.names;Object.assign(t,e),n&&e.names&&(t.names=t.names.concat(n))}function In(t,e,n){Sn(t,e).defineRulesFromMappings(dn,fn,n)}function An(t,e,n,r){Sn(n,n).defineRuleFromStrings(dn,fn,t,e,r)}function Rn(t){if(!pn(t))for(const[e,n]of Object.entries(t))An("default","default",e,n)}function On(t){for(let e,n=0;e=t.names[n];n++)In(t.key,e,t.mappings)}function Cn(t){for(const e of Object.keys(mn)){const n=Object.assign({},t);n.mappings={};const r=mn[e];n.names=n.names.map((function(t){return e+t}));for(const e of Object.keys(t.mappings)){n.mappings[e]={};for(const s of Object.keys(t.mappings[e]))n.mappings[e][s]=We[dn]().FUNCTIONS.si(r,t.mappings[e][s])}On(n)}}function bn(t,e){return e=e||{},t.length?(e[t[0]]=bn(t.slice(1),e[t[0]]),e):e}N.getInstance().evaluator=function(t,e){const n=function(t,e){const n=gn.get(t);return n?n.lookupRule(null,e):null}(t,e);return n?n.action:null};class Ln{constructor(t,e){this.speech=t,this.attributes=e}static empty(){return new Ln("",{})}static stringEmpty(t){return new Ln(t,{})}static stringAttr(t,e){return new Ln(t,e)}static singleton(t,e={}){return[Ln.stringAttr(t,e)]}static node(t,e,n={}){const r=Ln.getAttributes(e);return Object.assign(r,n),new Ln(t,r)}static getAttributes(t){const e={};for(const n of Ln.attributeList)t.hasAttribute(n)&&(e[n]=t.getAttribute(n));return e}}Ln.attributeList=["id","extid"];class Mn{constructor(t=null){this.data=t,this.prev=null,this.next=null}}class yn extends Set{constructor(t){super(),this.annotations=[],this.anchor=new Mn,this.anchor.next=this.anchor,this.anchor.prev=this.anchor,t.forEach((t=>{let e=new Mn(t);t.annotation&&this.annotations.push(e),this.push(e)}))}first(){return this.empty?null:this.anchor.next}last(){return this.empty?null:this.anchor.prev}push(t){t.next=this.anchor,t.prev=this.anchor.prev,t.prev.next=t,this.anchor.prev=t,super.add(t)}pop(){let t=this.last();return t?(this.delete(t),t):null}delete(t){return!!this.has(t)&&(super.delete(t),t.prev.next=t.next,t.next=t.prev,!0)}insertAfter(t,e){this.insertBefore(t,e.next)}insertBefore(t,e){let n=new Mn(t);e&&this.has(e)?(e.prev.next=n,n.prev=e.prev,n.next=e,e.prev=n):this.push(n)}prevText(t){do{t=t.prev}while(t!==this.anchor&&!t.data.text);return t===this.anchor?null:t}*[Symbol.iterator](){let t=this.anchor.next;for(;t!==this.anchor;)yield t,t=t.next}nextText(t){for(;t!==this.anchor&&!t.data.text;)t=t.next;return t}clear(){this.anchor.next=this.anchor,this.anchor.prev=this.anchor,super.clear()}empty(){return this.anchor.prev===this.anchor&&this.anchor===this.anchor.next}toList(){let t=[],e=this.anchor.next;for(;e!==this.anchor;)t.push(e.data),e=e.next;return t}}class _n{static create(t,e={}){return t.text=gt.getInstance().apply(t.text,e),new _n(t)}constructor({context:t,text:e,userValue:n,annotation:r,attributes:s,personality:o,layout:i}){this.context=t||"",this.text=e||"",this.userValue=n||"",this.annotation=r||"",this.attributes=s||{},this.personality=o||{},this.layout=i||""}isEmpty(){return 0===this.context.length&&0===this.text.length&&0===this.userValue.length&&0===this.annotation.length}clone(){let t,e;if(this.personality){t={};for(const[e,n]of Object.entries(this.personality))t[e]=n}if(this.attributes){e={};for(const[t,n]of Object.entries(this.attributes))e[t]=n}return new _n({context:this.context,text:this.text,userValue:this.userValue,annotation:this.annotation,personality:t,attributes:e,layout:this.layout})}toString(){return'AuditoryDescription(context="'+this.context+'"  text="'+this.text+'"  userValue="'+this.userValue+'"  annotation="'+this.annotation+'")'}descriptionString(){return this.context&&this.text?this.context+" "+this.text:this.context||this.text}descriptionSpan(){return Ln.stringAttr(this.descriptionString(),this.attributes)}equals(t){return this.context===t.context&&this.text===t.text&&this.userValue===t.userValue&&this.annotation===t.annotation}}const Pn=new Map;function Fn(t,e,n){const r={};if(e){const t=Pn.get(e)||{};Object.assign(r,t)}Pn.set(t,Object.assign(r,n))}function Un(t,e){const n=t.length;let r=0,s=e;return e||(s=""),function(){return r<n&&(r+=1),s+" "+r}}function xn(t,e){const n=parseFloat(e),r=isNaN(n)?e:n;return function(){return[_n.create({text:"",personality:{pause:r}})]}}function Dn(t,e){let n;return n=t.length>0?b("../../content/*",t[0]):[],function(){const t=n.shift(),r=e?[_n.create({text:e},{translate:!0})]:[];if(!t)return r;const s=N.evaluateNode(t);return r.concat(s)}}class vn{constructor(t,e,n){this.domain=t,this.name=e,this.func=n,this.active=!1}annotate(t){t.childNodes.forEach(this.annotate.bind(this)),t.addAnnotation(this.domain,this.func(t))}}class wn{constructor(t,e,n,r={}){this.domain=t,this.name=e,this.func=n,this.def=r,this.active=!1}visit(t,e){let n=this.func(t,e);t.addAnnotation(this.domain,n[0]);for(let e,r=0;e=t.childNodes[r];r++)n=this.visit(e,n[1]);return n}}const Bn=new Map,kn=new Map;function Gn(t){const e=t.domain+":"+t.name;t instanceof vn?Bn.set(e,t):kn.set(e,t)}function Vn(t,e){const n=t+":"+e,r=Bn.get(n)||kn.get(n);r&&(r.active=!0)}function $n(t,e){const n=e.split("-"),r=Un(t,n[0]||""),s=n[1]||"",o=n[2]||"";let i=!0;return function(){const t=r();return i?(i=!1,o+t+s):t+s}}function jn(t){return Yn(t)||function(t){return Xn(t)||t.type===z.INFIXOP&&t.role===J.IMPLICIT&&(2===t.childNodes.length&&(Xn(t.childNodes[0])||Yn(t.childNodes[0]))&&Xn(t.childNodes[1])||3===t.childNodes.length&&Yn(t.childNodes[0])&&Xn(t.childNodes[1])&&Xn(t.childNodes[2]))}(t)||function(t){return t.type===z.PUNCTUATED&&t.role===J.ENDPUNCT&&2===t.childNodes.length&&t.childNodes[1].role===J.DEGREE&&(Xn(t.childNodes[0])||Wn(t.childNodes[0])||t.childNodes[0].type===z.PREFIXOP&&t.childNodes[0].role===J.NEGATIVE&&(Xn(t.childNodes[0].childNodes[0])||Wn(t.childNodes[0].childNodes[0])))}(t)||function(t){return t.type===z.PREFIXOP&&t.role===J.NEGATIVE&&Hn(t.childNodes[0])&&t.childNodes[0].type!==z.PREFIXOP&&t.childNodes[0].type!==z.APPL&&t.childNodes[0].type!==z.PUNCTUATED}(t)||function(t){return t.type===z.APPL&&(t.childNodes[0].role===J.PREFIXFUNC||t.childNodes[0].role===J.SIMPLEFUNC)&&(Hn(t.childNodes[1])||t.childNodes[1].type===z.FENCED&&Hn(t.childNodes[1].childNodes[0]))}(t)}function Hn(t){return t.hasAnnotation("clearspeak","simple")}function Xn(t){return t.type===z.IDENTIFIER&&(t.role===J.LATINLETTER||t.role===J.GREEKLETTER||t.role===J.OTHERLETTER||t.role===J.SIMPLEFUNC)}function Wn(t){return t.type===z.NUMBER&&(t.role===J.INTEGER||t.role===J.FLOAT)}function Yn(t){return Wn(t)||function(t){if(Kn("Fraction_Over")||Kn("Fraction_FracOver"))return!1;if(t.type!==z.FRACTION||t.role!==J.VULGAR)return!1;if(Kn("Fraction_Ordinal"))return!0;const e=parseInt(t.childNodes[0].textContent,10),n=parseInt(t.childNodes[1].textContent,10);return e>0&&e<20&&n>0&&n<11}(t)}function Kn(t){return N.getInstance().style===t}function qn(t){if(function(t){if(!t.hasAttribute("annotation"))return!1;const e=t.getAttribute("annotation");return!!/clearspeak:simple$|clearspeak:simple;/.exec(e)}(t))return!0;if(t.tagName!==z.SUBSCRIPT)return!1;const e=t.childNodes[0].childNodes,n=e[1];return e[0].tagName===z.IDENTIFIER&&(zn(n)||n.tagName===z.INFIXOP&&n.hasAttribute("role")&&n.getAttribute("role")===J.IMPLICIT&&function(t){const e=b("children/*",t);return e.every((t=>zn(t)||t.tagName===z.IDENTIFIER))}(n))}function zn(t){return t.tagName===z.NUMBER&&t.hasAttribute("role")&&t.getAttribute("role")===J.INTEGER}function Qn(t){return b(t.tagName===z.MATRIX?"children/row/children/cell/children/*":"children/line/children/*",t).every(qn)?[t]:[]}function Jn(t){return at(t,20,11)?[t]:[]}function Zn(t){return t.type===z.TEXT||t.type===z.PUNCTUATED&&t.role===J.TEXT&&Wn(t.childNodes[0])&&function(t){for(let e=0;e<t.length-1;e++)if(t[e].type!==z.TEXT||""!==t[e].textContent)return!1;return t[t.length-1].type===z.TEXT}(t.childNodes.slice(1))||t.type===z.IDENTIFIER&&t.role===J.UNIT||t.type===z.INFIXOP&&(t.role===J.IMPLICIT||t.role===J.UNIT)}function tr(t){const e=parseInt(t.textContent,10);return[Ln.stringEmpty(isNaN(e)?t.textContent:e>10?ut.NUMBERS.numericOrdinal(e):ut.NUMBERS.wordOrdinal(e))]}Gn(new vn("clearspeak","simple",(function(t){return jn(t)?"simple":""}))),Gn(new vn("clearspeak","unit",(function(t){return Zn(t)?"unit":""})));let er=null;function nr(t){let e=0;const n=t.textContent,r="open"===t.getAttribute("role")?0:1;let s=t.parentNode;for(;s;)s.tagName===z.FENCED&&s.childNodes[0].childNodes[r].textContent===n&&e++,s=s.parentNode;return er=e>1?ut.NUMBERS.wordOrdinal(e):"",[Ln.stringEmpty(er)]}function rr(t){const e=t.previousSibling;let n,r;return e?(n=e,r=t):(n=t,r=t.nextSibling),r&&function(t,e){const n=on.Meaning.get(t);return n.type===z.FENCE&&(n.role===J.NEUTRAL||n.role===J.METRIC?t===e:on.FencesHoriz.get(t)===e||on.FencesVert.get(t)===e)}(n.textContent,r.textContent)?[t]:[]}function sr(t){const e=M(t.parentNode.childNodes),n=b("../../children/*",t),r=e.indexOf(t);return cr(n[r])||cr(n[r+1])?[t]:[]}function or(t){const e=M(t.parentNode.childNodes),n=b("../../children/*",t),r=e.indexOf(t);return ir(n[r])&&n[r+1]&&(ir(n[r+1])||n[r+1].tagName===z.ROOT||n[r+1].tagName===z.SQRT||n[r+1].tagName===z.SUPERSCRIPT&&n[r+1].childNodes[0].childNodes[0]&&(n[r+1].childNodes[0].childNodes[0].tagName===z.NUMBER||n[r+1].childNodes[0].childNodes[0].tagName===z.IDENTIFIER)&&("2"===n[r+1].childNodes[0].childNodes[1].textContent||"3"===n[r+1].childNodes[0].childNodes[1].textContent))?[t]:[]}function ir(t){return!!t&&(t.tagName===z.NUMBER||t.tagName===z.IDENTIFIER||t.tagName===z.FUNCTION||t.tagName===z.APPL||t.tagName===z.FRACTION)}function cr(t){return t&&(t.tagName===z.FENCED||t.hasAttribute("role")&&t.getAttribute("role")===J.LEFTRIGHT||function(t){return!!t&&(t.tagName===z.MATRIX||t.tagName===z.VECTOR)}(t))}function ar(t){return[Ln.stringEmpty(ut.NUMBERS.wordOrdinal(parseInt(t.textContent,10)))]}function lr(t,e){const n=[];for(;t.length||e.length;)t.length&&n.push(t.shift()),e.length&&n.push(e.shift());return n}function ur(t,e){return t?e?t.filter((t=>e.indexOf(t)<0)):t:[]}gt.getInstance().setCorrection("insertNesting",(function(t,e){if(!e||!t)return t;const n=t.match(/^(open|close) /);return n?n[0]+e+" "+t.substring(n[0].length):e+" "+t}));const hr={factory:null,updateFactory:function(t){hr.factory=t},heuristics:new Map,flags:{combine_juxtaposition:!0,convert_juxtaposition:!0,multioperator:!0},blacklist:{},add:function(t){const e=t.name;hr.heuristics.set(e,t),hr.flags[e]||(hr.flags[e]=!1)},run:function(t,e,n){const r=hr.heuristics.get(t);return r&&!hr.blacklist[t]&&(hr.flags[t]||r.applicable(e))?r.apply(e):n?n(e):e}},dr=[];function fr(t,e){for(let n,r=0;n=dr[r];r++){const r=n.compare(t,e);if(0!==r)return r}return 0}function pr(t){if(t.length<=1)return t;const e=t.slice();!function(t){t.sort(fr)}(e);const n=[];let r;do{r=e.pop(),n.push(r)}while(r&&e.length&&0===fr(e[e.length-1],r));return n}function mr(t,e){return t.match(/^.+:.+$/)||!e?t:t+":"+e}new class{constructor(t,e=null){this.comparator=t,this.type=e,function(t){dr.push(t)}(this)}compare(t,e){return this.type&&this.type===t.type&&this.type===e.type?this.comparator(t,e):0}}((function(t,e){return t.role===J.SIMPLEFUNC?1:e.role===J.SIMPLEFUNC?-1:0}),z.IDENTIFIER);class Er extends Map{set(t,e){return super.set(mr(t,e.font),e),this}setNode(t){this.set(t.textContent,t.meaning())}get(t,e=null){return super.get(mr(t,e))}getNode(t){return this.get(t.textContent,t.font)}}class gr extends Map{add(t,e){const n=this.get(t);n?n.push(e):super.set(t,[e])}get(t,e=null){return super.get(mr(t,e))}getNode(t){return this.get(t.textContent,t.font)}minimize(){for(const[t,e]of this)1===e.length&&this.delete(t)}isMultiValued(){for(const t of this.values())if(t.length>1)return!0;return!1}}class Nr extends gr{add(t,e){super.add(mr(t,e.font),e)}addNode(t){this.add(t.textContent,t)}toString(){const t=[];for(const[e,n]of this){const r=Array(e.length+3).join(" "),s=n.map((t=>t.toString())).join("\n"+r);t.push(e+": "+s)}return t.join("\n")}collateMeaning(){const t=new Sr;for(const[e,n]of this)t.set(e,n.map((t=>t.meaning())));return t}}class Sr extends gr{add(t,e){const n=this.get(t,e.font);n&&n.find((function(t){return r=e,(n=t).type===r.type&&n.role===r.role&&n.font===r.font;var n,r}))||super.add(mr(t,e.font),e)}addNode(t){this.add(t.textContent,t.meaning())}toString(){const t=[];for(const[e,n]of this){const r=Array(e.length+3).join(" "),s=n.map((t=>`{type: ${t.type}, role: ${t.role}, font: ${t.font}}`)).join("\n"+r);t.push(e+": "+s)}return t.join("\n")}reduce(){for(const[t,e]of this)1!==e.length&&this.set(t,pr(e))}default(){const t=new Er;for(const[e,n]of this)1===n.length&&t.set(e,n[0]);return t}newDefault(){const t=this.default();this.reduce();const e=this.default();return t.size!==e.size?e:null}}var Tr;!function(t){t.ANNOTATION="ANNOTATION",t.ANNOTATIONXML="ANNOTATION-XML",t.MACTION="MACTION",t.MALIGNGROUP="MALIGNGROUP",t.MALIGNMARK="MALIGNMARK",t.MATH="MATH",t.MENCLOSE="MENCLOSE",t.MERROR="MERROR",t.MFENCED="MFENCED",t.MFRAC="MFRAC",t.MGLYPH="MGLYPH",t.MI="MI",t.MLABELEDTR="MLABELEDTR",t.MMULTISCRIPTS="MMULTISCRIPTS",t.MN="MN",t.MO="MO",t.MOVER="MOVER",t.MPADDED="MPADDED",t.MPHANTOM="MPHANTOM",t.MPRESCRIPTS="MPRESCRIPTS",t.MROOT="MROOT",t.MROW="MROW",t.MS="MS",t.MSPACE="MSPACE",t.MSQRT="MSQRT",t.MSTYLE="MSTYLE",t.MSUB="MSUB",t.MSUBSUP="MSUBSUP",t.MSUP="MSUP",t.MTABLE="MTABLE",t.MTD="MTD",t.MTEXT="MTEXT",t.MTR="MTR",t.MUNDER="MUNDER",t.MUNDEROVER="MUNDEROVER",t.NONE="NONE",t.SEMANTICS="SEMANTICS"}(Tr||(Tr={}));const Ir=[Tr.MO,Tr.MI,Tr.MN,Tr.MTEXT,Tr.MS,Tr.MSPACE],Ar=[Tr.MERROR,Tr.MPHANTOM,Tr.MALIGNGROUP,Tr.MALIGNMARK,Tr.MPRESCRIPTS,Tr.ANNOTATION,Tr.ANNOTATIONXML],Rr=[Tr.MATH,Tr.MROW,Tr.MPADDED,Tr.MACTION,Tr.NONE,Tr.MSTYLE,Tr.SEMANTICS],Or=[Tr.MROOT,Tr.MSQRT],Cr=["aria-label","exact-speech","alt"];function br(t){return!!t&&G(t)===Tr.MATH}function Lr(t){return!!t&&-1!==Ar.indexOf(G(t))}function Mr(t){return!!t&&-1!==Rr.indexOf(G(t))}function yr(t){return!!t&&G(t)===Tr.MGLYPH&&!function(t){return!!t&&-1!==Ir.indexOf(G(t))}(t.parentNode)}function _r(t){const e=[];for(let n,r=0;n=t[r];r++){if(n.nodeType!==_.ELEMENT_NODE)continue;const t=G(n);-1===Ar.indexOf(t)&&(-1!==Rr.indexOf(t)&&0===n.childNodes.length||e.push(n))}return e}function Pr(t,e){if(e.hasAttributes()){const n=e.attributes;for(let e=n.length-1;e>=0;e--){const r=n[e].name;r.match(/^ext/)&&(t.attributes[r]=n[e].value,t.nobreaking=!0),-1!==Cr.indexOf(r)&&(t.attributes["ext-speech"]=n[e].value,t.nobreaking=!0),r.match(/texclass$/)&&(t.attributes.texclass=n[e].value),"data-latex"===r.toLowerCase()&&(t.attributes.latex=n[e].value),"href"===r&&(t.attributes.href=n[e].value,t.nobreaking=!0)}}}function Fr(t){return t&&t.embellished&&t.childNodes.length>0?Fr(t.childNodes[0]):t}function Ur(t,e,n){n&&t.reverse();const r=[];for(let s,o=0;s=t[o];o++){if(e(s))return n?{head:t.slice(o+1).reverse(),div:s,tail:r.reverse()}:{head:r,div:s,tail:t.slice(o+1)};r.push(s)}return n?{head:[],div:null,tail:r.reverse()}:{head:r,div:null,tail:[]}}function xr(t,e){let n=t;const r=[],s=[];let o=null;do{o=Ur(n,e),s.push(o.head),r.push(o.div),n=o.tail}while(o.div);return r.pop(),{rel:r,comp:s}}class Dr{static fromXml(t){const e=parseInt(t.getAttribute("id"),10),n=new Dr(e);return n.type=t.tagName,Dr.setAttribute(n,t,"role"),Dr.setAttribute(n,t,"font"),Dr.setAttribute(n,t,"embellished"),Dr.setAttribute(n,t,"fencepointer","fencePointer"),t.getAttribute("annotation")&&n.parseAnnotation(t.getAttribute("annotation")),Pr(n,t),Dr.processChildren(n,t),n}static setAttribute(t,e,n,r){r=r||n;const s=e.getAttribute(n);s&&(t[r]=s)}static processChildren(t,e){for(const n of M(e.childNodes)){if(n.nodeType===_.TEXT_NODE){t.textContent=n.textContent;continue}const e=M(n.childNodes).map(Dr.fromXml);e.forEach((e=>e.parent=t)),"CONTENT"===G(n)?t.contentNodes=e:t.childNodes=e}}constructor(t){this.id=t,this.mathml=[],this.parent=null,this.type=z.UNKNOWN,this.role=J.UNKNOWN,this.font=tt.UNKNOWN,this.embellished=null,this.fencePointer="",this.childNodes=[],this.textContent="",this.mathmlTree=null,this.contentNodes=[],this.annotation={},this.attributes={},this.nobreaking=!1}querySelectorAll(t){let e=[];for(let n,r=0;n=this.childNodes[r];r++)e=e.concat(n.querySelectorAll(t));for(let n,r=0;n=this.contentNodes[r];r++)e=e.concat(n.querySelectorAll(t));return t(this)&&e.unshift(this),e}xml(t,e){const n=function(n,r){const s=r.map((function(n){return n.xml(t,e)})),o=t.createElementNS("",n);for(let t,e=0;t=s[e];e++)o.appendChild(t);return o},r=t.createElementNS("",this.type);return e||this.xmlAttributes(r),r.textContent=this.textContent,this.contentNodes.length>0&&r.appendChild(n("content",this.contentNodes)),this.childNodes.length>0&&r.appendChild(n("children",this.childNodes)),r}toString(t=!1){const e=y("<snode/>");return $(this.xml(e.ownerDocument,t))}allAttributes(){const t=[];return t.push(["role",this.role]),this.font!==tt.UNKNOWN&&t.push(["font",this.font]),Object.keys(this.annotation).length&&t.push(["annotation",this.annotationXml()]),this.embellished&&t.push(["embellished",this.embellished]),this.fencePointer&&t.push(["fencepointer",this.fencePointer]),t.push(["id",this.id.toString()]),t}annotationXml(){const t=[];for(const[e,n]of Object.entries(this.annotation))n.forEach((n=>t.push(e+":"+n)));return t.join(";")}attributesXml(){const t=[];for(const[e,n]of Object.entries(this.attributes))t.push(e+":"+Dr.escapeValue(n));return t.join(";")}toJson(){const t={};t.type=this.type;const e=this.allAttributes();for(let n,r=0;n=e[r];r++)t[n[0]]=n[1].toString();return this.textContent&&(t.$t=this.textContent),this.childNodes.length&&(t.children=this.childNodes.map((function(t){return t.toJson()}))),this.contentNodes.length&&(t.content=this.contentNodes.map((function(t){return t.toJson()}))),t}updateContent(t,e){const n=e?t.replace(/^[ \f\n\r\t\v\u200b]*/,"").replace(/[ \f\n\r\t\v\u200b]*$/,""):t.trim();if(t=t&&!n?t:n,this.textContent===t)return;const r=on.Meaning.get(t);this.textContent=t,this.role=r.role,this.type=r.type,this.font=r.font}addMathmlNodes(t){for(let e,n=0;e=t[n];n++)-1===this.mathml.indexOf(e)&&this.mathml.push(e)}appendChild(t){this.childNodes.push(t),this.addMathmlNodes(t.mathml),t.parent=this}replaceChild(t,e){const n=this.childNodes.indexOf(t);if(-1===n)return;t.parent=null,e.parent=this,this.childNodes[n]=e;const r=t.mathml.filter((function(t){return-1===e.mathml.indexOf(t)})),s=e.mathml.filter((function(e){return-1===t.mathml.indexOf(e)}));this.removeMathmlNodes(r),this.addMathmlNodes(s)}appendContentNode(t){t&&(this.contentNodes.push(t),this.addMathmlNodes(t.mathml),t.parent=this)}removeContentNode(t){if(t){const e=this.contentNodes.indexOf(t);-1!==e&&this.contentNodes.slice(e,1)}}equals(t){if(!t)return!1;if(this.type!==t.type||this.role!==t.role||this.textContent!==t.textContent||this.childNodes.length!==t.childNodes.length||this.contentNodes.length!==t.contentNodes.length)return!1;for(let e,n,r=0;e=this.childNodes[r],n=t.childNodes[r];r++)if(!e.equals(n))return!1;for(let e,n,r=0;e=this.contentNodes[r],n=t.contentNodes[r];r++)if(!e.equals(n))return!1;return!0}displayTree(){console.info(this.displayTree_(0))}addAnnotation(t,e){e&&this.addAnnotation_(t,e)}getAnnotation(t){const e=this.annotation[t];return e||[]}hasAnnotation(t,e){const n=this.annotation[t];return!!n&&-1!==n.indexOf(e)}parseAnnotation(t){const e=t.split(";");for(let t=0,n=e.length;t<n;t++){const n=e[t].split(":");this.addAnnotation(n[0],n[1])}}meaning(){return{type:this.type,role:this.role,font:this.font}}xmlAttributes(t){const e=this.allAttributes();for(let n,r=0;n=e[r];r++)t.setAttribute(n[0],n[1]);this.addExternalAttributes(t)}addExternalAttributes(t){for(const[e,n]of Object.entries(this.attributes))t.setAttribute(e,n)}static escapeValue(t){return t.replace(/;/g,"\\0003B")}parseAttributes(t){if(!t)return;const e=t.split(";");for(let t=0,n=e.length;t<n;t++){const[n,...r]=e[t].split(":");n&&(this.attributes[n]=r.join("").replace(/\\0003B/g,";"))}}removeMathmlNodes(t){const e=this.mathml;for(let n,r=0;n=t[r];r++){const t=e.indexOf(n);-1!==t&&e.splice(t,1)}this.mathml=e}displayTree_(t){t++;const e=Array(t).join("  ");let n="";n+="\n"+e+this.toString(),n+="\n"+e+"MathmlTree:",n+="\n"+e+this.mathmlTreeString(),n+="\n"+e+"MathML:";for(let t,r=0;t=this.mathml[r];r++)n+="\n"+e+t.toString();return n+="\n"+e+"Begin Content",this.contentNodes.forEach((function(e){n+=e.displayTree_(t)})),n+="\n"+e+"End Content",n+="\n"+e+"Begin Children",this.childNodes.forEach((function(e){n+=e.displayTree_(t)})),n+="\n"+e+"End Children",n}mathmlTreeString(){return this.mathmlTree?this.mathmlTree.toString():"EMPTY"}addAnnotation_(t,e){const n=this.annotation[t];n?n.push(e):this.annotation[t]=[e]}}class vr{constructor(){this.leafMap=new Nr,this.defaultMap=new Er,this.idCounter_=-1}makeNode(t){return this.createNode_(t)}makeUnprocessed(t){const e=this.createNode_();return e.mathml=[t],e.mathmlTree=t,e}makeEmptyNode(){const t=this.createNode_();return t.type=z.EMPTY,t}makeContentNode(t){const e=this.createNode_();return e.updateContent(t),e}makeMultipleContentNodes(t,e){const n=[];for(let r=0;r<t;r++)n.push(this.makeContentNode(e));return n}makeLeafNode(t,e){if(!t)return this.makeEmptyNode();const n=this.makeContentNode(t);n.font=e||n.font;const r=this.defaultMap.getNode(n);return r&&(n.type=r.type,n.role=r.role,n.font=r.font),this.leafMap.addNode(n),n}makeBranchNode(t,e,n,r){const s=this.createNode_();return r&&s.updateContent(r),s.type=t,s.childNodes=e,s.contentNodes=n,e.concat(n).forEach((function(t){t.parent=s,s.addMathmlNodes(t.mathml)})),s}createNode_(t){return void 0!==t?this.idCounter_=Math.max(this.idCounter_,t):t=++this.idCounter_,new Dr(t)}}function wr(t,e){return t.type===e}function Br(t,e){return t.embellished===e}function kr(t,e){return t.role===e}function Gr(t){return wr(t,z.FENCE)||wr(t,z.PUNCTUATION)||wr(t,z.OPERATOR)||wr(t,z.RELATION)}function Vr(t){return Yr(t)&&!kr(t,J.DIVISION)||wr(t,z.APPL)||Xr(t)}function $r(t){return Yr(t)||Xr(t)}function jr(t,e){return!!e&&wr(e,z.IDENTIFIER)&&on.Secondary.has(t.textContent,nt.D)}function Hr(t){if(wr(t,z.IDENTIFIER)){const e=t.textContent[0];return e&&t.textContent[1]&&on.Secondary.has(e,nt.D)}return!1}function Xr(t){return Kr(t)||qr(t)}function Wr(t){return t.embellished?t.embellished:(e=t.type)===z.OPERATOR||e===z.RELATION||e===z.FENCE||e===z.PUNCTUATION?t.type:null;var e}function Yr(t){return wr(t,z.OPERATOR)||Br(t,z.OPERATOR)}function Kr(t){return wr(t,z.RELATION)||Br(t,z.RELATION)}function qr(t){return wr(t,z.PUNCTUATION)||Br(t,z.PUNCTUATION)}function zr(t){return wr(t,z.FENCE)||Br(t,z.FENCE)}function Qr(t){return!(!t||!zr(t))&&(!t.embellished||Jr(t))}function Jr(t){return!t.embellished||!function(t){return wr(t,z.TENSOR)&&(!wr(t.childNodes[1],z.EMPTY)||!wr(t.childNodes[2],z.EMPTY))&&(!wr(t.childNodes[3],z.EMPTY)||!wr(t.childNodes[4],z.EMPTY))}(t)&&((!kr(t,J.CLOSE)||!wr(t,z.TENSOR))&&((!kr(t,J.OPEN)||!wr(t,z.SUBSCRIPT)&&!wr(t,z.SUPERSCRIPT))&&Jr(t.childNodes[0])))}function Zr(t){return!!t&&(wr(t,z.TABLE)||wr(t,z.MULTILINE))}function ts(t){return!!t&&es(t)&&Zr(t.childNodes[0])}function es(t){return!!t&&wr(t,z.FENCED)&&(kr(t,J.LEFTRIGHT)||ms(t))&&1===t.childNodes.length}function ns(t,e){return e.length>0&&kr(e[e.length-1],J.OPENFENCE)}function rs(t){return t.childNodes.every((function(t){return t.childNodes.length<=1}))}function ss(t){return wr(t,z.LARGEOP)||wr(t,z.LIMBOTH)||wr(t,z.LIMLOWER)||wr(t,z.LIMUPPER)||wr(t,z.FUNCTION)&&kr(t,J.LIMFUNC)||(wr(t,z.OVERSCORE)||wr(t,z.UNDERSCORE))&&ss(t.childNodes[0])}function os(t,e,n){return 1===e.length&&(t[n].type===z.PUNCTUATION||t[n].embellished===z.PUNCTUATION)&&t[n]===e[0]}function is(t){return wr(t,z.IDENTIFIER)&&kr(t,J.SIMPLEFUNC)}const cs=[z.PUNCTUATION,z.PUNCTUATED,z.RELSEQ,z.MULTIREL,z.TABLE,z.MULTILINE,z.CASES,z.INFERENCE],as=[z.LIMUPPER,z.LIMLOWER,z.LIMBOTH,z.SUBSCRIPT,z.SUPERSCRIPT,z.UNDERSCORE,z.OVERSCORE,z.TENSOR];function ls(t){const e=t.type;return-1===cs.indexOf(e)&&(e!==z.INFIXOP||t.role===J.IMPLICIT)&&(e===z.FENCED?t.role!==J.LEFTRIGHT||ls(t.childNodes[0]):-1===as.indexOf(e)||ls(t.childNodes[0]))}function us(t){return function(t){return t.type===z.NUMBER&&(t.role===J.INTEGER||t.role===J.FLOAT)}(t)||t.role===J.VULGAR||t.role===J.MIXED}function hs(t){const e=t.childNodes;return t.role===J.UNIT&&(!e.length||e[0].role===J.UNIT)}function ds(t){const e=t.childNodes;return t.type===z.INFIXOP&&(t.role===J.MULTIPLICATION||t.role===J.IMPLICIT)&&e.length&&(hs(e[0])||us(e[0]))&&t.childNodes.slice(1).every(hs)}function fs(t){return t.type===z.INFIXOP&&(t.role===J.IMPLICIT||t.role===J.UNIT&&!!t.contentNodes.length&&t.contentNodes[0].textContent===nn.invisibleTimes)}function ps(t){return t.type===z.INFIXOP&&t.role===J.IMPLICIT}function ms(t){return t.role===J.NEUTRAL||t.role===J.METRIC}function Es(t,e){return ms(t)&&ms(e)&&Fr(t).textContent===Fr(e).textContent}function gs(t){return!!ms(t)&&(!t.embellished||t.type!==z.SUPERSCRIPT&&t.type!==z.SUBSCRIPT&&(t.type!==z.TENSOR||t.childNodes[3].type===z.EMPTY&&t.childNodes[4].type===z.EMPTY))}function Ns(t){return!!ms(t)&&(!t.embellished||(t.type!==z.TENSOR||t.childNodes[1].type===z.EMPTY&&t.childNodes[2].type===z.EMPTY))}class Ss{static getInstance(){return Ss.instance=Ss.instance||new Ss,Ss.instance}static tableToMultiline(t){if(!rs(t))return hr.run("rewrite_subcases",t,Ss.classifyTable);t.type=z.MULTILINE;for(let e,n=0;e=t.childNodes[n];n++)Ss.rowToLine_(e,J.MULTILINE);var e;return 1!==t.childNodes.length||wr(e=t.childNodes[0],z.LINE)&&e.contentNodes.length&&kr(e.contentNodes[0],J.LABEL)||!es(t.childNodes[0].childNodes[0])||Ss.tableToMatrixOrVector_(Ss.rewriteFencedLine_(t)),Ss.binomialForm_(t),Ss.classifyMultiline(t),t}static number(t){t.type!==z.UNKNOWN&&t.type!==z.IDENTIFIER||(t.type=z.NUMBER),Ss.meaningFromContent(t,Ss.numberRole_),Ss.exprFont_(t)}static classifyMultiline(t){let e=0;const n=t.childNodes.length;let r;for(;e<n&&(!(r=t.childNodes[e])||!r.childNodes.length);)e++;if(e>=n)return;const s=r.childNodes[0].role;s!==J.UNKNOWN&&t.childNodes.every((function(t){const e=t.childNodes[0];return!e||e.role===s&&(wr(e,z.RELATION)||wr(e,z.RELSEQ))}))&&(t.role=s)}static classifyTable(t){const e=Ss.computeColumns_(t);return Ss.classifyByColumns_(t,e,J.EQUALITY)||Ss.classifyByColumns_(t,e,J.INEQUALITY,[J.EQUALITY])||Ss.classifyByColumns_(t,e,J.ARROW)||Ss.detectCaleyTable(t),t}static detectCaleyTable(t){if(!t.mathmlTree)return!1;const e=t.mathmlTree,n=e.getAttribute("columnlines"),r=e.getAttribute("rowlines");return!(!n||!r)&&(!(!Ss.cayleySpacing(n)||!Ss.cayleySpacing(r))&&(t.role=J.CAYLEY,!0))}static cayleySpacing(t){const e=t.split(" ");return("solid"===e[0]||"dashed"===e[0])&&e.slice(1).every((t=>"none"===t))}static proof(t,e,n){const r=Ss.separateSemantics(e);return Ss.getInstance().proof(t,r,n)}static findSemantics(t,e,n){const r=null==n?null:n,s=Ss.getSemantics(t);return!!s&&(!!s[e]&&(null==r||s[e]===r))}static getSemantics(t){const e=t.getAttribute("semantics");return e?Ss.separateSemantics(e):null}static removePrefix(t){const[,...e]=t.split("_");return e.join("_")}static separateSemantics(t){const e={};return t.split(";").forEach((function(t){const[n,r]=t.split(":");e[Ss.removePrefix(n)]=r})),e}static matchSpaces_(t,e){for(let n,r=0;n=e[r];r++){const e=t[r].mathmlTree,s=t[r+1].mathmlTree;if(!e||!s)continue;const o=e.nextSibling;if(!o||o===s)continue;const i=Ss.getSpacer_(o);i&&(n.mathml.push(i),n.mathmlTree=i,n.role=J.SPACE)}}static getSpacer_(t){if(G(t)===Tr.MSPACE)return t;for(;Mr(t)&&1===t.childNodes.length;)if(G(t=t.childNodes[0])===Tr.MSPACE)return t;return null}static fenceToPunct_(t){const e=Ss.FENCE_TO_PUNCT_[t.role];if(e){for(;t.embellished;)t.embellished=z.PUNCTUATION,kr(t,J.SUBSUP)||kr(t,J.UNDEROVER)||(t.role=e),t=t.childNodes[0];t.type=z.PUNCTUATION,t.role=e}}static classifyFunction_(t,e){if(t.type===z.APPL||t.type===z.BIGOP||t.type===z.INTEGRAL)return"";if(e[0]&&e[0].textContent===nn.functionApplication){Ss.getInstance().funcAppls[t.id]=e.shift();let n=J.SIMPLEFUNC;return hr.run("simple2prefix",t),t.role!==J.PREFIXFUNC&&t.role!==J.LIMFUNC||(n=t.role),Ss.propagateFunctionRole_(t,n),"prefix"}const n=Ss.CLASSIFY_FUNCTION_[t.role];return n||((r=t).type===z.IDENTIFIER||r.role===J.LATINLETTER||r.role===J.GREEKLETTER||r.role===J.OTHERLETTER?"simple":"");var r}static propagateFunctionRole_(t,e){if(t){if(t.type===z.INFIXOP)return;kr(t,J.SUBSUP)||kr(t,J.UNDEROVER)||(t.role=e),Ss.propagateFunctionRole_(t.childNodes[0],e)}}static getFunctionOp_(t,e){if(e(t))return t;for(let n,r=0;n=t.childNodes[r];r++){const t=Ss.getFunctionOp_(n,e);if(t)return t}return null}static tableToMatrixOrVector_(t){const e=t.childNodes[0];wr(e,z.MULTILINE)?Ss.tableToVector_(t):Ss.tableToMatrix_(t),t.contentNodes.forEach(e.appendContentNode.bind(e));for(let t,n=0;t=e.childNodes[n];n++)Ss.assignRoleToRow_(t,Ss.getComponentRoles_(e));return e.parent=null,e}static tableToVector_(t){const e=t.childNodes[0];e.type=z.VECTOR,1!==e.childNodes.length?Ss.binomialForm_(e):Ss.tableToSquare_(t)}static binomialForm_(t){kr(t,J.UNKNOWN)&&(2===t.childNodes.length&&(t.role=J.BINOMIAL,t.childNodes[0].role=J.BINOMIAL,t.childNodes[1].role=J.BINOMIAL))}static tableToMatrix_(t){const e=t.childNodes[0];e.type=z.MATRIX,e.childNodes&&e.childNodes.length>0&&e.childNodes[0].childNodes&&e.childNodes.length===e.childNodes[0].childNodes.length?Ss.tableToSquare_(t):e.childNodes&&1===e.childNodes.length&&(e.role=J.ROWVECTOR)}static tableToSquare_(t){const e=t.childNodes[0];kr(e,J.UNKNOWN)&&(ms(t)?e.role=J.DETERMINANT:e.role=J.SQUAREMATRIX)}static getComponentRoles_(t){const e=t.role;return e&&e!==J.UNKNOWN?e:t.type.toLowerCase()||J.UNKNOWN}static tableToCases_(t,e){for(let e,n=0;e=t.childNodes[n];n++)Ss.assignRoleToRow_(e,J.CASES);return t.type=z.CASES,t.appendContentNode(e),rs(t)&&Ss.binomialForm_(t),t}static rewriteFencedLine_(t){const e=t.childNodes[0],n=t.childNodes[0].childNodes[0],r=t.childNodes[0].childNodes[0].childNodes[0];return n.parent=t.parent,t.parent=n,r.parent=e,n.childNodes=[t],e.childNodes=[r],n}static rowToLine_(t,e){const n=e||J.UNKNOWN;wr(t,z.ROW)&&(t.type=z.LINE,t.role=n,1===t.childNodes.length&&wr(t.childNodes[0],z.CELL)&&(t.childNodes=t.childNodes[0].childNodes,t.childNodes.forEach((function(e){e.parent=t}))))}static assignRoleToRow_(t,e){wr(t,z.LINE)?t.role=e:wr(t,z.ROW)&&(t.role=e,t.childNodes.forEach((function(t){wr(t,z.CELL)&&(t.role=e)})))}static nextSeparatorFunction_(t){let e;if(t){if(t.match(/^\s+$/))return null;e=t.replace(/\s/g,"").split("").filter((function(t){return t}))}else e=[","];return function(){return e.length>1?e.shift():e[0]}}static meaningFromContent(t,e){const n=[...t.textContent].filter((t=>t.match(/[^\s]/))),r=n.map((t=>on.Meaning.get(t)));e(t,n,r)}static numberRole_(t,e,n){if(t.role===J.UNKNOWN)return n.every((function(t){return t.type===z.NUMBER&&t.role===J.INTEGER||t.type===z.PUNCTUATION&&t.role===J.COMMA}))?(t.role=J.INTEGER,void("0"===e[0]&&t.addAnnotation("general","basenumber"))):void(n.every((function(t){return t.type===z.NUMBER&&t.role===J.INTEGER||t.type===z.PUNCTUATION}))?t.role=J.FLOAT:t.role=J.OTHERNUMBER)}static exprFont_(t){t.font===tt.UNKNOWN&&Ss.compSemantics(t,"font",tt)}static compSemantics(t,e,n){const r=[...t.textContent].map((t=>on.Meaning.get(t))).reduce((function(t,r){return t&&r[e]&&r[e]!==n.UNKNOWN&&r[e]!==t?t===n.UNKNOWN?r[e]:null:t}),n.UNKNOWN);r&&(t[e]=r)}static purgeFences_(t){const e=t.rel,n=t.comp,r=[],s=[];for(;e.length>0;){const t=e.shift();let o=n.shift();Qr(t)?(r.push(t),s.push(o)):(Ss.fenceToPunct_(t),o.push(t),o=o.concat(n.shift()),n.unshift(o))}return s.push(n.shift()),{rel:r,comp:s}}static rewriteFencedNode_(t){const e=t.contentNodes[0],n=t.contentNodes[1];let r=Ss.rewriteFence_(t,e);return t.contentNodes[0]=r.fence,r=Ss.rewriteFence_(r.node,n),t.contentNodes[1]=r.fence,t.contentNodes[0].parent=t,t.contentNodes[1].parent=t,r.node.parent=null,r.node}static rewriteFence_(t,e){if(!e.embellished)return{node:t,fence:e};const n=e.childNodes[0],r=Ss.rewriteFence_(t,n);return wr(e,z.SUPERSCRIPT)||wr(e,z.SUBSCRIPT)||wr(e,z.TENSOR)?(kr(e,J.SUBSUP)||(e.role=t.role),n!==r.node&&(e.replaceChild(n,r.node),n.parent=t),Ss.propagateFencePointer_(e,n),{node:e,fence:r.fence}):(e.replaceChild(n,r.fence),e.mathmlTree&&-1===e.mathml.indexOf(e.mathmlTree)&&e.mathml.push(e.mathmlTree),{node:r.node,fence:e})}static propagateFencePointer_(t,e){t.fencePointer=e.fencePointer||e.id.toString(),t.embellished=null}static classifyByColumns_(t,e,n,r=[]){const s=[n].concat(r);return!!(3===e.length&&Ss.testColumns_(e,1,(t=>Ss.isPureRelation_(t,s)))||2===e.length&&(Ss.testColumns_(e,1,(t=>Ss.isEndRelation_(t,s)||Ss.isPureRelation_(t,s)))||Ss.testColumns_(e,0,(t=>Ss.isEndRelation_(t,s,!0)||Ss.isPureRelation_(t,s)))))&&(t.role=n,!0)}static isEndRelation_(t,e,n){const r=n?t.childNodes.length-1:0;return wr(t,z.RELSEQ)&&e.some((e=>kr(t,e)))&&wr(t.childNodes[r],z.EMPTY)}static isPureRelation_(t,e){return wr(t,z.RELATION)&&e.some((e=>kr(t,e)))}static computeColumns_(t){const e=[];for(let n,r=0;n=t.childNodes[r];r++)for(let t,r=0;t=n.childNodes[r];r++){e[r]?e[r].push(t):e[r]=[t]}return e}static testColumns_(t,e,n){const r=t[e];return!!r&&(r.some((function(t){return t.childNodes.length&&n(t.childNodes[0])}))&&r.every((function(t){return!t.childNodes.length||n(t.childNodes[0])})))}setNodeFactory(t){Ss.getInstance().factory_=t,hr.updateFactory(Ss.getInstance().factory_)}getNodeFactory(){return Ss.getInstance().factory_}identifierNode(t,e,n){if("MathML-Unit"===n)t.type=z.IDENTIFIER,t.role=J.UNIT;else if(!e&&1===t.textContent.length&&(t.role===J.INTEGER||t.role===J.LATINLETTER||t.role===J.GREEKLETTER)&&t.font===tt.NORMAL)return t.font=tt.ITALIC,hr.run("simpleNamedFunction",t);return t.type===z.UNKNOWN&&(t.type=z.IDENTIFIER),Ss.exprFont_(t),hr.run("simpleNamedFunction",t)}implicitNode(t){if(t=Ss.getInstance().getMixedNumbers_(t),1===(t=Ss.getInstance().combineUnits_(t)).length)return t[0];const e=Ss.getInstance().implicitNode_(t);return hr.run("combine_juxtaposition",e)}text(t,e){return Ss.exprFont_(t),t.type=z.TEXT,e===Tr.ANNOTATIONXML?(t.role=J.ANNOTATION,t):e===Tr.MS?(t.role=J.STRING,t):e===Tr.MSPACE||t.textContent.match(/^\s*$/)?(t.role=J.SPACE,t):/\s/.exec(t.textContent)?(t.role=J.TEXT,t):(t.role=J.UNKNOWN,t)}row(t){return 0===(t=t.filter((function(t){return!wr(t,z.EMPTY)}))).length?Ss.getInstance().factory_.makeEmptyNode():(t=Ss.getInstance().getFencesInRow_(t),t=Ss.getInstance().tablesInRow(t),t=Ss.getInstance().getPunctuationInRow_(t),t=Ss.getInstance().getTextInRow_(t),t=Ss.getInstance().getFunctionsInRow_(t),Ss.getInstance().relationsInRow_(t))}limitNode(t,e){if(!e.length)return Ss.getInstance().factory_.makeEmptyNode();let n,r=e[0],s=z.UNKNOWN;if(!e[1])return r;if(ss(r)){n=Ss.MML_TO_LIMIT_[t];const o=n.length;if(s=n.type,e=e.slice(0,n.length+1),1===o&&Gr(e[1])||2===o&&Gr(e[1])&&Gr(e[2]))return n=Ss.MML_TO_BOUNDS_[t],Ss.getInstance().accentNode_(r,e,n.type,n.length,n.accent);if(2===o){if(Gr(e[1]))return r=Ss.getInstance().accentNode_(r,[r,e[1]],{MSUBSUP:z.SUBSCRIPT,MUNDEROVER:z.UNDERSCORE}[t],1,!0),e[2]?Ss.getInstance().makeLimitNode_(r,[r,e[2]],null,z.LIMUPPER):r;if(e[2]&&Gr(e[2]))return r=Ss.getInstance().accentNode_(r,[r,e[2]],{MSUBSUP:z.SUPERSCRIPT,MUNDEROVER:z.OVERSCORE}[t],1,!0),Ss.getInstance().makeLimitNode_(r,[r,e[1]],null,z.LIMLOWER);e[o]||(s=z.LIMLOWER)}return Ss.getInstance().makeLimitNode_(r,e,null,s)}return n=Ss.MML_TO_BOUNDS_[t],Ss.getInstance().accentNode_(r,e,n.type,n.length,n.accent)}tablesInRow(t){let e=xr(t,ts),n=[];for(let t,r=0;t=e.rel[r];r++)n=n.concat(e.comp.shift()),n.push(Ss.tableToMatrixOrVector_(t));n=n.concat(e.comp.shift()),e=xr(n,Zr),n=[];for(let t,r=0;t=e.rel[r];r++){const r=e.comp.shift();ns(0,r)&&Ss.tableToCases_(t,r.pop()),n=n.concat(r),n.push(t)}return n.concat(e.comp.shift())}mfenced(t,e,n,r){if(n&&r.length>0){const t=Ss.nextSeparatorFunction_(n),e=[r.shift()];r.forEach((n=>{e.push(Ss.getInstance().factory_.makeContentNode(t())),e.push(n)})),r=e}return t&&e?Ss.getInstance().horizontalFencedNode_(Ss.getInstance().factory_.makeContentNode(t),Ss.getInstance().factory_.makeContentNode(e),r):(t&&r.unshift(Ss.getInstance().factory_.makeContentNode(t)),e&&r.push(Ss.getInstance().factory_.makeContentNode(e)),Ss.getInstance().row(r))}fractionLikeNode(t,e,n,r){let s;if(!r&&function(t){if(!t)return!1;if(-1!==["negativeveryverythinmathspace","negativeverythinmathspace","negativethinmathspace","negativemediummathspace","negativethickmathspace","negativeverythickmathspace","negativeveryverythickmathspace"].indexOf(t))return!0;const e=t.match(/[0-9.]+/);return!!e&&0===parseFloat(e[0])}(n)){const n=Ss.getInstance().factory_.makeBranchNode(z.LINE,[t],[]),r=Ss.getInstance().factory_.makeBranchNode(z.LINE,[e],[]);return s=Ss.getInstance().factory_.makeBranchNode(z.MULTILINE,[n,r],[]),Ss.binomialForm_(s),Ss.classifyMultiline(s),s}return s=Ss.getInstance().fractionNode_(t,e),r&&s.addAnnotation("general","bevelled"),s}tensor(t,e,n,r,s){const o=Ss.getInstance().factory_.makeBranchNode(z.TENSOR,[t,Ss.getInstance().scriptNode_(e,J.LEFTSUB),Ss.getInstance().scriptNode_(n,J.LEFTSUPER),Ss.getInstance().scriptNode_(r,J.RIGHTSUB),Ss.getInstance().scriptNode_(s,J.RIGHTSUPER)],[]);return o.role=t.role,o.embellished=Wr(t),o}pseudoTensor(t,e,n){const r=t=>!wr(t,z.EMPTY),s=e.filter(r).length,o=n.filter(r).length;if(!s&&!o)return t;const i=s?o?Tr.MSUBSUP:Tr.MSUB:Tr.MSUP,c=[t];return s&&c.push(Ss.getInstance().scriptNode_(e,J.RIGHTSUB,!0)),o&&c.push(Ss.getInstance().scriptNode_(n,J.RIGHTSUPER,!0)),Ss.getInstance().limitNode(i,c)}font(t){const e=Ss.MATHJAX_FONTS[t];return e||t}proof(t,e,n){if(e.inference||e.axiom||console.log("Noise"),e.axiom){const e=Ss.getInstance().cleanInference(t.childNodes),r=e.length?Ss.getInstance().factory_.makeBranchNode(z.INFERENCE,n(e),[]):Ss.getInstance().factory_.makeEmptyNode();return r.role=J.AXIOM,r.mathmlTree=t,r}const r=Ss.getInstance().inference(t,e,n);return e.proof&&(r.role=J.PROOF,r.childNodes[0].role=J.FINAL),r}inference(t,e,n){if(e.inferenceRule){const e=Ss.getInstance().getFormulas(t,[],n);return Ss.getInstance().factory_.makeBranchNode(z.INFERENCE,[e.conclusion,e.premises],[])}const r=e.labelledRule,s=M(t.childNodes),o=[];"left"!==r&&"both"!==r||o.push(Ss.getInstance().getLabel(t,s,n,J.LEFT)),"right"!==r&&"both"!==r||o.push(Ss.getInstance().getLabel(t,s,n,J.RIGHT));const i=Ss.getInstance().getFormulas(t,s,n),c=Ss.getInstance().factory_.makeBranchNode(z.INFERENCE,[i.conclusion,i.premises],o);return c.mathmlTree=t,c}getLabel(t,e,n,r){const s=Ss.getInstance().findNestedRow(e,"prooflabel",r),o=Ss.getInstance().factory_.makeBranchNode(z.RULELABEL,n(M(s.childNodes)),[]);return o.role=r,o.mathmlTree=s,o}getFormulas(t,e,n){const r=e.length?Ss.getInstance().findNestedRow(e,"inferenceRule"):t,s="up"===Ss.getSemantics(r).inferenceRule,o=s?r.childNodes[1]:r.childNodes[0],i=s?r.childNodes[0]:r.childNodes[1],c=o.childNodes[0].childNodes[0],a=M(c.childNodes[0].childNodes),l=[];let u=1;for(const t of a)u%2&&l.push(t.childNodes[0]),u++;const h=n(l),d=n(M(i.childNodes[0].childNodes))[0],f=Ss.getInstance().factory_.makeBranchNode(z.PREMISES,h,[]);f.mathmlTree=c;const p=Ss.getInstance().factory_.makeBranchNode(z.CONCLUSION,[d],[]);return p.mathmlTree=i.childNodes[0].childNodes[0],{conclusion:p,premises:f}}findNestedRow(t,e,n){return Ss.getInstance().findNestedRow_(t,e,0,n)}cleanInference(t){return M(t).filter((function(t){return"MSPACE"!==G(t)}))}operatorNode(t){return t.type===z.UNKNOWN&&(t.type=z.OPERATOR),hr.run("multioperator",t)}constructor(){this.funcAppls={},this.splitRoles=new Map([[J.SUBTRACTION,J.NEGATIVE],[J.ADDITION,J.POSITIVE]]),this.splitOps=["\u2212","-","\u2010","\u2011","+"],this.factory_=new vr,hr.updateFactory(this.factory_)}implicitNode_(t){const e=Ss.getInstance().factory_.makeMultipleContentNodes(t.length-1,nn.invisibleTimes);Ss.matchSpaces_(t,e);const n=Ss.getInstance().infixNode_(t,e[0]);return n.role=J.IMPLICIT,e.forEach((function(t){t.parent=n})),n.contentNodes=e,n}infixNode_(t,e){const n=Ss.getInstance().factory_.makeBranchNode(z.INFIXOP,t,[e],Fr(e).textContent);return n.role=e.role,hr.run("propagateSimpleFunction",n)}explicitMixed_(t){const e=xr(t,(function(t){return t.textContent===nn.invisiblePlus}));if(!e.rel.length)return t;let n=[];for(let t,r=0;t=e.rel[r];r++){const s=e.comp[r],o=e.comp[r+1],i=s.length-1;if(s[i]&&o[0]&&wr(s[i],z.NUMBER)&&!kr(s[i],J.MIXED)&&wr(o[0],z.FRACTION)){const t=Ss.getInstance().factory_.makeBranchNode(z.NUMBER,[s[i],o[0]],[]);t.role=J.MIXED,n=n.concat(s.slice(0,i)),n.push(t),o.shift()}else n=n.concat(s),n.push(t)}return n.concat(e.comp[e.comp.length-1])}concatNode_(t,e,n){if(0===e.length)return t;const r=e.map((function(t){return Fr(t).textContent})).join(" "),s=Ss.getInstance().factory_.makeBranchNode(n,[t],e,r);return e.length>1&&(s.role=J.MULTIOP),s}prefixNode_(t,e){const n=this.splitSingles(e);let r=t;for(;n.length>0;){const t=n.pop();r=Ss.getInstance().concatNode_(r,t,z.PREFIXOP),1===t.length&&-1!==this.splitOps.indexOf(t[0].textContent)&&(r.role=this.splitRoles.get(t[0].role))}return r}splitSingles(t){let e=0;const n=[];let r=0;for(;r<t.length;){const s=t[r];!this.splitRoles.has(s.role)||t[r-1]&&t[r-1].role===s.role||t[r+1]&&t[r+1].role===s.role||-1===this.splitOps.indexOf(s.textContent)||(n.push(t.slice(e,r)),n.push(t.slice(r,r+1)),e=r+1),r++}return e<r&&n.push(t.slice(e,r)),n}postfixNode_(t,e){return e.length?Ss.getInstance().concatNode_(t,e,z.POSTFIXOP):t}combineUnits_(t){const e=xr(t,(function(t){return!kr(t,J.UNIT)}));if(t.length===e.rel.length)return e.rel;const n=[];let r,s;do{const t=e.comp.shift();r=e.rel.shift();let o=null;s=n.pop(),s&&(t.length&&us(s)?t.unshift(s):n.push(s)),1===t.length&&(o=t.pop()),t.length>1&&(o=Ss.getInstance().implicitNode_(t),o.role=J.UNIT),o&&n.push(o),r&&n.push(r)}while(r);return n}getMixedNumbers_(t){const e=xr(t,(function(t){return wr(t,z.FRACTION)&&kr(t,J.VULGAR)}));if(!e.rel.length)return t;let n=[];for(let t,r=0;t=e.rel[r];r++){const s=e.comp[r],o=s.length-1;if(s[o]&&wr(s[o],z.NUMBER)&&(kr(s[o],J.INTEGER)||kr(s[o],J.FLOAT))){const e=Ss.getInstance().factory_.makeBranchNode(z.NUMBER,[s[o],t],[]);e.role=J.MIXED,n=n.concat(s.slice(0,o)),n.push(e)}else n=n.concat(s),n.push(t)}return n.concat(e.comp[e.comp.length-1])}getTextInRow_(t){if(0===t.length)return t;if(1===t.length)return t[0].type===z.TEXT&&t[0].role===J.UNKNOWN&&(t[0].role=J.ANNOTATION),t;const{rel:e,comp:n}=xr(t,(t=>wr(t,z.TEXT)));if(0===e.length)return t;const r=[];let s=n.shift();for(;e.length>0;){let t=e.shift(),o=n.shift();const i=[];for(;!o.length&&e.length&&t.role!==J.SPACE&&e[0].role!==J.SPACE;)i.push(t),t=e.shift(),o=n.shift();if(i.length){s.length&&r.push(Ss.getInstance().row(s)),i.push(t);let e=Ss.getInstance().dummyNode_(i);r.push(e),s=o;continue}if(t.role!==J.UNKNOWN){s.length&&r.push(Ss.getInstance().row(s)),r.push(t),s=o;continue}const c=on.Meaning.get(t.textContent);c.type!==z.PUNCTUATION?c.type===z.UNKNOWN?(Ss.meaningFromContent(t,((t,e,n)=>{if(t.role===J.UNKNOWN){if(Ss.numberRole_(t,e,n),t.role===J.OTHERNUMBER)return n.some((t=>t.type!==z.NUMBER&&t.type!==z.IDENTIFIER))?(t.type=z.TEXT,void(t.role=J.ANNOTATION)):void(t.role=J.UNKNOWN);t.type=z.NUMBER}})),t.type!==z.TEXT||t.role===J.UNKNOWN?(t.role===J.UNKNOWN&&(e.length||o.length?o.length&&o[0].type===z.FENCED?(t.type=z.FUNCTION,t.role=J.PREFIXFUNC):t.role=J.TEXT:(t.type=z.IDENTIFIER,t.role=J.UNIT)),s.push(t),s=s.concat(o)):(s.length&&r.push(Ss.getInstance().row(s)),r.push(t),s=o)):(t.type=c.type,t.role=c.role,t.font=c.font,t.addAnnotation("general","text"),s.push(t),s=s.concat(o)):(t.role=c.role,t.font=c.font,s.length&&r.push(Ss.getInstance().row(s)),r.push(t),s=o)}return s.length>0&&r.push(Ss.getInstance().row(s)),r.length>1?[Ss.getInstance().dummyNode_(r)]:r}relationsInRow_(t){const e=xr(t,Kr),n=e.rel[0];if(!n)return Ss.getInstance().operationsInRow_(t);if(1===t.length)return t[0];const r=e.comp.map(Ss.getInstance().operationsInRow_);let s;return e.rel.some((function(t){return!t.equals(n)}))?(s=Ss.getInstance().factory_.makeBranchNode(z.MULTIREL,r,e.rel),e.rel.every((function(t){return t.role===n.role}))&&(s.role=n.role),s):(s=Ss.getInstance().factory_.makeBranchNode(z.RELSEQ,r,e.rel,Fr(n).textContent),s.role=n.role,s)}operationsInRow_(t){if(0===t.length)return Ss.getInstance().factory_.makeEmptyNode();if(1===(t=Ss.getInstance().explicitMixed_(t)).length)return t[0];const e=[];for(;t.length>0&&Yr(t[0]);)e.push(t.shift());if(0===t.length)return Ss.getInstance().prefixNode_(e.pop(),e);if(1===t.length)return Ss.getInstance().prefixNode_(t[0],e);const n=Ur(t=hr.run("convert_juxtaposition",t),Yr),r=Ss.getInstance().wrapFactor(e,n);return Ss.getInstance().addFactor(r,n)}wrapPostfix(t){var e;(null===(e=t.div)||void 0===e?void 0:e.role)===J.POSTFIXOP&&(t.tail.length&&t.tail[0].type!==z.OPERATOR?t.div.role=J.DIVISION:(t.head=[Ss.getInstance().postfixNode_(Ss.getInstance().implicitNode(t.head),[t.div])],t.div=t.tail.shift(),Ss.getInstance().wrapPostfix(t)))}wrapFactor(t,e){return Ss.getInstance().wrapPostfix(e),Ss.getInstance().prefixNode_(Ss.getInstance().implicitNode(e.head),t)}addFactor(t,e){return e.div?Ss.getInstance().operationsTree_(e.tail,t,e.div):(ds(t)&&(t.role=J.UNIT),t)}operationsTree_(t,e,n,r=[]){if(0===t.length){if(r.unshift(n),e.type===z.INFIXOP){const t=Ss.getInstance().postfixNode_(e.childNodes.pop(),r);return e.appendChild(t),e}return Ss.getInstance().postfixNode_(e,r)}const s=Ur(t,Yr);if(0===s.head.length)return r.push(s.div),Ss.getInstance().operationsTree_(s.tail,e,n,r);const o=Ss.getInstance().wrapFactor(r,s),i=Ss.getInstance().appendOperand_(e,n,o);return Ss.getInstance().addFactor(i,s)}appendOperand_(t,e,n){if(t.type!==z.INFIXOP)return Ss.getInstance().infixNode_([t,n],e);const r=Ss.getInstance().appendDivisionOp_(t,e,n);return r||(Ss.getInstance().appendExistingOperator_(t,e,n)?t:e.role===J.MULTIPLICATION?Ss.getInstance().appendMultiplicativeOp_(t,e,n):Ss.getInstance().appendAdditiveOp_(t,e,n))}appendDivisionOp_(t,e,n){return e.role===J.DIVISION?fs(t)?Ss.getInstance().infixNode_([t,n],e):Ss.getInstance().appendLastOperand_(t,e,n):t.role===J.DIVISION?Ss.getInstance().infixNode_([t,n],e):null}appendLastOperand_(t,e,n){let r=t,s=t.childNodes[t.childNodes.length-1];for(;s&&s.type===z.INFIXOP&&!fs(s);)r=s,s=r.childNodes[t.childNodes.length-1];const o=Ss.getInstance().infixNode_([r.childNodes.pop(),n],e);return r.appendChild(o),t}appendMultiplicativeOp_(t,e,n){if(fs(t))return Ss.getInstance().infixNode_([t,n],e);let r=t,s=t.childNodes[t.childNodes.length-1];for(;s&&s.type===z.INFIXOP&&!fs(s);)r=s,s=r.childNodes[t.childNodes.length-1];const o=Ss.getInstance().infixNode_([r.childNodes.pop(),n],e);return r.appendChild(o),t}appendAdditiveOp_(t,e,n){return Ss.getInstance().infixNode_([t,n],e)}appendExistingOperator_(t,e,n){return!(!t||t.type!==z.INFIXOP||fs(t))&&(t.contentNodes[0].equals(e)?(t.appendContentNode(e),t.appendChild(n),!0):Ss.getInstance().appendExistingOperator_(t.childNodes[t.childNodes.length-1],e,n))}getFencesInRow_(t){let e=xr(t,zr);e=Ss.purgeFences_(e);const n=e.comp.shift();return Ss.getInstance().fences_(e.rel,e.comp,[],[n])}fences_(t,e,n,r){if(0===t.length&&0===n.length)return r[0];const s=t=>kr(t,J.OPEN);if(0===t.length){const t=r.shift();for(;n.length>0;){if(s(n[0])){const e=n.shift();Ss.fenceToPunct_(e),t.push(e)}else{const e=Ur(n,s),o=e.head.length-1,i=Ss.getInstance().neutralFences_(e.head,r.slice(0,o));r=r.slice(o),t.push(...i),e.div&&e.tail.unshift(e.div),n=e.tail}t.push(...r.shift())}return t}const o=n[n.length-1],i=t[0].role;if(i===J.OPEN||ms(t[0])&&(!o||!Es(t[0],o))){n.push(t.shift());const s=e.shift();return s&&r.push(s),Ss.getInstance().fences_(t,e,n,r)}if(o&&i===J.CLOSE&&o.role===J.OPEN){const s=Ss.getInstance().horizontalFencedNode_(n.pop(),t.shift(),r.pop());return r.push(r.pop().concat([s],e.shift())),Ss.getInstance().fences_(t,e,n,r)}if(o&&Es(t[0],o)){if(!gs(o)||!Ns(t[0])){n.push(t.shift());const s=e.shift();return s&&r.push(s),Ss.getInstance().fences_(t,e,n,r)}const s=Ss.getInstance().horizontalFencedNode_(n.pop(),t.shift(),r.pop());return r.push(r.pop().concat([s],e.shift())),Ss.getInstance().fences_(t,e,n,r)}if(o&&i===J.CLOSE&&ms(o)&&n.some(s)){const o=Ur(n,s,!0),i=r.pop(),c=r.length-o.tail.length+1,a=Ss.getInstance().neutralFences_(o.tail,r.slice(c));r=r.slice(0,c);const l=Ss.getInstance().horizontalFencedNode_(o.div,t.shift(),r.pop().concat(a,i));return r.push(r.pop().concat([l],e.shift())),Ss.getInstance().fences_(t,e,o.head,r)}const c=t.shift();return Ss.fenceToPunct_(c),r.push(r.pop().concat([c],e.shift())),Ss.getInstance().fences_(t,e,n,r)}neutralFences_(t,e){if(0===t.length)return t;if(1===t.length)return Ss.fenceToPunct_(t[0]),t;const n=t.shift();if(!gs(n)){Ss.fenceToPunct_(n);const r=e.shift();return r.unshift(n),r.concat(Ss.getInstance().neutralFences_(t,e))}const r=Ur(t,(function(t){return Es(t,n)}));if(!r.div){Ss.fenceToPunct_(n);const r=e.shift();return r.unshift(n),r.concat(Ss.getInstance().neutralFences_(t,e))}if(!Ns(r.div))return Ss.fenceToPunct_(r.div),t.unshift(n),Ss.getInstance().neutralFences_(t,e);const s=Ss.getInstance().combineFencedContent_(n,r.div,r.head,e);if(r.tail.length>0){const t=s.shift(),e=Ss.getInstance().neutralFences_(r.tail,s);return t.concat(e)}return s[0]}combineFencedContent_(t,e,n,r){if(0===n.length){const n=Ss.getInstance().horizontalFencedNode_(t,e,r.shift());return r.length>0?r[0].unshift(n):r=[[n]],r}const s=r.shift(),o=n.length-1,i=r.slice(0,o),c=(r=r.slice(o)).shift(),a=Ss.getInstance().neutralFences_(n,i);s.push(...a),s.push(...c);const l=Ss.getInstance().horizontalFencedNode_(t,e,s);return r.length>0?r[0].unshift(l):r=[[l]],r}horizontalFencedNode_(t,e,n){const r=Ss.getInstance().row(n);let s=Ss.getInstance().factory_.makeBranchNode(z.FENCED,[r],[t,e]);return t.role===J.OPEN?(Ss.getInstance().classifyHorizontalFence_(s),s=hr.run("propagateComposedFunction",s)):s.role=t.role,s=hr.run("detect_cycle",s),Ss.rewriteFencedNode_(s)}classifyHorizontalFence_(t){t.role=J.LEFTRIGHT;const e=t.childNodes;if(!function(t){return function(t){return!!t&&-1!==["{","\ufe5b","\uff5b"].indexOf(t.textContent)}(t.contentNodes[0])&&function(t){return!!t&&-1!==["}","\ufe5c","\uff5d"].indexOf(t.textContent)}(t.contentNodes[1])}(t)||e.length>1)return;if(0===e.length||e[0].type===z.EMPTY)return void(t.role=J.SETEMPTY);const n=e[0].type;if(1===e.length&&ls(e[0]))return void(t.role=J.SETSINGLE);const r=e[0].role;if(n===z.PUNCTUATED&&r===J.SEQUENCE){if(e[0].contentNodes[0].role!==J.COMMA)return 1!==e[0].contentNodes.length||e[0].contentNodes[0].role!==J.VBAR&&e[0].contentNodes[0].role!==J.COLON?void 0:(t.role=J.SETEXT,void Ss.getInstance().setExtension_(t));t.role=J.SETCOLLECT}}setExtension_(t){const e=t.childNodes[0].childNodes[0];var n;e&&e.type===z.INFIXOP&&1===e.contentNodes.length&&(n=e.contentNodes[0],[J.ELEMENT,J.NONELEMENT,J.REELEMENT,J.RENONELEMENT].includes(n.role))&&(e.addAnnotation("set","intensional"),e.contentNodes[0].addAnnotation("set","intensional"))}getPunctuationInRow_(t){if(t.length<=1)return t;const e=t=>{const e=t.type;return"punctuation"===e||"text"===e||"operator"===e||"relation"===e},n=xr(t,(function(n){if(!qr(n))return!1;if(qr(n)&&!kr(n,J.ELLIPSIS))return!0;const r=t.indexOf(n);if(0===r)return!t[1]||!e(t[1]);const s=t[r-1];if(r===t.length-1)return!e(s);const o=t[r+1];return!e(s)||!e(o)}));if(0===n.rel.length)return t;let r=[],s=n.comp.shift();s.length>0&&r.push(Ss.getInstance().row(s));let o=0;for(;n.comp.length>0;){let t=[],e=o;do{t.push(n.rel[o++]),s=n.comp.shift()}while(n.rel[o]&&s&&0===s.length);t=hr.run("ellipses",t),n.rel.splice(e,o-e,...t),o=e+t.length,r=r.concat(t),s&&s.length>0&&r.push(Ss.getInstance().row(s))}return[Ss.getInstance().punctuatedNode_(r,n.rel)]}punctuatedNode_(t,e){const n=Ss.getInstance().factory_.makeBranchNode(z.PUNCTUATED,t,e);if(e.length===t.length){const t=e[0].role;if(t!==J.UNKNOWN&&e.every((function(e){return e.role===t})))return n.role=t,n}let r=e[0];return os(t,e,0)?n.role=r.childNodes.length&&!r.embellished?r.role:J.STARTPUNCT:os(t,e,t.length-1)?n.role=r.childNodes.length&&!r.embellished?r.role:J.ENDPUNCT:e.every((t=>kr(t,J.DUMMY)))?n.role=J.TEXT:e.every((t=>kr(t,J.SPACE)))?n.role=J.SPACE:n.role=J.SEQUENCE,n}dummyNode_(t){const e=Ss.getInstance().factory_.makeMultipleContentNodes(t.length-1,nn.invisibleComma);return e.forEach((function(t){t.role=J.DUMMY})),Ss.getInstance().punctuatedNode_(t,e)}accentRole_(t,e){if(!Gr(t))return!1;const n=t.textContent,r=on.Secondary.get(n,nt.BAR)||on.Secondary.get(n,nt.TILDE)||t.role;return t.role=e===z.UNDERSCORE?J.UNDERACCENT:J.OVERACCENT,t.addAnnotation("accent",r),!0}accentNode_(t,e,n,r,s){const o=(e=e.slice(0,r+1))[1],i=e[2];let c;if(!s&&i&&(c=Ss.getInstance().factory_.makeBranchNode(z.SUBSCRIPT,[t,o],[]),c.role=J.SUBSUP,e=[c,i],n=z.SUPERSCRIPT),s){const r=Ss.getInstance().accentRole_(o,n);if(i){Ss.getInstance().accentRole_(i,z.OVERSCORE)&&!r?(c=Ss.getInstance().factory_.makeBranchNode(z.OVERSCORE,[t,i],[]),e=[c,o],n=z.UNDERSCORE):(c=Ss.getInstance().factory_.makeBranchNode(z.UNDERSCORE,[t,o],[]),e=[c,i],n=z.OVERSCORE),c.role=J.UNDEROVER}}return Ss.getInstance().makeLimitNode_(t,e,c,n)}makeLimitNode_(t,e,n,r){if(r===z.LIMUPPER&&t.type===z.LIMLOWER)return t.childNodes.push(e[1]),e[1].parent=t,t.type=z.LIMBOTH,t;if(r===z.LIMLOWER&&t.type===z.LIMUPPER)return t.childNodes.splice(1,-1,e[1]),e[1].parent=t,t.type=z.LIMBOTH,t;const s=Ss.getInstance().factory_.makeBranchNode(r,e,[]),o=Wr(t);return n&&(n.embellished=o),s.embellished=o,s.role=t.role,s}getFunctionsInRow_(t,e){const n=e||[];if(0===t.length)return n;const r=t.shift(),s=Ss.classifyFunction_(r,t);if(!s)return n.push(r),Ss.getInstance().getFunctionsInRow_(t,n);const o=Ss.getInstance().getFunctionsInRow_(t,[]),i=Ss.getInstance().getFunctionArgs_(r,o,s);return n.concat(i)}getFunctionArgs_(t,e,n){let r,s,o;switch(n){case"integral":{const n=Ss.getInstance().getIntegralArgs_(e);if(!n.intvar&&!n.integrand.length)return n.rest.unshift(t),n.rest;const r=Ss.getInstance().row(n.integrand);return o=Ss.getInstance().integralNode_(t,r,n.intvar),hr.run("intvar_from_fraction",o),n.rest.unshift(o),n.rest}case"prefix":if(e[0]&&e[0].type===z.FENCED){const n=e.shift();return ms(n)||(n.role=J.LEFTRIGHT),o=Ss.getInstance().functionNode_(t,n),e.unshift(o),e}if(r=Ur(e,Vr),r.head.length)s=Ss.getInstance().row(r.head),r.div&&r.tail.unshift(r.div);else{if(!r.div||!wr(r.div,z.APPL))return e.unshift(t),e;s=r.div}return o=Ss.getInstance().functionNode_(t,s),r.tail.unshift(o),r.tail;case"bigop":return r=Ur(e,$r),r.head.length?(s=Ss.getInstance().row(r.head),o=Ss.getInstance().bigOpNode_(t,s),r.div&&r.tail.unshift(r.div),r.tail.unshift(o),r.tail):(e.unshift(t),e);default:{if(0===e.length)return[t];const n=e[0];return n.type===z.FENCED&&!ms(n)&&function(t){const e=t.childNodes;if(0===e.length)return!0;if(e.length>1)return!1;const n=e[0];if(n.type===z.INFIXOP){if(n.role!==J.IMPLICIT)return!1;if(n.childNodes.some((t=>wr(t,z.INFIXOP))))return!1}return!0}(n)?(n.role=J.LEFTRIGHT,Ss.propagateFunctionRole_(t,J.SIMPLEFUNC),o=Ss.getInstance().functionNode_(t,e.shift()),e.unshift(o),e):(e.unshift(t),e)}}}getIntegralArgs_(t,e=[]){if(0===t.length){const t=Ur(e,$r);return t.div&&t.tail.unshift(t.div),{integrand:t.head,intvar:null,rest:t.tail}}hr.run("intvar_from_implicit",t);const n=t[0];if(Xr(n)){let{integrand:n,rest:r}=Ss.getInstance().getIntegralArgs_(e);return{integrand:n,intvar:null,rest:r.concat(t)}}if(Hr(n))return n.role=J.INTEGRAL,{integrand:e,intvar:n,rest:t.slice(1)};if(t[1]&&jr(n,t[1])){const r=Ss.getInstance().prefixNode_(t[1],[n]);return r.role=J.INTEGRAL,{integrand:e,intvar:r,rest:t.slice(2)}}return e.push(t.shift()),Ss.getInstance().getIntegralArgs_(t,e)}functionNode_(t,e){const n=Ss.getInstance().factory_.makeContentNode(nn.functionApplication),r=Ss.getInstance().funcAppls[t.id];r&&(n.mathmlTree=r.mathmlTree,n.mathml=r.mathml,n.annotation=r.annotation,n.attributes=r.attributes,delete Ss.getInstance().funcAppls[t.id]),n.type=z.PUNCTUATION,n.role=J.APPLICATION;const s=Ss.getFunctionOp_(t,(function(t){return wr(t,z.FUNCTION)||wr(t,z.IDENTIFIER)&&kr(t,J.SIMPLEFUNC)}));return Ss.getInstance().functionalNode_(z.APPL,[t,e],s,[n])}bigOpNode_(t,e){const n=Ss.getFunctionOp_(t,(t=>wr(t,z.LARGEOP)));return Ss.getInstance().functionalNode_(z.BIGOP,[t,e],n,[])}integralNode_(t,e,n){e=e||Ss.getInstance().factory_.makeEmptyNode(),n=n||Ss.getInstance().factory_.makeEmptyNode();const r=Ss.getFunctionOp_(t,(t=>wr(t,z.LARGEOP)));return Ss.getInstance().functionalNode_(z.INTEGRAL,[t,e,n],r,[])}functionalNode_(t,e,n,r){const s=e[0];let o;n&&(o=n.parent,r.push(n));const i=Ss.getInstance().factory_.makeBranchNode(t,e,r);return i.role=s.role,o&&(n.parent=o),i}fractionNode_(t,e){const n=Ss.getInstance().factory_.makeBranchNode(z.FRACTION,[t,e],[]);return n.role=n.childNodes.every((function(t){return wr(t,z.NUMBER)&&kr(t,J.INTEGER)}))?J.VULGAR:n.childNodes.every(hs)?J.UNIT:J.DIVISION,hr.run("propagateSimpleFunction",n)}scriptNode_(t,e,n){let r;switch(t.length){case 0:r=Ss.getInstance().factory_.makeEmptyNode();break;case 1:if(r=t[0],n)return r;break;default:r=Ss.getInstance().dummyNode_(t)}return r.role=e,r}findNestedRow_(t,e,n,r){if(n>3)return null;for(let s,o=0;s=t[o];o++){const t=G(s);if(t!==Tr.MSPACE){if(t===Tr.MROW)return Ss.getInstance().findNestedRow_(M(s.childNodes),e,n+1,r);if(Ss.findSemantics(s,e,r))return s}}return null}}Ss.FENCE_TO_PUNCT_={[J.METRIC]:J.METRIC,[J.NEUTRAL]:J.VBAR,[J.OPEN]:J.OPENFENCE,[J.CLOSE]:J.CLOSEFENCE},Ss.MML_TO_LIMIT_={[Tr.MSUB]:{type:z.LIMLOWER,length:1},[Tr.MUNDER]:{type:z.LIMLOWER,length:1},[Tr.MSUP]:{type:z.LIMUPPER,length:1},[Tr.MOVER]:{type:z.LIMUPPER,length:1},[Tr.MSUBSUP]:{type:z.LIMBOTH,length:2},[Tr.MUNDEROVER]:{type:z.LIMBOTH,length:2}},Ss.MML_TO_BOUNDS_={[Tr.MSUB]:{type:z.SUBSCRIPT,length:1,accent:!1},[Tr.MSUP]:{type:z.SUPERSCRIPT,length:1,accent:!1},[Tr.MSUBSUP]:{type:z.SUBSCRIPT,length:2,accent:!1},[Tr.MUNDER]:{type:z.UNDERSCORE,length:1,accent:!0},[Tr.MOVER]:{type:z.OVERSCORE,length:1,accent:!0},[Tr.MUNDEROVER]:{type:z.UNDERSCORE,length:2,accent:!0}},Ss.CLASSIFY_FUNCTION_={[J.INTEGRAL]:"integral",[J.SUM]:"bigop",[J.PREFIXFUNC]:"prefix",[J.LIMFUNC]:"prefix",[J.SIMPLEFUNC]:"prefix",[J.COMPFUNC]:"prefix"},Ss.MATHJAX_FONTS={"-tex-caligraphic":tt.CALIGRAPHIC,"-tex-caligraphic-bold":tt.CALIGRAPHICBOLD,"-tex-calligraphic":tt.CALIGRAPHIC,"-tex-calligraphic-bold":tt.CALIGRAPHICBOLD,"-tex-oldstyle":tt.OLDSTYLE,"-tex-oldstyle-bold":tt.OLDSTYLEBOLD,"-tex-mathit":tt.ITALIC};let Ts={};function Is(t){return Array.from(t.textContent).map(Ln.stringEmpty)}function As(t,e){const n=Array.from(t.textContent),r=[],s=Ss.getInstance(),o=t.ownerDocument;for(let t,i=0;t=n[i];i++){const n=s.getNodeFactory().makeLeafNode(t,tt.UNKNOWN),i=s.identifierNode(n,tt.UNKNOWN,"");e(i),r.push(i.xml(o))}return r}function Rs(t){return As(t,(function(t){t.textContent.match(/\W/)||(t.type=z.NUMBER)}))}function Os(t){return As(t,(function(t){t.font=tt.UNKNOWN,t.type=z.IDENTIFIER}))}const Cs=[z.CASES,z.CELL,z.INTEGRAL,z.LINE,z.MATRIX,z.MULTILINE,z.OVERSCORE,z.ROOT,z.ROW,z.SQRT,z.SUBSCRIPT,z.SUPERSCRIPT,z.TABLE,z.UNDERSCORE,z.VECTOR];function bs(t){return Ts={},[t]}function Ls(t,e,n,r,s,o){r=r||Cs,s=s||{},o=o||function(t){return!1};const i=$(e);if(Ts[t]||(Ts[t]={}),Ts[t][i])return Ts[t][i];if(o(e)||n.indexOf(e.tagName)<0)return 0;const c=Ms(e,n,ur(r,n),s,o,0);return Ts[t][i]=c,c}function Ms(t,e,n,r,s,o){if(s(t)||n.indexOf(t.tagName)>-1||function(t,e){if(!t.attributes)return!1;const n=M(t.attributes);for(let t,r=0;t=n[r];r++)if(e[t.nodeName]===t.nodeValue)return!0;return!1}(t,r))return o;if(e.indexOf(t.tagName)>-1&&o++,!t.childNodes||0===t.childNodes.length)return o;const i=M(t.childNodes);return Math.max.apply(null,i.map((function(t){return Ms(t,e,n,r,s,o)})))}function ys(t){return Ls("fraction",t,["fraction"],Cs,{},ut.FUNCTIONS.fracNestDepth)}function _s(t,e,n){const r=ys(t),s=Array(r).fill(e);return n&&s.push(n),s.join(ut.MESSAGES.regexp.JOINER_FRAC)}function Ps(t){return Ln.singleton(_s(t,ut.MESSAGES.MS.START,ut.MESSAGES.MS.FRAC_V))}function Fs(t){return Ln.singleton(_s(t,ut.MESSAGES.MS.END,ut.MESSAGES.MS.FRAC_V),{kind:"LAST"})}function Us(t){return Ln.singleton(_s(t,ut.MESSAGES.MS.FRAC_OVER),{})}function xs(t){return Ln.singleton(_s(t,ut.MESSAGES.MS.START,ut.MESSAGES.MS.FRAC_B))}function Ds(t){return Ln.singleton(_s(t,ut.MESSAGES.MS.END,ut.MESSAGES.MS.FRAC_B),{kind:"LAST"})}function vs(t){const e=ys(t);return Ln.singleton(1===e?ut.MESSAGES.MS.FRAC_S:ut.FUNCTIONS.combineNestedFraction(ut.MESSAGES.MS.NEST_FRAC,ut.FUNCTIONS.radicalNestDepth(e-1),ut.MESSAGES.MS.FRAC_S))}function ws(t){const e=ys(t);return Ln.singleton(1===e?ut.MESSAGES.MS.ENDFRAC:ut.FUNCTIONS.combineNestedFraction(ut.MESSAGES.MS.NEST_FRAC,ut.FUNCTIONS.radicalNestDepth(e-1),ut.MESSAGES.MS.ENDFRAC),{kind:"LAST"})}function Bs(t){const e=ys(t);return Ln.singleton(1===e?ut.MESSAGES.MS.FRAC_OVER:ut.FUNCTIONS.combineNestedFraction(ut.MESSAGES.MS.NEST_FRAC,ut.FUNCTIONS.radicalNestDepth(e-1),ut.MESSAGES.MS.FRAC_OVER))}function ks(t){return ut.FUNCTIONS.fracNestDepth(t)?[t]:[]}function Gs(t,e,n){for(;t.parentNode;){const r=t.parentNode,s=r.parentNode;if(!s)break;const o=t.getAttribute&&t.getAttribute("role");(s.tagName===z.SUBSCRIPT&&t===r.childNodes[1]||s.tagName===z.TENSOR&&o&&(o===J.LEFTSUB||o===J.RIGHTSUB))&&(e=n.sub+ut.MESSAGES.regexp.JOINER_SUBSUPER+e),(s.tagName===z.SUPERSCRIPT&&t===r.childNodes[1]||s.tagName===z.TENSOR&&o&&(o===J.LEFTSUPER||o===J.RIGHTSUPER))&&(e=n.sup+ut.MESSAGES.regexp.JOINER_SUBSUPER+e),t=s}return e.trim()}function Vs(t){return Ln.singleton(Gs(t,ut.MESSAGES.MS.SUBSCRIPT,{sup:ut.MESSAGES.MS.SUPER,sub:ut.MESSAGES.MS.SUB}))}function $s(t){return Ln.singleton(Gs(t,ut.MESSAGES.MS.SUB,{sup:ut.MESSAGES.MS.SUP,sub:ut.MESSAGES.MS.SUB}))}function js(t){return Ln.singleton(Gs(t,ut.MESSAGES.MS.SUPERSCRIPT,{sup:ut.MESSAGES.MS.SUPER,sub:ut.MESSAGES.MS.SUB}))}function Hs(t){return Ln.singleton(Gs(t,ut.MESSAGES.MS.SUP,{sup:ut.MESSAGES.MS.SUP,sub:ut.MESSAGES.MS.SUB}))}function Xs(t){const e=Gs(t,"",{sup:ut.MESSAGES.MS.SUPER,sub:ut.MESSAGES.MS.SUB});return Ln.singleton(e?e.replace(new RegExp(ut.MESSAGES.MS.SUB+"$"),ut.MESSAGES.MS.SUBSCRIPT).replace(new RegExp(ut.MESSAGES.MS.SUPER+"$"),ut.MESSAGES.MS.SUPERSCRIPT):ut.MESSAGES.MS.BASELINE)}function Ws(t){const e=Gs(t,"",{sup:ut.MESSAGES.MS.SUP,sub:ut.MESSAGES.MS.SUB});return Ln.singleton(e||ut.MESSAGES.MS.BASE)}function Ys(t){return Ls("radical",t,["sqrt","root"],Cs,{})}function Ks(t,e,n){const r=Ys(t),s=function(t){const e="sqrt"===t.tagName?"2":b("children/*[1]",t)[0].textContent.trim();return ut.MESSAGES.MSroots[e]||""}(t);return n=s?ut.FUNCTIONS.combineRootIndex(n,s):n,1===r?n:ut.FUNCTIONS.combineNestedRadical(e,ut.FUNCTIONS.radicalNestDepth(r-1),n)}function qs(t){return Ln.singleton(Ks(t,ut.MESSAGES.MS.NESTED,ut.MESSAGES.MS.STARTROOT))}function zs(t){return Ln.singleton(Ks(t,ut.MESSAGES.MS.NESTED,ut.MESSAGES.MS.ENDROOT))}function Qs(t){return Ln.singleton(Ks(t,ut.MESSAGES.MS.NESTED,ut.MESSAGES.MS.ROOTINDEX))}function Js(t){return Ln.singleton(Ks(t,ut.MESSAGES.MS.NEST_ROOT,ut.MESSAGES.MS.STARTROOT))}function Zs(t){return Ln.singleton(Ks(t,ut.MESSAGES.MS.NEST_ROOT,ut.MESSAGES.MS.ENDROOT))}function to(t){return Ln.singleton(Ks(t,ut.MESSAGES.MS.NEST_ROOT,ut.MESSAGES.MS.ROOTINDEX))}function eo(t){return Ln.singleton(Ks(t,ut.MESSAGES.MS.NEST_ROOT,ut.MESSAGES.MS.ROOT))}function no(t){return Ln.singleton(Ks(t,ut.MESSAGES.MS.NEST_ROOT,ut.MESSAGES.MS.INDEX))}function ro(t){const e=function(t){return Ls("underscore",t,["underscore"],Cs,{},(function(t){return t.tagName&&t.tagName===z.UNDERSCORE&&t.childNodes[0].childNodes[1].getAttribute("role")===J.UNDERACCENT}))}(t);return Ln.singleton(Array(e).join(ut.MESSAGES.MS.UNDER)+ut.MESSAGES.MS.UNDERSCRIPT)}function so(t){return Ln.singleton(ut.MESSAGES.MS.ENDSCRIPTS)}function oo(t){const e=function(t){return Ls("overscore",t,["overscore"],Cs,{},(function(t){return t.tagName&&t.tagName===z.OVERSCORE&&t.childNodes[0].childNodes[1].getAttribute("role")===J.OVERACCENT}))}(t);return Ln.singleton(Array(e).join(ut.MESSAGES.MS.OVER)+ut.MESSAGES.MS.OVERSCRIPT)}function io(t){if(t.tagName!==z.MATRIX||t.getAttribute("role")!==J.DETERMINANT)return[];const e=b("children/row/children/cell/children/*",t);for(let t,n=0;t=e[n];n++)if(t.tagName!==z.NUMBER){if(t.tagName===z.IDENTIFIER){const e=t.getAttribute("role");if(e===J.LATINLETTER||e===J.GREEKLETTER||e===J.OTHERLETTER)continue}return[]}return[t]}function co(){const t=t=>t.map((t=>"ancestor::"+t)),e=t=>"not("+t+")",n=e(t(["subscript","superscript","tensor"]).join(" or ")),r=t(["relseq","multrel"]),s=t(["fraction","punctuation","fenced","sqrt","root"]);let o=[];for(let t,e=0;t=s[e];e++)o=o.concat(r.map((function(e){return t+"/"+e})));return[["ancestor::*/following-sibling::*",n,e(o.join(" | "))].join(" and ")]}function ao(t){if(!t.childNodes.length||!t.childNodes[0].childNodes.length||!t.childNodes[0].childNodes[0].childNodes.length)return Ln.singleton("");const e=t.childNodes[0].childNodes[0].childNodes[0].textContent;return Ln.singleton(e.match(/^\(.+\)$/)?e.slice(1,-1):e)}const lo=new Map([[3,"CSFleftsuperscript"],[4,"CSFleftsubscript"],[2,"CSFbaseline"],[1,"CSFrightsubscript"],[0,"CSFrightsuperscript"]]),uo=new Map([[4,2],[3,3],[2,1],[1,4],[0,5]]);function ho(t){const e=[];let n="",r="",s=parseInt(t,2);for(let t=0;t<5;t++){const o="children/*["+uo.get(t)+"]";if(1&s){const e=lo.get(t%5);n="[t] "+e+"Verbose; [n] "+o+";"+n,r="[t] "+e+"Brief; [n] "+o+";"+r}else e.unshift("name("+o+')="empty"');s>>=1}return[e,n,r]}function fo(t,e=!0){const n=["11111","11110","11101","11100","10111","10110","10101","10100","01111","01110","01101","01100"];for(const r of n){let n="tensor"+r,[s,o,i]=ho(r);if(t.defineRule(n,"default",o,"self::tensor",...s),e&&(t.defineRule(n,"brief",i,"self::tensor",...s),t.defineRule(n,"sbrief",i,"self::tensor",...s)),!(3&parseInt(r,2)))continue;const c=lo.get(2);o+="; [t]"+c+"Verbose",i+="; [t]"+c+"Brief",n+="-baseline";const a="((.//*[not(*)])[last()]/@id)!=(((.//ancestor::fraction|ancestor::root|ancestor::sqrt|ancestor::cell|ancestor::line|ancestor::stree)[1]//*[not(*)])[last()]/@id)";t.defineRule(n,"default",o,"self::tensor",a,...s),e&&(t.defineRule(n,"brief",i,"self::tensor",a,...s),t.defineRule(n,"sbrief",i,"self::tensor",a,...s))}}function po(t){let e=Object.keys(ut.MESSAGES.MSroots).length;if(!e)return[];if(e++,!t.childNodes||0===t.childNodes.length||!t.childNodes[0].childNodes)return[];const n=t.childNodes[0].childNodes[0].textContent;if(!/^\d+$/.test(n))return[];const r=parseInt(n,10);return r>1&&r<=e?[t]:[]}function mo(t,e){let n=0;return function(){return ut.NUMBERS.numericOrdinal(++n)+" "+e}}function Eo(t,e){let n=0;return function(){return ut.NUMBERS.numberToOrdinal(++n,!1)+" "+e}}function go(t){const e=ct(t,ut.MESSAGES.MS.FRAC_OVER);return e.convertible&&e.enumerator&&e.denominator?[Ln.node(ut.NUMBERS.numberToWords(e.enumerator),t.childNodes[0].childNodes[0],{separator:""}),Ln.stringAttr(ut.NUMBERS.vulgarSep,{separator:""}),Ln.node(ut.NUMBERS.numberToOrdinal(e.denominator,1!==e.enumerator),t.childNodes[0].childNodes[1])]:[Ln.node(e.content||"",t)]}function No(t){const e=M(t.parentNode.childNodes);return Ln.singleton(ut.NUMBERS.numericOrdinal(e.indexOf(t)+1).toString())}function So(t){const e=Xs(t);return e[0].speech=e[0].speech.replace(/-$/,""),e}function To(t){const e=Ws(t);return e[0].speech=e[0].speech.replace(/-$/,""),e}function Io(t){const e=js(t);return e[0].speech=e[0].speech.replace(/^exposant/,"exposant gauche"),e}function Ao(t){const e=Vs(t);return e[0].speech=e[0].speech.replace(/^indice/,"indice gauche"),e}function Ro(t){const e=Hs(t);return e[0].speech=e[0].speech.replace(/^sup/,"sup gauche"),e}function Oo(t){const e=$s(t);return e[0].speech=e[0].speech.replace(/^sub/,"sub gauche"),e}function Co(t,e,n){const r=ys(t),s=Array.apply(null,Array(r)).map((t=>e));return n&&s.unshift(n),s.join(ut.MESSAGES.regexp.JOINER_FRAC)}function bo(t){return Ln.singleton(Co(t,ut.MESSAGES.MS.START,ut.MESSAGES.MS.FRAC_V))}function Lo(t){return Ln.singleton(Co(t,ut.MESSAGES.MS.END,ut.MESSAGES.MS.FRAC_V))}function Mo(t){return Ln.singleton(Co(t,ut.MESSAGES.MS.START,ut.MESSAGES.MS.FRAC_B))}function yo(t){return Ln.singleton(Co(t,ut.MESSAGES.MS.END,ut.MESSAGES.MS.FRAC_B))}function _o(t){const e=ys(t);return 1===e?Ln.singleton(ut.MESSAGES.MS.FRAC_S):Ln.singleton(ut.FUNCTIONS.combineNestedFraction(ut.FUNCTIONS.radicalNestDepth(e-1),ut.MESSAGES.MS.NEST_FRAC,ut.MESSAGES.MS.FRAC_S))}function Po(t){const e=ys(t);return 1===e?Ln.singleton(ut.MESSAGES.MS.ENDFRAC):Ln.singleton(ut.FUNCTIONS.combineNestedFraction(ut.FUNCTIONS.radicalNestDepth(e-1),ut.MESSAGES.MS.NEST_FRAC,ut.MESSAGES.MS.ENDFRAC))}function Fo(t){const e=ys(t);return 1===e?Ln.singleton(ut.MESSAGES.MS.FRAC_OVER):Ln.singleton(ut.FUNCTIONS.combineNestedFraction(ut.FUNCTIONS.radicalNestDepth(e-1),ut.MESSAGES.MS.NEST_FRAC,ut.MESSAGES.MS.FRAC_OVER))}function Uo(t){return 1===b("children/*[1]",t)[0].toString().match(/[^>\u2062>]+<\/[^>]*>/g).length?[t]:[]}function xo(t,e,n){const r=Ys(t);return 1===r?n:ut.FUNCTIONS.combineNestedRadical(ut.FUNCTIONS.radicalNestDepth(r-1),e,n)}function Do(t){return Ln.singleton(xo(t,ut.MESSAGES.MS.NESTED,ut.MESSAGES.MS.STARTROOT))}function vo(t){return Ln.singleton(xo(t,ut.MESSAGES.MS.NESTED,ut.MESSAGES.MS.ENDROOT))}function wo(t){return Ln.singleton(xo(t,ut.MESSAGES.MS.NEST_ROOT,ut.MESSAGES.MS.STARTROOT))}function Bo(t){return Ln.singleton(xo(t,ut.MESSAGES.MS.NEST_ROOT,ut.MESSAGES.MS.ENDROOT))}function ko(t){return Ln.singleton(xo(t,ut.MESSAGES.MS.NEST_ROOT,ut.MESSAGES.MS.ROOT))}function Go(t,e){const n=function(t){const e=b("children/*[1]",t)[0].textContent.trim();return ut.MESSAGES.MSroots[e]||e+"\uc81c\uacf1\uadfc"}(t);return n||e}function Vo(t){return Ln.singleton(Go(t,ut.MESSAGES.MS.ROOTINDEX))}function $o(t){return Ln.singleton(Go(t,ut.MESSAGES.MS.ROOTINDEX))}function jo(t){return Ln.singleton(Go(t,ut.MESSAGES.MS.INDEX))}function Ho(t){const e=b("children/*",t);return Ln.singleton(ut.NUMBERS.wordOrdinal(e.length))}function Xo(t){const e=b("children/*",t);return Ln.singleton(ut.NUMBERS.wordOrdinal(e.length-1))}function Wo(t){const e=b("children/*",t),n=b("content/*",t);return Ln.singleton(ut.NUMBERS.wordOrdinal(e.length-n.length))}function Yo(t,e){const n=t;let r=0;return function(){const t=_n.create({text:qo(n[r])&&zo(n[r+1])?ut.MESSAGES.unitTimes:""},{});return r++,[t]}}const Ko=[z.SUPERSCRIPT,z.SUBSCRIPT,z.OVERSCORE,z.UNDERSCORE];function qo(t){for(;t;){if("unit"===t.getAttribute("role"))return!0;const e=t.tagName,n=b("children/*",t);t=-1!==Ko.indexOf(e)?n[0]:n[n.length-1]}return!1}function zo(t){for(;t;){if("unit"===t.getAttribute("role"))return!0;t=b("children/*",t)[0]}return!1}function Qo(t){for(;t;){if("number"===t.tagName&&"1"===t.textContent)return[t];if("infixop"!==t.tagName||"multiplication"!==t.getAttribute("role")&&"implicit"!==t.getAttribute("role"))return[];t=b("children/*",t)[0]}return[]}function Jo(t){const e=ys(t);return Ln.singleton(new Array(e).join(ut.MESSAGES.MS.FRACTION_REPEAT)+ut.MESSAGES.MS.FRACTION_START)}function Zo(t){const e=ys(t);return Ln.singleton(new Array(e).join(ut.MESSAGES.MS.FRACTION_REPEAT)+ut.MESSAGES.MS.FRACTION_END)}function ti(t){const e=ys(t);return Ln.singleton(new Array(e).join(ut.MESSAGES.MS.FRACTION_REPEAT)+ut.MESSAGES.MS.FRACTION_OVER)}function ei(t){const e=ys(t);return Ln.singleton(new Array(e).join(ut.MESSAGES.MS.FRACTION_REPEAT)+"\u2838"+ut.MESSAGES.MS.FRACTION_OVER)}function ni(t){return ut.MESSAGES.regexp.HYPER===ys(t).toString()?[t]:[]}function ri(t,e){const n=si(t);return Ln.singleton(1===n?e:new Array(n).join(ut.MESSAGES.MS.NESTED)+e)}function si(t,e){const n=e||0;return t.parentNode?si(t.parentNode,"root"===t.tagName||"sqrt"===t.tagName?n+1:n):n}function oi(t){return ri(t,ut.MESSAGES.MS.STARTROOT)}function ii(t){return ri(t,ut.MESSAGES.MS.ENDROOT)}function ci(t){return ri(t,ut.MESSAGES.MS.ROOTINDEX)}gt.getInstance().setCorrection("enlargeFence",(function(t){const e="\u2820";if(1===t.length)return e+t;const n=t.split("");return n.every((function(t){return"\u2833"===t}))?e+n.join(e):t.slice(0,-1)+e+t.slice(-1)}));const ai=[z.MULTIREL,z.RELSEQ,z.APPL,z.ROW,z.LINE],li=[z.SUBSCRIPT,z.SUPERSCRIPT,z.OVERSCORE,z.UNDERSCORE];function ui(t,e){const n=t.parent;if(!n)return!1;const r=n.type;return-1!==ai.indexOf(r)||r===z.PREFIXOP&&n.role===J.NEGATIVE&&!e.script&&!e.enclosed||r===z.PREFIXOP&&n.role===J.GEOMETRY||!(r!==z.PUNCTUATED||e.enclosed&&n.role!==J.TEXT)}function hi(t,e){const n=t.slice(0);let r,s=!0,o=t[0].parentNode.parentNode,i=o.getAttribute("annotation").match(/depth:(\d+)/),c=i?i[1]:"";return r=t.length>0?b("./content/*",o):[],function(){const t=r.shift(),i=n.shift(),a=n[0],l=e?[_n.create({text:e},{translate:!0})]:[];if(!t)return l;const u=i?Gs(i,"",{sup:ut.MESSAGES.MS.SUPER,sub:ut.MESSAGES.MS.SUB}):"",h=i&&"EMPTY"!==G(i)||s&&o&&o.previousSibling?[_n.create({text:ut.MESSAGES.regexp.SPACE+u},{})]:[],d=a&&"EMPTY"!==G(a)||!r.length&&o&&o.nextSibling?[_n.create({text:ut.MESSAGES.regexp.SPACE},{})]:[],f=N.evaluateNode(t);return f.unshift(new _n({text:"",layout:`beginrel${c}`})),f.push(new _n({text:"",layout:`endrel${c}`})),s=!1,l.concat(h,f,d)}}function di(t,e){const n=t.slice(0);let r;return r=t.length>0?b("../../content/*",t[0]):[],function(){const t=n.shift(),s=n[0],o=r.shift(),i=e?[_n.create({text:e},{translate:!0})]:[];if(!o)return i;const c=t&&"NUMBER"===G(t),a=s&&"NUMBER"===G(s);return i.concat(c&&a&&o.getAttribute("role")===J.SPACE?[_n.create({text:ut.MESSAGES.regexp.SPACE},{})]:[])}}function fi(t,e){let n=Dn(t,e),r=t[0].parentNode.parentNode.getAttribute("annotation").match(/depth:(\d+)/),s=r?r[1]:"";return function(){const t=n();return t.unshift(new _n({text:"",layout:`beginrel${s}`})),t.push(new _n({text:"",layout:`endrel${s}`})),t}}Gn(new wn("nemeth","number",(function(t,e){return t.childNodes.length?(-1!==li.indexOf(t.type)&&(e.script=!0),t.type===z.FENCED?(e.number=!1,e.enclosed=!0,["",e]):t.type===z.PREFIXOP&&t.role!==J.GEOMETRY&&t.role!==J.NEGATIVE?(e.number=!1,["",e]):(ui(t,e)&&(e.number=!0,e.enclosed=!1),["",e])):(ui(t,e)&&(e.number=!0,e.script=!1,e.enclosed=!1),[e.number?"number":"",{number:!1,enclosed:e.enclosed,script:e.script}])}),{number:!0})),Gn(new wn("depth","depth",(function(t){return t.parent?[parseInt(t.parent.annotation.depth[0])+1]:[1]}))),Vn("depth","depth"),gt.getInstance().setCorrection("ignoreEnglish",(function(t){return Nt(t,ut.ALPHABETS.languagePrefix.english)}));let pi=!1;function mi(){pi||(Fn(c.BASE_LOCALE+".speech.mathspeak","",{CQFspaceoutNumber:Rs,CQFspaceoutIdentifier:Os,CSFspaceoutText:Is,CSFopenFracVerbose:Ps,CSFcloseFracVerbose:Fs,CSFoverFracVerbose:Us,CSFopenFracBrief:xs,CSFcloseFracBrief:Ds,CSFopenFracSbrief:vs,CSFcloseFracSbrief:ws,CSFoverFracSbrief:Bs,CSFvulgarFraction:go,CQFvulgarFractionSmall:ks,CSFopenRadicalVerbose:qs,CSFcloseRadicalVerbose:zs,CSFindexRadicalVerbose:Qs,CSFopenRadicalBrief:Js,CSFcloseRadicalBrief:Zs,CSFindexRadicalBrief:to,CSFopenRadicalSbrief:eo,CSFindexRadicalSbrief:no,CQFisSmallRoot:po,CSFsuperscriptVerbose:js,CSFsuperscriptBrief:Hs,CSFsubscriptVerbose:Vs,CSFsubscriptBrief:$s,CSFbaselineVerbose:Xs,CSFbaselineBrief:Ws,CSFleftsuperscriptVerbose:js,CSFleftsubscriptVerbose:Vs,CSFrightsuperscriptVerbose:js,CSFrightsubscriptVerbose:Vs,CSFleftsuperscriptBrief:Hs,CSFleftsubscriptBrief:$s,CSFrightsuperscriptBrief:Hs,CSFrightsubscriptBrief:$s,CSFunderscript:ro,CSFoverscript:oo,CSFendscripts:so,CTFordinalCounter:mo,CTFwordCounter:Eo,CTFcontentIterator:Dn,CQFdetIsSimple:io,CSFRemoveParens:ao,CQFresetNesting:bs,CGFbaselineConstraint:co,CGFtensorRules:fo}),Fn("es.speech.mathspeak",c.BASE_LOCALE+".speech.mathspeak",{CTFunitMultipliers:Yo,CQFoneLeft:Qo}),Fn("fr.speech.mathspeak",c.BASE_LOCALE+".speech.mathspeak",{CSFbaselineVerbose:So,CSFbaselineBrief:To,CSFleftsuperscriptVerbose:Io,CSFleftsubscriptVerbose:Ao,CSFleftsuperscriptBrief:Ro,CSFleftsubscriptBrief:Oo}),Fn("ko.speech.mathspeak",c.BASE_LOCALE+".speech.mathspeak",{CSFopenFracVerbose:bo,CSFcloseFracVerbose:Lo,CSFopenFracBrief:Mo,CSFcloseFracBrief:yo,CSFopenFracSbrief:_o,CSFoverFracSbrief:Fo,CSFcloseFracSbrief:Po,CQFisSimpleIndex:Uo,CSFindexRadicalVerbose:Vo,CSFindexRadicalBrief:$o,CSFindexRadicalSbrief:jo,CSFopenRadicalVerbose:Do,CSFcloseRadicalVerbose:vo,CSFopenRadicalBrief:wo,CSFcloseRadicalBrief:Bo,CSFopenRadicalSbrief:ko}),Fn(c.BASE_LOCALE+".speech.clearspeak","",{CTFpauseSeparator:xn,CTFnodeCounter:$n,CTFcontentIterator:Dn,CSFvulgarFraction:go,CQFvulgarFractionSmall:Jn,CQFcellsSimple:Qn,CSFordinalExponent:tr,CSFwordOrdinal:ar,CQFmatchingFences:rr,CSFnestingDepth:nr,CQFfencedArguments:sr,CQFsimpleArguments:or,CQFspaceoutNumber:Rs}),Fn("en.prefix.default","",{CSFordinalPosition:No}),Fn("en.speech.chromevox","",{CTFnodeCounter:Un,CTFcontentIterator:Dn}),Fn("en.speech.emacspeak","en.speech.chromevox",{CQFvulgarFractionSmall:ks,CSFvulgarFraction:go}),Fn("ko.summary.","ko.speech.mathspeak",{CSFordinalConversion:Ho,CSFdecreasedOrdinalConversion:Xo,CSFlistOrdinalConversion:Wo}),Fn("nemeth.braille.default",c.BASE_LOCALE+".speech.mathspeak",{CSFopenFraction:Jo,CSFcloseFraction:Zo,CSFoverFraction:ti,CSFoverBevFraction:ei,CQFhyperFraction:ni,CSFopenRadical:oi,CSFcloseRadical:ii,CSFindexRadical:ci,CSFsubscript:Vs,CSFsuperscript:js,CSFbaseline:Xs,CGFtensorRules:t=>fo(t,!1),CTFcontentIterator:fi,CTFrelationIterator:hi,CTFimplicitIterator:di}),Fn("euro.braille.default","nemeth.braille.default",{}),pi=!0)}class Ei{constructor(t,e,n,r){this.name=t,this.dynamicCstr=e,this.precondition=n,this.action=r,this.context=null}toString(){return this.name+" | "+this.dynamicCstr.toString()+" | "+this.precondition.toString()+" ==> "+this.action.toString()}}var gi,Ni;function Si(t){switch(t){case"[n]":return gi.NODE;case"[m]":return gi.MULTI;case"[t]":return gi.TEXT;case"[p]":return gi.PERSONALITY;default:throw"Parse error: "+t}}!function(t){t.NODE="NODE",t.MULTI="MULTI",t.TEXT="TEXT",t.PERSONALITY="PERSONALITY"}(gi||(gi={}));class Ti{static grammarFromString(t){return gt.parseInput(t)}static fromString(t){const e={type:Si(t.substring(0,3))};let n=t.slice(3).trim();if(!n)throw new Ri("Missing content.");switch(e.type){case gi.TEXT:if('"'===n[0]){const t=Oi(n,"\\(")[0].trim();if('"'!==t.slice(-1))throw new Ri("Invalid string syntax.");e.content=t,n=n.slice(t.length).trim(),-1===n.indexOf("(")&&(n="");break}case gi.NODE:case gi.MULTI:{const t=n.indexOf(" (");if(-1===t){e.content=n.trim(),n="";break}e.content=n.substring(0,t).trim(),n=n.slice(t).trim()}}if(n){const t=Ti.attributesFromString(n);t.grammar&&(e.grammar=t.grammar,delete t.grammar),Object.keys(t).length&&(e.attributes=t)}return new Ti(e)}static attributesFromString(t){if("("!==t[0]||")"!==t.slice(-1))throw new Ri("Invalid attribute expression: "+t);const e={},n=Oi(t.slice(1,-1),",");for(const t of n){const n=t.indexOf(":");if(-1===n)e[t.trim()]="true";else{const r=t.substring(0,n).trim(),s=t.slice(n+1).trim();e[r]=r===Et?Ti.grammarFromString(s):s}}return e}constructor({type:t,content:e,attributes:n,grammar:r}){this.type=t,this.content=e,this.attributes=n,this.grammar=r}toString(){let t="";t+=function(t){switch(t){case gi.NODE:return"[n]";case gi.MULTI:return"[m]";case gi.TEXT:return"[t]";case gi.PERSONALITY:return"[p]";default:throw"Unknown type error: "+t}}(this.type),t+=this.content?" "+this.content:"";const e=this.attributesToString();return t+=e?" "+e:"",t}grammarToString(){return this.getGrammar().join(":")}getGrammar(){if(!this.grammar)return[];const t=[];for(const[e,n]of Object.entries(this.grammar))t.push(!0===n?e:!1===n?`!${e}`:`${e}=${n}`);return t}attributesToString(){const t=this.getAttributes(),e=this.grammarToString();return e&&t.push("grammar:"+e),t.length>0?"("+t.join(", ")+")":""}getAttributes(){if(!this.attributes)return[];const t=[];for(const[e,n]of Object.entries(this.attributes))t.push("true"===n?e:`${e}:${n}`);return t}}class Ii{static fromString(t){const e=Oi(t,";").filter((function(t){return t.match(/\S/)})).map((function(t){return t.trim()})),n=[];for(let t=0,r=e.length;t<r;t++){const r=Ti.fromString(e[t]);r&&n.push(r)}return Ii.naiveSpan(n),new Ii(n)}static naiveSpan(t){var e;let n=!1;for(let r,s=0;r=t[s];s++){if(n&&(r.type!==gi.TEXT||'"'!==r.content[0]&&!r.content.match(/^CSF/)))continue;if(!n&&r.type===gi.PERSONALITY)continue;if(!n){n=!0;continue}if(null===(e=r.attributes)||void 0===e?void 0:e.span)continue;const o=t[s+1];o&&o.type!==gi.NODE||Ii.addNaiveSpan(r,o?o.content:"LAST")}}static addNaiveSpan(t,e){t.attributes||(t.attributes={}),t.attributes.span=e}constructor(t){this.components=t}toString(){return this.components.map((function(t){return t.toString()})).join("; ")}}class Ai{static constraintValue(t,e){for(let n,r=0;n=e[r];r++)if(t.match(n))return++r;return 0}toString(){const t=this.constraints.join(", ");return`${this.query}, ${t} (${this.priority}, ${this.rank})`}constructor(t,...e){this.query=t,this.constraints=e;const[n,r]=this.presetPriority();this.priority=n?r:this.calculatePriority()}calculatePriority(){const t=Ai.constraintValue(this.query,Ai.queryPriorities);if(!t)return 0;const e=this.query.match(/^self::.+\[(.+)\]/);let n=0;if((null==e?void 0:e.length)&&e[1]){const t=e[1];n=Ai.constraintValue(t,Ai.attributePriorities)}return 100*t+10*n}presetPriority(){if(!this.constraints.length)return[!1,0];const t=this.constraints[this.constraints.length-1].match(/^priority=(.*$)/);if(!t)return[!1,0];this.constraints.pop();const e=parseFloat(t[1]);return[!0,isNaN(e)?0:e]}}Ai.queryPriorities=[/^self::\*$/,/^self::[\w-]+$/,/^self::\*\[.+\]$/,/^self::[\w-]+\[.+\]$/],Ai.attributePriorities=[/^@[\w-]+$/,/^@[\w-]+!=".+"$/,/^not\(contains\(@[\w-]+,\s*".+"\)\)$/,/^contains\(@[\w-]+,".+"\)$/,/^@[\w-]+=".+"$/];class Ri extends g{constructor(t){super(t),this.name="RuleError"}}function Oi(t,e){const n=[];let r="";for(;""!==t;){const s=t.search(e);if(-1===s){if((t.match(/"/g)||[]).length%2!=0)throw new Ri("Invalid string in expression: "+t);n.push(r+t),r="",t=""}else if((t.substring(0,s).match(/"/g)||[]).length%2==0)n.push(r+t.substring(0,s)),r="",t=t.substring(s+1);else{const e=t.substring(s).search('"');if(-1===e)throw new Ri("Invalid string in expression: "+t);r+=t.substring(0,s+e+1),t=t.substring(s+e+1)}}return r&&n.push(r),n}class Ci{constructor(t,e){this.prefix=t,this.store=e}add(t,e){this.checkCustomFunctionSyntax_(t)&&(this.store[t]=e)}addStore(t){const e=Object.keys(t.store);for(let n,r=0;n=e[r];r++)this.add(n,t.store[n])}lookup(t){return this.store[t]}checkCustomFunctionSyntax_(t){const e=new RegExp("^"+this.prefix);return!!t.match(e)||(console.error("FunctionError: Invalid function name. Expected prefix "+this.prefix),!1)}}class bi extends Ci{constructor(){super("CQF",{})}}class Li extends Ci{constructor(){super("CSF",{})}}class Mi extends Ci{constructor(){super("CTF",{})}}class yi extends Ci{constructor(){super("CGF",{})}}class _i{constructor(){this.customQueries=new bi,this.customStrings=new Li,this.contextFunctions=new Mi,this.customGenerators=new yi}applyCustomQuery(t,e){const n=this.customQueries.lookup(e);return n?n(t):null}applySelector(t,e){return this.applyCustomQuery(t,e)||b(e,t)}applyQuery(t,e){const n=this.applySelector(t,e);return n.length>0?n[0]:null}applyConstraint(t,e){return!!this.applyQuery(t,e)||function(t,e){let n;try{n=C(t,e,I.result.BOOLEAN_TYPE)}catch(t){return!1}return n.booleanValue}(e,t)}constructString(t,e){const n=this.constructString_(t,e);return Array.isArray(n)?n.map((t=>t.speech)).join(""):n}constructSpan(t,e,n){const r=this.constructString_(t,e);if(Array.isArray(r)){const t=r[r.length-1];return t.attributes=Object.assign({},n,t.attributes),r}return[Ln.node(r,t,n)]}constructString_(t,e){if(!e)return"";if('"'===e.charAt(0))return e.slice(1,-1);const n=this.customStrings.lookup(e);return n?n(t):function(t,e){let n;try{n=C(t,e,I.result.STRING_TYPE)}catch(t){return""}return n.stringValue}(e,t)}parse(t){const e=Array.isArray(t)?t:Object.entries(t);for(const t of e){switch(t[0].slice(0,3)){case"CQF":this.customQueries.add(t[0],t[1]);break;case"CSF":this.customStrings.add(t[0],t[1]);break;case"CTF":this.contextFunctions.add(t[0],t[1]);break;case"CGF":this.customGenerators.add(t[0],t[1]);break;default:console.error("FunctionError: Invalid function name "+t[0])}}}}class Pi{static compareStaticConstraints_(t,e){if(t.length!==e.length)return!1;for(let n,r=0;n=t[r];r++)if(-1===e.indexOf(n))return!1;return!0}static comparePreconditions_(t,e){const n=t.precondition,r=e.precondition;return n.query===r.query&&Pi.compareStaticConstraints_(n.constraints,r.constraints)}constructor(){this.context=new _i,this.parseOrder=c.DEFAULT_ORDER,this.parser=new a(this.parseOrder),this.locale=c.DEFAULT_VALUES[r.LOCALE],this.modality=c.DEFAULT_VALUES[r.MODALITY],this.domain="",this.initialized=!1,this.inherits=null,this.kind="standard",this.customTranscriptions={},this.preconditions=new Map,this.speechRules_=[],this.rank=0,this.parseMethods={Rule:this.defineRule,Generator:this.generateRules,Action:this.defineAction,Precondition:this.definePrecondition,Ignore:this.ignoreRules}}defineRule(t,e,n,r,...s){const o=this.parseAction(n),i=this.parsePrecondition(r,s),c=this.parseCstr(e);if(!(o&&i&&c))return console.error(`Rule Error: ${r}, (${e}): ${n}`),null;const a=new Ei(t,c,i,o);return a.precondition.rank=this.rank++,this.addRule(a),a}addRule(t){t.context=this.context,this.speechRules_.unshift(t)}deleteRule(t){const e=this.speechRules_.indexOf(t);-1!==e&&this.speechRules_.splice(e,1)}findRule(t){for(let e,n=0;e=this.speechRules_[n];n++)if(t(e))return e;return null}findAllRules(t){return this.speechRules_.filter(t)}evaluateDefault(t){const e=t.textContent.slice(0);return e.match(/^\s+$/)?this.evaluateWhitespace(e):this.evaluateString(e)}evaluateWhitespace(t){return[]}evaluateCustom(t){const e=this.customTranscriptions[t];return void 0!==e?_n.create({text:e},{adjust:!0,translate:!1}):null}evaluateCharacter(t){return this.evaluateCustom(t)||_n.create({text:t},{adjust:!0,translate:!0})}removeDuplicates(t){for(let e,n=this.speechRules_.length-1;e=this.speechRules_[n];n--)e!==t&&t.dynamicCstr.equal(e.dynamicCstr)&&Pi.comparePreconditions_(e,t)&&this.speechRules_.splice(n,1)}getSpeechRules(){return this.speechRules_}setSpeechRules(t){this.speechRules_=t}getPreconditions(){return this.preconditions}parseCstr(t){try{return this.parser.parse(this.locale+"."+this.modality+(this.domain?"."+this.domain:"")+"."+t)}catch(e){if("RuleError"===e.name)return console.error("Rule Error ",`Illegal Dynamic Constraint: ${t}.`,e.message),null;throw e}}parsePrecondition(t,e){try{const n=this.parsePrecondition_(t);t=n[0];let r=n.slice(1);for(const t of e)r=r.concat(this.parsePrecondition_(t));return new Ai(t,...r)}catch(n){if("RuleError"===n.name)return console.error("Rule Error ",`Illegal preconditions: ${t}, ${e}.`,n.message),null;throw n}}parseAction(t){try{return Ii.fromString(t)}catch(e){if("RuleError"===e.name)return console.error("Rule Error ",`Illegal action: ${t}.`,e.message),null;throw e}}parse(t){this.modality=t.modality||this.modality,this.locale=t.locale||this.locale,this.domain=t.domain||this.domain,this.context.parse(t.functions||[]),"actions"!==t.kind&&(this.kind=t.kind||this.kind,this.inheritRules()),this.parseRules(t.rules||[])}parseRules(t){for(let e,n=0;e=t[n];n++){const t=e[0],n=this.parseMethods[t];t&&n&&n.apply(this,e.slice(1))}}generateRules(t){const e=this.context.customGenerators.lookup(t);e&&e(this)}defineAction(t,e){let n;try{n=Ii.fromString(e)}catch(t){if("RuleError"===t.name)return void console.error("Action Error ",e,t.message);throw t}const r=this.getFullPreconditions(t);if(!r)return void console.error(`Action Error: No precondition for action ${t}`);this.ignoreRules(t);const s=new RegExp("^\\w+\\.\\w+\\."+(this.domain?"\\w+\\.":""));r.conditions.forEach((([e,r])=>{const o=this.parseCstr(e.toString().replace(s,""));this.addRule(new Ei(t,o,r,n))}))}getFullPreconditions(t){const e=this.preconditions.get(t);return e||!this.inherits?e:this.inherits.getFullPreconditions(t)}definePrecondition(t,e,n,...r){const s=this.parsePrecondition(n,r),o=this.parseCstr(e);s&&o?(s.rank=this.rank++,this.preconditions.set(t,new Fi(o,s))):console.error(`Precondition Error: ${n}, (${e})`)}inheritRules(){if(!this.inherits||!this.inherits.getSpeechRules().length)return;const t=new RegExp("^\\w+\\.\\w+\\."+(this.domain?"\\w+\\.":""));this.inherits.getSpeechRules().forEach((e=>{const n=this.parseCstr(e.dynamicCstr.toString().replace(t,""));this.addRule(new Ei(e.name,n,e.precondition,e.action))}))}ignoreRules(t,...e){let n=this.findAllRules((e=>e.name===t));if(!e.length)return void n.forEach(this.deleteRule.bind(this));let r=[];for(const t of e){const e=this.parseCstr(t);for(const t of n)e.equal(t.dynamicCstr)?this.deleteRule(t):r.push(t);n=r,r=[]}}parsePrecondition_(t){const e=this.context.customGenerators.lookup(t);return e?e():[t]}}class Fi{constructor(t,e){this.base=t,this._conditions=[],this.constraints=[],this.allCstr={},this.constraints.push(t),this.addCondition(t,e)}get conditions(){return this._conditions}addConstraint(t){if(this.constraints.filter((e=>e.equal(t))).length)return;this.constraints.push(t);const e=[];for(const[n,r]of this.conditions)this.base.equal(n)&&e.push([t,r]);this._conditions=this._conditions.concat(e)}addBaseCondition(t){this.addCondition(this.base,t)}addFullCondition(t){this.constraints.forEach((e=>this.addCondition(e,t)))}addCondition(t,e){const n=t.toString()+" "+e.toString();this.allCstr.condStr||(this.allCstr[n]=!0,this._conditions.push([t,e]))}}class Ui extends Pi{constructor(){super(),this.annotators=[],this.parseMethods.Alias=this.defineAlias,this.parseMethods.SpecializedRule=this.defineSpecializedRule,this.parseMethods.Specialized=this.defineSpecialized}initialize(){this.initialized||(this.annotations(),this.initialized=!0)}annotations(){for(let t,e=0;t=this.annotators[e];e++)Vn(this.domain,t)}defineAlias(t,e,...n){const r=this.parsePrecondition(e,n);if(!r)return void console.error(`Precondition Error: ${e} ${n}`);const s=this.preconditions.get(t);s?s.addFullCondition(r):console.error(`Alias Error: No precondition by the name of ${t}`)}defineRulesAlias(t,e,...n){const r=this.findAllRules((function(e){return e.name===t}));if(0===r.length)throw new Ri("Rule with name "+t+" does not exist.");const s=[];r.forEach((t=>{(t=>{const e=t.dynamicCstr.toString(),n=t.action.toString();for(let t,r=0;t=s[r];r++)if(t.action===n&&t.cstr===e)return!1;return s.push({cstr:e,action:n}),!0})(t)&&this.addAlias_(t,e,n)}))}defineSpecializedRule(t,e,n,r){const s=this.parseCstr(e),o=this.findRule((e=>e.name===t&&s.equal(e.dynamicCstr))),i=this.parseCstr(n);if(!o&&r)throw new Ri("Rule named "+t+" with style "+e+" does not exist.");const c=r?Ii.fromString(r):o.action,a=new Ei(o.name,i,o.precondition,c);this.addRule(a)}defineSpecialized(t,e,n){const r=this.parseCstr(n);if(!r)return void console.error(`Dynamic Constraint Error: ${n}`);const s=this.preconditions.get(t);s?s.addConstraint(r):console.error(`Alias Error: No precondition by the name of ${t}`)}evaluateString(t){const e=[];if(t.match(/^\s+$/))return e;let n=this.matchNumber(t);if(n&&n.length===t.length)return e.push(this.evaluateCharacter(n.number)),e;const r=t.replace(/\s/g," ").split(" ").filter((t=>t));for(let t,s=0;t=r[s];s++)if(1===t.length)e.push(this.evaluateCharacter(t));else if(t.match(new RegExp("^["+ut.MESSAGES.regexp.TEXT+"]+$")))e.push(this.evaluateCharacter(t));else{let r=t;for(;r;){n=this.matchNumber(r);const t=r.match(new RegExp("^["+ut.MESSAGES.regexp.TEXT+"]+"));if(n)e.push(this.evaluateCharacter(n.number)),r=r.substring(n.length);else if(t)e.push(this.evaluateCharacter(t[0])),r=r.substring(t[0].length);else{const t=Array.from(r),n=t[0];e.push(this.evaluateCharacter(n)),r=t.slice(1).join("")}}}return e}parse(t){super.parse(t),this.annotators=t.annotators||[]}addAlias_(t,e,n){const r=this.parsePrecondition(e,n),s=new Ei(t.name,t.dynamicCstr,r,t.action);s.name=t.name,this.addRule(s)}matchNumber(t){const e=t.match(new RegExp("^"+ut.MESSAGES.regexp.NUMBER)),n=t.match(new RegExp("^"+Ui.regexp.NUMBER));if(!e&&!n)return null;const r=n&&n[0]===t;if(e&&e[0]===t||!r)return e?{number:e[0],length:e[0].length}:null;return{number:n[0].replace(new RegExp(Ui.regexp.DIGIT_GROUP,"g"),"X").replace(new RegExp(Ui.regexp.DECIMAL_MARK,"g"),ut.MESSAGES.regexp.DECIMAL_MARK).replace(/X/g,ut.MESSAGES.regexp.DIGIT_GROUP.replace(/\\/g,"")),length:n[0].length}}}Ui.regexp={NUMBER:"((\\d{1,3})(?=(,| ))((,| )\\d{3})*(\\.\\d+)?)|^\\d*\\.\\d+|^\\d+",DECIMAL_MARK:"\\.",DIGIT_GROUP:","};class xi extends Ui{constructor(){super(...arguments),this.modality="braille",this.customTranscriptions={"\u22ca":"\u2808\u2821\u2833"}}evaluateString(t){const e=[],n=Array.from(t);for(let t=0;t<n.length;t++)e.push(this.evaluateCharacter(n[t]));return e}annotations(){for(let t,e=0;t=this.annotators[e];e++)Vn(this.locale,t)}}class Di extends xi{constructor(){super(...arguments),this.locale="euro",this.customTranscriptions={},this.customCommands={"\\cdot":"*","\\lt":"<","\\gt":">"},this.lastSpecial=!1,this.specialChars=["^","_","{","}"]}evaluateString(t){let e=t.split(/(\\[a-z]+|\\{|\\}|\\\\)/i),n=this.cleanup(e);return super.evaluateString(n)}cleanup(t){let e=[],n=!1,r=null;for(let s of t){if(s.match(/^\\/)){"\\text"===s&&(n=!0),this.addSpace(on.LatexCommands.get(s))&&e.push(" "),s=this.customCommands[s]||s;let t=s.match(/^\\/);t&&s.match(/^\\[a-zA-Z]+$/)&&r&&e.push(" "),r=t?s:null,e.push(s);continue}let t=s.split("");for(let s of t)n?(e.push(s),n="}"!==s,r=null):s.match(/[a-z]/i)&&r?(r=null,e.push(" "),e.push(s)):s.match(/\s/)||(this.addSpace(s)&&e.push(" "),e.push(s),r=null)}return e.join("")}addSpace(t){if(!t)return!1;if(-1!==this.specialChars.indexOf(t))return this.lastSpecial=!0,!1;if(this.lastSpecial)return this.lastSpecial=!1,!1;let e=on.Meaning.get(t);return e.type===z.OPERATOR||e.type===z.RELATION||e.type===z.PUNCTUATION&&e.role===J.COLON}}!function(t){t.ROOT="root",t.DYNAMIC="dynamic",t.QUERY="query",t.BOOLEAN="boolean",t.STATIC="static"}(Ni||(Ni={}));class vi{constructor(t,e){this.constraint=t,this.test=e,this.children_={},this.kind=Ni.ROOT}getConstraint(){return this.constraint}getKind(){return this.kind}applyTest(t){return this.test(t)}addChild(t){const e=t.getConstraint(),n=this.children_[e];return this.children_[e]=t,n}getChild(t){return this.children_[t]}getChildren(){const t=[];for(const e of Object.values(this.children_))t.push(e);return t}findChildren(t){const e=[];for(const n of Object.values(this.children_))n.applyTest(t)&&e.push(n);return e}removeChild(t){delete this.children_[t]}toString(){return this.constraint}}class wi extends vi{constructor(t,e){super(t,e),this.rule_=null,this.kind=Ni.STATIC}getRule(){return this.rule_}setRule(t){this.rule_&&m.getInstance().output("Replacing rule "+this.rule_+" with "+t),this.rule_=t}toString(){return this.getRule()?this.constraint+"\n==> "+this.getRule().action:this.constraint}}function Bi(t,e,n){switch(t){case Ni.ROOT:return new ki;case Ni.DYNAMIC:return new Gi(e);case Ni.QUERY:return new ji(e,n);case Ni.BOOLEAN:return new Hi(e,n);default:return null}}class ki extends vi{constructor(){super("",(()=>!0)),this.kind=Ni.ROOT}}class Gi extends vi{constructor(t){super(t,(e=>e===t)),this.kind=Ni.DYNAMIC}}const Vi={"=":(t,e)=>t===e,"!=":(t,e)=>t!==e,"<":(t,e)=>t<e,">":(t,e)=>t>e,"<=":(t,e)=>t<=e,">=":(t,e)=>t>=e};function $i(t){if(t.match(/^self::\*$/))return t=>!0;if(t.match(/^self::\w+$/)){const e=t.slice(6).toUpperCase();return t=>t.tagName&&G(t)===e}if(t.match(/^self::\w+:\w+$/)){const e=t.split(":"),n=R(e[2]);if(!n)return null;const r=e[3].toUpperCase();return t=>t.localName&&t.localName.toUpperCase()===r&&t.namespaceURI===n}if(t.match(/^@\w+$/)){const e=t.slice(1);return t=>t.hasAttribute&&t.hasAttribute(e)}if(t.match(/^@\w+="[\w\d ]+"$/)){const e=t.split("="),n=e[0].slice(1),r=e[1].slice(1,-1);return t=>t.hasAttribute&&t.hasAttribute(n)&&t.getAttribute(n)===r}if(t.match(/^@\w+!="[\w\d ]+"$/)){const e=t.split("!="),n=e[0].slice(1),r=e[1].slice(1,-1);return t=>!t.hasAttribute||!t.hasAttribute(n)||t.getAttribute(n)!==r}if(t.match(/^contains\(\s*@grammar\s*,\s*"[\w\d ]+"\s*\)$/)){const e=t.split('"')[1];return t=>!!gt.getInstance().getParameter(e)}if(t.match(/^not\(\s*contains\(\s*@grammar\s*,\s*"[\w\d ]+"\s*\)\s*\)$/)){const e=t.split('"')[1];return t=>!gt.getInstance().getParameter(e)}if(t.match(/^name\(\.\.\/\.\.\)="\w+"$/)){const e=t.split('"')[1].toUpperCase();return t=>{var n,r;return(null===(r=null===(n=t.parentNode)||void 0===n?void 0:n.parentNode)||void 0===r?void 0:r.tagName)&&G(t.parentNode.parentNode)===e}}if(t.match(/^count\(preceding-sibling::\*\)=\d+$/)){const e=t.split("="),n=parseInt(e[1],10);return t=>{var e;return(null===(e=t.parentNode)||void 0===e?void 0:e.childNodes[n])===t}}if(t.match(/^.+\[@category!?=".+"\]$/)){let[,e,n,r]=t.match(/^(.+)\[@category(!?=)"(.+)"\]$/);const s=r.match(/^unit:(.+)$/);let o="";return s&&(r=s[1],o=":unit"),t=>{const s=b(e,t)[0];if(s){const t=function(t){const e=gn.get(t);return(null==e?void 0:e.base)?e.base.category:""}(s.textContent+o);return"="===n?t===r:t!==r}return!1}}if(t.match(/^string-length\(.+\)\W+\d+/)){const[,e,n,r]=t.match(/^string-length\((.+)\)(\W+)(\d+)/),s=Vi[n]||Vi["="],o=parseInt(r,10);return t=>{const n=b(e,t)[0];return!!n&&s(Array.from(n.textContent).length,o)}}return null}class ji extends wi{constructor(t,e){super(t,$i(t)),this.context=e,this.kind=Ni.QUERY}applyTest(t){return this.test?this.test(t):this.context.applyQuery(t,this.constraint)===t}}class Hi extends wi{constructor(t,e){super(t,$i(t)),this.context=e,this.kind=Ni.BOOLEAN}applyTest(t){return this.test?this.test(t):this.context.applyConstraint(t,this.constraint)}}class Xi{static collectRules_(t){const e=[];let n=[t];for(;n.length;){const t=n.shift();if(t.getKind()===Ni.QUERY||t.getKind()===Ni.BOOLEAN){const n=t.getRule();n&&e.unshift(n)}n=n.concat(t.getChildren())}return e}static printWithDepth_(t,e,n){n+=new Array(e+2).join(e.toString())+": "+t.toString()+"\n";const r=t.getChildren();for(let t,s=0;t=r[s];s++)n=Xi.printWithDepth_(t,e+1,n);return n}static order_(t){const e=t.getChildren();if(!e.length)return 0;const n=Math.max.apply(null,e.map(Xi.order_));return Math.max(e.length,n)}constructor(){this.root=Bi(Ni.ROOT,"",null)}addRule(t){let e=this.root;const n=t.context,r=t.dynamicCstr.getValues();for(let t=0,s=r.length;t<s;t++)e=this.addNode_(e,r[t],Ni.DYNAMIC,n);e=this.addNode_(e,t.precondition.query,Ni.QUERY,n);const s=t.precondition.constraints;for(let t=0,r=s.length;t<r;t++)e=this.addNode_(e,s[t],Ni.BOOLEAN,n);e.setRule(t)}lookupRules(t,e){let n=[this.root];const r=[];for(;e.length;){const t=e.shift(),r=[];for(;n.length;){n.shift().getChildren().forEach((e=>{e.getKind()===Ni.DYNAMIC&&-1===t.indexOf(e.getConstraint())||r.push(e)}))}n=r.slice()}for(;n.length;){const e=n.shift();if(e.getRule){const t=e.getRule();t&&r.push(t)}const s=e.findChildren(t);n=n.concat(s)}return r}hasSubtrie(t){let e=this.root;for(let n=0,r=t.length;n<r;n++){const r=t[n];if(e=e.getChild(r),!e)return!1}return!0}toString(){return Xi.printWithDepth_(this.root,0,"")}collectRules(t=this.root){return Xi.collectRules_(t)}order(){return Xi.order_(this.root)}enumerate(t){return this.enumerate_(this.root,t)}byConstraint(t){let e=this.root;for(;t.length&&e;){const n=t.shift();e=e.getChild(n)}return e||null}enumerate_(t,e){e=e||{};const n=t.getChildren();for(let t,r=0;t=n[r];r++)t.kind===Ni.DYNAMIC&&(e[t.getConstraint()]=this.enumerate_(t,e[t.getConstraint()]));return e}addNode_(t,e,n,r){let s=t.getChild(e);return s||(s=Bi(n,e,r),t.addChild(s)),s}}class Wi{static getInstance(){return Wi.instance=Wi.instance||new Wi,Wi.instance}static debugSpeechRule(t,e){const n=t.precondition,r=t.context.applyQuery(e,n.query);m.getInstance().output(n.query,r?r.toString():r),n.constraints.forEach((n=>m.getInstance().output(n,t.context.applyConstraint(e,n))))}static debugNamedSpeechRule(t,e){const n=Wi.getInstance().trie.collectRules().filter((e=>e.name==t));for(let r,s=0;r=n[s];s++)m.getInstance().output("Rule",t,"DynamicCstr:",r.dynamicCstr.toString(),"number",s),Wi.debugSpeechRule(r,e)}evaluateNode(t){L(t);const e=(new Date).getTime();let n=[];try{n=this.evaluateNode_(t)}catch(t){console.log(t),console.error("Something went wrong computing speech."),m.getInstance().output(t)}const r=(new Date).getTime();return m.getInstance().output("Time:",r-e),n}toString(){return this.trie.collectRules().map((t=>t.toString())).join("\n")}runInSetting(t,e){const n=N.getInstance(),r={};for(const[e,s]of Object.entries(t))r[e]=n[e],n[e]=s;n.setDynamicCstr();const s=e();for(const[t,e]of Object.entries(r))n[t]=e;return n.setDynamicCstr(),s}static addStore(t){const e=function(t){const e=`${t.locale}.${t.modality}.${t.domain}`;if("actions"===t.kind){const n=Yi.get(e);return n.parse(t),n}mi(),t&&!t.functions&&(t.functions=function(t,e,n){return Pn.get([t,e,n].join("."))||Pn.get([c.DEFAULT_VALUES[r.LOCALE],e,n].join("."))||Pn.get([c.BASE_LOCALE,e,n].join("."))||{}}(t.locale,t.modality,t.domain));const n=function(t,e){if("braille"===e&&"euro"===t)return new Di;if("braille"===e)return new xi;return new Ui}(t.locale,t.modality);Yi.set(e,n),t.inherits&&(n.inherits=Yi.get(`${t.inherits}.${t.modality}.${t.domain}`));return n.parse(t),n.initialize(),n}(t);"abstract"!==e.kind&&e.getSpeechRules().forEach((t=>Wi.getInstance().trie.addRule(t))),Wi.getInstance().addEvaluator(e)}processGrammar(t,e,n){const r={};for(const[s,o]of Object.entries(n))r[s]="string"==typeof o?t.constructString(e,o):o;gt.getInstance().pushState(r)}addEvaluator(t){const e=t.evaluateDefault.bind(t),n=this.evaluators_[t.locale];if(n)return void(n[t.modality]=e);const r={};r[t.modality]=e,this.evaluators_[t.locale]=r}getEvaluator(t,e){const n=this.evaluators_[t]||this.evaluators_[c.DEFAULT_VALUES[r.LOCALE]];return n[e]||n[c.DEFAULT_VALUES[r.MODALITY]]}enumerate(t){return this.trie.enumerate(t)}constructor(){this.trie=null,this.evaluators_={},this.trie=new Xi}evaluateNode_(t){if(!t)return[];this.updateConstraint_();let e=this.evaluateTree_(t);return e=function(t){let e=new yn(t);for(let t of e.annotations){let n=t.data;if("punctuation"===n.annotation){let r=e.prevText(t);if(!r)continue;let s=r.data;"punctuation"!==s.annotation&&"\u2800"!==s.text&&1===n.text.length&&-1!==Ki.indexOf(n.text)&&(n.text="\u2838"+n.text)}}return e.toList()}(e),e}evaluateTree_(t){const e=N.getInstance();let n;m.getInstance().output(e.mode!==s.HTTP?t.toString():t),gt.getInstance().setAttribute(t);const r=this.lookupRule(t,e.dynamicCstr);if(!r)return e.strict?[]:(n=this.getEvaluator(e.locale,e.modality)(t),t.attributes&&this.addPersonality_(n,{},!1,t),n);m.getInstance().generateOutput((()=>["Apply Rule:",r.name,r.dynamicCstr.toString(),e.mode===s.HTTP?$(t):t.toString()])),gt.getInstance().processSingles();const o=r.context,i=r.action.components;n=[];for(let e,r=0;e=i[r];r++){let r=[];const s=e.content||"",i=e.attributes||{};let c=!1;e.grammar&&this.processGrammar(o,t,e.grammar);let a=null;if(i.engine){a=N.getInstance().dynamicCstr.getComponents();const t=Object.assign({},a,gt.parseInput(i.engine));N.getInstance().setDynamicCstr(t),this.updateConstraint_()}switch(e.type){case gi.NODE:{const e=o.applyQuery(t,s);e&&(r=this.evaluateTree_(e))}break;case gi.MULTI:{c=!0;const e=o.applySelector(t,s);e.length>0&&(r=this.evaluateNodeList_(o,e,i.sepFunc,o.constructString(t,i.separator),i.ctxtFunc,o.constructString(t,i.context)))}break;case gi.TEXT:{const e=i.span;let n={};if(e){const r=b(e,t);n=r.length?Ln.getAttributes(r[0]):{kind:e}}r=o.constructSpan(t,s,n).map((function(t){return _n.create({text:t.speech,attributes:t.attributes},{adjust:!0})}))}break;case gi.PERSONALITY:default:r=[_n.create({text:s})]}r[0]&&!c&&(i.context&&(r[0].context=o.constructString(t,i.context)+(r[0].context||"")),i.annotation&&(r[0].annotation=i.annotation)),this.addLayout(r,i,c),e.grammar&&gt.getInstance().popState(),n=n.concat(this.addPersonality_(r,i,c,t)),a&&(N.getInstance().setDynamicCstr(a),this.updateConstraint_())}return gt.getInstance().popState(),n}evaluateNodeList_(t,e,n,r,s,o){if(!e.length)return[];const i=r||"",c=o||"",a=t.contextFunctions.lookup(s),l=a?a(e,c):function(){return c},u=t.contextFunctions.lookup(n),h=u?u(e,i):function(){return[_n.create({text:i},{translate:!0})]};let d=[];for(let t,n=0;t=e[n];n++){const r=this.evaluateTree_(t);if(r.length>0&&(r[0].context=l()+(r[0].context||""),d=d.concat(r),n<e.length-1)){const t=h();d=d.concat(t)}}return d}addLayout(t,e,n){const r=e.layout;r&&(r.match(/^begin/)?t.unshift(new _n({text:"",layout:r})):r.match(/^end/)?t.push(new _n({text:"",layout:r})):(t.unshift(new _n({text:"",layout:`begin${r}`})),t.push(new _n({text:"",layout:`end${r}`}))))}addPersonality_(t,e,n,r){const s={};let i=null;for(const t of u){const n=e[t];if(void 0===n)continue;const r=parseFloat(n),c=isNaN(r)?'"'===n.charAt(0)?n.slice(1,-1):n:r;t===o.PAUSE?i=c:s[t]=c}for(let e,n=0;e=t[n];n++)this.addRelativePersonality_(e,s),this.addExternalAttributes_(e,r);if(n&&t.length&&delete t[t.length-1].personality[o.JOIN],i&&t.length){const e=t[t.length-1];e.text||Object.keys(e.personality).length?t.push(_n.create({text:"",personality:{pause:i}})):e.personality[o.PAUSE]=i}return t}addExternalAttributes_(t,e){if(void 0===t.attributes.id&&(t.attributes.id=e.getAttribute("id")),e.hasAttributes()){const n=e.attributes;for(let e=n.length-1;e>=0;e--){const r=n[e].name;!t.attributes[r]&&r.match(/^ext/)&&(t.attributes[r]=n[e].value)}}}addRelativePersonality_(t,e){if(!t.personality)return t.personality=e,t;const n=t.personality;for(const[t,r]of Object.entries(e))n[t]&&"number"==typeof n[t]&&"number"==typeof r?n[t]=n[t]+r:n[t]||(n[t]=r);return t}updateConstraint_(){const t=N.getInstance().dynamicCstr,e=N.getInstance().strict,n=this.trie,s={};let o=t.getValue(r.LOCALE),i=t.getValue(r.MODALITY),a=t.getValue(r.DOMAIN);n.hasSubtrie([o,i,a])||(a=c.DEFAULT_VALUES[r.DOMAIN],n.hasSubtrie([o,i,a])||(i=c.DEFAULT_VALUES[r.MODALITY],n.hasSubtrie([o,i,a])||(o=c.DEFAULT_VALUES[r.LOCALE]))),s[r.LOCALE]=[o],s[r.MODALITY]=["summary"!==i?i:c.DEFAULT_VALUES[r.MODALITY]],s[r.DOMAIN]=["speech"!==i?c.DEFAULT_VALUES[r.DOMAIN]:a];const l=t.getOrder();for(let n,r=0;n=l[r];r++)if(!s[n]){const r=t.getValue(n),o=this.makeSet_(r,t.preference),i=c.DEFAULT_VALUES[n];e||r===i||o.push(i),s[n]=o}t.updateProperties(s)}makeSet_(t,e){return e&&Object.keys(e).length?t.split(":"):[t]}lookupRule(t,e){if(!t||t.nodeType!==_.ELEMENT_NODE&&t.nodeType!==_.TEXT_NODE)return null;const n=this.lookupRules(t,e);return n.length>0?this.pickMostConstraint_(e,n):null}lookupRules(t,e){return this.trie.lookupRules(t,e.allProperties())}pickMostConstraint_(t,e){const n=N.getInstance().comparator;return e.sort((function(t,e){return n.compare(t.dynamicCstr,e.dynamicCstr)||e.precondition.priority-t.precondition.priority||e.precondition.constraints.length-t.precondition.constraints.length||e.precondition.rank-t.precondition.rank})),m.getInstance().generateOutput((()=>e.map((t=>t.name+"("+t.dynamicCstr.toString()+")"))).bind(this)),e[0]}}const Yi=new Map;N.nodeEvaluator=Wi.getInstance().evaluateNode.bind(Wi.getInstance());let Ki=["\u2806","\u2812","\u2832","\u2826","\u2834","\u2804"];const qi={small:["default"],capital:["default"],digit:["default"]};function zi(t){const e=N.getInstance().locale;N.getInstance().locale=t,Ye(),pn({locale:t}),function(){const t=ut.ALPHABETS,e=(t,e)=>{const n={};return Object.keys(t).forEach((t=>n[t]=!0)),Object.keys(e).forEach((t=>n[t]=!0)),Object.keys(n)};qi.small=e(t.smallPrefix,t.letterTrans),qi.capital=e(t.capPrefix,t.letterTrans),qi.digit=e(t.digitPrefix,t.digitTrans)}();for(const t of Y.values()){const e=t.unicode;if("offset"in t)Zi(e,t.font,t.offset||0);else{Ji(e,ut.ALPHABETS[t.base],t.font,!!t.capital)}}N.getInstance().locale=e,Ye()}function Qi(t){return function(t){return"string"==typeof t?{font:t,combiner:ut.ALPHABETS.combiner}:{font:t[0],combiner:ut.COMBINERS[t[1]]||it[t[1]]||ut.ALPHABETS.combiner}}("normal"===t||"fullwidth"===t?"":ut.MESSAGES.font[t]||ut.MESSAGES.embellish[t]||"")}function Ji(t,e,n,r){const s=Qi(n);for(let n,o,i=0;n=t[i],o=e[i];i++){const t=r?ut.ALPHABETS.capPrefix:ut.ALPHABETS.smallPrefix,e=r?qi.capital:qi.small;tc(s.combiner,n,o,s.font,t,ut.ALPHABETS.letterTrans,e)}}function Zi(t,e,n){const r=Qi(e);for(let e,s=0;e=t[s];s++){const t=ut.ALPHABETS.digitPrefix,o=s+n;tc(r.combiner,e,o,r.font,t,ut.ALPHABETS.digitTrans,qi.digit)}}function tc(t,e,n,r,s,o,i){for(let c,a=0;c=i[a];a++){const i=c in o?o[c]:o.default,a=c in s?s[c]:s.default;An(c,"default",e,t(i(n),r,a))}}var ec=function(t,e,n,r){return new(n||(n=Promise))((function(s,o){function i(t){try{a(r.next(t))}catch(t){o(t)}}function c(t){try{a(r.throw(t))}catch(t){o(t)}}function a(t){var e;t.done?s(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(i,c)}a((r=r.apply(t,e||[])).next())}))};const nc={functions:function(t){for(const n of t)pn(n)||(e=n.key,cn(n.names||[],on.Meaning.get(e)||{type:z.FUNCTION,role:J.PREFIXFUNC}),"base"!==dn?(Tn(n),On(n)):Nn.set(n.key,n));var e},symbols:function(t){for(const e of t){if(pn(e))continue;const t=hn.parseUnicode(e.key);"base"!==dn?In(t,t,e.mappings):Nn.set(t,e)}},units:function(t){for(const e of t)pn(e)||(e.key+=":unit","base"!==dn?(Tn(e),e.names&&(e.names=e.names.map((function(t){return t+":unit"}))),e.si&&Cn(e),On(e)):Nn.set(e.key,e))},si:t=>t.forEach(En),messages:function(t){const e=We[t.locale];if(!e)return void console.error("Locale "+t.locale+" does not exist!");const n=t.kind.toUpperCase(),r=t.messages;if(!r)return;const s=e();for(const[t,e]of Object.entries(r))s[n][t]=e},rules:Wi.addStore,characters:t=>t.forEach(Rn)};let rc=!1;function sc(t=N.getInstance().locale){return ec(this,void 0,void 0,(function*(){return rc||(!function(){for(const t of Y.values()){const e=t.unicode;for(const n of e)Nn.set(n,{key:n,category:t.category})}}(),oc(c.BASE_LOCALE),rc=!0),S.promises[c.BASE_LOCALE].then((()=>ec(this,void 0,void 0,(function*(){const e=N.getInstance().defaultLocale;return e?(oc(e),S.promises[e].then((()=>ec(this,void 0,void 0,(function*(){return oc(t),S.promises[t]}))))):(oc(t),S.promises[t])}))))}))}function oc(t=N.getInstance().locale){S.loaded[t]||(S.loaded[t]=[!1,!1],dn=c.DEFAULT_VALUES[r.LOCALE],fn=c.DEFAULT_VALUES[r.MODALITY],function(t){if(N.getInstance().isIE&&N.getInstance().mode===s.HTTP)return void ac(t);!function(t){const e=function(){if(N.getInstance().customLoader)return N.getInstance().customLoader;return ic()}(),n=new Promise((n=>{e(t).then((e=>{var r;cc("string"==typeof(r=e)?JSON.parse(r):r),S.loaded[t]=[!0,!0],n(t)}),(e=>{S.loaded[t]=[!0,!1],console.error(`Unable to load locale: ${t}`),N.getInstance().locale=N.getInstance().defaultLocale,n(t)}))}));S.promises[t]=n}(t)}(t))}function ic(){switch(N.getInstance().mode){case s.ASYNC:return lc;case s.HTTP:return hc;case s.SYNC:default:return uc}}function cc(t,e){let n=!0;for(let r,s=0;r=Object.keys(t)[s];s++){const s=r.split("/");e&&e!==s[0]||(n&&"symbols"===s[1]&&"base"!==s[0]&&(zi(s[0]),n=!1),nc[s[1]](t[r]))}}function ac(t,e){let n=e||1;qe?cc(qe,t):n<=5&&setTimeout((()=>ac(t,n++)).bind(this),300)}function lc(t){const e=tn(t);return new Promise(((t,n)=>{p.f.fs.readFile(e,"utf8",((e,r)=>{if(e)return n(e);t(r)}))}))}function uc(t){const e=tn(t);return new Promise(((t,n)=>{let r="{}";try{r=p.f.fs.readFileSync(e,"utf8")}catch(t){return n(t)}t(r)}))}function hc(t){const e=tn(t),n=new XMLHttpRequest;return new Promise(((t,r)=>{n.onreadystatechange=function(){if(4===n.readyState){const e=n.status;0===e||e>=200&&e<400?t(n.responseText):r(e)}},n.open("GET",e,!0),n.send()}))}var dc=function(t,e,n,r){return new(n||(n=Promise))((function(s,o){function i(t){try{a(r.next(t))}catch(t){o(t)}}function c(t){try{a(r.throw(t))}catch(t){o(t)}}function a(t){var e;t.done?s(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(i,c)}a((r=r.apply(t,e||[])).next())}))};const fc=["ca","da","es"],pc=["chromevox","clearspeak","mathspeak","emacspeak","html"];function mc(t){return dc(this,void 0,void 0,(function*(){!function(t){if(t.modality&&"speech"!==t.modality||!t.modality&&"speech"!==N.getInstance().modality)return;if(!t.domain)return;if("default"===t.domain)return void(t.domain="mathspeak");const e=t.locale||N.getInstance().locale,n=t.domain;-1===fc.indexOf(e)?"en"!==e?"mathspeak"!==n&&"clearspeak"!==n&&(t.domain="mathspeak"):-1===pc.indexOf(n)&&(t.domain="mathspeak"):"mathspeak"!==n&&(t.domain="mathspeak")}(t);const e=N.getInstance(),n=n=>{void 0!==t[n]&&(e[n]=t[n])};return n("mode"),e.configurate(t),N.BINARY_FEATURES.forEach((n=>{void 0!==t[n]&&(e[n]=!!t[n])})),N.STRING_FEATURES.forEach(n),t.debug&&m.getInstance().init(),t.json&&(p.f.jsonPath=Ze(t.json)),t.xpath&&(p.f.WGXpath=t.xpath),e.setCustomLoader(t.custom),function(t){t.isIE=Ke(),t.isEdge="undefined"!=typeof window&&"MSGestureEvent"in window&&null===(null===(e=window.chrome)||void 0===e?void 0:e.loadTimes)&&(document.evaluate=null,ze(!0),!0);var e}(e),Ye(),e.setDynamicCstr(),e.init?(S.promises.init=new Promise(((t,e)=>{setTimeout((()=>{t("init")}),10)})),e.init=!1,S.get()):e.delay?(e.delay=!1,S.get()):sc()}))}var Ec;!function(t){t[t.ENTER=13]="ENTER",t[t.ESC=27]="ESC",t[t.SPACE=32]="SPACE",t[t.PAGE_UP=33]="PAGE_UP",t[t.PAGE_DOWN=34]="PAGE_DOWN",t[t.END=35]="END",t[t.HOME=36]="HOME",t[t.LEFT=37]="LEFT",t[t.UP=38]="UP",t[t.RIGHT=39]="RIGHT",t[t.DOWN=40]="DOWN",t[t.TAB=9]="TAB",t[t.LESS=188]="LESS",t[t.GREATER=190]="GREATER",t[t.DASH=189]="DASH",t[t.ZERO=48]="ZERO",t[t.ONE=49]="ONE",t[t.TWO=50]="TWO",t[t.THREE=51]="THREE",t[t.FOUR=52]="FOUR",t[t.FIVE=53]="FIVE",t[t.SIX=54]="SIX",t[t.SEVEN=55]="SEVEN",t[t.EIGHT=56]="EIGHT",t[t.NINE=57]="NINE",t[t.A=65]="A",t[t.B=66]="B",t[t.C=67]="C",t[t.D=68]="D",t[t.E=69]="E",t[t.F=70]="F",t[t.G=71]="G",t[t.H=72]="H",t[t.I=73]="I",t[t.J=74]="J",t[t.K=75]="K",t[t.L=76]="L",t[t.M=77]="M",t[t.N=78]="N",t[t.O=79]="O",t[t.P=80]="P",t[t.Q=81]="Q",t[t.R=82]="R",t[t.S=83]="S",t[t.T=84]="T",t[t.U=85]="U",t[t.V=86]="V",t[t.W=87]="W",t[t.X=88]="X",t[t.Y=89]="Y",t[t.Z=90]="Z"}(Ec||(Ec={}));const gc=new Map([[13,"ENTER"],[27,"ESC"],[32,"SPACE"],[33,"PAGE_UP"],[34,"PAGE_DOWN"],[35,"END"],[36,"HOME"],[37,"LEFT"],[38,"UP"],[39,"RIGHT"],[40,"DOWN"],[9,"TAB"],[188,"LESS"],[190,"GREATER"],[189,"DASH"],[48,"ZERO"],[49,"ONE"],[50,"TWO"],[51,"THREE"],[52,"FOUR"],[53,"FIVE"],[54,"SIX"],[55,"SEVEN"],[56,"EIGHT"],[57,"NINE"],[65,"A"],[66,"B"],[67,"C"],[68,"D"],[69,"E"],[70,"F"],[71,"G"],[72,"H"],[73,"I"],[74,"J"],[75,"K"],[76,"L"],[77,"M"],[78,"N"],[79,"O"],[80,"P"],[81,"Q"],[82,"R"],[83,"S"],[84,"T"],[85,"U"],[86,"V"],[87,"W"],[88,"X"],[89,"Y"],[90,"Z"]]);var Nc;!function(t){t.CLICK="click",t.DBLCLICK="dblclick",t.MOUSEDOWN="mousedown",t.MOUSEUP="mouseup",t.MOUSEOVER="mouseover",t.MOUSEOUT="mouseout",t.MOUSEMOVE="mousemove",t.SELECTSTART="selectstart",t.KEYPRESS="keypress",t.KEYDOWN="keydown",t.KEYUP="keyup",t.TOUCHSTART="touchstart",t.TOUCHMOVE="touchmove",t.TOUCHEND="touchend",t.TOUCHCANCEL="touchcancel"}(Nc||(Nc={}));function Sc(t,e,n){return(n||function(n,r){return"number"==typeof n&&"number"==typeof r?n+r:"number"==typeof n?r:"number"==typeof r?n:[t,e].sort()[0]}).call(null,t,e)}function Tc(t,e){delete t.open,e.close.forEach((e=>delete t[e])),e.open.forEach((n=>t[n]=e[n]));const n=Object.keys(t);t.open=n}function Ic(t,e){if(t.length<=1)return t;const n=[];for(let r,s=0;r=e[s],t.length;s++)r.close&&r.close.length&&r.close.forEach((function(e){const r=t.indexOf(e);-1!==r&&(n.unshift(e),t.splice(r,1))}));return n}let Ac={},Rc=[];function Oc(t){Ac={},Rc=[];let e=[];const n={};for(let r,s=0;r=t[s];s++){let t=null;const s=r.descriptionSpan(),i=r.personality,c=i[o.JOIN];delete i[o.JOIN],void 0!==i[o.PAUSE]&&(t={[o.PAUSE]:i[o.PAUSE]},delete i[o.PAUSE]);_c(e,s,Pc(i,n),c,t,!0)}return e=e.concat(function(){const t=[];for(let e=Rc.length-1;e>=0;e--){const n=Rc[e];if(n.length){const e={open:[],close:[]};for(let t=0;t<n.length;t++){const r=n[t];e.close.push(r),e[r]=0}t.push(e)}}return t}()),e=function(t){const e={},n=[];for(let r,s=0;r=t[s];s++){if(!Lc(r)){Cc(n,r);continue}if(!r.close||1!==r.close.length||r.open.length){bc(r,e),n.push(r);continue}let o=t[s+1];if(!o||yc(o)){bc(r,e),n.push(r);continue}const i=Mc(o)?o:null;i&&(o=t[s+2]),o&&Lc(o)&&o.open[0]===r.close[0]&&!o.close.length&&o[o.open[0]]===e[o.open[0]]?i?(Cc(n,i),s+=2):s+=1:(bc(r,e),n.push(r))}return n}(e),e=N.getInstance().cleanpause?function(t){for(;Mc(t[0]);)t.shift();for(;Mc(t[t.length-1]);)t.pop();return t}(e):e,e}function Cc(t,e){const n=t[t.length-1];if(n){if(yc(e)&&yc(n)){if(void 0===n.join)return void(n.span=n.span.concat(e.span));const t=n.span.pop(),r=e.span.shift();return n.span.push(t+n.join+r),n.span=n.span.concat(e.span),void(n.join=e.join)}Mc(e)&&Mc(n)?n.pause=Sc(n.pause,e.pause):t.push(e)}else t.push(e)}function bc(t,e){t.rate&&(e.rate=t.rate),t.pitch&&(e.pitch=t.pitch),t.volume&&(e.volume=t.volume)}function Lc(t){return"object"==typeof t&&t.open}function Mc(t){return"object"==typeof t&&1===Object.keys(t).length&&Object.keys(t)[0]===o.PAUSE}function yc(t){const e=Object.keys(t);return"object"==typeof t&&(1===e.length&&"span"===e[0]||2===e.length&&("span"===e[0]&&"join"===e[1]||"span"===e[1]&&"join"===e[0]))}function _c(t,e,n,r,s,i=!1){if(i){const i=t[t.length-1];let c;if(i&&(c=i[o.JOIN]),i&&!e.speech&&s&&Mc(i)){const t=o.PAUSE;i[t]=Sc(i[t],s[t]),s=null}if(i&&e.speech&&0===Object.keys(n).length&&yc(i)){if(void 0!==c){const t=i.span.pop();e=Ln.stringAttr(t.speech+c+e.speech,t.attributes)}i.span.push(e),e=Ln.empty(),i[o.JOIN]=r}}0!==Object.keys(n).length&&t.push(n),e.speech&&t.push({span:[e],join:r}),s&&t.push(s)}function Pc(t,e){if(!e)return t;const n={};for(const r of u){const s=t[r],o=e[r];if(!s&&!o||s&&o&&s===o)continue;const i=s||0;Lc(n)||(n.open=[],n.close=[]),s||n.close.push(r),o||n.open.push(r),o&&s&&(n.close.push(r),n.open.push(r)),e[r]=i,n[r]=i,Ac[r]?Ac[r].push(i):Ac[r]=[i]}if(Lc(n)){let t=n.close.slice();for(;t.length>0;){let r=Rc.pop();const s=ur(r,t);if(t=ur(t,r),r=s,0!==t.length){if(0!==r.length){n.close=n.close.concat(r),n.open=n.open.concat(r);for(let t,s=0;t=r[s];s++)n[t]=e[t]}}else 0!==r.length&&Rc.push(r)}Rc.push(n.open)}return n}class Fc{constructor(){this.separator_=" "}set separator(t){this.separator_=t}get separator(){return"braille"===N.getInstance().modality?"":this.separator_}error(t){return null}merge(t){let e="";const n=t.length-1;for(let r,s=0;r=t[s];s++)if(e+=r.speech,s<n){const t=r.attributes.separator;e+=void 0!==t?t:this.separator}return e}finalize(t){return t}pauseValue(t){let e;switch(t){case"long":e=750;break;case"medium":e=500;break;case"short":e=250;break;default:e=parseInt(t,10)}return Math.floor(e*N.getInstance().getRate()/100)}}class Uc extends Fc{constructor(){super(...arguments),this.ignoreElements=[o.LAYOUT],this.scaleFunction=null}setScaleFunction(t,e,n,r,s=0){this.scaleFunction=o=>{const i=(o-t)/(e-t),c=n*(1-i)+r*i;return+(Math.round(c+"e+"+s)+"e-"+s)}}applyScaleFunction(t){return this.scaleFunction?this.scaleFunction(t):t}ignoreElement(t){return-1!==this.ignoreElements.indexOf(t)}}class xc extends Uc{markup(t){this.setScaleFunction(-2,2,-100,100,2);const e=Oc(t),n=[],r=[];for(let t,s=0;t=e[s];s++)if(t.span)n.push(this.merge(t.span));else if(Mc(t))n.push(this.pause(t));else{if(t.close.length)for(let e=0;e<t.close.length;e++){const e=r.pop();if(-1===t.close.indexOf(e))throw new g("Unknown closing markup element: "+e);n.push(this.closeTag(e))}if(t.open.length){Ic(t.open.slice(),e.slice(s+1)).forEach((e=>{n.push(this.prosodyElement(e,t[e])),r.push(e)}))}}return n.join(" ")}}class Dc extends xc{constructor(){super(...arguments),this.values=new Map}finalize(t){return function(t){if(kc.clear(),!t)return;const e=Object.keys(t).map((t=>parseInt(t))).sort();for(let t,n=0;t=e[n];n++)kc.set(t,n+1)}(this.values.get("rel")),function(t){vc="";const e=y(`<all>${t}</all>`);return m.getInstance().output(w(e.toString())),vc=Vc(e),vc}(t)}pause(t){return""}prosodyElement(t,e){return t===o.LAYOUT?`<${e}>`:""}closeTag(t){return`</${t}>`}markup(t){this.values.clear();const e=[];let n=[];for(const r of t){if(!r.layout){n.push(r);continue}e.push(this.processContent(n)),n=[];const[t,s,o]=this.layoutValue(r.layout);"begin"!==t?"end"!==t?console.warn("Something went wrong with layout markup: "+s):e.push("</"+s+">"):e.push("<"+s+(o?` value="${o}"`:"")+">")}return e.push(this.processContent(n)),e.join("")}processContent(t){const e=[],n=Oc(t);for(let t,r=0;t=n[r];r++)t.span?e.push(this.merge(t.span)):Mc(t);return e.join("")}layoutValue(t){const e=t.match(/^(begin|end|)(.*\D)(\d*)$/),n=e[3];return n?(t=e[2],this.values.has(t)||this.values.set(t,{}),this.values.get(t)[n]=!0,[e[1],t,n]):[e[1],e[2],""]}}Dc.options={cayleyshort:N.getInstance().cayleyshort,linebreaks:N.getInstance().linebreaks};let vc="";const wc={TABLE:function(t){let e=Xc(t);e.forEach((t=>{t.cells=t.cells.slice(1).slice(0,-1),t.width=t.width.slice(1).slice(0,-1)}));const[n,r]=Wc(e);return e=Yc(e,r),Kc(e,n)},CASES:function(t){let e=Xc(t);e.forEach((t=>{t.cells=t.cells.slice(0,-1),t.width=t.width.slice(0,-1)}));const[n,r]=Wc(e);return e=Yc(e,r),Kc(e,n)},CAYLEY:function(t){let e=Xc(t);e.forEach((t=>{t.cells=t.cells.slice(1).slice(0,-1),t.width=t.width.slice(1).slice(0,-1),t.sep=t.sep+t.sep}));const[n,r]=Wc(e),s={lfence:"",rfence:"",cells:r.map((t=>"\u2810"+new Array(t).join("\u2812"))),width:r,height:1,sep:e[0].sep};N.getInstance().cayleyshort&&"\u2800"===e[0].cells[0]&&(s.cells[0]="\u2800");return e.splice(1,0,s),e=Yc(e,r),Kc(e,n)},MATRIX:function(t){let e=Xc(t);const[n,r]=Wc(e);return e=Yc(e,r),Kc(e,n)},CELL:Vc,FENCE:Vc,ROW:Vc,FRACTION:function(t){const[e,n,,r,s]=Array.from(t.childNodes),o=Bc(n),i=Bc(r),c=jc(o),a=jc(i);let l=Math.max(c,a);const u=e+new Array(l+1).join("\u2812")+s;return l=u.length,`${Jc(o,l)}\n${u}\n${Jc(i,l)}`},NUMERATOR:Zc,DENOMINATOR:Zc,REL:ta,OP:ta};function Bc(t){const e=G(t),n=wc[e];return n?n(t):t.textContent}const kc=new Map;function Gc(t,e){if(!t||!e)return t+e;const n=$c(t),r=$c(e),s=n-r;t=s<0?Hc(t,r,jc(t)):t,e=s>0?Hc(e,n,jc(e)):e;const o=t.split(/\r\n|\r|\n/),i=e.split(/\r\n|\r|\n/),c=[];for(let t=0;t<o.length;t++)c.push(o[t]+i[t]);return c.join("\n")}function Vc(t){let e="";for(const n of Array.from(t.childNodes))e=n.nodeType!==_.TEXT_NODE?Gc(e,Bc(n)):Gc(e,n.textContent);return e}function $c(t){return t.split(/\r\n|\r|\n/).length}function jc(t){return t.split(/\r\n|\r|\n/).reduce(((t,e)=>Math.max(e.length,t)),0)}function Hc(t,e,n){return t=function(t,e){const n=e-$c(t);return t+(n>0?new Array(n+1).join("\n"):"")}(t,e),function(t,e){const n=t.split(/\r\n|\r|\n/),r=[];for(const t of n){const n=e-t.length;r.push(t+(n>0?new Array(n+1).join("\u2800"):""))}return r.join("\n")}(t,n)}function Xc(t){const e=Array.from(t.childNodes),n=[];for(const t of e)t.nodeType===_.ELEMENT_NODE&&n.push(Qc(t));return n}function Wc(t){const e=t.reduce(((t,e)=>Math.max(e.height,t)),0),n=[];for(let e=0;e<t[0].width.length;e++)n.push(t.map((t=>t.width[e])).reduce(((t,e)=>Math.max(t,e)),0));return[e,n]}function Yc(t,e){const n=[];for(const r of t){if(0===r.height)continue;const t=[];for(let n=0;n<r.cells.length;n++)t.push(Hc(r.cells[n],r.height,e[n]));r.cells=t,n.push(r)}return n}function Kc(t,e){if(1===e)return t.map((t=>t.lfence+t.cells.join(t.sep)+t.rfence)).join("\n");const n=[];for(const e of t){const t=qc(e.sep,e.height);let r=e.cells.shift();for(;e.cells.length;)r=Gc(r,t),r=Gc(r,e.cells.shift());r=Gc(qc(e.lfence,e.height),r),r=Gc(r,qc(e.rfence,e.height)),n.push(r),n.push(e.lfence+new Array(jc(r)-3).join(e.sep)+e.rfence)}return n.slice(0,-1).join("\n")}function qc(t,e){let n="";for(;e;)n+=t+"\n",e--;return n.slice(0,-1)}function zc(t){return t.nodeType===_.ELEMENT_NODE&&"FENCE"===G(t)?Bc(t):""}function Qc(t){const e=Array.from(t.childNodes),n=zc(e[0]),r=zc(e[e.length-1]);n&&e.shift(),r&&e.pop();let s="";const o=[];for(const t of e){if(t.nodeType===_.TEXT_NODE){s=t.textContent;continue}const e=Bc(t);o.push(e)}return{lfence:n,rfence:r,sep:s,cells:o,height:o.reduce(((t,e)=>Math.max($c(e),t)),0),width:o.map(jc)}}function Jc(t,e){const n=(e-jc(t))/2,[r,s]=Math.floor(n)===n?[n,n]:[Math.floor(n),Math.ceil(n)],o=t.split(/\r\n|\r|\n/),i=[],[c,a]=[new Array(r+1).join("\u2800"),new Array(s+1).join("\u2800")];for(const t of o)i.push(c+t+a);return i.join("\n")}function Zc(t){const e=t.firstChild,n=Vc(t);if(e&&e.nodeType===_.ELEMENT_NODE){if("ENGLISH"===G(e))return"\u2830"+n;if("NUMBER"===G(e))return"\u283c"+n}return n}function ta(t){if(!N.getInstance().linebreaks)return Vc(t);let e=kc.get(parseInt(t.getAttribute("value")));return(e?`<br value="${e}"/>`:"")+Vc(t)}class ea extends Fc{markup(t){const e=Oc(t);let n="",r=null,s=!1;for(let t,i=0;t=e[i];i++)Lc(t)||(Mc(t)?r=t:(r&&(n+=this.pause(r[o.PAUSE]),r=null),n+=(s?this.separator:"")+this.merge(t.span),s=!0));return n}pause(t){let e;return e="number"==typeof t?t<=250?"short":t<=500?"medium":"long":t,ea.PAUSE_PUNCTUATION.get(e)||""}}ea.PAUSE_PUNCTUATION=new Map([["short",","],["medium",";"],["long","."]]);class na extends xc{finalize(t){return`<?xml version="1.0"?><speak version="1.1" xmlns="http://www.w3.org/2001/10/synthesis" xml:lang="${N.getInstance().locale}"><prosody rate="`+N.getInstance().getRate()+'%">'+this.separator+t+this.separator+"</prosody></speak>"}pause(t){return'<break time="'+this.pauseValue(t[o.PAUSE])+'ms"/>'}prosodyElement(t,e){const n=(e=Math.floor(this.applyScaleFunction(e)))<0?e.toString():"+"+e.toString();return"<prosody "+t.toLowerCase()+'="'+n+(t===o.VOLUME?">":'%">')}closeTag(t){return"</prosody>"}markup(t){return na.MARKS={},super.markup(t)}merge(t){const e=[];let n="";for(let r=0;r<t.length;r++){const s=t[r];if(this.isEmptySpan(s))continue;const o=na.MARK_KIND?s.attributes.kind:"",i=N.getInstance().automark?s.attributes.id:N.getInstance().mark?s.attributes.extid:"";!i||i===n||na.MARK_ONCE&&na.MARKS[i]||(e.push(o?`<mark name="${i}" kind="${o}"/>`:`<mark name="${i}"/>`),n=i,na.MARKS[i]=!0),N.getInstance().character&&1===s.speech.length&&s.speech.match(/[a-zA-Z]/)?e.push('<say-as interpret-as="'+na.CHARACTER_ATTR+'">'+s.speech+"</say-as>"):e.push(s.speech)}return e.join(this.separator)}isEmptySpan(t){const e=t.attributes.separator;return t.speech.match(/^\s*$/)&&(!e||e.match(/^\s*$/))}}na.MARK_ONCE=!1,na.MARK_KIND=!0,na.CHARACTER_ATTR="character",na.MARKS={};class ra extends Fc{markup(t){let e="";const n=Oc(t).filter((t=>t.span));if(!n.length)return e;const r=n.length-1;for(let t,s=0;t=n[s];s++){if(t.span&&(e+=this.merge(t.span)),s>=r)continue;const n=t.join;e+=void 0===n?this.separator:n}return e}}const sa=new na,oa=new Map([[d.NONE,new ra],[d.COUNTING,new class extends ra{finalize(t){const e=super.finalize(t),n="braille"===N.getInstance().modality?"\u28ff\u2800\u28ff\u2800\u28ff\u2800\u28ff\u2800\u28ff\u2800":"0123456789";let r=new Array(Math.trunc(e.length/10)+1).join(n);return r+=n.slice(0,e.length%10),e+"\n"+r}}],[d.PUNCTUATION,new ea],[d.LAYOUT,new Dc],[d.ACSS,new class extends Uc{markup(t){this.setScaleFunction(-2,2,0,10,0);const e=Oc(t),n=[],r={open:[]};let s=null,o=!1;for(let t,l=0;t=e[l];l++){if(Lc(t)){Tc(r,t);continue}if(Mc(t)){o&&(i=s,c=t,a=Math.max,s=i?{pause:Sc(i.pause,c.pause,a)}:c);continue}const e='"'+this.merge(t.span)+'"';o=!0,s&&(n.push(this.pause(s)),s=null);const l=this.prosody_(r);n.push(l?"(text ("+l+") "+e+")":e)}var i,c,a;return"(exp "+n.join(" ")+")"}error(t){return'(error "'+gc.get(t)+'")'}prosodyElement(t,e){switch(e=this.applyScaleFunction(e),t){case o.RATE:return"(richness . "+e+")";case o.PITCH:return"(average-pitch . "+e+")";case o.VOLUME:return"(stress . "+e+")"}return"(value . "+e+")"}pause(t){return"(pause . "+this.pauseValue(t[o.PAUSE])+")"}prosody_(t){const e=t.open,n=[];for(let r,s=0;r=e[s];s++)n.push(this.prosodyElement(r,t[r]));return n.join(" ")}}],[d.SABLE,new class extends xc{finalize(t){return'<?xml version="1.0"?><!DOCTYPE SABLE PUBLIC "-//SABLE//DTD SABLE speech mark up//EN" "Sable.v0_2.dtd" []><SABLE>'+this.separator+t+this.separator+"</SABLE>"}pause(t){return'<BREAK MSEC="'+this.pauseValue(t[o.PAUSE])+'"/>'}prosodyElement(t,e){switch(e=this.applyScaleFunction(e),t){case o.PITCH:return'<PITCH RANGE="'+e+'%">';case o.RATE:return'<RATE SPEED="'+e+'%">';case o.VOLUME:return'<VOLUME LEVEL="'+e+'%">';default:return"<"+t.toUpperCase()+' VALUE="'+e+'">'}}closeTag(t){return"</"+t.toUpperCase()+">"}}],[d.VOICEXML,sa],[d.SSML,sa]]);function ia(t){const e=oa.get(N.getInstance().markup);return e?e.markup(t):""}function ca(t){const e=oa.get(N.getInstance().markup);return e?e.finalize(t):t}class aa{constructor(t){this.type=t,this.factory_=new vr}getFactory(){return this.factory_}setFactory(t){this.factory_=t}getType(){return this.type}parseList(t){const e=[];for(let n,r=0;n=t[r];r++)e.push(this.parse(n));return e}}class la extends aa{static getAttribute_(t,e,n){if(!t.hasAttribute(e))return n;const r=t.getAttribute(e);return r.match(/^\s*$/)?null:r}constructor(){super("MathML"),this.parseMap_=new Map([[Tr.SEMANTICS,this.semantics_.bind(this)],[Tr.MATH,this.rows_.bind(this)],[Tr.MROW,this.rows_.bind(this)],[Tr.MPADDED,this.rows_.bind(this)],[Tr.MSTYLE,this.rows_.bind(this)],[Tr.MFRAC,this.fraction_.bind(this)],[Tr.MSUB,this.limits_.bind(this)],[Tr.MSUP,this.limits_.bind(this)],[Tr.MSUBSUP,this.limits_.bind(this)],[Tr.MOVER,this.limits_.bind(this)],[Tr.MUNDER,this.limits_.bind(this)],[Tr.MUNDEROVER,this.limits_.bind(this)],[Tr.MROOT,this.root_.bind(this)],[Tr.MSQRT,this.sqrt_.bind(this)],[Tr.MTABLE,this.table_.bind(this)],[Tr.MLABELEDTR,this.tableLabeledRow_.bind(this)],[Tr.MTR,this.tableRow_.bind(this)],[Tr.MTD,this.tableCell_.bind(this)],[Tr.MS,this.text_.bind(this)],[Tr.MTEXT,this.text_.bind(this)],[Tr.MSPACE,this.space_.bind(this)],[Tr.ANNOTATIONXML,this.text_.bind(this)],[Tr.MI,this.identifier_.bind(this)],[Tr.MN,this.number_.bind(this)],[Tr.MO,this.operator_.bind(this)],[Tr.MFENCED,this.fenced_.bind(this)],[Tr.MENCLOSE,this.enclosed_.bind(this)],[Tr.MMULTISCRIPTS,this.multiscripts_.bind(this)],[Tr.ANNOTATION,this.empty_.bind(this)],[Tr.NONE,this.empty_.bind(this)],[Tr.MACTION,this.action_.bind(this)]]);const t={type:z.IDENTIFIER,role:J.NUMBERSET,font:tt.DOUBLESTRUCK};["C","H","N","P","Q","R","Z","\u2102","\u210d","\u2115","\u2119","\u211a","\u211d","\u2124"].forEach((e=>this.getFactory().defaultMap.set(e,t)).bind(this))}parse(t){Ss.getInstance().setNodeFactory(this.getFactory());const e=M(t.childNodes),n=G(t),r=this.parseMap_.get(n),s=(r||this.dummy_.bind(this))(t,e);return Pr(s,t),-1!==[Tr.MATH,Tr.MROW,Tr.MPADDED,Tr.MSTYLE,Tr.SEMANTICS,Tr.MACTION].indexOf(n)||(s.mathml.unshift(t),s.mathmlTree=t),s}semantics_(t,e){return e.length?this.parse(e[0]):this.getFactory().makeEmptyNode()}rows_(t,e){const n=t.getAttribute("semantics");if(n&&n.match("bspr_"))return Ss.proof(t,n,this.parseList.bind(this));let r;return 1===(e=_r(e)).length?(r=this.parse(e[0]),r.type!==z.EMPTY||r.mathmlTree||(r.mathmlTree=t)):r=Ss.getInstance().row(this.parseList(e)),r.mathml.unshift(t),r}fraction_(t,e){if(!e.length)return this.getFactory().makeEmptyNode();const n=this.parse(e[0]),r=e[1]?this.parse(e[1]):this.getFactory().makeEmptyNode();return Ss.getInstance().fractionLikeNode(n,r,t.getAttribute("linethickness"),"true"===t.getAttribute("bevelled"))}limits_(t,e){return Ss.getInstance().limitNode(G(t),this.parseList(e))}root_(t,e){return e[1]?this.getFactory().makeBranchNode(z.ROOT,[this.parse(e[1]),this.parse(e[0])],[]):this.sqrt_(t,e)}sqrt_(t,e){const n=this.parseList(_r(e));return this.getFactory().makeBranchNode(z.SQRT,[Ss.getInstance().row(n)],[])}table_(t,e){const n=t.getAttribute("semantics");if(n&&n.match("bspr_"))return Ss.proof(t,n,this.parseList.bind(this));const r=this.getFactory().makeBranchNode(z.TABLE,this.parseList(e),[]);return r.mathmlTree=t,Ss.tableToMultiline(r)}tableRow_(t,e){const n=this.getFactory().makeBranchNode(z.ROW,this.parseList(e),[]);return n.role=J.TABLE,n}tableLabeledRow_(t,e){if(!e.length)return this.tableRow_(t,e);const n=this.parse(e[0]);n.role=J.LABEL;const r=this.getFactory().makeBranchNode(z.ROW,this.parseList(e.slice(1)),[n]);return r.role=J.TABLE,r}tableCell_(t,e){const n=this.parseList(_r(e));let r;r=n.length?1===n.length&&wr(n[0],z.EMPTY)?n:[Ss.getInstance().row(n)]:[];const s=this.getFactory().makeBranchNode(z.CELL,r,[]);return s.role=J.TABLE,s}space_(t,e){const n=t.getAttribute("width"),r=n&&n.match(/[a-z]*$/);if(!r)return this.empty_(t,e);const s=r[0],o=parseFloat(n.slice(0,r.index)),i={cm:.4,pc:.5,em:.5,ex:1,in:.15,pt:5,mm:5}[s];if(!i||isNaN(o)||o<i)return this.empty_(t,e);const c=this.getFactory().makeUnprocessed(t);return Ss.getInstance().text(c,G(t))}text_(t,e){const n=this.leaf_(t,e);return t.textContent?(n.updateContent(t.textContent,!0),Ss.getInstance().text(n,G(t))):n}identifier_(t,e){const n=this.leaf_(t,e);return Ss.getInstance().identifierNode(n,Ss.getInstance().font(t.getAttribute("mathvariant")),t.getAttribute("class"))}number_(t,e){const n=this.leaf_(t,e);return Ss.number(n),n}operator_(t,e){const n=this.leaf_(t,e);return Ss.getInstance().operatorNode(n),n}fenced_(t,e){const n=this.parseList(_r(e)),r=la.getAttribute_(t,"separators",","),s=la.getAttribute_(t,"open","("),o=la.getAttribute_(t,"close",")"),i=Ss.getInstance().mfenced(s,o,r,n);return Ss.getInstance().tablesInRow([i])[0]}enclosed_(t,e){const n=this.parseList(_r(e)),r=this.getFactory().makeBranchNode(z.ENCLOSE,[Ss.getInstance().row(n)],[]);return r.role=t.getAttribute("notation")||J.UNKNOWN,r}multiscripts_(t,e){if(!e.length)return this.getFactory().makeEmptyNode();const n=this.parse(e.shift());if(!e.length)return n;const r=[],s=[],o=[],i=[];let c=!1,a=0;for(let t,n=0;t=e[n];n++)G(t)!==Tr.MPRESCRIPTS?(c?1&a?r.push(t):s.push(t):1&a?o.push(t):i.push(t),a++):(c=!0,a=0);return _r(r).length||_r(s).length?Ss.getInstance().tensor(n,this.parseList(s),this.parseList(r),this.parseList(i),this.parseList(o)):Ss.getInstance().pseudoTensor(n,this.parseList(i),this.parseList(o))}empty_(t,e){return this.getFactory().makeEmptyNode()}action_(t,e){const n=e[t.hasAttribute("selection")?parseInt(t.getAttribute("selection"),10)-1:0],r=this.parse(n);return r.mathmlTree=n,r}dummy_(t,e){const n=this.getFactory().makeUnprocessed(t);return n.role=t.tagName,n.textContent=t.textContent,n}leaf_(t,e){if(1===e.length&&e[0].nodeType!==_.TEXT_NODE){const n=this.getFactory().makeUnprocessed(t);return n.role=e[0].tagName,Pr(n,e[0]),n}const n=this.getFactory().makeLeafNode(t.textContent,Ss.getInstance().font(t.getAttribute("mathvariant")));return t.hasAttribute("data-latex")&&on.LatexCommands.set(t.getAttribute("data-latex"),t.textContent),n}}class ua{constructor(t,e,n=(t=>!1)){this.name=t,this.apply=e,this.applicable=n}}class ha extends ua{}class da extends ua{}const fa="data-semantic-";var pa;!function(t){t.ADDED="data-semantic-added",t.ALTERNATIVE="data-semantic-alternative",t.CHILDREN="data-semantic-children",t.COLLAPSED="data-semantic-collapsed",t.CONTENT="data-semantic-content",t.EMBELLISHED="data-semantic-embellished",t.FENCEPOINTER="data-semantic-fencepointer",t.FONT="data-semantic-font",t.ID="data-semantic-id",t.ANNOTATION="data-semantic-annotation",t.ATTRIBUTES="data-semantic-attributes",t.OPERATOR="data-semantic-operator",t.OWNS="data-semantic-owns",t.PARENT="data-semantic-parent",t.POSTFIX="data-semantic-postfix",t.PREFIX="data-semantic-prefix",t.ROLE="data-semantic-role",t.SPEECH="data-semantic-speech",t.STRUCTURE="data-semantic-structure",t.SUMMARY="data-semantic-summary",t.TYPE="data-semantic-type"}(pa||(pa={}));const ma=[pa.ADDED,pa.ALTERNATIVE,pa.CHILDREN,pa.COLLAPSED,pa.CONTENT,pa.EMBELLISHED,pa.FENCEPOINTER,pa.FONT,pa.ID,pa.ANNOTATION,pa.ATTRIBUTES,pa.OPERATOR,pa.OWNS,pa.PARENT,pa.POSTFIX,pa.PREFIX,pa.ROLE,pa.SPEECH,pa.STRUCTURE,pa.SUMMARY,pa.TYPE];function Ea(t){return t.map((function(t){return t.id})).join(",")}function ga(t,e){t.setAttribute(pa.TYPE,e.type);const n=e.allAttributes();for(let e,r=0;e=n[r];r++)t.setAttribute(fa+e[0].toLowerCase(),e[1]);e.childNodes.length&&t.setAttribute(pa.CHILDREN,Ea(e.childNodes)),e.contentNodes.length&&t.setAttribute(pa.CONTENT,Ea(e.contentNodes)),e.parent&&t.setAttribute(pa.PARENT,e.parent.id.toString());const r=e.attributesXml();r&&t.setAttribute(pa.ATTRIBUTES,r),function(t,e){const n=[];e.role===J.MGLYPH&&n.push("image");e.attributes.href&&n.push("link");n.length&&t.setAttribute(pa.POSTFIX,n.join(" "))}(t,e)}function Na(t){return fa+t}function Sa(){const t=D("mrow");return t.setAttribute(pa.ADDED,"true"),t}const Ta=!1;class Ia{static fromTree(t){return Ia.fromNode(t.root)}static fromNode(t){return new Ia(Ia.fromNode_(t))}static fromString(t){return new Ia(Ia.fromString_(t))}static simpleCollapseStructure(t){return"number"==typeof t}static contentCollapseStructure(t){return!!t&&!Ia.simpleCollapseStructure(t)&&"c"===t[0]}static interleaveIds(t,e){return lr(Ia.collapsedLeafs(t),Ia.collapsedLeafs(e))}static collapsedLeafs(...t){return t.reduce(((t,e)=>{return t.concat((n=e,Ia.simpleCollapseStructure(n)?[n]:Ia.contentCollapseStructure(n[1])?n.slice(2):n.slice(1)));var n}),[])}static fromStructure(t,e){return new Ia(Ia.tree_(t,e.root))}static combineContentChildren(t,e,n,r){switch(t){case z.RELSEQ:case z.INFIXOP:case z.MULTIREL:return lr(r,n);case z.PREFIXOP:return n.concat(r);case z.POSTFIXOP:return r.concat(n);case z.MATRIX:case z.VECTOR:case z.FENCED:return r.unshift(n[0]),r.push(n[1]),r;case z.CASES:return r.unshift(n[0]),r;case z.APPL:return[r[0],n[0],r[1]];case z.ROOT:return[r[0],r[1]];case z.ROW:case z.LINE:return n.length&&r.unshift(n[0]),r;default:return r}}static makeSexp_(t){return Ia.simpleCollapseStructure(t)?t.toString():Ia.contentCollapseStructure(t)?"(c "+t.slice(1).map(Ia.makeSexp_).join(" ")+")":"("+t.map(Ia.makeSexp_).join(" ")+")"}static fromString_(t){let e=t.replace(/\(/g,"[");return e=e.replace(/\)/g,"]"),e=e.replace(/ /g,","),e=e.replace(/c/g,'"c"'),JSON.parse(e)}static fromNode_(t){if(!t)return[];const e=t.contentNodes;let n;e.length&&(n=e.map(Ia.fromNode_),n.unshift("c"));const r=t.childNodes;if(!r.length)return e.length?[t.id,n]:t.id;const s=r.map(Ia.fromNode_);return e.length&&s.unshift(n),s.unshift(t.id),s}static tree_(t,e,n=0,r=1,s=1){if(!e)return[];const o=e.id,i=[o];L(t);const c=b(`.//self::*[@${pa.ID}=${o}]`,t)[0];if(!e.childNodes.length)return Ia.addAria(c,n,r,s),e.id;const a=Ia.combineContentChildren(e.type,e.role,e.contentNodes.map((function(t){return t})),e.childNodes.map((function(t){return t})));c&&Ia.addOwns_(c,a);for(let e,r=0,s=a.length;e=a[r];r++)i.push(Ia.tree_(t,e,n+1,r+1,s));return Ia.addAria(c,n,r,s,Ta?n?"group":"tree":"treeitem"),i}static addAria(t,e,n,r,s=(Ta?e?"treeitem":"tree":"treeitem")){N.getInstance().aria&&t&&(t.setAttribute("aria-level",e.toString()),t.setAttribute("aria-posinset",n.toString()),t.setAttribute("aria-setsize",r.toString()),t.setAttribute("role",s),t.hasAttribute(pa.OWNS)&&t.setAttribute("aria-owns",t.getAttribute(pa.OWNS)))}static addOwns_(t,e){const n=t.getAttribute(pa.COLLAPSED),r=n?Ia.realLeafs_(Ia.fromString(n).array):e.map((t=>t.id));t.setAttribute(pa.OWNS,r.join(" "))}static realLeafs_(t){if(Ia.simpleCollapseStructure(t))return[t];if(Ia.contentCollapseStructure(t))return[];let e=[];for(let n=1;n<t.length;n++)e=e.concat(Ia.realLeafs_(t[n]));return e}constructor(t){this.parents=null,this.levelsMap=null,t=0===t?t:t||[],this.array=t}populate(){this.parents&&this.levelsMap||(this.parents={},this.levelsMap={},this.populate_(this.array,this.array,[]))}toString(){return Ia.makeSexp_(this.array)}populate_(t,e,n){if(Ia.simpleCollapseStructure(t))return this.levelsMap[t]=e,void(this.parents[t]=t===n[0]?n.slice(1):n);const r=Ia.contentCollapseStructure(t)?t.slice(1):t,s=[r[0]].concat(n);for(let e=0,n=r.length;e<n;e++){const n=r[e];this.populate_(n,t,s)}}isRoot(t){return t===this.levelsMap[t][0]}directChildren(t){if(!this.isRoot(t))return[];return this.levelsMap[t].slice(1).map((t=>Ia.simpleCollapseStructure(t)?t:Ia.contentCollapseStructure(t)?t[1]:t[0]))}subtreeNodes(t){if(!this.isRoot(t))return[];const e=(t,n)=>{Ia.simpleCollapseStructure(t)?n.push(t):(Ia.contentCollapseStructure(t)&&(t=t.slice(1)),t.forEach((t=>e(t,n))))},n=this.levelsMap[t],r=[];return e(n.slice(1),r),r}}function Aa(t,e,n){let r=null;if(!t.length)return r;const s=n[n.length-1],o=s&&s.length,i=e&&e.length,c=Ss.getInstance();if(o&&i){if(e[0].type===z.INFIXOP&&e[0].role===J.IMPLICIT)return r=t.pop(),s.push(c.postfixNode_(s.pop(),t)),r;r=t.shift();const n=c.prefixNode_(e.shift(),t);return e.unshift(n),r}return o?(s.push(c.postfixNode_(s.pop(),t)),r):(i&&e.unshift(c.prefixNode_(e.shift(),t)),r)}function Ra(t,e,n){if(!e.length)return t;const r=t.pop(),s=e.shift(),o=n.shift();if(s.type===z.INFIXOP&&(s.role===J.IMPLICIT||s.role===J.UNIT)){m.getInstance().output("Juxta Heuristic Case 2");const i=(r?[r,s]:[s]).concat(o);return Ra(t.concat(i),e,n)}if(!r)return m.getInstance().output("Juxta Heuristic Case 3"),Ra([s].concat(o),e,n);const i=o.shift();if(!i){m.getInstance().output("Juxta Heuristic Case 9");const o=hr.factory.makeBranchNode(z.INFIXOP,[r,e.shift()],[s],s.textContent);return o.role=J.IMPLICIT,hr.run("combine_juxtaposition",o),e.unshift(o),Ra(t,e,n)}if(Yr(r)||Yr(i))return m.getInstance().output("Juxta Heuristic Case 4"),Ra(t.concat([r,s,i]).concat(o),e,n);let c=null;return ps(r)&&ps(i)?(m.getInstance().output("Juxta Heuristic Case 5"),r.contentNodes.push(s),r.contentNodes=r.contentNodes.concat(i.contentNodes),r.childNodes.push(i),r.childNodes=r.childNodes.concat(i.childNodes),i.childNodes.forEach((t=>t.parent=r)),s.parent=r,r.addMathmlNodes(s.mathml),r.addMathmlNodes(i.mathml),c=r):ps(r)?(m.getInstance().output("Juxta Heuristic Case 6"),r.contentNodes.push(s),r.childNodes.push(i),i.parent=r,s.parent=r,r.addMathmlNodes(s.mathml),r.addMathmlNodes(i.mathml),c=r):ps(i)?(m.getInstance().output("Juxta Heuristic Case 7"),i.contentNodes.unshift(s),i.childNodes.unshift(r),r.parent=i,s.parent=i,i.addMathmlNodes(s.mathml),i.addMathmlNodes(r.mathml),c=i):(m.getInstance().output("Juxta Heuristic Case 8"),c=hr.factory.makeBranchNode(z.INFIXOP,[r,i],[s],s.textContent),c.role=J.IMPLICIT),t.push(c),Ra(t.concat(o),e,n)}function Oa(t){return t.childNodes[0]&&t.childNodes[0].childNodes[0]&&G(t.childNodes[0])===Tr.MPADDED&&G(t.childNodes[0].childNodes[0])===Tr.MPADDED&&G(t.childNodes[0].childNodes[t.childNodes[0].childNodes.length-1])===Tr.MPHANTOM}hr.add(new ha("combine_juxtaposition",(function(t){for(let e,n=t.childNodes.length-1;e=t.childNodes[n];n--)ps(e)&&!e.nobreaking&&(t.childNodes.splice(n,1,...e.childNodes),t.contentNodes.splice(n,0,...e.contentNodes),e.childNodes.concat(e.contentNodes).forEach((function(e){e.parent=t})),t.addMathmlNodes(e.mathml));return t}))),hr.add(new ha("propagateSimpleFunction",(t=>(t.type!==z.INFIXOP&&t.type!==z.FRACTION||!t.childNodes.every(is)||(t.role=J.COMPFUNC),t)),(t=>"clearspeak"===N.getInstance().domain))),hr.add(new ha("simpleNamedFunction",(t=>(t.role!==J.UNIT&&-1!==["f","g","h","F","G","H"].indexOf(t.textContent)&&(t.role=J.SIMPLEFUNC),t)),(t=>"clearspeak"===N.getInstance().domain))),hr.add(new ha("propagateComposedFunction",(t=>(t.type===z.FENCED&&t.childNodes[0].role===J.COMPFUNC&&(t.role=J.COMPFUNC),t)),(t=>"clearspeak"===N.getInstance().domain))),hr.add(new ha("multioperator",(t=>{t.role!==J.UNKNOWN||t.textContent.length<=1||(Ss.compSemantics(t,"role",J),Ss.compSemantics(t,"type",z))}))),hr.add(new da("convert_juxtaposition",(t=>{let e=xr(t,(function(t){return t.textContent===nn.invisibleTimes&&t.type===z.OPERATOR}));e=e.rel.length?function(t){const e=[],n=[];let r=t.comp.shift(),s=null,o=[];for(;t.comp.length;)if(o=[],r.length)s&&e.push(s),n.push(r),s=t.rel.shift(),r=t.comp.shift();else{for(s&&o.push(s);!r.length&&t.comp.length;)r=t.comp.shift(),o.push(t.rel.shift());s=Aa(o,r,n)}o.length||r.length?(e.push(s),n.push(r)):(o.push(s),Aa(o,r,n));return{rel:e,comp:n}}(e):e,t=e.comp[0];for(let n,r,s=1;n=e.comp[s],r=e.rel[s-1];s++)t.push(r),t=t.concat(n);return e=xr(t,(function(t){return t.textContent===nn.invisibleTimes&&(t.type===z.OPERATOR||t.type===z.INFIXOP)})),e.rel.length?Ra(e.comp.shift(),e.rel,e.comp):t}))),hr.add(new ha("simple2prefix",(t=>(t.textContent.length>1&&!t.textContent[0].match(/[A-Z]/)&&(t.role=J.PREFIXFUNC),t)),(t=>"braille"===N.getInstance().modality&&t.type===z.IDENTIFIER))),hr.add(new ha("detect_cycle",(t=>{t.type=z.MATRIX,t.role=J.CYCLE;const e=t.childNodes[0];return e.type=z.ROW,e.role=J.CYCLE,e.textContent="",e.contentNodes=[],t}),(t=>t.type===z.FENCED&&t.childNodes[0].type===z.INFIXOP&&t.childNodes[0].role===J.IMPLICIT&&t.childNodes[0].childNodes.every((function(t){return t.type===z.NUMBER}))&&t.childNodes[0].contentNodes.every((function(t){return t.role===J.SPACE}))))),hr.add(new da("intvar_from_implicit",(function(t){const e=t[0].childNodes;t.splice(0,1,...e)}),(t=>t[0]&&fs(t[0])))),hr.add(new ha("intvar_from_fraction",(function(t){const e=t.childNodes[1],n=e.childNodes[0];if(Hr(n))return void(n.role=J.INTEGRAL);if(!fs(n))return;const r=n.childNodes.length,s=n.childNodes[r-2],o=n.childNodes[r-1];if(Hr(o))return void(o.role=J.INTEGRAL);if(jr(s,o)){const t=Ss.getInstance().prefixNode_(o,[s]);t.role=J.INTEGRAL,2===r?e.childNodes[0]=t:(n.childNodes.pop(),n.contentNodes.pop(),n.childNodes[r-2]=t,t.parent=n)}}),(t=>{if(t.type!==z.INTEGRAL)return!1;const[,e,n]=t.childNodes;return n.type===z.EMPTY&&e.type===z.FRACTION}))),hr.add(new ha("rewrite_subcases",(function(t){t.addAnnotation("Emph","top");let e=[];if(t.hasAnnotation("Emph","left")){const n=ba(t.childNodes[0].childNodes[0].childNodes[0],!0);n.forEach((t=>t.addAnnotation("Emph","left"))),e=e.concat(n);for(let e,n=0;e=t.childNodes[n];n++)e.childNodes.shift()}if(e.push(t),t.hasAnnotation("Emph","right")){const n=ba(t.childNodes[0].childNodes[t.childNodes[0].childNodes.length-1].childNodes[0]);n.forEach((t=>t.addAnnotation("Emph","left"))),e=e.concat(n),t.childNodes[0].childNodes.pop()}Ss.tableToMultiline(t);const n=Ss.getInstance().row(e),r=t.annotation.Emph;return t.annotation.Emph=["table"],r.forEach((t=>n.addAnnotation("Emph",t))),n}),(t=>{let e=!0,n=!0;if(Oa(t.childNodes[0].childNodes[0].mathmlTree)){for(let n,r=1;n=t.childNodes[r];r++)if(n.childNodes[0].childNodes.length){e=!1;break}}else e=!1;e&&t.addAnnotation("Emph","left");if(Oa(t.childNodes[0].childNodes[t.childNodes[0].childNodes.length-1].mathmlTree)){const e=t.childNodes[0].childNodes.length;for(let r,s=1;r=t.childNodes[s];s++)if(r.childNodes.length>=e){n=!1;break}}else n=!1;return n&&t.addAnnotation("Emph","right"),e||n})));const Ca=[z.PUNCTUATED,z.RELSEQ,z.MULTIREL,z.INFIXOP,z.PREFIXOP,z.POSTFIXOP];function ba(t,e){if(!t.childNodes.length)return Ma(t),[t];let n=null;if(t.type===z.PUNCTUATED&&(e?t.role===J.ENDPUNCT:t.role===J.STARTPUNCT)){const r=t.childNodes;Ma(r[e?r.length-1:0])&&(t=r[e?0:r.length-1],n=r[e?r.length-1:0])}if(-1!==Ca.indexOf(t.type)){const r=t.childNodes;Ma(r[e?r.length-1:0]);const s=Ia.combineContentChildren(t.type,t.role,t.contentNodes,t.childNodes);return n&&(e?s.push(n):s.unshift(n)),s}return n?e?[t,n]:[n,t]:[t]}const La={[J.METRIC]:J.METRIC,[J.VBAR]:J.NEUTRAL,[J.OPENFENCE]:J.OPEN,[J.CLOSEFENCE]:J.CLOSE};function Ma(t){if(t.type!==z.PUNCTUATION)return!1;const e=La[t.role];return!!e&&(t.role=e,t.type=z.FENCE,t.addAnnotation("Emph","fence"),!0)}function ya(t,e,n,r=n){let s=[];for(;t&&t.role===n;)s.push(t),t=e.shift();return s.length?(t&&e.unshift(t),[1===s.length?s[0]:_a(s,r),e]):[t,e]}function _a(t,e){let n=hr.factory.makeBranchNode(z.PUNCTUATION,t,[]);return n.role=e,n}hr.add(new da("ellipses",(t=>{let e=[],n=t.shift();for(;n;)[n,t]=ya(n,t,J.FULLSTOP,J.ELLIPSIS),[n,t]=ya(n,t,J.DASH),e.push(n),n=t.shift();return e}),(t=>t.length>1)));class Pa{static empty(){const t=y("<math/>"),e=new Pa(t);return e.mathml=t,e}static fromNode(t,e){const n=Pa.empty();return n.root=t,e&&(n.mathml=e),n}static fromRoot(t,e){let n=t;for(;n.parent;)n=n.parent;const r=Pa.fromNode(n);return e&&(r.mathml=e),r}static fromXml(t){const e=Pa.empty();return t.childNodes[0]&&(e.root=Dr.fromXml(t.childNodes[0])),e}constructor(t){this.mathml=t,this.parser=new la,this.root=this.parser.parse(t),this.collator=this.parser.getFactory().leafMap.collateMeaning();const e=this.collator.newDefault();e&&(this.parser=new la,this.parser.getFactory().defaultMap=e,this.root=this.parser.parse(t)),Fa.visit(this.root,{}),function(t){for(const e of Bn.values())e.active&&e.annotate(t);for(const e of kn.values())e.active&&e.visit(t,Object.assign({},e.def))}(this.root)}xml(t){const e=y("<stree></stree>"),n=this.root.xml(e.ownerDocument,t);return e.appendChild(n),e}toString(t){return $(this.xml(t))}formatXml(t){return w(this.toString(t))}displayTree(){this.root.displayTree()}replaceNode(t,e){const n=t.parent;n?n.replaceChild(t,e):this.root=e}toJson(){const t={};return t.stree=this.root.toJson(),t}}const Fa=new wn("general","unit",((t,e)=>(ds(t)&&(t.role=J.UNIT),!1)));function Ua(t){return xa(t).xml()}function xa(t){return new Pa(t)}const Da=[],va={collapsed:!0,implicit:!0,wiki:!0};function wa(t){m.getInstance().output("WALKING START: "+t.toString());const e=function(t){for(let e,n=0;e=Da[n];n++)if(e.test(t))return e.constr(t);return null}(t);let n;if(e)return n=e.getMathml(),m.getInstance().output("WALKING END: "+t.toString()),Ka(n);if(1===t.mathml.length){if(m.getInstance().output("Walktree Case 0"),!t.childNodes.length)return m.getInstance().output("Walktree Case 0.1"),n=t.mathml[0],ga(n,t),m.getInstance().output("WALKING END: "+t.toString()),Ka(n);const e=t.childNodes[0];if(1===t.childNodes.length&&e.type===z.EMPTY)return m.getInstance().output("Walktree Case 0.2"),n=t.mathml[0],ga(n,t),n.appendChild(wa(e)),m.getInstance().output("WALKING END: "+t.toString()),Ka(n);t.childNodes.forEach((t=>{t.mathml.length||(t.mathml=[nl(t)])}))}const r=t.contentNodes.map(tl);rl(t,r);const s=t.childNodes.map(wa),o=Ia.combineContentChildren(t.type,t.role,r,s);if(n=t.mathmlTree,null===n)m.getInstance().output("Walktree Case 1"),n=Ba(o,t);else{const t=Xa(o);m.getInstance().output("Walktree Case 2"),t?(m.getInstance().output("Walktree Case 2.1"),n=Ja(t)):(m.getInstance().output("Walktree Case 2.2"),n=sl(n))}return n=el(n),function(t,e,n){if(!e.length)return;if(1===e.length&&t===e[0])return;const r=n.role===J.IMPLICIT&&hr.flags.combine_juxtaposition?function(t,e,n){const r=[];let s=M(t.childNodes),o=!1;for(;s.length;){const t=s.shift();if(t.hasAttribute(pa.TYPE)){r.push(t);continue}const n=Ga(t,e);0!==n.length&&(1!==n.length?(o?t.setAttribute("AuxiliaryImplicit",!0):o=!0,s=n.concat(s)):r.push(t))}const i=[],c=n.childNodes.map((function(t){return t.mathmlTree}));for(;c.length;){const t=c.pop();if(t){if(-1!==r.indexOf(t))break;-1!==e.indexOf(t)&&i.unshift(t)}}return r.concat(i)}(t,e,n):M(t.childNodes);if(!r.length)return void e.forEach((function(e){t.appendChild(e)}));let s=0;for(;e.length;){const n=e[0];if(r[s]===n||ja(r[s],n)){e.shift(),s++;continue}if(r[s]&&-1===e.indexOf(r[s])){s++;continue}if($a(n,t)){e.shift();continue}const o=r[s];if(o)Va(t,o,n),e.shift();else{if(n.parentNode){t=Ja(n),e.shift();continue}const r=e[1];if(r&&r.parentNode){(t=Ja(r)).insertBefore(n,r),e.shift(),e.shift();continue}t.insertBefore(n,null),e.shift()}}}(n,o,t),ga(n,t),m.getInstance().output("WALKING END: "+t.toString()),Ka(n)}function Ba(t,e){const n=function(t){const e=Xa(t);if(!e)return{type:Ha.INVALID,node:null};const n=Xa(t.slice().reverse());if(e===n)return{type:Ha.VALID,node:e};const r=Wa(e),s=function(t,e){let n=0;for(;t[n]&&-1===e.indexOf(t[n]);)n++;return t.slice(0,n+1)}(r,t),o=Wa(n,(function(t){return-1!==s.indexOf(t)})),i=o[0],c=s.indexOf(i);if(-1===c)return{type:Ha.INVALID,node:null};return{type:s.length!==r.length?Ha.PRUNED:Ya(s[c+1],o[1])?Ha.VALID:Ha.INVALID,node:i}}(t);let r=n.node;const s=n.type;if(s!==Ha.VALID||!Mr(r)||!r.parentNode&&e.parent)if(m.getInstance().output("Walktree Case 1.1"),r=Sa(),s===Ha.PRUNED)m.getInstance().output("Walktree Case 1.1.0"),r=function(t,e,n){let r=qa(e);if(br(r)){m.getInstance().output("Walktree Case 1.1.0.0"),ka(r,t),M(r.childNodes).forEach((function(e){t.appendChild(e)}));const e=t;t=r,r=e}const s=n.indexOf(e);return n[s]=r,x(r,t),t.appendChild(r),n.forEach((function(e){t.appendChild(e)})),t}(r,n.node,t);else if(t[0]){m.getInstance().output("Walktree Case 1.1.1");const e=Xa(t);if(e){const n=function(t,e){const n=M(t.childNodes);let r=1/0,s=-1/0;return e.forEach((function(t){const e=n.indexOf(t);-1!==e&&(r=Math.min(r,e),s=Math.max(s,e))})),n.slice(r,s+1)}(Ja(e),t);x(e,r),n.forEach((function(t){r.appendChild(t)}))}else ka(r,t[0]),r=t[0]}return e.mathmlTree||(e.mathmlTree=r),r}function ka(t,e){for(const n of ma)t.hasAttribute(n)&&(e.setAttribute(n,t.getAttribute(n)),t.removeAttribute(n))}function Ga(t,e){const n=[];let r=M(t.childNodes);for(;r.length;){const t=r.shift();t.nodeType===_.ELEMENT_NODE&&(t.hasAttribute(pa.TYPE)||-1!==e.indexOf(t)?n.push(t):r=M(t.childNodes).concat(r))}return n}function Va(t,e,n){let r=e,s=Ja(r);for(;s&&s.firstChild===r&&!r.hasAttribute("AuxiliaryImplicit")&&s!==t;)r=s,s=Ja(r);s&&(s.insertBefore(n,r),r.removeAttribute("AuxiliaryImplicit"))}function $a(t,e){if(!t)return!1;do{if((t=Ja(t))===e)return!0}while(t);return!1}function ja(t,e){const n=nn.functionApplication;if(t&&e&&t.textContent&&e.textContent&&t.textContent===n&&e.textContent===n&&"true"===e.getAttribute(pa.ADDED)){for(let n,r=0;n=t.attributes[r];r++)e.hasAttribute(n.nodeName)||e.setAttribute(n.nodeName,n.nodeValue);return x(t,e),!0}return!1}var Ha;function Xa(t){let e=0,n=null;for(;!n&&e<t.length;)t[e].parentNode&&(n=t[e]),e++;return n}function Wa(t,e){const n=e||(t=>!1),r=[t];for(;!n(t)&&!br(t)&&t.parentNode;)t=Ja(t),r.unshift(t);return r}function Ya(t,e){return!(!t||!e||t.previousSibling||e.nextSibling)}function Ka(t){for(;!br(t)&&za(t);)t=Ja(t);return t}function qa(t){const e=M(t.childNodes);if(!e)return t;const n=e.filter((function(t){return t.nodeType===_.ELEMENT_NODE&&!Lr(t)}));return 1===n.length&&Mr(n[0])&&!n[0].hasAttribute(pa.TYPE)?qa(n[0]):t}function za(t){const e=Ja(t);return!(!e||!Mr(e))&&M(e.childNodes).every((function(e){return e===t||Qa(e)}))}function Qa(t){if(t.nodeType!==_.ELEMENT_NODE)return!0;if(!t||Lr(t))return!0;const e=M(t.childNodes);return!(!Mr(t)&&e.length||function(t){return!!t&&-1!==Or.indexOf(G(t))}(t)||t.hasAttribute(pa.TYPE)||yr(t))&&M(t.childNodes).every(Qa)}function Ja(t){return t.parentNode}function Za(t,e){const n=new Ia(e);t.setAttribute(pa.COLLAPSED,n.toString())}function tl(t){if(t.mathml.length)return wa(t);const e=va.implicit?nl(t):Sa();return t.mathml=[e],e}function el(t){if(G(t)!==Tr.MFENCED)return t;const e=Sa();for(let n,r=0;n=t.attributes[r];r++)-1===["open","close","separators"].indexOf(n.name)&&e.setAttribute(n.name,n.value);return M(t.childNodes).forEach((function(t){e.appendChild(t)})),x(t,e),e}function nl(t){const e=D("mo"),n=(r=t.textContent,p.f.document.createTextNode(r));var r;return e.appendChild(n),ga(e,t),e.setAttribute(pa.ADDED,"true"),e}function rl(t,e){const n=t.type+(t.textContent?","+t.textContent:"");e.forEach((function(t){sl(t).setAttribute(pa.OPERATOR,n)}))}function sl(t){const e=M(t.childNodes);if(!e)return t;const n=e.filter((function(t){return!Qa(t)})),r=[];for(let t,e=0;t=n[e];e++)if(Mr(t)&&t.getAttribute(pa.TYPE)!==z.PUNCTUATION){const e=sl(t);e&&e!==t&&r.push(e)}else r.push(t);return 1===r.length?r[0]:t}function ol(t,e,n=!1){const r=w(t.toString()).toString().replace(new RegExp(fa,"g"),"");return n?e+":\n```html\n"+r+"\n```\n":r}function il(t,e){const n=!!e,r=e||[],s=t.parent,o=t.contentNodes.map((function(t){return t.id}));o.unshift("c");const i=[t.id,o];for(let e,o=0;e=t.childNodes[o];o++){const t=wa(e);r.push(t);const o=sl(t);s&&!n&&o.setAttribute(pa.PARENT,s.id.toString()),i.push(e.id)}return i}!function(t){t.VALID="valid",t.INVALID="invalid",t.PRUNED="pruned"}(Ha||(Ha={}));class cl{constructor(t){this.semantic=t}}class al extends cl{static test(t){return!t.mathmlTree&&t.type===z.LINE&&t.role===J.BINOMIAL}constructor(t){super(t),this.mml=t.mathmlTree}getMathml(){if(!this.semantic.childNodes.length)return this.mml;const t=this.semantic.childNodes[0];if(this.mml=wa(t),this.mml.hasAttribute(pa.TYPE)){const t=Sa();x(this.mml,t),t.appendChild(this.mml),this.mml=t}return ga(this.mml,this.semantic),this.mml}}class ll extends cl{static test(t){if(!t.mathmlTree||!t.childNodes.length)return!1;const e=G(t.mathmlTree),n=t.childNodes[0].role;return e===Tr.MSUBSUP&&n===J.SUBSUP||e===Tr.MUNDEROVER&&n===J.UNDEROVER}constructor(t){super(t),this.mml=t.mathmlTree}getMathml(){const t=this.semantic.childNodes[0],e=t.childNodes[0],n=this.semantic.childNodes[1],r=t.childNodes[1],s=wa(n),o=wa(e),i=wa(r);return ga(this.mml,this.semantic),this.mml.setAttribute(pa.CHILDREN,Ea([e,r,n])),[o,i,s].forEach((t=>sl(t).setAttribute(pa.PARENT,this.mml.getAttribute(pa.ID)))),this.mml.setAttribute(pa.TYPE,t.role),Za(this.mml,[this.semantic.id,[t.id,e.id,r.id],n.id]),this.mml}}class ul extends cl{static multiscriptIndex(t){return t.type===z.PUNCTUATED&&t.contentNodes[0].role===J.DUMMY?il(t):(wa(t),t.id)}static createNone_(t){const e=D("none");return t&&ga(e,t),e.setAttribute(pa.ADDED,"true"),e}constructor(t){super(t),this.mml=t.mathmlTree}completeMultiscript(t,e){const n=M(this.mml.childNodes).slice(1);let r=0;const s=t=>{for(let e,s=0;e=t[s];s++){const t=n[r];if(t&&e===parseInt(sl(t).getAttribute(pa.ID)))sl(t).setAttribute(pa.PARENT,this.semantic.id.toString()),r++;else{const n=this.semantic.querySelectorAll((t=>t.id===e));this.mml.insertBefore(ul.createNone_(n[0]),t||null)}}};s(t),n[r]&&G(n[r])!==Tr.MPRESCRIPTS?this.mml.insertBefore(n[r],D("mprescripts")):r++,s(e)}}class hl extends ul{static test(t){if(!t.mathmlTree)return!1;return G(t.mathmlTree)===Tr.MMULTISCRIPTS&&(t.type===z.SUPERSCRIPT||t.type===z.SUBSCRIPT)}constructor(t){super(t)}getMathml(){let t,e,n;if(ga(this.mml,this.semantic),this.semantic.childNodes[0]&&this.semantic.childNodes[0].role===J.SUBSUP){const r=this.semantic.childNodes[0];t=r.childNodes[0],e=ul.multiscriptIndex(this.semantic.childNodes[1]),n=ul.multiscriptIndex(r.childNodes[1]);const s=[this.semantic.id,[r.id,t.id,n],e];Za(this.mml,s),this.mml.setAttribute(pa.TYPE,r.role),this.completeMultiscript(Ia.interleaveIds(n,e),[])}else{t=this.semantic.childNodes[0],e=ul.multiscriptIndex(this.semantic.childNodes[1]);const n=[this.semantic.id,t.id,e];Za(this.mml,n)}const r=Ia.collapsedLeafs(n||[],e);return sl(wa(t)).setAttribute(pa.PARENT,this.semantic.id.toString()),r.unshift(t.id),this.mml.setAttribute(pa.CHILDREN,r.join(",")),this.mml}}class dl extends ul{static test(t){return!!t.mathmlTree&&t.type===z.TENSOR}constructor(t){super(t)}getMathml(){wa(this.semantic.childNodes[0]);const t=ul.multiscriptIndex(this.semantic.childNodes[1]),e=ul.multiscriptIndex(this.semantic.childNodes[2]),n=ul.multiscriptIndex(this.semantic.childNodes[3]),r=ul.multiscriptIndex(this.semantic.childNodes[4]);ga(this.mml,this.semantic);const s=[this.semantic.id,this.semantic.childNodes[0].id,t,e,n,r];Za(this.mml,s);const o=Ia.collapsedLeafs(t,e,n,r);return o.unshift(this.semantic.childNodes[0].id),this.mml.setAttribute(pa.CHILDREN,o.join(",")),this.completeMultiscript(Ia.interleaveIds(n,r),Ia.interleaveIds(t,e)),this.mml}}class fl extends cl{static test(t){return!(!t.mathmlTree||!t.fencePointer||t.mathmlTree.getAttribute("data-semantic-type"))}static makeEmptyNode_(t){const e=Sa(),n=new Dr(t);return n.type=z.EMPTY,n.mathmlTree=e,n}static fencedMap_(t,e){e[t.id]=t.mathmlTree,t.embellished&&fl.fencedMap_(t.childNodes[0],e)}constructor(t){super(t),this.fenced=null,this.fencedMml=null,this.fencedMmlNodes=[],this.ofence=null,this.ofenceMml=null,this.ofenceMap={},this.cfence=null,this.cfenceMml=null,this.cfenceMap={},this.parentCleanup=[]}getMathml(){this.getFenced_(),this.fencedMml=wa(this.fenced),this.getFencesMml_(),this.fenced.type!==z.EMPTY||this.fencedMml.parentNode||(this.fencedMml.setAttribute(pa.ADDED,"true"),this.cfenceMml.parentNode.insertBefore(this.fencedMml,this.cfenceMml)),this.getFencedMml_();return this.rewrite_()}fencedElement(t){return t.type===z.FENCED||t.type===z.MATRIX||t.type===z.VECTOR}getFenced_(){let t=this.semantic;for(;!this.fencedElement(t);)t=t.childNodes[0];this.fenced=t.childNodes[0],this.ofence=t.contentNodes[0],this.cfence=t.contentNodes[1],fl.fencedMap_(this.ofence,this.ofenceMap),fl.fencedMap_(this.cfence,this.cfenceMap)}getFencedMml_(){let t=this.ofenceMml.nextSibling;for(t=t===this.fencedMml?t:this.fencedMml;t&&t!==this.cfenceMml;)this.fencedMmlNodes.push(t),t=t.nextSibling}getFencesMml_(){let t=this.semantic;const e=Object.keys(this.ofenceMap),n=Object.keys(this.cfenceMap);for(;!(this.ofenceMml&&this.cfenceMml||t===this.fenced);)-1===e.indexOf(t.fencePointer)||this.ofenceMml||(this.ofenceMml=t.mathmlTree),-1===n.indexOf(t.fencePointer)||this.cfenceMml||(this.cfenceMml=t.mathmlTree),t=t.childNodes[0];this.ofenceMml||(this.ofenceMml=this.ofence.mathmlTree),this.cfenceMml||(this.cfenceMml=this.cfence.mathmlTree),this.ofenceMml&&(this.ofenceMml=Ka(this.ofenceMml)),this.cfenceMml&&(this.cfenceMml=Ka(this.cfenceMml))}rewrite_(){let t=this.semantic,e=null;const n=this.introduceNewLayer_();for(ga(n,this.fenced.parent);!this.fencedElement(t);){const r=t.mathmlTree,s=this.specialCase_(t,r);if(s)t=s;else{ga(r,t);const e=[];for(let n,r=1;n=t.childNodes[r];r++)e.push(wa(n));t=t.childNodes[0]}const o=D("dummy"),i=r.childNodes[0];x(r,o),x(n,r),x(r.childNodes[0],n),x(o,i),e||(e=r)}return wa(this.ofence),wa(this.cfence),this.cleanupParents_(),e||n}specialCase_(t,e){const n=G(e);let r,s=null;if(n===Tr.MSUBSUP?(s=t.childNodes[0],r=ll):n===Tr.MMULTISCRIPTS&&(t.type===z.SUPERSCRIPT||t.type===z.SUBSCRIPT?r=hl:t.type===z.TENSOR&&(r=dl),s=r&&t.childNodes[0]&&t.childNodes[0].role===J.SUBSUP?t.childNodes[0]:t),!s)return null;const o=s.childNodes[0],i=fl.makeEmptyNode_(o.id);return s.childNodes[0]=i,e=new r(t).getMathml(),s.childNodes[0]=o,this.parentCleanup.push(e),s.childNodes[0]}introduceNewLayer_(){const t=this.fullFence(this.ofenceMml),e=this.fullFence(this.cfenceMml);let n=Sa();if(x(this.fencedMml,n),this.fencedMmlNodes.forEach((t=>n.appendChild(t))),n.insertBefore(t,this.fencedMml),n.appendChild(e),!n.parentNode){const t=Sa();for(;n.childNodes.length>0;)t.appendChild(n.childNodes[0]);n.appendChild(t),n=t}return n}fullFence(t){const e=this.fencedMml.parentNode;let n=t;for(;n.parentNode&&n.parentNode!==e;)n=n.parentNode;return n}cleanupParents_(){this.parentCleanup.forEach((function(t){const e=t.childNodes[1].getAttribute(pa.PARENT);t.childNodes[0].setAttribute(pa.PARENT,e)}))}}class pl extends cl{static test(t){return!!t.mathmlTree&&t.hasAnnotation("Emph","top")}constructor(t){super(t),this.mrows=[],this.mml=t.mathmlTree}getMathml(){if(this.recurseToTable(this.semantic),this.mrows.length){const t=Sa();this.mml.parentNode.insertBefore(t,this.mml);for(const e of this.mrows)t.appendChild(e);t.appendChild(this.mml)}return this.mml}recurseToTable(t){var e,n;if(t.hasAnnotation("Emph","top")||t.hasAnnotation("Emph","fence")||!t.hasAnnotation("Emph","left")&&!t.hasAnnotation("Emph","right")){if(!t.mathmlTree||G(t.mathmlTree)===Tr.MTABLE&&(null===(e=t.annotation.Emph)||void 0===e?void 0:e.length)&&"table"!==t.annotation.Emph[0]){const e=Sa();ga(e,t),this.mrows.unshift(e)}else{if(G(t.mathmlTree)===Tr.MTABLE&&(null===(n=t.annotation.Emph)||void 0===n?void 0:n.length)&&"table"===t.annotation.Emph[0])return void this.finalizeTable(t);ga(t.mathmlTree,t)}if(t.childNodes.forEach(this.recurseToTable.bind(this)),t.textContent||"punctuated"===t.type){const e=t.contentNodes.map((t=>{const e=tl(t);return e.hasAttribute("data-semantic-added")?this.mrows.unshift(e):this.recurseToTable(t),e}));rl(t,e)}else t.contentNodes.forEach(this.recurseToTable.bind(this))}else wa(t)}finalizeTable(t){ga(t.mathmlTree,t),t.contentNodes.forEach((t=>{wa(t)})),t.childNodes.forEach((t=>{wa(t)}))}}class ml extends cl{static test(t){if(!t.mathmlTree||!t.childNodes.length)return!1;const e=G(t.mathmlTree),n=t.type;return(n===z.LIMUPPER||n===z.LIMLOWER)&&(e===Tr.MSUBSUP||e===Tr.MUNDEROVER)||n===z.LIMBOTH&&(e===Tr.MSUB||e===Tr.MUNDER||e===Tr.MSUP||e===Tr.MOVER)}static walkTree_(t){t&&wa(t)}constructor(t){super(t),this.mml=t.mathmlTree}getMathml(){const t=this.semantic.childNodes;return this.semantic.type!==z.LIMBOTH&&this.mml.childNodes.length>=3&&(this.mml=Ba([this.mml],this.semantic)),ga(this.mml,this.semantic),t[0].mathmlTree||(t[0].mathmlTree=this.semantic.mathmlTree),t.forEach(ml.walkTree_),this.mml}}class El extends cl{static test(t){return!!t.mathmlTree&&t.type===z.LINE}constructor(t){super(t),this.mml=t.mathmlTree}getMathml(){return this.semantic.contentNodes.length&&wa(this.semantic.contentNodes[0]),this.semantic.childNodes.length&&wa(this.semantic.childNodes[0]),ga(this.mml,this.semantic),this.mml}}class gl extends cl{static test(t){return!!t.mathmlTree&&(t.type===z.INFERENCE||t.type===z.PREMISES)}constructor(t){super(t),this.mml=t.mathmlTree}getMathml(){return this.semantic.childNodes.length?(this.semantic.contentNodes.forEach((function(t){wa(t),ga(t.mathmlTree,t)})),this.semantic.childNodes.forEach((function(t){wa(t)})),ga(this.mml,this.semantic),this.mml.getAttribute("data-semantic-id")===this.mml.getAttribute("data-semantic-parent")&&this.mml.removeAttribute("data-semantic-parent"),this.mml):this.mml}}class Nl extends cl{static test(t){return t.type===z.MATRIX||t.type===z.VECTOR||t.type===z.CASES}constructor(t){super(t),this.inner=[],this.mml=t.mathmlTree}getMathml(){const t=tl(this.semantic.contentNodes[0]),e=this.semantic.contentNodes[1]?tl(this.semantic.contentNodes[1]):null;if(this.inner=this.semantic.childNodes.map(wa),this.mml)if(G(this.mml)===Tr.MFENCED){const n=this.mml.childNodes;this.mml.insertBefore(t,n[0]||null),e&&this.mml.appendChild(e),this.mml=el(this.mml)}else{const n=[t,this.mml];e&&n.push(e),this.mml=Ba(n,this.semantic)}else this.mml=Ba([t].concat(this.inner,[e]),this.semantic);return ga(this.mml,this.semantic),this.mml}}class Sl extends cl{static test(t){return t.type===z.PUNCTUATED&&(t.role===J.TEXT||t.contentNodes.every((t=>t.role===J.DUMMY)))}constructor(t){super(t),this.mml=t.mathmlTree}getMathml(){const t=[],e=il(this.semantic,t);return this.mml=Ba(t,this.semantic),ga(this.mml,this.semantic),this.mml.removeAttribute(pa.CONTENT),Za(this.mml,e),this.mml}}function Tl(t){const e=V(t);return function(t,e){const n=V(t);return wa(e.root),N.getInstance().structure&&t.setAttribute(pa.STRUCTURE,Ia.fromStructure(t,e).toString()),m.getInstance().generateOutput((()=>[ol(n,"Original MathML",va.wiki),ol(e,"Semantic Tree",va.wiki),ol(t,"Semantically enriched MathML",va.wiki)])),t}(e,xa(e))}function Il(t){return Tl(y(t))}Da.push({test:ml.test,constr:t=>new ml(t)},{test:fl.test,constr:t=>new fl(t)},{test:ll.test,constr:t=>new ll(t)},{test:dl.test,constr:t=>new dl(t)},{test:hl.test,constr:t=>new hl(t)},{test:El.test,constr:t=>new El(t)},{test:al.test,constr:t=>new al(t)},{test:gl.test,constr:t=>new gl(t)},{test:pl.test,constr:t=>new pl(t)},{test:Nl.test,constr:t=>new Nl(t)},{test:Sl.test,constr:t=>new Sl(t)});let Al=0;class Rl{constructor(){this.counter=Al++,this.ATTR="sre-highlight-"+this.counter.toString(),this.color=null,this.mactionName="",this.currentHighlights=[]}highlight(t){this.currentHighlights.push(t.map((t=>{const e=this.highlightNode(t);return this.setHighlighted(t),e})))}highlightAll(t){const e=this.getMactionNodes(t);for(let t,n=0;t=e[n];n++)this.highlight([t])}unhighlight(){const t=this.currentHighlights.pop();t&&t.forEach((t=>{this.isHighlighted(t.node)&&(this.unhighlightNode(t),this.unsetHighlighted(t.node))}))}unhighlightAll(){for(;this.currentHighlights.length>0;)this.unhighlight()}setColor(t){this.color=t}colorString(){return this.color.rgba()}addEvents(t,e){const n=this.getMactionNodes(t);for(let t,r=0;t=n[r];r++)for(const[n,r]of Object.entries(e))t.addEventListener(n,r)}getMactionNodes(t){return Array.from(t.getElementsByClassName(this.mactionName))}isMactionNode(t){const e=t.className||t.getAttribute("class");return!!e&&!!e.match(new RegExp(this.mactionName))}isHighlighted(t){return t.hasAttribute(this.ATTR)}setHighlighted(t){t.setAttribute(this.ATTR,"true")}unsetHighlighted(t){t.removeAttribute(this.ATTR)}colorizeAll(t){L(t);b(`.//*[@${pa.ID}]`,t).forEach((t=>this.colorize(t)))}uncolorizeAll(t){b(`.//*[@${pa.ID}]`,t).forEach((t=>this.uncolorize(t)))}colorize(t){const e=Na("foreground");t.hasAttribute(e)&&(t.setAttribute(e+"-old",t.style.color),t.style.color=t.getAttribute(e))}uncolorize(t){const e=Na("foreground")+"-old";t.hasAttribute(e)&&(t.style.color=t.getAttribute(e))}}class Ol extends Rl{constructor(){super(),this.mactionName="mjx-maction"}highlightNode(t){const e={node:t,background:t.style.backgroundColor,foreground:t.style.color};if(!this.isHighlighted(t)){const e=this.colorString();t.style.backgroundColor=e.background,t.style.color=e.foreground}return e}unhighlightNode(t){t.node.style.backgroundColor=t.background,t.node.style.color=t.foreground}}const Cl={red:{red:255,green:0,blue:0},green:{red:0,green:255,blue:0},blue:{red:0,green:0,blue:255},yellow:{red:255,green:255,blue:0},cyan:{red:0,green:255,blue:255},magenta:{red:255,green:0,blue:255},white:{red:255,green:255,blue:255},black:{red:0,green:0,blue:0}};function bl(t,e){const n=t||{color:e};let r=Object.prototype.hasOwnProperty.call(n,"color")?Cl[n.color]:n;return r||(r=Cl[e]),r.alpha=Object.prototype.hasOwnProperty.call(n,"alpha")?n.alpha:1,function(t){const e=t=>(t=Math.max(t,0),t=Math.min(255,t),Math.round(t));return t.red=e(t.red),t.green=e(t.green),t.blue=e(t.blue),t.alpha=Math.max(t.alpha,0),t.alpha=Math.min(1,t.alpha),t}(r)}class Ll{static toHex(t){const e=t.toString(16);return 1===e.length?"0"+e:e}constructor(t,e){this.foreground=bl(e,Ll.DEFAULT_FOREGROUND_),this.background=bl(t,Ll.DEFAULT_BACKGROUND_)}rgba(){const t=function(t){return"rgba("+t.red+","+t.green+","+t.blue+","+t.alpha+")"};return{background:t(this.background),foreground:t(this.foreground)}}rgb(){const t=function(t){return"rgb("+t.red+","+t.green+","+t.blue+")"};return{background:t(this.background),alphaback:this.background.alpha.toString(),foreground:t(this.foreground),alphafore:this.foreground.alpha.toString()}}hex(){const t=function(t){return"#"+Ll.toHex(t.red)+Ll.toHex(t.green)+Ll.toHex(t.blue)};return{background:t(this.background),alphaback:this.background.alpha.toString(),foreground:t(this.foreground),alphafore:this.foreground.alpha.toString()}}}Ll.DEFAULT_BACKGROUND_="blue",Ll.DEFAULT_FOREGROUND_="black";class Ml{constructor(){this.hue=10,this.sat=100,this.light=50,this.incr=50}generate(){return e=function(t,e,n){e=e>1?e/100:e,n=n>1?n/100:n;const r=(1-Math.abs(2*n-1))*e,s=r*(1-Math.abs(t/60%2-1)),o=n-r/2;let i=0,c=0,a=0;return 0<=t&&t<60?[i,c,a]=[r,s,0]:60<=t&&t<120?[i,c,a]=[s,r,0]:120<=t&&t<180?[i,c,a]=[0,r,s]:180<=t&&t<240?[i,c,a]=[0,s,r]:240<=t&&t<300?[i,c,a]=[s,0,r]:300<=t&&t<360&&([i,c,a]=[r,0,s]),{red:i+o,green:c+o,blue:a+o}}(this.hue,this.sat,this.light),"rgb("+(t={red:Math.round(255*e.red),green:Math.round(255*e.green),blue:Math.round(255*e.blue)}).red+","+t.green+","+t.blue+")";var t,e}increment(){this.hue=(this.hue+this.incr)%360}}class yl extends Rl{constructor(){super(),this.mactionName="mjx-svg-maction"}highlightNode(t){let e;if(this.isHighlighted(t))return e={node:t.previousSibling||t,background:t.style.backgroundColor,foreground:t.style.color},e;if("svg"===t.tagName){const e={node:t,background:t.style.backgroundColor,foreground:t.style.color};return t.style.backgroundColor=this.colorString().background,t.style.color=this.colorString().foreground,e}const n=v("http://www.w3.org/2000/svg","rect");let r;if("use"===t.nodeName){const e=v("http://www.w3.org/2000/svg","g");t.parentNode.insertBefore(e,t),e.appendChild(t),r=e.getBBox(),e.parentNode.replaceChild(t,e)}else r=t.getBBox();n.setAttribute("x",(r.x-40).toString()),n.setAttribute("y",(r.y-40).toString()),n.setAttribute("width",(r.width+80).toString()),n.setAttribute("height",(r.height+80).toString());const s=t.getAttribute("transform");return s&&n.setAttribute("transform",s),n.setAttribute("fill",this.colorString().background),n.setAttribute(this.ATTR,"true"),t.parentNode.insertBefore(n,t),e={node:n,foreground:t.getAttribute("fill")},t.setAttribute("fill",this.colorString().foreground),e}setHighlighted(t){"svg"===t.tagName&&super.setHighlighted(t)}unhighlightNode(t){if("background"in t)return t.node.style.backgroundColor=t.background,void(t.node.style.color=t.foreground);t.foreground?t.node.nextSibling.setAttribute("fill",t.foreground):t.node.nextSibling.removeAttribute("fill"),t.node.parentNode.removeChild(t.node)}isMactionNode(t){let e=t.className||t.getAttribute("class");return!!e&&(e=void 0!==e.baseVal?e.baseVal:e,!!e&&!!e.match(new RegExp(this.mactionName)))}}function _l(t,e,n){const r=new Ll(t,e),s="NativeMML"===n.renderer&&"Safari"===n.browser?"MML-CSS":"SVG"===n.renderer&&"v3"===n.browser?"SVG-V3":n.renderer,o=new(Fl[s]||Fl.NativeMML);return o.setColor(r),o}function Pl(t,e,n){const r=new Ll(t,e);n.setColor(r)}const Fl={SVG:yl,"SVG-V3":class extends yl{constructor(){super(),this.mactionName="maction"}highlightNode(t){let e;if(this.isHighlighted(t))return e={node:t,background:this.colorString().background,foreground:this.colorString().foreground},e;if("svg"===t.tagName||"MJX-CONTAINER"===t.tagName)return e={node:t,background:t.style.backgroundColor,foreground:t.style.color},t.style.backgroundColor=this.colorString().background,t.style.color=this.colorString().foreground,e;const n=v("http://www.w3.org/2000/svg","rect");n.setAttribute("sre-highlighter-added","true");const r=t.getBBox();n.setAttribute("x",(r.x-40).toString()),n.setAttribute("y",(r.y-40).toString()),n.setAttribute("width",(r.width+80).toString()),n.setAttribute("height",(r.height+80).toString());const s=t.getAttribute("transform");if(s&&n.setAttribute("transform",s),n.setAttribute("fill",this.colorString().background),t.setAttribute(this.ATTR,"true"),t.parentNode.insertBefore(n,t),e={node:t,foreground:t.getAttribute("fill")},"rect"===t.nodeName){const e=new Ll({alpha:0,color:"black"});t.setAttribute("fill",e.rgba().foreground)}else t.setAttribute("fill",this.colorString().foreground);return e}unhighlightNode(t){const e=t.node.previousSibling;if(e&&e.hasAttribute("sre-highlighter-added"))return t.foreground?t.node.setAttribute("fill",t.foreground):t.node.removeAttribute("fill"),void t.node.parentNode.removeChild(e);t.node.style.backgroundColor=t.background,t.node.style.color=t.foreground}isMactionNode(t){return t.getAttribute("data-mml-node")===this.mactionName}getMactionNodes(t){return Array.from(b(`.//*[@data-mml-node="${this.mactionName}"]`,t))}},NativeMML:class extends Rl{constructor(){super(),this.mactionName="maction"}highlightNode(t){let e=t.getAttribute("style");return e+=";background-color: "+this.colorString().background,e+=";color: "+this.colorString().foreground,t.setAttribute("style",e),{node:t}}unhighlightNode(t){let e=t.node.getAttribute("style");e=e.replace(";background-color: "+this.colorString().background,""),e=e.replace(";color: "+this.colorString().foreground,""),t.node.setAttribute("style",e)}colorString(){return this.color.rgba()}getMactionNodes(t){return Array.from(t.getElementsByTagName(this.mactionName))}isMactionNode(t){return t.tagName===this.mactionName}},"HTML-CSS":class extends Rl{constructor(){super(),this.mactionName="maction"}highlightNode(t){const e={node:t,foreground:t.style.color,position:t.style.position},n=this.color.rgb();t.style.color=n.foreground,t.style.position="relative";const r=t.bbox;if(r&&r.w){const s=.05,o=0,i=D("span"),c=parseFloat(t.style.paddingLeft||"0");i.style.backgroundColor=n.background,i.style.opacity=n.alphaback.toString(),i.style.display="inline-block",i.style.height=r.h+r.d+2*s+"em",i.style.verticalAlign=-r.d+"em",i.style.marginTop=i.style.marginBottom=-s+"em",i.style.width=r.w+2*o+"em",i.style.marginLeft=c-o+"em",i.style.marginRight=-r.w-o-c+"em",t.parentNode.insertBefore(i,t),e.box=i}return e}unhighlightNode(t){const e=t.node;e.style.color=t.foreground,e.style.position=t.position,t.box&&t.box.parentNode.removeChild(t.box)}},"MML-CSS":class extends Ol{constructor(){super(),this.mactionName="maction"}getMactionNodes(t){return Array.from(t.getElementsByTagName(this.mactionName))}isMactionNode(t){return t.tagName===this.mactionName}},CommonHTML:Ol,CHTML:class extends Ol{constructor(){super()}isMactionNode(t){var e;return(null===(e=t.tagName)||void 0===e?void 0:e.toUpperCase())===this.mactionName.toUpperCase()}getMactionNodes(t){return Array.from(t.getElementsByTagName(this.mactionName))}}};function Ul(t){return t?t.split(/,/):[]}function xl(t,e){return t.getAttribute(e)}function Dl(t){if(t.hasAttribute(pa.TYPE)&&!t.hasAttribute(pa.PARENT))return t;const e=function(t,e){return t.querySelectorAll?M(t.querySelectorAll(`[${e}]`)):b(`.//*[@${e}]`,t)}(t,pa.TYPE);for(let t,n=0;t=e[n];n++)if(!t.hasAttribute(pa.PARENT))return t;return t}function vl(t,e){return t.getAttribute(pa.ID)===e?t:k(t,pa.ID,e)[0]}function wl(t,e){return t.getAttribute(pa.ID)===e?[t]:k(t,pa.ID,e)}class Bl{static textContent(t,e,n){if(!n&&e.textContent)return void(t.textContent=e.textContent);const r=Ul(xl(e,pa.OPERATOR));r.length>1&&(t.textContent=r[1])}static isPunctuated(t){return!Ia.simpleCollapseStructure(t)&&t[1]&&Ia.contentCollapseStructure(t[1])}constructor(t){this.mathml=t,this.factory=new vr,this.nodeDict={},this.mmlRoot=Dl(t),this.streeRoot=this.assembleTree(this.mmlRoot),this.stree=Pa.fromNode(this.streeRoot,this.mathml),this.xml=this.stree.xml()}getTree(){return this.stree}assembleTree(t){const e=this.makeNode(t),n=Ul(xl(t,pa.CHILDREN)),r=Ul(xl(t,pa.CONTENT));if(0===r.length&&0===n.length)return Bl.textContent(e,t),e;if(r.length>0){const t=vl(this.mathml,r[0]);t&&Bl.textContent(e,t,!0)}e.contentNodes=r.map((t=>this.setParent(t,e))),e.childNodes=n.map((t=>this.setParent(t,e)));const s=xl(t,pa.COLLAPSED);return s?this.postProcess(e,s):e}makeNode(t){const e=xl(t,pa.TYPE),n=xl(t,pa.ROLE),r=xl(t,pa.FONT),s=xl(t,pa.ANNOTATION)||"",o=xl(t,pa.ATTRIBUTES)||"",i=xl(t,pa.ID),c=xl(t,pa.EMBELLISHED),a=xl(t,pa.FENCEPOINTER),l=this.createNode(parseInt(i,10));return l.type=e,l.role=n,l.font=r||tt.UNKNOWN,l.parseAnnotation(s),l.parseAttributes(o),a&&(l.fencePointer=a),c&&(l.embellished=c),l}makePunctuation(t){const e=this.createNode(t);return e.updateContent(nn.invisibleComma),e.role=J.DUMMY,e}makePunctuated(t,e,n){const r=this.createNode(e[0]);r.type=z.PUNCTUATED,r.embellished=t.embellished,r.fencePointer=t.fencePointer,r.role=n;const s=e.splice(1,1)[0].slice(1);r.contentNodes=s.map(this.makePunctuation.bind(this)),this.collapsedChildren_(e)}makeEmpty(t,e,n){const r=this.createNode(e);r.type=z.EMPTY,r.embellished=t.embellished,r.fencePointer=t.fencePointer,r.role=n}makeIndex(t,e,n){if(Bl.isPunctuated(e))return this.makePunctuated(t,e,n),void(e=e[0]);Ia.simpleCollapseStructure(e)&&!this.nodeDict[e.toString()]&&this.makeEmpty(t,e,n)}postProcess(t,e){const n=Ia.fromString(e).array;if(t.type===J.SUBSUP){const e=this.createNode(n[1][0]);return e.type=z.SUBSCRIPT,e.role=J.SUBSUP,t.type=z.SUPERSCRIPT,e.embellished=t.embellished,e.fencePointer=t.fencePointer,this.makeIndex(t,n[1][2],J.RIGHTSUB),this.makeIndex(t,n[2],J.RIGHTSUPER),this.collapsedChildren_(n),t}if(t.type===z.SUBSCRIPT)return this.makeIndex(t,n[2],J.RIGHTSUB),this.collapsedChildren_(n),t;if(t.type===z.SUPERSCRIPT)return this.makeIndex(t,n[2],J.RIGHTSUPER),this.collapsedChildren_(n),t;if(t.type===z.TENSOR)return this.makeIndex(t,n[2],J.LEFTSUB),this.makeIndex(t,n[3],J.LEFTSUPER),this.makeIndex(t,n[4],J.RIGHTSUB),this.makeIndex(t,n[5],J.RIGHTSUPER),this.collapsedChildren_(n),t;if(t.type===z.PUNCTUATED){if(Bl.isPunctuated(n)){const e=n.splice(1,1)[0].slice(1);t.contentNodes=e.map(this.makePunctuation.bind(this))}return t}if(t.type===J.UNDEROVER){const e=this.createNode(n[1][0]);return t.childNodes[1].role===J.OVERACCENT?(e.type=z.OVERSCORE,t.type=z.UNDERSCORE):(e.type=z.UNDERSCORE,t.type=z.OVERSCORE),e.role=J.UNDEROVER,e.embellished=t.embellished,e.fencePointer=t.fencePointer,this.collapsedChildren_(n),t}return t}createNode(t){const e=this.factory.makeNode(t);return this.nodeDict[t.toString()]=e,e}collapsedChildren_(t){const e=t=>{const n=this.nodeDict[t[0]];n.childNodes=[];for(let r=1,s=t.length;r<s;r++){const s=t[r];n.childNodes.push(Ia.simpleCollapseStructure(s)?this.nodeDict[s]:e(s))}return n};e(t)}setParent(t,e){const n=vl(this.mathml,t),r=this.assembleTree(n);return r.parent=e,r}}function kl(t){return Wi.getInstance().evaluateNode(t)}function Gl(t){return ia(kl(t))}function Vl(t){const e=function(t){return kl(Pa.fromNode(t).xml())}(t);return ia(e)}function $l(t,e,n){const r=k(n,"id",e.id.toString())[0],s=r?ia(kl(r)):Vl(e);t.setAttribute(pa.SPEECH,s)}function jl(t,e,n){const r=Vl(e);t.setAttribute(n,r)}function Hl(t,e){const n=Xl(e);n&&t.setAttribute(pa.PREFIX,n)}function Xl(t){const e=function(t){const e=Pa.fromRoot(t),n=b('.//*[@id="'+t.id+'"]',e.xml());let r=n[0];n.length>1&&(r=function(t,e){const n=e[0];if(!t.parent)return n;const r=[];for(;t;)r.push(t.id),t=t.parent;const s=function(t,e){for(;e.length&&e.shift().toString()===t.getAttribute("id")&&t.parentNode&&t.parentNode.parentNode;)t=t.parentNode.parentNode;return!e.length};for(let t,n=0;t=e[n];n++)if(s(t,r.slice()))return t;return n}(t,n)||r);return r?Wi.getInstance().runInSetting({modality:"prefix",domain:"default",style:"default",strict:!0,speech:!0},(function(){return Wi.getInstance().evaluateNode(r)})):[]}(t);return ia(e)}function Wl(t,e,n){const r=function(t,e){return t.querySelectorAll?M(t.querySelectorAll(e)):b(`.//${e}`,t)}(e,"maction");for(let e,s=0;e=r[s];s++){const r=k(t,"id",e.getAttribute("id"))[0];if(!r)continue;const s=e.childNodes[1],o=s.getAttribute(pa.ID);let i=vl(t,o);if(i&&"dummy"!==i.getAttribute(pa.TYPE))continue;if(i=r.childNodes[0],i.getAttribute("sre-highlighter-added"))continue;const c=s.getAttribute(pa.PARENT);c&&i.setAttribute(pa.PARENT,c),i.setAttribute(pa.TYPE,"dummy"),i.setAttribute(pa.ID,o),i.setAttribute("role","treeitem"),i.setAttribute("aria-level",s.getAttribute("aria-level"));k(n,"id",o)[0].setAttribute("alternative",o)}}function Yl(t,e={}){const n=function(t,e={}){const n=e.locale?{locale:e.locale}:{};return t?Wi.getInstance().runInSetting(Object.assign(n,{modality:"summary",strict:!1,speech:!0}),(function(){return Wi.getInstance().evaluateNode(t)})):[]}(t,e);return ia(n)}class Kl extends c{static comparator(){return new zl(N.getInstance().dynamicCstr,i.createProp([c.DEFAULT_VALUES[r.LOCALE]],[c.DEFAULT_VALUES[r.MODALITY]],[c.DEFAULT_VALUES[r.DOMAIN]],[c.DEFAULT_VALUES[r.STYLE]]))}static fromPreference(t){const e=t.split(":"),n={},r=ql.getProperties(),s=Object.keys(r);for(let t,o=0;t=e[o];o++){const e=t.split("_");if(-1===s.indexOf(e[0]))continue;const o=e[1];o&&o!==Kl.AUTO&&-1!==r[e[0]].indexOf(o)&&(n[e[0]]=e[1])}return n}static toPreference(t){const e=Object.keys(t),n=[];for(let r=0;r<e.length;r++)n.push(e[r]+"_"+t[e[r]]);return n.length?n.join(":"):c.DEFAULT_VALUE}static getLocalePreferences(t){const e=t||function(t={}){for(const e of gn.values())for(const[,n]of e.rules.entries())for(const{cstr:e}of n)t=bn(e.getValues(),t);return t}(Wi.getInstance().enumerate());return Kl.getLocalePreferences_(e)}static currentPreference(){return f.clearspeak}static relevantPreferences(t){const e=Jl[t.type];return e&&(e[t.role]||e[""])||"ImpliedTimes"}static findPreference(t,e){if("default"===t)return Kl.AUTO;return Kl.fromPreference(t)[e]||Kl.AUTO}static addPreference(t,e,n){if("default"===t)return e+"_"+n;const r=Kl.fromPreference(t);return r[e]=n,Kl.toPreference(r)}static getLocalePreferences_(t){const e={};for(const n of Object.keys(t)){if(!t[n].speech||!t[n].speech.clearspeak)continue;const r=Object.keys(t[n].speech.clearspeak);if(r.length<3)continue;const s=e[n]={};for(const t in ql.getProperties()){const e=ql.getProperties()[t],n=[t+"_Auto"];if(e)for(const s of e)-1!==r.indexOf(t+"_"+s)&&n.push(t+"_"+s);s[t]=n}}return e}constructor(t,e){super(t),this.preference=e}equal(t){if(!super.equal(t))return!1;const e=Object.keys(this.preference),n=t.preference;if(e.length!==Object.keys(n).length)return!1;for(let t,r=0;t=e[r];r++)if(this.preference[t]!==n[t])return!1;return!0}}Kl.AUTO="Auto";const ql=new i({AbsoluteValue:["Auto","AbsEnd","Cardinality","Determinant"],Bar:["Auto","Conjugate"],Caps:["Auto","SayCaps"],CombinationPermutation:["Auto","ChoosePermute"],Currency:["Auto","Position","Prefix"],Ellipses:["Auto","AndSoOn"],Enclosed:["Auto","EndEnclose"],Exponent:["Auto","AfterPower","Ordinal","OrdinalPower","Exponent"],Fraction:["Auto","EndFrac","FracOver","General","GeneralEndFrac","Ordinal","Over","OverEndFrac","Per"],Functions:["Auto","None","Reciprocal"],ImpliedTimes:["Auto","MoreImpliedTimes","None"],Log:["Auto","LnAsNaturalLog"],Matrix:["Auto","Combinatoric","EndMatrix","EndVector","SilentColNum","SpeakColNum","Vector"],MultiLineLabel:["Auto","Case","Constraint","Equation","Line","None","Row","Step"],MultiLineOverview:["Auto","None"],MultiLinePausesBetweenColumns:["Auto","Long","Short"],MultsymbolDot:["Auto","Dot"],MultsymbolX:["Auto","By","Cross"],Paren:["Auto","CoordPoint","Interval","Silent","Speak","SpeakNestingLevel"],Prime:["Auto","Angle","Length"],Roots:["Auto","PosNegSqRoot","PosNegSqRootEnd","RootEnd"],SetMemberSymbol:["Auto","Belongs","Element","Member","In"],Sets:["Auto","SilentBracket","woAll"],TriangleSymbol:["Auto","Delta"],Trig:["Auto","ArcTrig","TrigInverse","Reciprocal"],VerticalLine:["Auto","Divides","Given","SuchThat"]});class zl extends l{constructor(t,e){super(t,e),this.preference=t instanceof Kl?t.preference:{}}match(t){if(!(t instanceof Kl))return super.match(t);if("default"===t.getComponents()[r.STYLE])return!0;const e=Object.keys(t.preference);for(let n,r=0;n=e[r];r++)if(this.preference[n]!==t.preference[n])return!1;return!0}compare(t,e){const n=super.compare(t,e);if(0!==n)return n;const r=t instanceof Kl,s=e instanceof Kl;if(!r&&s)return 1;if(r&&!s)return-1;if(!r&&!s)return 0;const o=Object.keys(t.preference).length,i=Object.keys(e.preference).length;return o>i?-1:o<i?1:0}}const Ql=[["AbsoluteValue",z.FENCED,J.NEUTRAL,J.METRIC],["Bar",z.OVERSCORE,J.OVERACCENT],["Caps",z.IDENTIFIER,J.LATINLETTER],["CombinationPermutation",z.APPL,J.UNKNOWN],["Ellipses",z.PUNCTUATION,J.ELLIPSIS],["Exponent",z.SUPERSCRIPT,""],["Fraction",z.FRACTION,""],["Functions",z.APPL,J.SIMPLEFUNC],["ImpliedTimes",z.OPERATOR,J.IMPLICIT],["Log",z.APPL,J.PREFIXFUNC],["Matrix",z.MATRIX,""],["Matrix",z.VECTOR,""],["MultiLineLabel",z.MULTILINE,J.LABEL],["MultiLineOverview",z.MULTILINE,J.TABLE],["MultiLinePausesBetweenColumns",z.MULTILINE,J.TABLE],["MultiLineLabel",z.TABLE,J.LABEL],["MultiLineOverview",z.TABLE,J.TABLE],["MultiLinePausesBetweenColumns",z.TABLE,J.TABLE],["MultiLineLabel",z.CASES,J.LABEL],["MultiLineOverview",z.CASES,J.TABLE],["MultiLinePausesBetweenColumns",z.CASES,J.TABLE],["MultsymbolDot",z.OPERATOR,J.MULTIPLICATION],["MultsymbolX",z.OPERATOR,J.MULTIPLICATION],["Paren",z.FENCED,J.LEFTRIGHT],["Prime",z.SUPERSCRIPT,J.PRIME],["Roots",z.ROOT,""],["Roots",z.SQRT,""],["SetMemberSymbol",z.RELATION,J.ELEMENT],["Sets",z.FENCED,J.SETEXT],["TriangleSymbol",z.IDENTIFIER,J.GREEKLETTER],["Trig",z.APPL,J.PREFIXFUNC],["VerticalLine",z.PUNCTUATED,J.VBAR]],Jl=function(){const t={};for(let e,n=0;e=Ql[n];n++){const n=e[0];let r=t[e[1]];r||(r={},t[e[1]]=r),r[e[2]]=n}return t}();N.getInstance().comparators.clearspeak=Kl.comparator,N.getInstance().parsers.clearspeak=new class extends a{constructor(){super([r.LOCALE,r.MODALITY,r.DOMAIN,r.STYLE])}parse(t){const e=super.parse(t);let n=e.getValue(r.STYLE);const s=e.getValue(r.LOCALE),o=e.getValue(r.MODALITY);let i={};return n!==c.DEFAULT_VALUE&&(i=this.fromPreference(n),n=this.toPreference(i)),new Kl({locale:s,modality:o,domain:"clearspeak",style:n},i)}fromPreference(t){return Kl.fromPreference(t)}toPreference(t){return Kl.toPreference(t)}};class Zl{constructor(){this.modality=Na("speech"),this.rebuilt_=null,this.options_={}}getRebuilt(){return this.rebuilt_}setRebuilt(t){this.rebuilt_=t}computeRebuilt(t,e=!1){return this.rebuilt_&&!e||(this.rebuilt_=new Bl(t)),this.rebuilt_}setOptions(t){this.options_=t||{},this.modality=Na(this.options_.modality||"speech")}setOption(t,e){const n=this.getOptions();n[t]=e,this.setOptions(n)}getOptions(){return this.options_}generateSpeech(t,e){return this.rebuilt_||(this.rebuilt_=new Bl(e)),mc(this.options_),Gl(this.getRebuilt().xml)}nextRules(){const t=this.getOptions();if("speech"!==t.modality)return;Kl.getLocalePreferences()[t.locale]&&(f[t.domain]=t.style,t.domain="mathspeak"===t.domain?"clearspeak":"mathspeak",t.style=f[t.domain],this.setOptions(t))}nextStyle(t){this.setOption("style",this.nextStyle_(this.getRebuilt().nodeDict[t]))}nextStyle_(t){const{modality:e,domain:n,style:r}=this.getOptions();if("speech"!==e)return r;if("mathspeak"===n){const t=["default","brief","sbrief"],e=t.indexOf(r);return-1===e?r:e>=t.length-1?t[0]:t[e+1]}if("clearspeak"===n){const e=Kl.getLocalePreferences().en;if(!e)return"default";const n=Kl.relevantPreferences(t),s=Kl.findPreference(r,n),o=e[n].map((function(t){return t.split("_")[1]})),i=o.indexOf(s);if(-1===i)return r;const c=i>=o.length-1?o[0]:o[i+1];return Kl.addPreference(r,n,c)}return r}getLevel(t){return ut.MESSAGES.navigate.LEVEL+" "+t}getActionable(t){return t?t<0?ut.MESSAGES.navigate.EXPANDABLE:ut.MESSAGES.navigate.COLLAPSIBLE:""}}class tu extends Zl{getSpeech(t,e){const n=this.generateSpeech(t,e);return t.setAttribute(this.modality,n),n}}class eu extends Zl{constructor(){super(...arguments),this.modality=Na("foreground"),this.contrast=new Ml}static visitStree_(t,e,n){if(t.childNodes.length){if(t.contentNodes.length&&("punctuated"===t.type&&t.contentNodes.forEach((t=>n[t.id]=!0)),"implicit"!==t.role&&e.push(t.contentNodes.map((t=>t.id)))),t.childNodes.length){if("implicit"===t.role){const r=[];let s=[];for(const e of t.childNodes){const t=[];eu.visitStree_(e,t,n),t.length<=2&&r.push(t.shift()),s=s.concat(t)}return e.push(r),void s.forEach((t=>e.push(t)))}t.childNodes.forEach((t=>eu.visitStree_(t,e,n)))}}else n[t.id]||e.push(t.id)}getSpeech(t,e){return xl(t,this.modality)}generateSpeech(t,e){return this.getRebuilt()||this.setRebuilt(new Bl(y(e))),this.colorLeaves_(t),xl(t,this.modality)}colorLeaves_(t){const e=[];eu.visitStree_(this.getRebuilt().streeRoot,e,{});for(const n of e){const e=this.contrast.generate();let r=!1;r=Array.isArray(n)?n.map((n=>this.colorLeave_(t,n,e))).reduce(((t,e)=>t||e),!1):this.colorLeave_(t,n.toString(),e),r&&this.contrast.increment()}}colorLeave_(t,e,n){const r=vl(t,e);return!!r&&(r.setAttribute(this.modality,n),!0)}}class nu extends Zl{getSpeech(t,e){return xl(t,this.modality)}}class ru extends Zl{getSpeech(t,e){return""}}class su extends Zl{getSpeech(t,e,n=null){this.getRebuilt()&&Wl(t,e,this.getRebuilt().xml);const r=this.generateSpeech(t,e),s=this.getRebuilt().nodeDict;for(const[r,o]of Object.entries(s)){const s=vl(e,r),i=vl(t,r)||n&&vl(n,r);s&&i&&(this.modality&&this.modality!==pa.SPEECH?jl(i,o,this.modality):$l(i,o,this.getRebuilt().xml),this.modality===pa.SPEECH&&Hl(i,o))}return r}}class ou extends su{getSpeech(t,e){return super.getSpeech(t,e),xl(t,this.modality)}}class iu extends Zl{getSpeech(t,e){mc(this.getOptions());const n=t.getAttribute(pa.ID);jl(t,this.getRebuilt().streeRoot.querySelectorAll((t=>t.id.toString()===n))[0],this.modality);return t.getAttribute(pa.SUMMARY)}}function cu(t){return(au[t]||au.Direct)()}const au={Adhoc:()=>new tu,Color:()=>new eu,Direct:()=>new nu,Dummy:()=>new ru,Node:()=>new ou,Summary:()=>new iu,Tree:()=>new su};class lu{static factory(t,e,n,r){const s=t=>vl(r,t),o=n.nodeDict,i=s(t),c=e.map(s),a=e.map((function(t){return o[t]})),l=new lu(a,o[t]);return l.domNodes=c,l.domPrimary_=i,l.allNodes=lu.generateAllVisibleNodes_(e,c,o,r),l}static generateAllVisibleNodes_(t,e,n,r){let s=[];for(let o=0,i=t.length;o<i;o++){if(e[o]){const n=lu.getAllVisibleNodes([t[o]],r);n.length?s=s.concat(n):s.push(e[o]);continue}const i=n[t[o]];if(!i)continue;const c=i.childNodes.map((t=>t.id.toString())),a=lu.getAllVisibleNodes(c,r);s=s.concat(lu.generateAllVisibleNodes_(c,a,n,r))}return s}static getAllVisibleNodes(t,e){let n=[];for(const r of t)n=n.concat(wl(e,r));return n}constructor(t,e){this.nodes=t,this.primary=e,this.domNodes=[],this.domPrimary_=null,this.allNodes=[]}getSemanticPrimary(){return this.primary}getSemanticNodes(){return this.nodes}getNodes(){return this.allNodes}getDomNodes(){return this.domNodes}getDomPrimary(){return this.domPrimary_}toString(){return"Primary:"+this.domPrimary_+" Nodes:"+this.domNodes}clone(){const t=new lu(this.nodes,this.primary);return t.domNodes=this.domNodes,t.domPrimary_=this.domPrimary_,t.allNodes=this.allNodes,t}}var uu;!function(t){t.UP="up",t.DOWN="down",t.LEFT="left",t.RIGHT="right",t.REPEAT="repeat",t.DEPTH="depth",t.ENTER="enter",t.EXPAND="expand",t.HOME="home",t.SUMMARY="summary",t.DETAIL="detail",t.ROW="row",t.CELL="cell"}(uu||(uu={}));class hu{static resetState(t){delete hu.STATE[t]}static setState(t,e){hu.STATE[t]=e}static getState(t){return hu.STATE[t]}}hu.STATE={};class du{constructor(t,e,n,r){this.node=t,this.generator=e,this.highlighter=n,this.modifier=!1,this.keyMapping=new Map([[Ec.UP,this.up.bind(this)],[Ec.DOWN,this.down.bind(this)],[Ec.RIGHT,this.right.bind(this)],[Ec.LEFT,this.left.bind(this)],[Ec.TAB,this.repeat.bind(this)],[Ec.DASH,this.expand.bind(this)],[Ec.SPACE,this.depth.bind(this)],[Ec.HOME,this.home.bind(this)],[Ec.X,this.summary.bind(this)],[Ec.Z,this.detail.bind(this)],[Ec.V,this.virtualize.bind(this)],[Ec.P,this.previous.bind(this)],[Ec.U,this.undo.bind(this)],[Ec.LESS,this.previousRules.bind(this)],[Ec.GREATER,this.nextRules.bind(this)]]),this.cursors=[],this.xml_=null,this.rebuilt_=null,this.focus_=null,this.active_=!1,this.node.id?this.id=this.node.id:this.node.hasAttribute(du.SRE_ID_ATTR)?this.id=this.node.getAttribute(du.SRE_ID_ATTR):(this.node.setAttribute(du.SRE_ID_ATTR,du.ID_COUNTER.toString()),this.id=du.ID_COUNTER++),this.rootNode=Dl(t),this.rootId=this.rootNode.getAttribute(pa.ID),this.xmlString_=r,this.moved=uu.ENTER}getXml(){return this.xml_||(this.xml_=y(this.xmlString_)),this.xml_}getRebuilt(){return this.rebuilt_||this.rebuildStree(),this.rebuilt_}isActive(){return this.active_}activate(){this.isActive()||this.toggleActive_()}deactivate(){this.isActive()&&(hu.setState(this.id,this.primaryId()),this.toggleActive_())}getFocus(t=!1){return null===this.rootId&&this.getRebuilt(),this.focus_||(this.focus_=this.singletonFocus(this.rootId)),t&&this.updateFocus(),this.focus_}setFocus(t){this.focus_=t}getDepth(){return this.levels.depth()-1}isSpeech(){return this.generator.modality===pa.SPEECH}focusDomNodes(){return this.getFocus().getDomNodes()}focusSemanticNodes(){return this.getFocus().getSemanticNodes()}speech(){const t=this.focusDomNodes();if(!t.length)return"";const e=this.specialMove();if(null!==e)return e;switch(this.moved){case uu.DEPTH:return this.depth_();case uu.SUMMARY:return this.summary_();case uu.DETAIL:return this.detail_();default:{const e=[],n=this.focusSemanticNodes();for(let r=0,s=t.length;r<s;r++){const s=t[r],o=n[r];e.push(s?this.generator.getSpeech(s,this.getXml(),this.node):Vl(o))}return this.mergePrefix_(e)}}}move(t){const e=this.keyMapping.get(t);if(!e)return null;const n=e();return!(!n||n===this.getFocus())&&(this.setFocus(n),this.moved===uu.HOME&&(this.levels=this.initLevels()),!0)}up(){return this.moved=uu.UP,this.getFocus()}down(){return this.moved=uu.DOWN,this.getFocus()}left(){return this.moved=uu.LEFT,this.getFocus()}right(){return this.moved=uu.RIGHT,this.getFocus()}repeat(){return this.moved=uu.REPEAT,this.getFocus().clone()}depth(){return this.moved=this.isSpeech()?uu.DEPTH:uu.REPEAT,this.getFocus().clone()}home(){this.moved=uu.HOME;return this.singletonFocus(this.rootId)}getBySemanticId(t){return vl(this.node,t)}primaryId(){return this.getFocus().getSemanticPrimary().id.toString()}expand(){const t=this.getFocus().getDomPrimary(),e=this.actionable_(t);return e?(this.moved=uu.EXPAND,e.dispatchEvent(new Event("click")),this.getFocus().clone()):this.getFocus()}expandable(t){return!!this.actionable_(t)&&0===t.childNodes.length}collapsible(t){return!!this.actionable_(t)&&t.childNodes.length>0}restoreState(){if(!this.highlighter)return;const t=hu.getState(this.id);if(!t)return;let e=this.getRebuilt().nodeDict[t];const n=[];for(;e;)n.push(e.id),e=e.parent;for(n.pop();n.length>0;){this.down();const t=n.pop(),e=this.findFocusOnLevel(t);if(!e)break;this.setFocus(e)}this.moved=uu.ENTER}updateFocus(){this.setFocus(lu.factory(this.getFocus().getSemanticPrimary().id.toString(),this.getFocus().getSemanticNodes().map((t=>t.id.toString())),this.getRebuilt(),this.node))}rebuildStree(){this.rebuilt_=new Bl(this.getXml()),this.rootId=this.rebuilt_.stree.root.id.toString(),this.generator.setRebuilt(this.rebuilt_),this.skeleton=Ia.fromTree(this.rebuilt_.stree),this.skeleton.populate(),this.focus_=this.singletonFocus(this.rootId),this.levels=this.initLevels(),Wl(this.node,this.getXml(),this.rebuilt_.xml)}previousLevel(){const t=this.getFocus().getDomPrimary();return t?xl(t,pa.PARENT):this.getFocus().getSemanticPrimary().parent.id.toString()}nextLevel(){const t=this.getFocus().getDomPrimary();let e,n;if(t){e=Ul(xl(t,pa.CHILDREN)),n=Ul(xl(t,pa.CONTENT));const r=xl(t,pa.TYPE),s=xl(t,pa.ROLE);return this.combineContentChildren(r,s,n,e)}const r=t=>t.id.toString(),s=this.getRebuilt().nodeDict[this.primaryId()];return e=s.childNodes.map(r),n=s.contentNodes.map(r),0===e.length?[]:this.combineContentChildren(s.type,s.role,n,e)}singletonFocus(t){this.getRebuilt();const e=this.retrieveVisuals(t);return this.focusFromId(t,e)}retrieveVisuals(t){if(!this.skeleton)return[t];const e=parseInt(t,10),n=this.skeleton.subtreeNodes(e);if(!n.length)return[t];n.unshift(e);const r={},s=[];L(this.getXml());for(const t of n)r[t]||(s.push(t.toString()),r[t]=!0,this.subtreeIds(t,r));return s}subtreeIds(t,e){const n=b(`//*[@data-semantic-id="${t}"]`,this.getXml());b("*//@data-semantic-id",n[0]).forEach((t=>e[parseInt(t.textContent,10)]=!0))}focusFromId(t,e){return lu.factory(t,e,this.getRebuilt(),this.node)}summary(){return this.moved=this.isSpeech()?uu.SUMMARY:uu.REPEAT,this.getFocus().clone()}detail(){return this.moved=this.isSpeech()?uu.DETAIL:uu.REPEAT,this.getFocus().clone()}specialMove(){return null}virtualize(t){return this.cursors.push({focus:this.getFocus(),levels:this.levels,undo:t||!this.cursors.length}),this.levels=this.levels.clone(),this.getFocus().clone()}previous(){const t=this.cursors.pop();return t?(this.levels=t.levels,t.focus):this.getFocus()}undo(){let t;do{t=this.cursors.pop()}while(t&&!t.undo);return t?(this.levels=t.levels,t.focus):this.getFocus()}update(t){mc(t).then((()=>cu("Tree").getSpeech(this.node,this.getXml())))}nextRules(){this.generator.nextRules();const t=this.generator.getOptions();return"speech"!==t.modality?this.getFocus():(this.update(t),this.moved=uu.REPEAT,this.getFocus().clone())}previousRules(){var t;this.generator.nextStyle(null===(t=this.getFocus().getSemanticPrimary())||void 0===t?void 0:t.id.toString());const e=this.generator.getOptions();return"speech"!==e.modality?this.getFocus():(this.update(e),this.moved=uu.REPEAT,this.getFocus().clone())}refocus(){let t,e=this.getFocus();for(;!e.getNodes().length;){t=this.levels.peek();const n=this.up();if(!n)break;this.setFocus(n),e=this.getFocus(!0)}this.levels.push(t),this.setFocus(e)}toggleActive_(){this.active_=!this.active_}mergePrefix_(t,e=[]){const n=this.isSpeech()?this.prefix_():"";n&&t.unshift(n);const r=this.isSpeech()?this.postfix_():"";return r&&t.push(r),ca(function(t){const e=t.map((t=>"string"==typeof t?Ln.stringEmpty(t):t)),n=oa.get(N.getInstance().markup);return n?n.merge(e):t.join()}(e.concat(t)))}prefix_(){const t=this.getFocus().getDomNodes(),e=this.getFocus().getSemanticNodes();return t[0]?xl(t[0],pa.PREFIX):Xl(e[0])}postfix_(){const t=this.getFocus().getDomNodes();return t[0]?xl(t[0],pa.POSTFIX):""}depth_(){const t=gt.getInstance().getParameter("depth");gt.getInstance().setParameter("depth",!0);const e=this.getFocus().getDomPrimary(),n=this.expandable(e)?ut.MESSAGES.navigate.EXPANDABLE:this.collapsible(e)?ut.MESSAGES.navigate.COLLAPSIBLE:"",r=ut.MESSAGES.navigate.LEVEL+" "+this.getDepth(),s=Xl(this.getFocus().getSemanticNodes()[0]),o=[new _n({text:r,personality:{}}),new _n({text:s,personality:{}}),new _n({text:n,personality:{}})];return gt.getInstance().setParameter("depth",t),ca(ia(o))}actionable_(t){const e=null==t?void 0:t.parentNode;return e&&this.highlighter.isMactionNode(e)?e:null}summary_(){const t=this.getFocus().getSemanticPrimary().id.toString(),e=Yl(this.getRebuilt().xml.getAttribute("id")===t?this.getRebuilt().xml:k(this.getRebuilt().xml,"id",t)[0]);return this.mergePrefix_([e])}detail_(){const t=this.getFocus().getSemanticPrimary().id.toString(),e=this.getRebuilt().xml.getAttribute("id")===t?this.getRebuilt().xml:k(this.getRebuilt().xml,"id",t)[0],n=e.getAttribute("alternative");e.removeAttribute("alternative");const r=Gl(e),s=this.mergePrefix_([r]);return e.setAttribute("alternative",n),s}}du.ID_COUNTER=0,du.SRE_ID_ATTR="sre-explorer-id";class fu extends du{up(){return null}down(){return null}left(){return null}right(){return null}repeat(){return null}depth(){return null}home(){return null}getDepth(){return 0}initLevels(){return null}combineContentChildren(t,e,n,r){return[]}findFocusOnLevel(t){return null}}class pu{constructor(){this.level_=[]}push(t){this.level_.push(t)}pop(){return this.level_.pop()}peek(){return this.level_[this.level_.length-1]||null}indexOf(t){const e=this.peek();return e?e.indexOf(t):null}find(t){const e=this.peek();if(!e)return null;for(let n=0,r=e.length;n<r;n++)if(t(e[n]))return e[n];return null}get(t){const e=this.peek();return!e||t<0||t>=e.length?null:e[t]}depth(){return this.level_.length}clone(){const t=new pu;return t.level_=this.level_.slice(0),t}toString(){let t="";for(let e,n=0;e=this.level_[n];n++)t+="\n"+e.map((function(t){return t.toString()}));return t}}class mu extends du{constructor(t,e,n,r){super(t,e,n,r),this.node=t,this.generator=e,this.highlighter=n,this.levels=null,this.restoreState()}initLevels(){const t=new pu;return t.push([this.getFocus()]),t}up(){super.up();const t=this.previousLevel();if(!t)return null;this.levels.pop();return this.levels.find((function(e){return e.getSemanticNodes().some((function(e){return e.id.toString()===t}))}))}down(){super.down();const t=this.nextLevel();return 0===t.length?null:(this.levels.push(t),t[0])}combineContentChildren(t,e,n,r){switch(t){case z.RELSEQ:case z.INFIXOP:case z.MULTIREL:return this.makePairList(r,n);case z.PREFIXOP:return[this.focusFromId(r[0],n.concat(r))];case z.POSTFIXOP:return[this.focusFromId(r[0],r.concat(n))];case z.MATRIX:case z.VECTOR:case z.FENCED:return[this.focusFromId(r[0],[n[0],r[0],n[1]])];case z.CASES:return[this.focusFromId(r[0],[n[0],r[0]])];case z.PUNCTUATED:return e===J.TEXT?r.map(this.singletonFocus.bind(this)):r.length===n.length?n.map(this.singletonFocus.bind(this)):this.combinePunctuations(r,n,[],[]);case z.APPL:return[this.focusFromId(r[0],[r[0],n[0]]),this.singletonFocus(r[1])];case z.ROOT:return[this.singletonFocus(r[0]),this.singletonFocus(r[1])];default:return r.map(this.singletonFocus.bind(this))}}combinePunctuations(t,e,n,r){if(0===t.length)return r;const s=t.shift(),o=e.shift();return s===o?(n.push(o),this.combinePunctuations(t,e,n,r)):(e.unshift(o),n.push(s),t.length===e.length?(r.push(this.focusFromId(s,n.concat(e))),r):(r.push(this.focusFromId(s,n)),this.combinePunctuations(t,e,[],r)))}makePairList(t,e){if(0===t.length)return[];if(1===t.length)return[this.singletonFocus(t[0])];const n=[this.singletonFocus(t.shift())];for(let r=0,s=t.length;r<s;r++)n.push(this.focusFromId(t[r],[e[r],t[r]]));return n}left(){super.left();const t=this.levels.indexOf(this.getFocus());if(null===t)return null;const e=this.levels.get(t-1);return e||null}right(){super.right();const t=this.levels.indexOf(this.getFocus());if(null===t)return null;const e=this.levels.get(t+1);return e||null}findFocusOnLevel(t){return this.levels.find((e=>e.getSemanticPrimary().id===t))}}class Eu extends du{constructor(t,e,n,r){super(t,e,n,r),this.node=t,this.generator=e,this.highlighter=n,this.levels=null,this.restoreState()}initLevels(){const t=new pu;return t.push([this.primaryId()]),t}up(){super.up();const t=this.previousLevel();return t?(this.levels.pop(),this.singletonFocus(t)):null}down(){super.down();const t=this.nextLevel();if(0===t.length)return null;const e=this.singletonFocus(t[0]);return e&&this.levels.push(t),e}combineContentChildren(t,e,n,r){switch(t){case z.RELSEQ:case z.INFIXOP:case z.MULTIREL:return lr(r,n);case z.PREFIXOP:return n.concat(r);case z.POSTFIXOP:return r.concat(n);case z.MATRIX:case z.VECTOR:case z.FENCED:return r.unshift(n[0]),r.push(n[1]),r;case z.CASES:return r.unshift(n[0]),r;case z.PUNCTUATED:return e===J.TEXT?lr(r,n):r;case z.APPL:return[r[0],n[0],r[1]];case z.ROOT:return[r[0],r[1]];default:return r}}left(){super.left();const t=this.levels.indexOf(this.primaryId());if(null===t)return null;const e=this.levels.get(t-1);return e?this.singletonFocus(e):null}right(){super.right();const t=this.levels.indexOf(this.primaryId());if(null===t)return null;const e=this.levels.get(t+1);return e?this.singletonFocus(e):null}findFocusOnLevel(t){return this.singletonFocus(t.toString())}focusDomNodes(){return[this.getFocus().getDomPrimary()]}focusSemanticNodes(){return[this.getFocus().getSemanticPrimary()]}}class gu extends Eu{constructor(t,e,n,r){super(t,e,n,r),this.node=t,this.generator=e,this.highlighter=n,this.firstJump=null,this.key_=null,this.row_=0,this.currentTable_=null,this.keyMapping.set(Ec.ZERO,this.jumpCell.bind(this)),this.keyMapping.set(Ec.ONE,this.jumpCell.bind(this)),this.keyMapping.set(Ec.TWO,this.jumpCell.bind(this)),this.keyMapping.set(Ec.THREE,this.jumpCell.bind(this)),this.keyMapping.set(Ec.FOUR,this.jumpCell.bind(this)),this.keyMapping.set(Ec.FIVE,this.jumpCell.bind(this)),this.keyMapping.set(Ec.SIX,this.jumpCell.bind(this)),this.keyMapping.set(Ec.SEVEN,this.jumpCell.bind(this)),this.keyMapping.set(Ec.EIGHT,this.jumpCell.bind(this)),this.keyMapping.set(Ec.NINE,this.jumpCell.bind(this))}move(t){this.key_=t;const e=super.move(t);return this.modifier=!1,e}up(){return this.moved=uu.UP,this.eligibleCell_()?this.verticalMove_(!1):super.up()}down(){return this.moved=uu.DOWN,this.eligibleCell_()?this.verticalMove_(!0):super.down()}jumpCell(){if(!this.isInTable_()||null===this.key_)return this.getFocus();if(this.moved===uu.ROW){this.moved=uu.CELL;const t=this.key_-Ec.ZERO;return this.isLegalJump_(this.row_,t)?this.jumpCell_(this.row_,t):this.getFocus()}const t=this.key_-Ec.ZERO;return t>this.currentTable_.childNodes.length?this.getFocus():(this.row_=t,this.moved=uu.ROW,this.getFocus().clone())}undo(){const t=super.undo();return t===this.firstJump&&(this.firstJump=null),t}eligibleCell_(){const t=this.getFocus().getSemanticPrimary();return this.modifier&&t.type===z.CELL&&-1!==gu.ELIGIBLE_CELL_ROLES.indexOf(t.role)}verticalMove_(t){const e=this.previousLevel();if(!e)return null;const n=this.getFocus(),r=this.levels.indexOf(this.primaryId()),s=this.levels.pop(),o=this.levels.indexOf(e),i=this.levels.get(t?o+1:o-1);if(!i)return this.levels.push(s),null;this.setFocus(this.singletonFocus(i));const c=this.nextLevel();return c[r]?(this.levels.push(c),this.singletonFocus(c[r])):(this.setFocus(n),this.levels.push(s),null)}jumpCell_(t,e){this.firstJump?this.virtualize(!1):(this.firstJump=this.getFocus(),this.virtualize(!0));const n=this.currentTable_.id.toString();let r;do{r=this.levels.pop()}while(-1===r.indexOf(n));this.levels.push(r),this.setFocus(this.singletonFocus(n)),this.levels.push(this.nextLevel());const s=this.currentTable_.childNodes[t-1];return this.setFocus(this.singletonFocus(s.id.toString())),this.levels.push(this.nextLevel()),this.singletonFocus(s.childNodes[e-1].id.toString())}isLegalJump_(t,e){const n=k(this.getRebuilt().xml,"id",this.currentTable_.id.toString())[0];if(!n||n.hasAttribute("alternative"))return!1;const r=this.currentTable_.childNodes[t-1];if(!r)return!1;const s=k(n,"id",r.id.toString())[0];return!(!s||s.hasAttribute("alternative"))&&!(!r||!r.childNodes[e-1])}isInTable_(){let t=this.getFocus().getSemanticPrimary();for(;t;){if(-1!==gu.ELIGIBLE_TABLE_TYPES.indexOf(t.type))return this.currentTable_=t,!0;t=t.parent}return!1}}gu.ELIGIBLE_CELL_ROLES=[J.DETERMINANT,J.ROWVECTOR,J.BINOMIAL,J.SQUAREMATRIX,J.MULTILINE,J.MATRIX,J.VECTOR,J.CASES,J.TABLE],gu.ELIGIBLE_TABLE_TYPES=[z.MULTILINE,z.MATRIX,z.VECTOR,z.CASES,z.TABLE];const Nu={dummy:(t,e,n,r)=>new fu(t,e,n,r),semantic:(t,e,n,r)=>new mu(t,e,n,r),syntax:(t,e,n,r)=>new Eu(t,e,n,r),table:(t,e,n,r)=>new gu(t,e,n,r)};class Su{static stringify_(t){return t?t.toString():t}constructor(t,e){this.name=t,this.process=e.processor,this.postprocess=e.postprocessor||((t,e)=>t),this.processor=this.postprocess?function(t){return this.postprocess(this.process(t),t)}:this.process,this.print=e.print||Su.stringify_,this.pprint=e.pprint||this.print}}Su.LocalState={walker:null,speechGenerator:null,highlighter:null};class Tu extends Su{static getKey_(t){return"string"==typeof t?Ec[t.toUpperCase()]:t}constructor(t,e){super(t,e),this.key=e.key||Tu.getKey_}}const Iu=new Map;function Au(t){Iu.set(t.name,t)}function Ru(t){const e=Iu.get(t);if(!e)throw new g("Unknown processor "+t);return e}function Ou(t,e){const n=Ru(t);try{return n.processor(e)}catch(t){throw new g("Processing error for expression "+e)}}function Cu(t,e){const n=Ru(t);try{const t=n.processor(e);return N.getInstance().pprint?n.pprint(t):n.print(t)}catch(t){throw console.log(t),new g("Processing error for expression "+e)}}Au(new Su("semantic",{processor:function(t){return Ua(y(t))},postprocessor:function(t,e){const n=N.getInstance().speech;if(n===h.NONE)return t;const r=V(t);let s=Gl(r);if(n===h.SHALLOW)return t.setAttribute("speech",ca(s)),t;const o=b(".//*[@id]",t),i=b(".//*[@id]",r);for(let t,e,n=0;t=o[n],e=i[n];n++)s=Gl(e),t.setAttribute("speech",ca(s));return t},pprint:function(t){return w(t.toString())}})),Au(new Su("speech",{processor:function(t){return ca(ia(kl(Ua(y(t)))))},pprint:function(t){const e=t.toString();return oa.get(N.getInstance().markup)instanceof xc?w(e):e}})),Au(new Su("json",{processor:function(t){return xa(y(t)).toJson()},postprocessor:function(t,e){const n=N.getInstance().speech;if(n===h.NONE)return t;const r=Ua(y(e)),s=Gl(r);if(n===h.SHALLOW)return t.stree.speech=ca(s),t;const o=t=>{const e=Gl(b(`.//*[@id=${t.id}]`,r)[0]);t.speech=ca(e),t.children&&t.children.forEach(o)};return o(t.stree),t},print:function(t){return JSON.stringify(t)},pprint:function(t){return JSON.stringify(t,null,2)}})),Au(new Su("description",{processor:function(t){return kl(Ua(y(t)))},print:function(t){return JSON.stringify(t)},pprint:function(t){return JSON.stringify(t,null,2)}})),Au(new Su("enriched",{processor:function(t){return Il(t)},postprocessor:function(t,e){const n=Dl(t);let r;switch(N.getInstance().speech){case h.NONE:break;case h.SHALLOW:r=cu("Adhoc"),r.getSpeech(n,t);break;case h.DEEP:r=cu("Tree"),r.getSpeech(t,t)}return t},pprint:function(t){return w(t.toString())}})),Au(new Su("walker",{processor:function(t){const e=cu("Node");Su.LocalState.speechGenerator=e,e.setOptions({modality:N.getInstance().modality,locale:N.getInstance().locale,domain:N.getInstance().domain,style:N.getInstance().style}),Su.LocalState.highlighter=_l({color:"black"},{color:"white"},{renderer:"NativeMML"});const n=Ou("enriched",t),r=function(t,e){const n=Ru(t);return N.getInstance().pprint?n.pprint(e):n.print(e)}("enriched",n);return Su.LocalState.walker=function(t,e,n,r,s){return(Nu[t.toLowerCase()]||Nu.dummy)(e,n,r,s)}(N.getInstance().walker,n,e,Su.LocalState.highlighter,r),Su.LocalState.walker},print:function(t){return Su.LocalState.walker.speech()}})),Au(new Tu("move",{processor:function(t){if(!Su.LocalState.walker)return null;return!1===Su.LocalState.walker.move(t)?function(t){const e=oa.get(N.getInstance().markup);return e?e.error(t):""}(t):Su.LocalState.walker.speech()}})),Au(new Su("number",{processor:function(t){const e=parseInt(t,10);return isNaN(e)?"":ut.NUMBERS.numberToWords(e)}})),Au(new Su("ordinal",{processor:function(t){const e=parseInt(t,10);return isNaN(e)?"":ut.NUMBERS.wordOrdinal(e)}})),Au(new Su("numericOrdinal",{processor:function(t){const e=parseInt(t,10);return isNaN(e)?"":ut.NUMBERS.numericOrdinal(e)}})),Au(new Su("vulgar",{processor:function(t){const[e,n]=t.split("/").map((t=>parseInt(t,10)));return isNaN(e)||isNaN(n)?"":Ou("speech",`<mfrac><mn>${e}</mn><mn>${n}</mn></mfrac>`)}})),Au(new Su("latex",{processor:function(t){return"braille"===N.getInstance().modality&&"euro"===N.getInstance().locale||console.info("LaTeX input currently only works for Euro Braille output. Please use the latex-to-speech package from npm for general LaTeX input to SRE."),Ou("speech",`<math data-latex="${t}"></math>`)}}));var bu=function(t,e,n,r){return new(n||(n=Promise))((function(s,o){function i(t){try{a(r.next(t))}catch(t){o(t)}}function c(t){try{a(r.throw(t))}catch(t){o(t)}}function a(t){var e;t.done?s(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(i,c)}a((r=r.apply(t,e||[])).next())}))};E.u.VERSION;function Lu(t){return bu(this,void 0,void 0,(function*(){return mc(t)}))}function Mu(){const t=["mode"].concat(N.STRING_FEATURES,N.BINARY_FEATURES),e=N.getInstance(),n={};return t.forEach((function(t){n[t]=e[t]})),n.json=p.f.jsonPath,n.xpath=p.f.WGXpath,n.rules=e.ruleSets.slice(),n}function yu(){return bu(this,void 0,void 0,(function*(){return Lu({}).then((()=>S.getall()))}))}const _u=ic;function Pu(t){return Uu("speech",t)}function Fu(t){return Uu("enriched",t)}function Uu(t,e){return Ou(t,e)}const xu={};function Du(t,e,n){switch(N.getInstance().mode){case s.ASYNC:return function(t,e,n){return bu(this,void 0,void 0,(function*(){const r=yield p.f.fs.promises.readFile(e,{encoding:"utf8"}),s=Cu(t,r);if(n)try{p.f.fs.promises.writeFile(n,s)}catch(t){throw new g("Can not write to file: "+n)}return s}))}(t,e,n);case s.SYNC:return function(t,e,n){const r=function(t){let e;try{e=p.f.fs.readFileSync(t,{encoding:"utf8"})}catch(e){throw new g("Can not open file: "+t)}return e}(e),s=Cu(t,r);if(n)try{p.f.fs.writeFileSync(n,s)}catch(t){throw new g("Can not write to file: "+n)}return s}(t,e,n);default:throw new g(`Can process files in ${N.getInstance().mode} mode`)}}xu.toSpeech=function(t,e){return Du("speech",t,e)},xu.toSemantic=function(t,e){return Du("semantic",t,e)},xu.toJson=function(t,e){return Du("json",t,e)},xu.toDescription=function(t,e){return Du("description",t,e)},xu.toEnriched=function(t,e){return Du("enriched",t,e)};p.f.documentSupported?Lu({mode:s.HTTP}).then((()=>Lu({}))):Lu({mode:s.SYNC}).then((()=>Lu({mode:s.ASYNC})));const vu=new Map;var wu,Bu=function(t,e,n,r){return new(n||(n=Promise))((function(s,o){function i(t){try{a(r.next(t))}catch(t){o(t)}}function c(t){try{a(r.throw(t))}catch(t){o(t)}}function a(t){var e;t.done?s(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(i,c)}a((r=r.apply(t,e||[])).next())}))};!function(t){t.locales=E.u.LOCALES,t.sreReady=yu,t.setupEngine=Lu,t.engineSetup=Mu,t.toEnriched=Fu,t.toSpeech=Pu,t.clearspeakPreferences=Kl,t.getHighlighter=_l,t.updateHighlighter=Pl,t.getSpeechGenerator=cu,t.parseDOM=y,t.preloadLocales=function(t){return Bu(this,void 0,void 0,(function*(){const e=vu.get(t);return e?new Promise(((t,n)=>t(JSON.stringify(e)))):_u()(t)}))}}(wu||(wu={}));const ku=wu.sreReady;N.getInstance().delay=!0;const Gu=wu;MathJax.loader&&MathJax.loader.checkVersion("a11y/sre","4.0.0-beta.7","a11y"),n({_:{a11y:{sre:t}}});const Vu=MathJax._.components.package,$u=(Vu.PackageError,Vu.Package);if(MathJax.startup){let t=$u.resolvePath("[sre]",!1);if("undefined"!=typeof window)window.SREfeature={json:t};else{try{t=MathJax.config.loader.require.resolve(t+"/base.json").replace(/\/base\.json$/,"")}catch(t){}global.SREfeature={json:t}}}MathJax.startup&&(("undefined"!=typeof window?window:global).SREfeature.custom=t=>wu.preloadLocales(t))})()})();