var e=window.codapi??{};e.version="0.19.6";e.engines=e.engines??{};e.settings=e.settings??{};window.codapi=e;var m=class extends HTMLElement{connectedCallback(){this.ready||(e.settings.url=this.getAttribute("url"),this.ready=!0)}attributeChangedCallback(n,s,o){e.settings[n]=o}};window.customElements.get("codapi-settings")||customElements.define("codapi-settings",m);var i={lua:{program:"lua",repo:"https://github.com/nalgeon/lua-wasi",path:"https://unpkg.com/@antonz/lua-wasi@5.4.6/dist",file:"lua.wasm"},php:{program:"php",repo:"https://github.com/nalgeon/php-wasi",path:"https://unpkg.com/@antonz/php-wasi@8.2.6/dist",file:"php-cgi.wasm"},python:{program:"python",repo:"https://github.com/nalgeon/python-wasi",path:"https://unpkg.com/@antonz/python-wasi@3.12.0/dist",file:"python.wasm"},ruby:{program:"ruby",repo:"https://github.com/nalgeon/ruby-wasi",path:"https://unpkg.com/@antonz/ruby-wasi@3.2.2/dist",file:"ruby.wasm"},sqlite:{program:"sqlite3",repo:"https://github.com/nalgeon/sqlite-wasi",path:"https://unpkg.com/@antonz/sqlite-wasi@3.44.2/dist",file:"sqlite.wasm"}};var p={lua:{run:{steps:[{box:"lua",stdin:!0,entry:"main.lua",args:["-e","main.lua"]}]}},php:{run:{steps:[{box:"php",entry:"main.php",args:["--no-header","--no-php-ini","/src/main.php"]}]}},python:{run:{steps:[{box:"python",entry:"main.py",args:["/src/main.py"]}]}},ruby:{run:{steps:[{box:"ruby",entry:"main.rb",args:["/src/main.rb"]}]}},sqlite:{run:{steps:[{box:"sqlite",stdin:!0,entry:"main.sql",args:["-box",":memory:","main.sql"]}]}}};var{WASI:w}=window.Runno,u={},b=new URL(z()).searchParams.get("path");async function d(t){if(!(t in i))throw Error(`unknown box: ${t}`);if(t in u)return u[t];let n=i[t],s=b||n.path,o=await R(`${s}/${n.file}`);return u[t]=()=>new Response(o,{status:200,headers:{"content-type":"application/wasm"}}),u[t]}async function h(t){try{let n,s=y(t);for(let o of s.steps)if(x(o,t),n=await k(o,t),!n.ok)break;return n}catch(n){return{ok:!1,duration:0,stdout:"",stderr:n.toString()}}}function y(t){if(!(t.sandbox in p))throw Error(`unknown sandbox: ${t.sandbox}`);if(!(t.command in p[t.sandbox]))throw Error(`unknown command: ${t.sandbox}.${t.command}`);return p[t.sandbox][t.command]}function x(t,n){return""in n.files&&(n.files[t.entry]=n.files[""],delete n.files[""]),n}async function k(t,n){let s=i[t.box],o=await d(t.box),r=E(t,n),a=$(n);return await S(s,o,r,a)}function E(t,n){return t.stdin?t.args.map(s=>s==t.entry?n.files[t.entry]:s):t.args}function $(t){let n={},s=new Date;for(let o in t.files){let r=`/src/${o}`;n[r]={path:r,timestamps:{access:s,change:s,modification:s},mode:"string",content:t.files[o]}}return n}async function S(t,n,s,o){let r=[],a=[],l=new Date,f=await w.start(n(),{args:[t.program,...s],stdout:c=>r.push(c),stderr:c=>a.push(c),fs:o}),g=new Date-l;return{ok:f.exitCode==0,elapsed:g,stdout:r.join(""),stderr:a.join("")}}async function R(t){let n=await fetch(t);if(!n.ok)throw new Error(`${t}: http status ${n.status}`);let s=await n.arrayBuffer();return new Uint8Array(s)}function z(){return typeof import.meta<"u"&&import.meta.url?import.meta.url:document.currentScript.src}e.engines={...e.engines,wasi:{init:d,exec:h}};var U={init:d,exec:h};export{U as default};
