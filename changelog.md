# Revision History for Decker

## decker 0.14.0

- Accessibility Improvements:
    - Decks:
        - Improved keyboard-navigation in navigation and feedback menu:
            - Elements are semantically grouped
            - TAB navigates between groups
            - Arrow keys navigate inside the group
            - Inside the feedback menu, each message is selectable and selecting a message allows usage of the buttons for the message
            - Touch and mouse interaction is unaffected
        - The feedback menu icon is now a speech bubble to make it clearer that it is a tool for conversation
        - The fullscreen button of an embedded document is now always visible
        - The handout mode now allows for proper scrolling with the arrow keys
        - The handout mode now displays conversations from the feedback menu beneath each slide if they exist
        - The title of a slide now contains a hidden counter to inform screenreaders on which slide they are on
        - A slide with additional whiteboard pages can now be scrolled through with Arrow Up/Down, Page Up/Down and Space, if focused or if focus is inside the scrollable slide - usual trappings of iframes within the slide stay and are subject to the designer of the embedded element.
        - Added localisation to several interface elements, most notably the whiteboard plugin
        - Small changes to the "continue where you left" dialog:
            - The dialog now stays onscreen until the user interacts with it or the slides so slow readers can process its message
            - The dialog options are now focused automatically when the slides are opened and the TAB key is trapped until the user does anything: Any other button or interaction with the slides closes the dialog as usual
        - Keyboard strokes that are not handled by the integrated presentation video are no longer suppressed
    - Index:
        - Added option for a color theme swapper to the index
        - Inserted icons to different display modes of the linked decks are now modal so keyboard uses don't have to skip through several links to get to the next deck in the table:
            - TAB focuses on the link group
            - Enter selects the link group
            - Right and Left Arrow keys navigate between link options
            - Up and Down Arrow keys navigate between rows
        - Improved keyboard navigation of the fuzzy-search:
            - Entering terms now updates a label that displays the search result amount
            - Submitting the term navigates keyboard focus into the display to move on from there
        - Added the boolean option 'index.manual' to insert a default manual to the tudo-resource pack
        - Added the boolean option 'index.search' to insert the fuzzy-search details element to any index by default
        - Added the boolean options 'index.searchShowsDeckTitle' and 'index.searchShowsDeckSubtitle' to indicate how fuzzy-search results should be displayed.
        - Several changes to the look and feel of the autogenerated index

- Search Plugin Improvements:
    - Fixed several bugs
    - Added several interface elements:
        - Added a display for the amount of search results
        - Added navigation buttons to move forwards and backwards
        - Added a close button

- Functionality changes:
    - Screen recording can only be started when in presenter mode

- Upgrade MathJax to version 4.0
    - Offers better accessibility features, which are enabled if slides are opened in a11y-mode
    - Allows to choose between several fonts in YAML, see also
      [here](https://docs.mathjax.org/en/latest/output/fonts.html). The font can be
      selected in YAML, the default is `newcm`, which is also MathJax4's new default.
      The previous font of MathJax3 is `tex`. Other options are `fira` and `asana`.
``` yaml
math:
  font: newcm  # other options are "tex", "fila", and "asana"
```

- Add a new "quizzer" plugin:
    - Handles divs that have the following classes akin to the quiz-wue plugin:
        -  `.quizzer`, `.quizzer.choice`, `.quizzer-choice`, `.quizzer-mc`, `.quizzer-multiple-choice`,
        - `.quizzer.selection`, `.quizzer-selection`, `.quizzer-ic`, `.quizzer-item-choice`,
        - `.quizzer.assignment`, `.quizzer-assignment`, `.quizzer-match-items`, `.quizzer-mi`,
        - `.quizzer.freetext`, `.quizzer-freetext`, `.quizzer-free-text`, `.quizzer-ft`,
    - These correspond to the quiz types:
        - Multiple-Choice (Buttons)
        - Selection (Drop-Down-Menu)
        - Assignment (Drag & Drop or Click & Assign)
        - Freetext (Text Input)
    - Renders interactive elements similar to the old quiz-wue plugin to the page:
        - The plugin tries to imitate the old behavior as best as possible, though the old plugin has some unexpected behavior that causes especially nested markdown code to not be handled at all by the old filters.
    - Interacts with a new quizzer backend, hosted on [quiz.jetzt](quiz.jetzt).
    - Presenter Mode allows for polling the audience with all 4 quiz types:
        - Has a connection indicator that tells the host if the connection is established.
        - Broken connections can be reestablished thanks to `socket.io` sockets.
        - Starting a poll displays two QR-Codes to the side:
            - Hover to enlarge and display quiz ID
            - Click to display very large QR-Code in the center of the screen
        - Poll results are available for all quiz types:
            - Multiple-Choice: Single Bar-Chart
            - Selection: One Bar-Chart per Select-Box
            - Assignemnt: Sankey-Diagram
            - Freetext: Word-Cloud
        - Sound cues can be configured with the quizzer.audio.start, .loop and .end configurations:
            - The string `'default'` selects the built-in audio files.
            - Expects a path to the audio file to be played at the beginning, loop or end of a poll.
            - `volume` can be configured to change the volume of the sound cues.
    - Configuration of plugin is available thus:
``` yaml
quizzer:
  url: 'https://quiz.jetzt'
  audio:
    start: 'default'
    loop: 'default'
    end: 'default'
    volume: 0.75
```

- External tools can now be configured in the decker.yaml:
    - Each external tool can be directly configured for all operating systems or have individual cases for `windows`, `linux` and `macos`.
    - The configuration of each tool defines the command to execute the external program call and the list of arguments to be passed to the called program.
    - Each argument should be its own entry in the arguments list.
    - You can use the placeholders `${input}` and `${output}` to pass the file names in the argument list.
    - As an example, here is the default configuration of calling the external gnuplot tool:
``` yaml
external-tools:
  gnuplot:
    command: "gnuplot"
    arguments:
      - "-d"
      - "-e"
      - "set terminal svg"
      - "-e"
      - "set output '${output}'"
      - "${input}"
```
    - Each tool is either called during conversion from markdown to html or triggered by an explicit operation of decker:
        - rsync: Called by `decker publish` to transfer files from the local machine to a remote host.
        - gnuplot: Called during markdown compilation to pre-render a code-block marked by `.render .gnuplot`.
        - plantuml: Called during markdown compilation to pre-render a code-block marked by `.render .plantuml`.
        - mermaid: Called during markdown compilation to pre-render a code-block marked by `.render .mermaid`.
        - dot: Called during markdown compilation to pre-render a code-block marked by `.render .dot`.
        - pdflatex: Called during markdown compilation to pre-render a code-block marked by `.render .tex`.
        - chrome: Program used to trigger a print-to-pdf call of the slides.
        - mp4towav: Program used by `decker transcribe` to convert existing `.mp4`-recordings to `.wav` so `whisper` can accept the recordings for transcription.
        - whisper: Program used to generate subtitles for the recordings by `decker transcribe` as well as perform automatic translation to english for these subtitles.
        - tomp4-copy: Program used by `decker crunch` to transcode `.webm` files to `.mp4` files.
        - tomp4-transcode: Program used by `decker crrrunch` to transcode `.webm` files to `.mp4` files while also doing several codec transformations.
        - tomp4-concat: Program used by `decker crunch` to concatenate multiple recordings to a single file.
    - The input and output of the rendered-code-block programs are temporary files that are copied to their final destination after conversion.
  
- Palette for charts can now be defined in YAML in `chart.colors`. 
  For this to work, disable the color plugin of Chart.js.
  ``` yaml
  chart:
    colors:
      - #ff0000
      - #00ff00
      - #00ff00
    defaults:
      plugins:
        colors:
          enabled: false
  ```

- The colorscheme ("light" or "dark") can now be enforced in YAML. Simply add
    ``` yaml
    colorscheme: "light"
    ```
    or `colorscheme: "dark"` to your YAML settings.

-   The feedback menu now has a "send" button.
-   The admin login button in the feedback menu is now clearly visible and also has a button to send the login request.

- Add a legend to the feedback menu that is only visible on mobile devices (small screens).
-   Decks can now be accessed in Presenter, Handout and A11Y Mode directly
    by appending ?presenter, ?handout or ?a11y to the deck's url.

-   The index page can now insert direct links to Presenter, Handout or A11Y
    Mode.
    Which of these is displayed can be configured with:

    ``` yaml
    index:
      progress: true
      links:
        - a11y
        - handout
        - presenter
    ```

-   Handout Mode now supports zooming by the (-)/(+) buttons in the
    top right corner. In addition, if the slides are zoomed away from,
    they center while if they are
    zoomed in they attach to the left side of the screen to properly
    allow scrolling the page. (Previously they fell out of the left side
    of the viewport).

-   All modes (presenter, handout, a11y) as well as functions accessible
    only by keyboard inputs (recorder) are now accessible through buttons
    in the main navigation menu. This solves the issue of some lecture
    halls not providing a keyboard.

-   The settings menu has been removed and replaced by a single
    light / dark mode switch.

-   Zooming in/out of a slide element is by default triggered via 
    double-click (left mouse button). It can now be configured to react on 
    double-click, triple-click, or alt-click (alt-key and left mouse).

    ``` yaml
    zoom:
      trigger: { "doubleClick" | "tripleClick" | "altClick" }
    ```

-   Decker slides can now be installed as progressive web apps (PWAs). We don't
    cache the content locally, so consumers of published slides still need
    internet connection. But the PWA mechanism allows to add slides to the
    home-screen (for iOS) or as an app shortcut (Chrome, Safari).

-   The whiteboard can now be configured to automatically switch on (when a
    pen-hover is detected) and off (two seconds after pen-up event). While it is
    convenient not having to toggle the whiteboard manually, it also means that
    one cannot use a pen to interact with elements on the slide. By default this
    feature is disabled. To enable, use this setting:

    ``` yaml
    whiteboard:
      autotoggle: true
    ```

-   Remove inert polyfill, since the inert feature is now supported in
    up-to-date browsers.

-   `column-1-2-3` DIV style columns are now detected recursively.

-   Files can be excluded from file watching using glob patterns:

    ``` yaml
    watch:
        exclude: 
            - "**/*.swp"
            - "**/~*"
    ```

-   The new command `decker transcribe` transcribes all recorded videos to
    `.vtt` files that are available with the integrated video player. The
    recorded language must be configured explicitly, default is German. By
    default, both German and English subtitles will be generated. In order to
    use this, install [whisper.cpp](https://github.com/ggerganov/whisper.cpp).
    On MacOS, we recommend installing it via homebrew:

    ``` bash
    brew install whisper.cpp
    ```

    In addition, download the language model from 
    [here](https://huggingface.co/ggerganov/whisper.cpp/tree/main).
    We recommend the model `ggml-large-v3.bin`, which by default should be
    installed in `/opt/whisper/ggml-large-v3.bin`.
    Those are the configuration options:

    ``` yaml
    # whisper.cpp default transcription settings
    whisper:
      # path to the (big) language model
      model: /opt/whisper/ggml-large-v3.bin
      # the recorded language (e.g., "de" or "en")
      lang: de 
    ```

-   Move `rsync` configuration entirely to `decker.yaml`.

    This will certainly break projects that define their own rsync options. They
    will have to add the removed options to their local rsync options list:

    ``` yaml
    publish:
    rsync:
        options:
        - "--recursive"
        - "--copy-links"
        - "--delete"
        ...
    ```

-   The title attribute on links and images is used as the `aria-label`, there
    are no more tooltips on links and images.

-   The title slide can now be extensively customized with multiple authors,
    institutions and logos. For example:

    ``` yaml
    authors:
    - name: 'First Author'
        url: 'https://example.com/first'
        affiliation: # 'First Department'
        name: 'First Department'
        url: 'https://example.com/first-dep'
        logo: '/test/decks/assets/dummy-long.png'
    - name: 'Second Author'
        url: 'https://example.com/second'
        affiliation: 'Second Department'
    - 'Third Author'
    ```

-   The use of `highlight.js` for code syntax highlighting is no longer
    supported. Use Pandoc highlighting by setting `highlight-style:` to
    something. To see supported highlight styles do

    ``` sh
    pandoc --list-highlight-styles
    ```

-   3D *glTF* files (https://www.khronos.org/gltf/) can now be embedded using
    Googles *model-viewer* (https://modelviewer.dev/):

    ``` md
    ![Expressive Robot (with autoplay)](assets/robot.glb){autoplay=1}
    ```

-   Decks can be switched to *handout mode* during presentation. All slides will
    be shown in one linearly scrollable HTML document view. Special handout
    versions of decks are no longer created by default.

-   Static resources can now be listed as file or directory paths in the
    variable `static-resources`. Directories are traversed recursively, adding
    all contained files to the list.

-   *Examiner* style poll (the ones loaded from YAML files) results can now be
    saved if running off a local Decker server (`decker -S`). They are stored in
    `*-poll.json` files alongside the presentation sources. Enable with:

    ``` yaml
    save-polls: true
    ```

-   Always generate an index document. If a custom `index.md` is present, the
    generated index is stored as `generated-index.html` alongside the custom
    `index.html`.

## decker 0.13.0

-   Use OKSolar (https://meat.io/oksolar) as default palette for resource pack
    `mono`.

-   Add syntax extensions from Kate (https://kate-editor.org/syntax/) for
    built-in code highlighting by through meta variable
    `extra-highlight-syntax`. For example:

    ``` yaml
    extra-highlight-syntax:
      Asm6502: asm6502.xml
    ```

-   Better messages for errors during template compilation.

-   Save whiteboard annotation when recording stops (`zzz`) and also save them
    to the local download folder.

-   Embed Geogebra (https://www.geogebra.org) apps using standard image
    notation. For Example:

    ``` markdown
    ![Interactive Geogebra](gradient.ggb)
    ```

-   Automatically open recording panel after initiating recording mode ('r').

-   Defer device search until after initiation of recording mode ('r').

-   Block quotes can now have captions and are layouted as a standard media
    element. For example:

    ``` markdown
    > The answer is 42.

    Caption: Douglas Adams, *The Hitchhikers Guide to the Galaxy*
    ```

-   Add the new `nwburg` resource pack containing the JMU templates and styles.

-   Various fixes and enhancements to the `tudo` resource pack.

-   Handle palettes of arbitrary size. The lower half of the palette is treated
    as shades, the upper half as accents.

-   Removed files (like `*-annot.json`) are now also removed from `public`.

-   Add `decker purge` command. There two cleanup commands now:

    -   `decker clean` - removes `public`.
    -   `decker purge` - also removes `.decker` (which contains crunched MP4s)

-   Rename: `decker-engine` is now `feedback`.

-   Handouts are not built by default anymore. Use `decker handouts` explicitly.

-   Additional math macros have been removed from the default resource pack. Use
    your favorite resource pack or `decker.yaml` to define them.

-   Decks that have `draft: true` or whose deck ids are the `no-index:` list are
    removed from the search index.

-   Use GPL-3.0 license.

-   Add the `tudo` resource pack.

-   Add template macros. For example:

    ``` yaml
    assign: |
      <a class="index-name" title="HTML Seite" href="assignments/:(url)-page.html">:(title)
      <i class="fas fa-file-code"></i></a>
    ```

    can be invoked as

    ``` markdown
    [@assign](a05 "Aufgabe 5")
    ```

    and yields

    ``` markdown
    <a class="index-name" title="HTML Seite" href="assignments/a05-page.html">Aufgabe 5<i class="fas fa-file-code"></i></a>
    ```

-   Add dynamic Lua filters for the Pandoc AST. For example:

``` yaml
pandoc:
  filters:
    before:
    - upcase-h1.lua
```

with `upcase-h1.lua` containing:

``` lua
local text = pandoc.text

function Header(el)
    if el.level == 1 then
      return el:walk {
        Str = function(el)
            return pandoc.Str(text.upper(el.text))
        end
      }
    end
end
```

transforms:

``` markdown
# A Lua Plugin {.columns}
```

to:

``` markdown
# A LUA PLUGIN {.columns}
```

-   Use *Scotty* instead of *Snap* as a webserver.

-   Add a separate `template/index.html` template and `support/css/index.css`
    for the index page.

-   Render blocks and DIVs with class `details` as
    `<detail><summary> ... </summary> ... </detail>`

-   Whiteboard uses all 16 palette colors in light and dark mode. The whiteboard
    button is only shown in presenter mode.

-   There is a presenter mode now (toggle with `ppp`). Currently enables the
    following:

    -   Arm the recording key (\`\`).
    -   Show the whiteboard button.
    -   Start a quiz session with the quiz server, if configured.

-   Panndocs footnotes are now rendered at the end of the slide, wrapped in a
    DIV with class `footnotes`.

-   Many, many bugs have been fixed all around.
